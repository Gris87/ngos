#!/bin/bash
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
#    PARAMETERS                                                                                                                                                                                          # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
WORKING_DIR=`pwd`                                                                                                                                                                                        # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
#    PROCESSING                                                                                                                                                                                          # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo -e "\e[36m==================================================\e[0m"                                                                                                                                  # Colorize: green
echo -e "\e[36m               Test: Symbols size\e[0m"                                                                                                                                                   # Colorize: green
echo -e "\e[36m==================================================\e[0m"                                                                                                                                  # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
cd ../../                                                                                                                                                                                                # Colorize: green
                                                                                                                                                                                                         # Colorize: green
for elf_file in `find -name \*.elf`                                                                                                                                                                      # Colorize: green
do                                                                                                                                                                                                       # Colorize: green
    EMPTY_SYMBOLS=`readelf -s ${elf_file} | grep -E -e " *[0-9]+: +[0-9a-f]+ +0 +[A-Z]+ +GLOBAL" | grep -v " _"`                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
    if [ "${EMPTY_SYMBOLS}" != "" ]; then                                                                                                                                                                # Colorize: green
        echo "Symbols with zero size found in ELF file: ${elf_file}"                                                                                                                                     # Colorize: green
        echo "${EMPTY_SYMBOLS}"                                                                                                                                                                          # Colorize: green
                                                                                                                                                                                                         # Colorize: green
        cd ${WORKING_DIR}/                                                                                                                                                                               # Colorize: green
                                                                                                                                                                                                         # Colorize: green
        exit 1                                                                                                                                                                                           # Colorize: green
    fi                                                                                                                                                                                                   # Colorize: green
done                                                                                                                                                                                                     # Colorize: green
                                                                                                                                                                                                         # Colorize: green
cd ${WORKING_DIR}/                                                                                                                                                                                       # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo "OK"                                                                                                                                                                                                # Colorize: green
                                                                                                                                                                                                         # Colorize: green
exit 0                                                                                                                                                                                                   # Colorize: green
