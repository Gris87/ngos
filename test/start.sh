#!/bin/bash
                                                                                                                                                                                                         # Colorize: green
# This script starts kernel testing                                                                                                                                                                      # Colorize: green
# Author: Maxim Shvecov                                                                                                                                                                                  # Colorize: green
# Usage: ./start.sh                                                                                                                                                                                      # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
#    PARAMETERS                                                                                                                                                                                          # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
CURRENT_PATH=`pwd`                                                                                                                                                                                       # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
#    PROCESSING                                                                                                                                                                                          # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo -e "\e[94mTesting started\e[0m"                                                                                                                                                                     # Colorize: green
                                                                                                                                                                                                         # Colorize: green
mkdir logs/ 2> /dev/null                                                                                                                                                                                 # Colorize: green
                                                                                                                                                                                                         # Colorize: green
for file in tests/*.sh;                                                                                                                                                                                  # Colorize: green
do                                                                                                                                                                                                       # Colorize: green
    SHELL_SCRIPT=`basename "${file}"`                                                                                                                                                                    # Colorize: green
    TEST_NAME=`echo "${SHELL_SCRIPT}" | sed -r "s/\.sh$//g"`                                                                                                                                             # Colorize: green
    TEST_NAME_LENGTH=${#TEST_NAME}                                                                                                                                                                       # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
    printf "%s...%$((40 - TEST_NAME_LENGTH))s" "${TEST_NAME}" ""                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
    cd tests/                                                                                                                                                                                            # Colorize: green
    "./${SHELL_SCRIPT}" > "../logs/${TEST_NAME}.log" 2>&1                                                                                                                                             # Colorize: green
    EXIT_CODE=$?                                                                                                                                                                                         # Colorize: green
    cd ${CURRENT_PATH}/                                                                                                                                                                                  # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
    if [ ${EXIT_CODE} -ne 0 ]; then                                                                                                                                                                      # Colorize: green
        echo -e "[\e[31mError\e[0m]"                                                                                                                                                                     # Colorize: green
        echo ""                                                                                                                                                                                          # Colorize: green
                                                                                                                                                                                                         # Colorize: green
        cat "logs/${TEST_NAME}.log"                                                                                                                                                                   # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
        exit ${EXIT_CODE}                                                                                                                                                                                # Colorize: green
    fi                                                                                                                                                                                                   # Colorize: green
                                                                                                                                                                                                         # Colorize: green
    echo -e "[\e[32mOK\e[0m]"                                                                                                                                                                            # Colorize: green
done                                                                                                                                                                                                     # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
exit 0                                                                                                                                                                                                   # Colorize: green
