#include "console.h"                                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <com/ngos/shared/common/assets/assets.h>                                                                                                                                                        // Colorize: green
#include <com/ngos/shared/common/assets/lib/glyphdata.h>                                                                                                                                                // Colorize: green
#include <com/ngos/shared/common/graphics/rgbapixel.h>                                                                                                                                                   // Colorize: green
#include <com/ngos/shared/common/log/assert.h>                                                                                                                                                           // Colorize: green
#include <com/ngos/shared/common/log/log.h>                                                                                                                                                              // Colorize: green
#include <com/ngos/shared/common/memory/memory.h>                                                                                                                                                        // Colorize: green
#include <com/ngos/shared/common/printf/printf.h>                                                                                                                                                        // Colorize: green
#include <com/ngos/shared/uefibase/uefi/uefi.h>                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define CHAR_HEIGHT   20                                                                                                                                                                                 // Colorize: green
#define SIDE_MARGIN   1                                                                                                                                                                                  // Colorize: green
#define BOTTOM_MARGIN 5                                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
UefiGraphicsOutputProtocol *Console::sScreenGop;                                                                                                                                                         // Colorize: green
RgbaPixel                  *Console::sLineBuffer;                                                                                                                                                    // Colorize: green
good_I64                    Console::sLineBufferSize;                                                                                                                                                // Colorize: green
good_I64                    Console::sPositionX;                                                                                                                                                        // Colorize: green
GlyphOffset                *Console::sGlyphOffsets;                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#ifndef BUILD_TARGET_KERNEL // Defined in pro file                                                                                                                                                                                                         // Colorize: green
NgosStatus Console::init(BootParams *params)                                                                                                         // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    COMMON_LT((" | params = 0x%p", params));                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    COMMON_ASSERT(params != nullptr, "params is null", NgosStatus::ASSERTION);                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Setup global variables                                                                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        COMMON_TEST_ASSERT(params->screensCount > 0, NgosStatus::ASSERTION);                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        sScreenGop = params->screens[0];                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        sLineBufferSize = sScreenGop->mode->info->horizontalResolution * (CHAR_HEIGHT + BOTTOM_MARGIN) * sizeof(RgbaPixel);                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (UEFI::allocatePool(UefiMemoryType::LOADER_DATA, sLineBufferSize, (void **)&sLineBuffer) != UefiStatus::SUCCESS)                                                                              // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            COMMON_LF(("Failed to allocate pool(%d) for line buffer", sLineBufferSize));                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return NgosStatus::OUT_OF_MEMORY;                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        COMMON_LVV(("Allocated pool(0x%p, %d) for line buffer", sLineBuffer, sLineBufferSize));                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        sPositionX = SIDE_MARGIN;                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        AssetEntry *asset = Assets::getAssetEntry("glyphs/console.bin");                                                                                                                                 // Colorize: green
        COMMON_TEST_ASSERT(asset != nullptr, NgosStatus::ASSERTION);                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        sGlyphOffsets = reinterpret_cast<GlyphOffset *>(asset->content);                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Clean buffer for last line                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        memzero(sLineBuffer, sLineBufferSize);                                                                                                                                                   // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill screen with black color                                                                                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        COMMON_ASSERT_EXECUTION(sScreenGop->blt(sScreenGop,                                                                                                                                              // Colorize: green
                                                reinterpret_cast<UefiGraphicsOutputBltPixel *>(sLineBuffer),                                                                                         // Colorize: green
                                                UefiGraphicsOutputBltOperation::VIDEO_FILL,                                                                                                              // Colorize: green
                                                0, 0,                                                                                                                                                    // Colorize: green
                                                0, 0,                                                                                                                                                    // Colorize: green
                                                sScreenGop->mode->info->horizontalResolution,                                                                                                            // Colorize: green
                                                sScreenGop->mode->info->verticalResolution,                                                                                                              // Colorize: green
                                                0),                                                                                                                                                      // Colorize: green
                                UefiStatus, UefiStatus::SUCCESS, NgosStatus::ASSERTION);                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return NgosStatus::OK;                                                                                                                                                                               // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
#endif                                                                                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
NgosStatus Console::init()                                                                                                                                                                               // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    COMMON_LT((""));                                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Validation                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        COMMON_TEST_ASSERT(sScreenGop      != nullptr,     NgosStatus::ASSERTION);                                                                                                                   // Colorize: green
        COMMON_TEST_ASSERT(sLineBuffer     != nullptr,     NgosStatus::ASSERTION);                                                                                                                   // Colorize: green
        COMMON_TEST_ASSERT(sLineBufferSize >  0,           NgosStatus::ASSERTION);                                                                                                                   // Colorize: green
        COMMON_TEST_ASSERT(sPositionX      == SIDE_MARGIN, NgosStatus::ASSERTION);                                                                                                                   // Colorize: green
        COMMON_TEST_ASSERT(sGlyphOffsets   != nullptr,     NgosStatus::ASSERTION);                                                                                                                   // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Update position of glyphs                                                                                                                                                                         // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        AssetEntry *asset = Assets::getAssetEntry("glyphs/console.bin");                                                                                                                                 // Colorize: green
        COMMON_TEST_ASSERT(asset != nullptr, NgosStatus::ASSERTION);                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        sGlyphOffsets = reinterpret_cast<GlyphOffset *>(asset->content);                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return NgosStatus::OK;                                                                                                                                                                               // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
NgosStatus Console::print(good_Char8 ch)                                                                                                                                                                      // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // COMMON_LT((" | ch = %c", ch)); // Commented to avoid bad looking logs                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    COMMON_ASSERT(sScreenGop != nullptr, "sScreenGop is null", NgosStatus::ASSERTION);                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (ch == '\n')                                                                                                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        COMMON_ASSERT_EXECUTION(newLineWithoutCaretReturn(), NgosStatus::ASSERTION);                                                                                                                     // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
    else                                                                                                                                                                                                 // Colorize: green
    if (ch == '\r')                                                                                                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        sPositionX = SIDE_MARGIN;                                                                                                                                                                       // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
    else                                                                                                                                                                                                 // Colorize: green
    if (ch >= 0x20 && ch < 0x7F)                                                                                                                                                                         // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        GlyphData *glyphData = reinterpret_cast<GlyphData *>(reinterpret_cast<good_U8 *>(sGlyphOffsets) + sGlyphOffsets[ch - 0x20].offset);                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Go to next line when we are on the edge                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            if (sPositionX + glyphData->width > sScreenGop->mode->info->horizontalResolution - SIDE_MARGIN)                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                COMMON_ASSERT_EXECUTION(newLine(), NgosStatus::ASSERTION);                                                                                                                               // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        good_I64  charPosX   = sPositionX + glyphData->bitmapLeft;                                                                                                                                      // Colorize: green
        good_I64  charPosY   = CHAR_HEIGHT - glyphData->bitmapTop;                                                                                                                                       // Colorize: green
        good_U8  *bitmapByte = glyphData->bitmap;                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Validation                                                                                                                                                                                    // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            COMMON_TEST_ASSERT(charPosX                           >= 0,                                            NgosStatus::ASSERTION);                                                               // Colorize: green
            COMMON_TEST_ASSERT(charPosX + glyphData->bitmapWidth  <= sScreenGop->mode->info->horizontalResolution, NgosStatus::ASSERTION);                                                               // Colorize: green
            COMMON_TEST_ASSERT(charPosY                           >= 0,                                            NgosStatus::ASSERTION);                                                               // Colorize: green
            COMMON_TEST_ASSERT(charPosY + glyphData->bitmapHeight <= CHAR_HEIGHT + BOTTOM_MARGIN,                  NgosStatus::ASSERTION);                                                               // Colorize: green
            COMMON_TEST_ASSERT(glyphData->bitmapHeight            <= CHAR_HEIGHT,                                  NgosStatus::ASSERTION);                                                               // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (good_I64 i = 0; i < glyphData->bitmapHeight; ++i)                                                                                                                                           // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            for (good_I64 j = 0; j < glyphData->bitmapWidth; ++j)                                                                                                                                        // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                RgbaPixel *pixel;                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                // Take pixel to update                                                                                                                                                                  // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    pixel = &sLineBuffer[(charPosY + i) * sScreenGop->mode->info->horizontalResolution + charPosX + j];                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    COMMON_TEST_ASSERT(pixel >= sLineBuffer,                                           NgosStatus::ASSERTION);                                                                           // Colorize: green
                    COMMON_TEST_ASSERT(pixel <= sLineBuffer + sLineBufferSize / sizeof(RgbaPixel) - 1, NgosStatus::ASSERTION);                                                                           // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                // Update pixel color                                                                                                                                                                    // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    good_U8 greyColor = *bitmapByte;                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    pixel->red   = greyColor;                                                                                                                                                            // Colorize: green
                    pixel->green = greyColor;                                                                                                                                                            // Colorize: green
                    pixel->blue  = greyColor;                                                                                                                                                            // Colorize: green
                    pixel->alpha = 0xFF;                                                                                                                                                                 // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                ++bitmapByte;                                                                                                                                                                            // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        sPositionX += glyphData->width;                                                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
    else                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        COMMON_LW(("Non-printable character found: 0x%02X", ch));                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        return NgosStatus::UNEXPECTED_BEHAVIOUR;                                                                                                                                                         // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return NgosStatus::OK;                                                                                                                                                                               // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
NgosStatus Console::print(const good_Char8 *str)                                                                                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // COMMON_LT((" | str = 0x%p", str)); // Commented to avoid bad looking logs                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    COMMON_ASSERT(str != nullptr, "str is null", NgosStatus::ASSERTION);                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    while (*str != 0)                                                                                                                                                                                    // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (*str == '\n')                                                                                                                                                                                // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            COMMON_ASSERT_EXECUTION(newLine(), NgosStatus::ASSERTION);                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++str;                                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            continue;                                                                                                                                                                                    // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        COMMON_ASSERT_EXECUTION(print(*str), NgosStatus::ASSERTION);                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        ++str;                                                                                                                                                                                           // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return NgosStatus::OK;                                                                                                                                                                               // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
NgosStatus Console::println()                                                                                                                                                                            // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // COMMON_LT(("")); // Commented to avoid bad looking logs                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    COMMON_ASSERT_EXECUTION(newLine(), NgosStatus::ASSERTION);                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return NgosStatus::OK;                                                                                                                                                                               // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
NgosStatus Console::println(good_Char8 ch)                                                                                                                                                                    // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // COMMON_LT((" | ch = %c", ch)); // Commented to avoid bad looking logs                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    COMMON_ASSERT_EXECUTION(print(ch), NgosStatus::ASSERTION);                                                                                                                                           // Colorize: green
    COMMON_ASSERT_EXECUTION(newLine(), NgosStatus::ASSERTION);                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return NgosStatus::OK;                                                                                                                                                                               // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
NgosStatus Console::println(const good_Char8 *str)                                                                                                                                                            // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // COMMON_LT((" | str = 0x%p", str)); // Commented to avoid bad looking logs                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    COMMON_ASSERT(str != nullptr, "str is null", NgosStatus::ASSERTION);                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    COMMON_ASSERT_EXECUTION(print(str), NgosStatus::ASSERTION);                                                                                                                                          // Colorize: green
    COMMON_ASSERT_EXECUTION(newLine(),  NgosStatus::ASSERTION);                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return NgosStatus::OK;                                                                                                                                                                               // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
NgosStatus Console::noMorePrint()                                                                                                                                                                        // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    COMMON_LT((""));                                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    COMMON_TEST_ASSERT(sScreenGop  != nullptr, NgosStatus::ASSERTION);                                                                                                                               // Colorize: green
    COMMON_TEST_ASSERT(sLineBuffer != nullptr, NgosStatus::ASSERTION);                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    sScreenGop = nullptr;                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#ifndef BUILD_TARGET_KERNEL // Defined in pro file                                                                                                                                                       // Colorize: green
    if (UEFI::freePool(sLineBuffer) == UefiStatus::SUCCESS)                                                                                                                                          // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        COMMON_LVV(("Released pool(0x%p) for line buffer", sLineBuffer));                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
    else                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        COMMON_LE(("Failed to release pool(0x%p) for line buffer", sLineBuffer));                                                                                                        // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
#endif                                                                                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return NgosStatus::OK;                                                                                                                                                                               // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool Console::canPrint()                                                                                                                                                                                 // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // COMMON_LT(("")); // Commented to avoid too frequent logs                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return sScreenGop != nullptr;                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
NgosStatus Console::newLineWithoutCaretReturn()                                                                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // COMMON_LT(("")); // Commented to avoid bad looking logs                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    COMMON_ASSERT(sScreenGop != nullptr, "sScreenGop is null", NgosStatus::ASSERTION);                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Move screen memory to free memory for last line                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        COMMON_ASSERT_EXECUTION(sScreenGop->blt(sScreenGop,                                                                                                                                              // Colorize: green
                                                nullptr,                                                                                                                                                 // Colorize: green
                                                UefiGraphicsOutputBltOperation::VIDEO_TO_VIDEO,                                                                                                          // Colorize: green
                                                0, CHAR_HEIGHT + BOTTOM_MARGIN,                                                                                                                          // Colorize: green
                                                0, 0,                                                                                                                                                    // Colorize: green
                                                sScreenGop->mode->info->horizontalResolution,                                                                                                            // Colorize: green
                                                sScreenGop->mode->info->verticalResolution - CHAR_HEIGHT - BOTTOM_MARGIN,                                                                                // Colorize: green
                                                0),                                                                                                                                                      // Colorize: green
                                UefiStatus, UefiStatus::SUCCESS, NgosStatus::ASSERTION);                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Copy buffer of last line to screen                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        COMMON_ASSERT_EXECUTION(sScreenGop->blt(sScreenGop,                                                                                                                                              // Colorize: green
                                                reinterpret_cast<UefiGraphicsOutputBltPixel *>(sLineBuffer),                                                                                         // Colorize: green
                                                UefiGraphicsOutputBltOperation::BLT_BUFFER_TO_VIDEO,                                                                                                     // Colorize: green
                                                0, 0,                                                                                                                                                    // Colorize: green
                                                0, sScreenGop->mode->info->verticalResolution - CHAR_HEIGHT - BOTTOM_MARGIN,                                                                             // Colorize: green
                                                sScreenGop->mode->info->horizontalResolution,                                                                                                            // Colorize: green
                                                CHAR_HEIGHT + BOTTOM_MARGIN,                                                                                                                             // Colorize: green
                                                0),                                                                                                                                                      // Colorize: green
                                UefiStatus, UefiStatus::SUCCESS, NgosStatus::ASSERTION);                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Clean buffer for last line                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        memzero(sLineBuffer, sLineBufferSize);                                                                                                                                                   // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return NgosStatus::OK;                                                                                                                                                                               // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
NgosStatus Console::newLine()                                                                                                                                                                            // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // COMMON_LT(("")); // Commented to avoid bad looking logs                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    COMMON_ASSERT_EXECUTION(newLineWithoutCaretReturn(), NgosStatus::ASSERTION);                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    sPositionX = SIDE_MARGIN;                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return NgosStatus::OK;                                                                                                                                                                               // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
