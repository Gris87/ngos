#!/bin/bash
                                                                                                                                                                                                         # Colorize: green
# This script helps to install prerequisites on CentOS 7.6                                                                                                                                               # Colorize: green
# Author: Maxim Shvecov                                                                                                                                                                                  # Colorize: green
# Usage: sudo ./centos_7_6.sh                                                                                                                                                                            # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
#    PARAMETERS                                                                                                                                                                                          # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
CURRENT_PATH=`pwd`                                                                                                                                                                                       # Colorize: green
BINUTILS_VERSION=2.36                                                                                                                                                                                    # Colorize: green
GCC_VERSION=10.2.0                                                                                                                                                                                       # Colorize: green
VIRTUALBOX_VERSION=6.1                                                                                                                                                                                   # Colorize: green
QT_VERSION=6.0.0                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
#    VERIFICATION                                                                                                                                                                                        # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
if [ ${EUID} -ne 0 ]; then                                                                                                                                                                               # Colorize: green
    echo "Please run as root"                                                                                                                                                                            # Colorize: green
                                                                                                                                                                                                         # Colorize: green
    exit 1                                                                                                                                                                                               # Colorize: green
fi                                                                                                                                                                                                       # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
yum install -y redhat-lsb                                                                                                                                                                                # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
if [[ `lsb_release -rs` != 7.6.* ]]; then                                                                                                                                                                # Colorize: green
    echo "This script should be called on CentOS 7.6"                                                                                                                                                    # Colorize: green
                                                                                                                                                                                                         # Colorize: green
    exit 1                                                                                                                                                                                               # Colorize: green
fi                                                                                                                                                                                                       # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
if [[ ${CURRENT_PATH} != /home/* ]]; then                                                                                                                                                                # Colorize: green
    echo "Please run this script under your home directory"                                                                                                                                              # Colorize: green
                                                                                                                                                                                                         # Colorize: green
    exit 1                                                                                                                                                                                               # Colorize: green
fi                                                                                                                                                                                                       # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
USER=`echo "${CURRENT_PATH}" | sed -r "s/\/home\/([^/]+).*/\1/g"`                                                                                                                                        # Colorize: green
                                                                                                                                                                                                         # Colorize: green
if [ "${USER}" == "" ]; then                                                                                                                                                                             # Colorize: green
    echo "Failed to detect user name"                                                                                                                                                                    # Colorize: green
                                                                                                                                                                                                         # Colorize: green
    exit 1                                                                                                                                                                                               # Colorize: green
fi                                                                                                                                                                                                       # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
#    PROCESSING                                                                                                                                                                                          # Colorize: green
###########################################################################################                                                                                                              # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
echo -e "\e[33m-------------------- Environment --------------------\e[0m"                                                                                                                               # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
mkdir /tmp/src/                                                                                                                                                                                          # Colorize: green
cd /tmp/src/                                                                                                                                                                                             # Colorize: green
mkdir epel/                                                                                                                                                                                              # Colorize: green
cd epel/                                                                                                                                                                                                 # Colorize: green
wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm                                                                                                                              # Colorize: green
yum install -y epel-release-latest-7.noarch.rpm                                                                                                                                                          # Colorize: green
                                                                                                                                                                                                         # Colorize: green
yum update -y                                                                                                                                                                                            # Colorize: green
yum group install -y "Development Tools"                                                                                                                                                                 # Colorize: green
yum --enablerepo=PowerTools install -y texinfo                                                                                                                                                           # Colorize: green
yum install -y gdb                                                                                                                                                                                       # Colorize: green
yum install -y socat                                                                                                                                                                                     # Colorize: green
yum install -y curl                                                                                                                                                                                      # Colorize: green
yum install -y mesa-libGL-devel                                                                                                                                                                          # Colorize: green
yum install -y libudev-devel                                                                                                                                                                             # Colorize: green
yum install -y poppler-utils                                                                                                                                                                             # Colorize: green
yum install -y ImageMagick                                                                                                                                                                               # Colorize: green
yum install -y npm                                                                                                                                                                                       # Colorize: green
                                                                                                                                                                                                         # Colorize: green
npm install sinon                                                                                                                                                                                        # Colorize: green
npm install markdown-spellcheck -g                                                                                                                                                                       # Colorize: green
                                                                                                                                                                                                         # Colorize: green
export PREFIX="/usr/local/x8664elfgcc"                                                                                                                                                                   # Colorize: green
export TARGET=x86_64-elf                                                                                                                                                                                 # Colorize: green
export PATH="${PREFIX}/bin:${PATH}"                                                                                                                                                                      # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
echo -e "\e[33m-------------------- binutils-${BINUTILS_VERSION} --------------------\e[0m"                                                                                                              # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
mkdir /tmp/src                                                                                                                                                                                           # Colorize: green
cd /tmp/src                                                                                                                                                                                              # Colorize: green
                                                                                                                                                                                                         # Colorize: green
if [ ! -d binutils-${BINUTILS_VERSION} ]; then                                                                                                                                                           # Colorize: green
    curl -O http://ftp.gnu.org/gnu/binutils/binutils-${BINUTILS_VERSION}.tar.xz                                                                                                                          # Colorize: green
    tar -xf binutils-${BINUTILS_VERSION}.tar.xz                                                                                                                                                           # Colorize: green
fi                                                                                                                                                                                                       # Colorize: green
                                                                                                                                                                                                         # Colorize: green
mkdir binutils-build                                                                                                                                                                                     # Colorize: green
cd binutils-build                                                                                                                                                                                        # Colorize: green
../binutils-${BINUTILS_VERSION}/configure --prefix=${PREFIX} --target=${TARGET} --disable-werror || exit 1                                                                                               # Colorize: green
make -j`nproc` all                                                                               || exit 1                                                                                               # Colorize: green
make install                                                                                     || exit 1                                                                                               # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
echo -e "\e[33m-------------------- gcc-${GCC_VERSION} --------------------\e[0m"                                                                                                                        # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
mkdir /tmp/src                                                                                                                                                                                           # Colorize: green
cd /tmp/src                                                                                                                                                                                              # Colorize: green
                                                                                                                                                                                                         # Colorize: green
if [ ! -d gcc-${GCC_VERSION} ]; then                                                                                                                                                                     # Colorize: green
    curl -O https://ftp.gnu.org/gnu/gcc/gcc-${GCC_VERSION}/gcc-${GCC_VERSION}.tar.xz                                                                                                                     # Colorize: green
    tar -xf gcc-${GCC_VERSION}.tar.xz                                                                                                                                                                     # Colorize: green
fi                                                                                                                                                                                                       # Colorize: green
                                                                                                                                                                                                         # Colorize: green
cd gcc-${GCC_VERSION}                                                                                                                                                                                    # Colorize: green
contrib/download_prerequisites                                                                                                                                                                           # Colorize: green
cd ..                                                                                                                                                                                                    # Colorize: green
                                                                                                                                                                                                         # Colorize: green
mkdir gcc-build                                                                                                                                                                                          # Colorize: green
cd gcc-build                                                                                                                                                                                             # Colorize: green
../gcc-${GCC_VERSION}/configure --prefix=${PREFIX} --target=${TARGET} --enable-languages=c,c++ || exit 1                                                                                                 # Colorize: green
make -j`nproc` all-gcc                                                                         || exit 1                                                                                                 # Colorize: green
make install-gcc                                                                               || exit 1                                                                                                 # Colorize: green
make -j`nproc` all-target-libgcc                                                               || exit 1                                                                                                 # Colorize: green
make install-target-libgcc                                                                     || exit 1                                                                                                 # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
echo -e "\e[33m-------------------- libvirt --------------------\e[0m"                                                                                                                                   # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
yum install -y qemu-kvm qemu-img libvirt libvirt-client virt-install virt-manager virt-viewer                                                                                                            # Colorize: green
                                                                                                                                                                                                         # Colorize: green
sed -i "s/^#\? \?user *=.*/user = \"${USER}\"/g"   /etc/libvirt/qemu.conf                                                                                                                                # Colorize: green
sed -i "s/^#\? \?group *=.*/group = \"${USER}\"/g" /etc/libvirt/qemu.conf                                                                                                                                # Colorize: green
                                                                                                                                                                                                         # Colorize: green
systemctl enable libvirtd                                                                                                                                                                                # Colorize: green
systemctl restart libvirtd                                                                                                                                                                               # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
echo -e "\e[33m-------------------- virtualbox-${VIRTUALBOX_VERSION} --------------------\e[0m"                                                                                                          # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
cd /etc/yum.repos.d                                                                                                                                                                                      # Colorize: green
wget http://download.virtualbox.org/virtualbox/rpm/rhel/virtualbox.repo                                                                                                                                  # Colorize: green
                                                                                                                                                                                                         # Colorize: green
yum --enablerepo=epel install -y dkms                                                                                                                                                                    # Colorize: green
                                                                                                                                                                                                         # Colorize: green
yum groupinstall -y "Development Tools"                                                                                                                                                                  # Colorize: green
yum install -y kernel-devel                                                                                                                                                                              # Colorize: green
                                                                                                                                                                                                         # Colorize: green
yum install -y VirtualBox-${VIRTUALBOX_VERSION}                                                                                                                                                          # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
echo -e "\e[33m-------------------- .gdbinit --------------------\e[0m"                                                                                                                                  # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
cp ${CURRENT_PATH}/../../tools/gdb/.gdbinit /home/${USER}/                                                                                                                                               # Colorize: green
chown ${USER}:${USER} /home/${USER}/.gdbinit                                                                                                                                                             # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
echo -e "\e[33m-------------------- .bashrc --------------------\e[0m"                                                                                                                                   # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
cat /home/${USER}/.bashrc | grep -v "/usr/local/x8664elfgcc/bin" | grep -v "~/Qt/" > /home/${USER}/temp                                                                                                  # Colorize: green
mv /home/${USER}/temp /home/${USER}/.bashrc                                                                                                                                                              # Colorize: green
echo "export PATH=/usr/local/x8664elfgcc/bin:\${PATH}"    >> /home/${USER}/.bashrc                                                                                                                       # Colorize: green
echo "export PATH=~/Qt/${QT_VERSION}/gcc_64/bin:\${PATH}" >> /home/${USER}/.bashrc                                                                                                                       # Colorize: green
chown ${USER}:${USER} /home/${USER}/.bashrc                                                                                                                                                              # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
echo -e "\e[33m-------------------- Qt --------------------\e[0m"                                                                                                                                        # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
cd /home/${USER}/                                                                                                                                                                                        # Colorize: green
wget http://download.qt.io/official_releases/online_installers/qt-unified-linux-x64-online.run                                                                                                           # Colorize: green
chmod 755 qt-unified-linux-x64-online.run                                                                                                                                                                # Colorize: green
chown ${USER}:${USER} qt-unified-linux-x64-online.run                                                                                                                                                    # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo -e "\e[31mPlease install Qt in your X-Window Manager\e[0m"                                                                                                                                          # Colorize: green
echo -e "\e[31m~/qt-unified-linux-x64-online.run\e[0m"                                                                                                                                                   # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
echo -e "\e[31mPlease choose following items during Qt installation:\e[0m"                                                                                                                               # Colorize: green
echo -e "\e[31m* Qt -> Qt ${QT_VERSION} -> Desktop gcc 64 bit\e[0m"                                                                                                                                      # Colorize: green
echo -e "\e[31m* Qt -> Qt ${QT_VERSION} -> Sources\e[0m"                                                                                                                                                 # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
echo -e "\e[32m-------------------- Done --------------------\e[0m"                                                                                                                                      # Colorize: green
echo ""                                                                                                                                                                                                  # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
                                                                                                                                                                                                         # Colorize: green
echo "Rebooting..."                                                                                                                                                                                      # Colorize: green
sleep 5                                                                                                                                                                                                  # Colorize: green
reboot                                                                                                                                                                                                   # Colorize: green
