#include "phppunctuationverifier.h"                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <com/ngos/devtools/code_verifier/other/codeverificationfiletype.h>                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
PhpPunctuationVerifier::PhpPunctuationVerifier()                                                                                                                                                         // Colorize: green
    : BaseCodeVerifier(CodeVerificationFileType::PHP)                                                                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // Nothing                                                                                                                                                                                           // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
inline bool isSpaceOrEmpty(const QChar &ch)                                                                                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    return ch.isNull() || ch == ' ';                                                                                                                                                                     // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
inline bool validateSignCommaCase1(const QChar &/*chPrev1*/, const QChar &/*chNext1*/, const QChar &/*chNext2*/)                                                                                         // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    return false;                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
inline bool validateSignComma(const QChar &chPrev1, const QChar &chNext1, const QChar &chNext2)                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    return validateSignCommaCase1(chPrev1, chNext1, chNext2);                                                                                                                                            // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
inline bool validateSignSemiColonCase1(const QChar &/*chPrev1*/, const QChar &/*chNext1*/, const QChar &/*chNext2*/)                                                                                     // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    return false;                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
inline bool validateSignSemiColon(const QChar &chPrev1, const QChar &chNext1, const QChar &chNext2)                                                                                                      // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    return validateSignSemiColonCase1(chPrev1, chNext1, chNext2);                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
inline bool validateSignColonCase1(const QChar &/*chPrev1*/, const QChar &chNext1, const QChar &chNext2)                                                                                                 // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // Cases:                                                                                                                                                                                            // Colorize: green
    //      "://"                                                                                                                                                                                        // Colorize: green
    //       ^                                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return chNext1 == '/'                                                                                                                                                                                // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            chNext2 == '/';                                                                                                                                                                              // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
inline bool validateSignColon(const QChar &chPrev1, const QChar &chNext1, const QChar &chNext2)                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    return validateSignColonCase1(chPrev1, chNext1, chNext2);                                                                                                                                            // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
inline bool validateChar(const QChar &ch, const QChar &chPrev1, const QChar &chNext1, const QChar &chNext2)                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // Cases:                                                                                                                                                                                            // Colorize: green
    //      "'?'"                                                                                                                                                                                        // Colorize: green
    //        ^                                                                                                                                                                                          // Colorize: green
    //                                                                                                                                                                                                   // Colorize: green
    //      "\"?"                                                                                                                                                                                        // Colorize: green
    //         ^                                                                                                                                                                                         // Colorize: green
    //                                                                                                                                                                                                   // Colorize: green
    //      "?\""                                                                                                                                                                                        // Colorize: green
    //      "?\\"                                                                                                                                                                                        // Colorize: green
    //      "? "                                                                                                                                                                                         // Colorize: green
    //       ^                                                                                                                                                                                           // Colorize: green
    if (                                                                                                                                                                                                 // Colorize: green
        (                                                                                                                                                                                                // Colorize: green
         chPrev1 == '\''                                                                                                                                                                                 // Colorize: green
         &&                                                                                                                                                                                              // Colorize: green
         chNext1 == '\''                                                                                                                                                                                 // Colorize: green
        )                                                                                                                                                                                                // Colorize: green
        ||                                                                                                                                                                                               // Colorize: green
        chPrev1 == '\"'                                                                                                                                                                                  // Colorize: green
        ||                                                                                                                                                                                               // Colorize: green
        chNext1 == '\"'                                                                                                                                                                                  // Colorize: green
        ||                                                                                                                                                                                               // Colorize: green
        chNext1 == '\\'                                                                                                                                                                                  // Colorize: green
        ||                                                                                                                                                                                               // Colorize: green
        isSpaceOrEmpty(chNext1)                                                                                                                                                                          // Colorize: green
       )                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        return true;                                                                                                                                                                                     // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    switch (ch.unicode())                                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        case ',': return validateSignComma(chPrev1, chNext1, chNext2);                                                                                                                                   // Colorize: green
        case ';': return validateSignSemiColon(chPrev1, chNext1, chNext2);                                                                                                                               // Colorize: green
        case ':': return validateSignColon(chPrev1, chNext1, chNext2);                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        default: return true;                                                                                                                                                                            // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PhpPunctuationVerifier::verify(CodeWorkerThread *worker, const QString &path, const QString &/*content*/, const QStringList &lines)                                                                 // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    for (qint64 i = 0; i < lines.size(); ++i)                                                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString line = lines.at(i);                                                                                                                                                                      // Colorize: green
        VERIFIER_IGNORE(line, "// Ignore PhpPunctuationVerifier");                                                                                                                                       // Colorize: green
        removeComments(line);                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            line.length() > 1                                                                                                                                                                            // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            !line.contains("regexp", Qt::CaseInsensitive)                                                                                                                                                // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QChar ch;                                                                                                                                                                                    // Colorize: green
            QChar chPrev1;                                                                                                                                                                               // Colorize: green
            QChar chNext1 = line.at(0);                                                                                                                                                                  // Colorize: green
            QChar chNext2 = line.at(1);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            for (qint64 j = 0; j < line.length(); ++j)                                                                                                                                                   // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                // Iterate characters                                                                                                                                                                    // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    chPrev1 = ch;                                                                                                                                                                        // Colorize: green
                    ch      = chNext1;                                                                                                                                                                   // Colorize: green
                    chNext1 = chNext2;                                                                                                                                                                   // Colorize: green
                    chNext2 = j < line.length() - 2 ? line.at(j + 2) : QChar();                                                                                                                          // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                if (!validateChar(ch, chPrev1, chNext1, chNext2))                                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    worker->addWarning(path, i, QString("Whitespace is missing after '%1' character in position %2")                                                                                     // Colorize: green
                                                        .arg(ch)                                                                                                                                         // Colorize: green
                                                        .arg(j + 1)                                                                                                                                      // Colorize: green
                    );                                                                                                                                                                                   // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                // Terminate if comment started                                                                                                                                                          // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    if (                                                                                                                                                                                 // Colorize: green
                        ch == '/'                                                                                                                                                                        // Colorize: green
                        &&                                                                                                                                                                               // Colorize: green
                        chNext1 == '/'                                                                                                                                                                   // Colorize: green
                       )                                                                                                                                                                                 // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        break;                                                                                                                                                                           // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
PhpPunctuationVerifier phpPunctuationVerifierInstance;                                                                                                                                                   // Colorize: green
