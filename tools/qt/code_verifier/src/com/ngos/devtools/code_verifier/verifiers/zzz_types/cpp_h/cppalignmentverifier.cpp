#include "cppalignmentverifier.h"                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <com/ngos/devtools/code_verifier/other/codeverificationfiletype.h>                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
CppAlignmentVerifier::CppAlignmentVerifier()                                                                                                                                                             // Colorize: green
    : BaseCodeVerifier(VERIFICATION_COMMON_CPP)                                                                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // Nothing                                                                                                                                                                                           // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
inline bool isTerminatorLine(const QString &line)                                                                                                                                                                     // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    QString lineTrimmed = line.trimmed();                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return lineTrimmed == ""                                                                                                                                                                             // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed == '{'                                                                                                                                                                            // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed == '}'                                                                                                                                                                           // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed == "};"                                                                                                                                                                          // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed == "//"                                                                                                                                                                          // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed == "/***"                                                                                                                                                                        // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed == "***"                                                                                                                                                                         // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed == "***/"                                                                                                                                                                        // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed.startsWith("} __attribute__((")                                                                                                                                                  // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed.startsWith("} while(")                                                                                                                                                           // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed.startsWith("#if")                                                                                                                                                                // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed.startsWith("#else")                                                                                                                                                              // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed.startsWith("#elif")                                                                                                                                                              // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed.startsWith("#endif")                                                                                                                                                             // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            lineTrimmed.startsWith("// Ignore CppAlignmentVerifier [");                                                                                                                                  // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void CppAlignmentVerifier::verify(CodeWorkerThread *worker, const QString &path, const QString &/*content*/, const QStringList &lines)                                                                   // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    for (qint64 i = 0; i < lines.size(); ++i)                                                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString line = lines.at(i);                                                                                                                                                                      // Colorize: green
        VERIFIER_IGNORE_REGION(lines, i, line, "// Ignore CppAlignmentVerifier");                                                                                                                        // Colorize: green
        removeComments(line);                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        qint64 startPos = 0;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        while (startPos < line.length() && line.at(startPos) == ' ')                                                                                                                                     // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            ++startPos;                                                                                                                                                                                  // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        qint64 startRow = -1;                                                                                                                                                                            // Colorize: green
        qint64 endRow   = -1;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 j = startPos + 1; j < line.length() - 1; ++j)                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QChar ch      = line.at(j);                                                                                                                                                                  // Colorize: green
            QChar chPrev1 = line.at(j - 1);                                                                                                                                                              // Colorize: green
            QChar chNext1 = line.at(j + 1);                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (                                                                                                                                                                                         // Colorize: green
                ch == ' '                                                                                                                                                                                // Colorize: green
                &&                                                                                                                                                                                       // Colorize: green
                chPrev1 == ' '                                                                                                                                                                           // Colorize: green
                &&                                                                                                                                                                                       // Colorize: green
                chNext1 != ' '                                                                                                                                                                           // Colorize: green
               )                                                                                                                                                                                         // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                // Get start and end line that should be aligned against symbol j                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    if (startRow < 0 || endRow < 0)                                                                                                                                                      // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        startRow = i;                                                                                                                                                                    // Colorize: green
                        endRow   = i;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        while (startRow > 0 && !isTerminatorLine(lines.at(startRow - 1)))                                                                                                                // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            --startRow;                                                                                                                                                                  // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        while (endRow < lines.size() - 1 && !isTerminatorLine(lines.at(endRow + 1)))                                                                                                     // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            ++endRow;                                                                                                                                                                    // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                for (qint64 k = startRow; k <= endRow ; ++k)                                                                                                                                             // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    if (k == i)                                                                                                                                                                          // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        continue;                                                                                                                                                                        // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    QString scannedLine = lines.at(k);                                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    if (j < scannedLine.length() - 1)                                                                                                                                                    // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        qint64 n = j;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Get real alignment position                                                                                                                                                   // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            while (                                                                                                                                                                      // Colorize: green
                                   n > 0                                                                                                                                                                 // Colorize: green
                                   &&                                                                                                                                                                    // Colorize: green
                                   (                                                                                                                                                                     // Colorize: green
                                    scannedLine.at(n) == '*'                                                                                                                                             // Colorize: green
                                    ||                                                                                                                                                                   // Colorize: green
                                    scannedLine.at(n) == '&'                                                                                                                                             // Colorize: green
                                   )                                                                                                                                                                     // Colorize: green
                                  )                                                                                                                                                                      // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                --n;                                                                                                                                                                     // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            while (                                                                                                                                                                      // Colorize: green
                                   n < line.length()                                                                                                                                                     // Colorize: green
                                   &&                                                                                                                                                                    // Colorize: green
                                   n < scannedLine.length()                                                                                                                                              // Colorize: green
                                   &&                                                                                                                                                                    // Colorize: green
                                   (                                                                                                                                                                     // Colorize: green
                                    line.at(n) == ' '                                                                                                                                                    // Colorize: green
                                    ||                                                                                                                                                                   // Colorize: green
                                    line.at(n) == '*'                                                                                                                                                    // Colorize: green
                                    ||                                                                                                                                                                   // Colorize: green
                                    line.at(n) == '&'                                                                                                                                                    // Colorize: green
                                   )                                                                                                                                                                     // Colorize: green
                                   &&                                                                                                                                                                    // Colorize: green
                                   (                                                                                                                                                                     // Colorize: green
                                    scannedLine.at(n) == ' '                                                                                                                                             // Colorize: green
                                    ||                                                                                                                                                                   // Colorize: green
                                    scannedLine.at(n) == '*'                                                                                                                                             // Colorize: green
                                    ||                                                                                                                                                                   // Colorize: green
                                    scannedLine.at(n) == '&'                                                                                                                                             // Colorize: green
                                   )                                                                                                                                                                     // Colorize: green
                                  )                                                                                                                                                                      // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                ++n;                                                                                                                                                                     // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Check that alignment is fine                                                                                                                                                  // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            if (                                                                                                                                                                         // Colorize: green
                                n < line.length()                                                                                                                                                        // Colorize: green
                                &&                                                                                                                                                                       // Colorize: green
                                n < scannedLine.length()                                                                                                                                                 // Colorize: green
                               )                                                                                                                                                                         // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                if (                                                                                                                                                                     // Colorize: green
                                    scannedLine.at(n) == ' '                                                                                                                                             // Colorize: green
                                    ||                                                                                                                                                                   // Colorize: green
                                    scannedLine.at(n) == '*'                                                                                                                                             // Colorize: green
                                    ||                                                                                                                                                                   // Colorize: green
                                    scannedLine.at(n) == '&'                                                                                                                                             // Colorize: green
                                    ||                                                                                                                                                                   // Colorize: green
                                    line.at(n) == ' '                                                                                                                                                    // Colorize: green
                                    ||                                                                                                                                                                   // Colorize: green
                                    line.at(n) == '*'                                                                                                                                                    // Colorize: green
                                    ||                                                                                                                                                                   // Colorize: green
                                    line.at(n) == '&'                                                                                                                                                    // Colorize: green
                                   )                                                                                                                                                                     // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    worker->addWarning(path, k, QString("Alignment is invalid in position %1")                                                                                           // Colorize: green
                                                                        .arg(j + 1)                                                                                                                      // Colorize: green
                                    );                                                                                                                                                                   // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                            else                                                                                                                                                                         // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                worker->addError(path, k, QString("Unexpected behavior during alignment verification in position %1")                                                                    // Colorize: green
                                                                    .arg(j + 1)                                                                                                                          // Colorize: green
                                );                                                                                                                                                                       // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
CppAlignmentVerifier cppAlignmentVerifierInstance;                                                                                                                                                       // Colorize: green
