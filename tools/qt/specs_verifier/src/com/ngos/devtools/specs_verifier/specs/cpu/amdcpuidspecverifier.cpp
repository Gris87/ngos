#include "amdcpuidspecverifier.h"                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <QDebug>                                                                                                                                                                                        // Colorize: green
#include <QEventLoop>                                                                                                                                                                                    // Colorize: green
#include <QFile>                                                                                                                                                                                         // Colorize: green
#include <QNetworkAccessManager>                                                                                                                                                                         // Colorize: green
#include <QNetworkReply>                                                                                                                                                                                 // Colorize: green
#include <QNetworkRequest>                                                                                                                                                                               // Colorize: green
#include <QProcess>                                                                                                                                                                                      // Colorize: green
#include <QTemporaryDir>                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define AMD_SPECIFICATION_URL "https://www.amd.com/system/files/TechDocs/24594.pdf" // Version: 3.33 November 2021                                                                                                           // Colorize: green
#define AMD_PDF               "amdcpuid.pdf"                                                                                                                                                             // Colorize: green
#define AMD_TXT               "amdcpuid.txt"                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define CPUID80000000EAX_H           "src/os/shared/common/src/com/ngos/shared/common/cpu/lib/cpuid/cpuid80000000eax.h"                                                                                        // Colorize: green
#define CPUID_MODEL_NAME_H           "src/os/shared/common/src/com/ngos/shared/common/cpu/lib/cpuid/cpuidmodelname.h"                                                                                        // Colorize: green
#define CPUID80000008EAX_H           "src/os/shared/common/src/com/ngos/shared/common/cpu/lib/cpuid/cpuid80000008eax.h"                                                                                        // Colorize: green
#define CPUID80000008ECX_H           "src/os/shared/common/src/com/ngos/shared/common/cpu/lib/cpuid/cpuid80000008ecx.h"                                                                                        // Colorize: green
#define CPUID_PERFORMANCE_TSC_SIZE_H "src/os/shared/common/src/com/ngos/shared/common/cpu/lib/cpuid/lib/cpuidperformancetscsize.h"                                                                                        // Colorize: green
#define CPUID_LEAF_H                 "src/os/shared/common/src/com/ngos/shared/common/cpu/lib/cpuidleaf.h"                                                                                        // Colorize: green
#define CPUID_SUBLEAF_H              "src/os/shared/common/src/com/ngos/shared/common/cpu/lib/cpuidsubleaf.h"                                                                                        // Colorize: green
#define X86_FEATURE_H                "src/os/shared/common/src/com/ngos/shared/common/cpu/lib/x86feature.h"                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
AmdCpuidSpecVerifier::AmdCpuidSpecVerifier()                                                                                                                                                             // Colorize: green
    : SpecVerifier()                                                                                                                                                                                     // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // Nothing                                                                                                                                                                                           // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void AmdCpuidSpecVerifier::verify(SpecVerifyThread *thread)                                                                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread != nullptr);                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString specContent;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!downloadSpecification(thread, AMD_SPECIFICATION_URL, specContent))                                                                                                                              // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        return;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    checkWithSpecification(thread, specContent);                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool AmdCpuidSpecVerifier::downloadSpecification(SpecVerifyThread *thread, const QString &url, QString &specContent)                                                                                     // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(url    != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QTemporaryDir tempDir;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Create temporary directory                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!tempDir.isValid())                                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to create temporary directory for AMD CPUID specification");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Download specification                                                                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QNetworkAccessManager  manager;                                                                                                                                                                  // Colorize: green
        QNetworkReply         *reply;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Send network request                                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QNetworkRequest request;                                                                                                                                                                     // Colorize: green
            request.setUrl(QUrl(url));                                                                                                                                                 // Colorize: green
            reply = manager.get(request);                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Wait for finish                                                                                                                                                                               // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QEventLoop waitLoop;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QObject::connect(reply, SIGNAL(finished()),                                 &waitLoop, SLOT(quit()));                                                                                        // Colorize: green
            QObject::connect(reply, SIGNAL(errorOccurred(QNetworkReply::NetworkError)), &waitLoop, SLOT(quit()));                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            waitLoop.exec();                                                                                                                                                                             // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Check status code                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QVariant statusCode = reply->attribute(QNetworkRequest::HttpStatusCodeAttribute);                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (statusCode.toInt() != 200)                                                                                                                                                               // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to get AMD CPUID specification from: %1")                                                                                                               // Colorize: green
                                            .arg(url)                                                                                                                                  // Colorize: green
                );                                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                delete reply;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return false;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        QByteArray content = reply->readAll();                                                                                                                                                           // Colorize: green
        delete reply;                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Write documentation to file                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QFile file(tempDir.path() + "/" + AMD_PDF);                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (!file.open(QIODevice::WriteOnly))                                                                                                                                                        // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError("Failed to create temporary file for AMD CPUID specification");                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return false;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            file.write(content);                                                                                                                                                                         // Colorize: green
            file.close();                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Convert PDF to text                                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QProcess process;                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        process.setWorkingDirectory(tempDir.path());                                                                                                                                                     // Colorize: green
        process.start("pdftotext", QStringList() << AMD_PDF << AMD_TXT);                                                                                                                                 // Colorize: green
        process.waitForFinished(-1);                                                                                                                                                                     // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Read specification text                                                                                                                                                                           // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QFile file(tempDir.path() + "/" + AMD_TXT);                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (!file.open(QIODevice::ReadOnly))                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to open AMD CPUID specification");                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        specContent += QString::fromUtf8(file.readAll());                                                                                                                                                 // Colorize: green
        file.close();                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return true;                                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void AmdCpuidSpecVerifier::checkWithSpecification(SpecVerifyThread *thread, const QString &specContent)                                                                                                  // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    qint64 errorsBefore = thread->getErrors().size();                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check code with specification                                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        checkAmdSpecification(thread, specContent);                                                                                                                                                      // Colorize: green
        checkCpuid80000000Eax(thread, specContent);                                                                                                                                                      // Colorize: green
        checkCpuidModelName(thread, specContent);                                                                                                                                                        // Colorize: green
        checkCpuid80000008Eax(thread, specContent);                                                                                                                                                      // Colorize: green
        checkCpuid80000008Ecx(thread, specContent);                                                                                                                                                      // Colorize: green
        checkCpuidPerformanceTscSize(thread, specContent);                                                                                                                                               // Colorize: green
        checkCpuidLeaf(thread, specContent);                                                                                                                                                             // Colorize: green
        checkCpuidSubLeaf(thread, specContent);                                                                                                                                                          // Colorize: green
        checkX86Feature(thread, specContent);                                                                                                                                                            // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (thread->getErrors().size() == errorsBefore)                                                                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addMessage("Code verified with AMD CPUID specification");                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
    else                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addMessage("Found error in code with AMD CPUID specification");                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void AmdCpuidSpecVerifier::checkAmdSpecification(SpecVerifyThread *thread, const QString &specContent)                                                                                                   // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString versionText;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init versionText                                                                                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        versionText =                                                                                                                                                                                    // Colorize: green
            "AMD64 Technology\n"                                                                                                                                                                         // Colorize: green
            "AMD64 Architecture\n"                                                                                                                                                                       // Colorize: green
            "Programmerâ€™s Manual\n"                                                                                                                                                                      // Colorize: green
            "Volume 3:\n"                                                                                                                                                                                // Colorize: green
            "General-Purpose and\n"                                                                                                                                                                      // Colorize: green
            "System Instructions\n"                                                                                                                                                                      // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Publication No.\n"                                                                                                                                                                          // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Revision\n"                                                                                                                                                                                 // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Date\n"                                                                                                                                                                                     // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "24594\n"                                                                                                                                                                                    // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "3.33\n"                                                                                                                                                                                     // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "November 2021";                                                                                                                                                                             // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(versionText))                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("AMD CPUID specification version didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void AmdCpuidSpecVerifier::checkCpuid80000000Eax(SpecVerifyThread *thread, const QString &specContent)                                                                                                   // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString cpuidText;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init cpuidText                                                                                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        cpuidText =                                                                                                                                                                                    // Colorize: green
            "CPUID Fn8000_0000_EAX Largest Extended Function Number\n"                                                                                                                                   // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "The value returned in EAX provides the largest extended function number supported by the processor.\n"                                                                                      // Colorize: green
            "Bits Field Name\n"                                                                                                                                                                          // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Description\n"                                                                                                                                                                              // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "31:0 LFuncExt\n"                                                                                                                                                                            // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Largest extended function. The largest CPUID extended function input value\n"                                                                                                               // Colorize: green
            "supported by the processor implementation.";                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(cpuidText))                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("CPUID 80000000 EAX specification didn't match with the stored one");                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList cpuidLines;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        cpuidLines.append(QString("// Verified with AmdCpuidSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                    .arg(AMD_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        cpuidLines.append("struct Cpuid80000000Eax");                                                                                                                                                    // Colorize: green
        cpuidLines.append("{");                                                                                                                                                                          // Colorize: green
        cpuidLines.append("    union");                                                                                                                                                                     // Colorize: green
        cpuidLines.append("    {");                                                                                                                                                                      // Colorize: green
        cpuidLines.append("        struct");                                                                                                                                                             // Colorize: green
        cpuidLines.append("        {");                                                                                                                                                                  // Colorize: green
        cpuidLines.append("            CpuidLeaf largestFunction;");                                                                                                                                     // Colorize: green
        cpuidLines.append("        };");                                                                                                                                                                 // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("        good_U32 value32;");                                                                                                                                                  // Colorize: green
        cpuidLines.append("    };");                                                                                                                                                                     // Colorize: green
        cpuidLines.append("} __attribute__((packed));");                                                                                                                                                 // Colorize: green
        cpuidLines.append(QString("// Verified with AmdCpuidSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                    .arg(AMD_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(cpuidLines, thread->getPath() + "/" + CPUID80000000EAX_H))                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check CPUID 80000000 EAX with specification");                                                                                                                         // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void AmdCpuidSpecVerifier::checkCpuidModelName(SpecVerifyThread *thread, const QString &specContent)                                                                                                     // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString cpuidText;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init cpuidText                                                                                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        cpuidText =                                                                                                                                                                                    // Colorize: green
            "E.4.3 Functions 8000_0002hâ€“8000_0004hâ€”Extended Processor Name String\n"                                                                                                                     // Colorize: green
            "CPUID Fn8000_000[4:2]_E[D,C,B,A]X Processor Name String Identifier\n"                                                                                                                       // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "The three extended functions from Fn8000_0002 to Fn8000_0004 are programmed to return a null\n"                                                                                             // Colorize: green
            "terminated ASCII string up to 48 characters in length corresponding to the processor name.\n"                                                                                               // Colorize: green
            "Bits Field Name\n"                                                                                                                                                                          // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Description\n"                                                                                                                                                                              // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "31:0 ProcName\n"                                                                                                                                                                            // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Four characters of the extended processor name string.\n"                                                                                                                                   // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "The 48 character maximum includes the terminating null character. The 48 character string is ordered\n"                                                                                     // Colorize: green
            "first to last (left to right) as follows:\n"                                                                                                                                                // Colorize: green
            "Fn8000_0002[EAX[7:0],..., EAX[31:24], EBX[7:0],..., EBX[31:24], ECX[7:0],...,\n"                                                                                                            // Colorize: green
            "ECX[31:24],EDX[7:0],..., EDX[31:24]],\n"                                                                                                                                                    // Colorize: green
            "Fn8000_0003[EAX[7:0],..., EAX[31:24], EBX[7:0],..., EBX[31:24], ECX[7:0],..., ECX[31:24],\n"                                                                                                // Colorize: green
            "EDX[7:0],..., EDX[31:24]],\n"                                                                                                                                                               // Colorize: green
            "Fn8000_0004[EAX[7:0],..., EAX[31:24], EBX[7:0],..., EBX[31:24], ECX[7:0],..., ECX[31:24],\n"                                                                                                // Colorize: green
            "EDX[7:0],..., EDX[31:24]].\n"                                                                                                                                                               // Colorize: green
            "The extended processor name string is programmed by system firmware. See your processor revision\n"                                                                                         // Colorize: green
            "guide for information about how to display the extended processor name string.";                                                                                                            // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(cpuidText))                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("CPUID Model Name specification didn't match with the stored one");                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList cpuidLines;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        cpuidLines.append(QString("// Verified with AmdCpuidSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                    .arg(AMD_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        cpuidLines.append("struct CpuidModelName");                                                                                                                                                      // Colorize: green
        cpuidLines.append("{");                                                                                                                                                                          // Colorize: green
        cpuidLines.append("    union");                                                                                                                                                                  // Colorize: green
        cpuidLines.append("    {");                                                                                                                                                                      // Colorize: green
        cpuidLines.append("        struct");                                                                                                                                                             // Colorize: green
        cpuidLines.append("        {");                                                                                                                                                                  // Colorize: green
        cpuidLines.append("            good_U32 uints[12];");                                                                                                                                            // Colorize: green
        cpuidLines.append("        };");                                                                                                                                                                 // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("        good_Char8 chars[48];");                                                                                                                                              // Colorize: green
        cpuidLines.append("    }; ");                                                                                                                                                                    // Colorize: green
        cpuidLines.append("} __attribute__((packed));");                                                                                                                                                // Colorize: green
        cpuidLines.append(QString("// Verified with AmdCpuidSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                    .arg(AMD_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(cpuidLines, thread->getPath() + "/" + CPUID_MODEL_NAME_H))                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check CPUID Model Name with specification");                                                                                                                         // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void AmdCpuidSpecVerifier::checkCpuid80000008Eax(SpecVerifyThread *thread, const QString &specContent)                                                                                                   // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString cpuidText;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init cpuidText                                                                                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        cpuidText =                                                                                                                                                                                    // Colorize: green
            "CPUID Fn8000_0008_EAX Long Mode Size Identifiers\n"                                                                                                                                         // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "The value returned in EAX provides information about the maximum host and guest physical and\n"                                                                                             // Colorize: green
            "linear address width (in bits) supported by the processor.\n"                                                                                                                               // Colorize: green
            "Bits Field Name\n"                                                                                                                                                                          // Colorize: green
            "31:24 â€”\n"                                                                                                                                                                                  // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Description\n"                                                                                                                                                                              // Colorize: green
            "Reserved.\n"                                                                                                                                                                                // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Maximum guest physical address size in bits. This number applies only to guests\n"                                                                                                          // Colorize: green
            "using nested paging. When this field is zero, refer to the PhysAddrSize field for\n"                                                                                                        // Colorize: green
            "23:16 GuestPhysAddrSize\n"                                                                                                                                                                  // Colorize: green
            "the maximum guest physical address size. See â€œSecure Virtual Machineâ€ in\n"                                                                                                                 // Colorize: green
            "APM2.\n"                                                                                                                                                                                    // Colorize: green
            "15:8 LinAddrSize\n"                                                                                                                                                                         // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Maximum linear address size in bits.\n"                                                                                                                                                     // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "7:0\n"                                                                                                                                                                                      // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Maximum physical address size in bits. When GuestPhysAddrSize is zero, this\n"                                                                                                              // Colorize: green
            "field also indicates the maximum guest physical address size.\n"                                                                                                                            // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "PhysAddrSize\n"                                                                                                                                                                             // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "The address width reported is the maximum supported in any mode. For long mode capable processors, the size reported is independent of whether long mode is enabled. See â€œProcessor Initialization\n" // Colorize: green
            "and Long-Mode Activationâ€ in APM2.";                                                                                                                                                        // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(cpuidText))                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("CPUID 80000008 EAX specification didn't match with the stored one");                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList cpuidLines;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        cpuidLines.append(QString("// Verified with AmdCpuidSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                    .arg(AMD_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        cpuidLines.append("struct Cpuid80000008Eax");                                                                                                                                                    // Colorize: green
        cpuidLines.append("{");                                                                                                                                                                          // Colorize: green
        cpuidLines.append("    union");                                                                                                                                                                  // Colorize: green
        cpuidLines.append("    {");                                                                                                                                                                      // Colorize: green
        cpuidLines.append("        struct");                                                                                                                                                             // Colorize: green
        cpuidLines.append("        {");                                                                                                                                                                  // Colorize: green
        cpuidLines.append("            good_U32 physicalAddressBits:      8;");                                                                                                                          // Colorize: green
        cpuidLines.append("            good_U32 virtualAddressBits:       8;");                                                                                                                          // Colorize: green
        cpuidLines.append("            good_U32 guestPhysicalAddressBits: 8;");                                                                                                                          // Colorize: green
        cpuidLines.append("            good_U32 _reserved:                8;");                                                                                                                          // Colorize: green
        cpuidLines.append("        };");                                                                                                                                                                 // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("        good_U32 value32;");                                                                                                                                                  // Colorize: green
        cpuidLines.append("    };");                                                                                                                                                                     // Colorize: green
        cpuidLines.append("} __attribute__((packed));");                                                                                                                                                 // Colorize: green
        cpuidLines.append(QString("// Verified with AmdCpuidSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                    .arg(AMD_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(cpuidLines, thread->getPath() + "/" + CPUID80000008EAX_H))                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check CPUID 80000008 EAX with specification");                                                                                                                         // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void AmdCpuidSpecVerifier::checkCpuid80000008Ecx(SpecVerifyThread *thread, const QString &specContent)                                                                                                   // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString cpuidText1;                                                                                                                                                                                 // Colorize: green
    QString cpuidText2;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init cpuidText1 and cpuidText2                                                                                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        cpuidText1 =                                                                                                                                                                                     // Colorize: green
            "CPUID Fn8000_0008_ECX Size Identifiers\n"                                                                                                                                                   // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "The value returned in ECX provides information about the number of cores supported by the\n"                                                                                                // Colorize: green
            "processor, the width of the APIC ID, and the width of the performance time-stamp counter.";                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        cpuidText2 =                                                                                                                                                                                     // Colorize: green
            "Bits Field Name\n"                                                                                                                                                                          // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "24594â€”Rev. 3.33â€”November 2021\n"                                                                                                                                                            // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Description\n"                                                                                                                                                                              // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "31:18 â€”\n"                                                                                                                                                                                  // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Reserved.\n"                                                                                                                                                                                // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "17:16 PerfTscSize\n"                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Performance time-stamp counter size. Indicates the size of\n"                                                                                                                               // Colorize: green
            "MSRC001_0280[PTSC].\n"                                                                                                                                                                      // Colorize: green
            "Bits\n"                                                                                                                                                                                     // Colorize: green
            "Description\n"                                                                                                                                                                              // Colorize: green
            "00b\n"                                                                                                                                                                                      // Colorize: green
            "40 bits\n"                                                                                                                                                                                  // Colorize: green
            "01b\n"                                                                                                                                                                                      // Colorize: green
            "48 bits\n"                                                                                                                                                                                  // Colorize: green
            "10b\n"                                                                                                                                                                                      // Colorize: green
            "56 bits\n"                                                                                                                                                                                  // Colorize: green
            "11b\n"                                                                                                                                                                                      // Colorize: green
            "64 bits\n"                                                                                                                                                                                  // Colorize: green
            "APIC ID size. The number of bits in the initial APIC20[ApicId] value that indicate\n"                                                                                                       // Colorize: green
            "logical processor ID within a package. The size of this field determines the\n"                                                                                                             // Colorize: green
            "maximum number of logical processors (MNLP) that the package could\n"                                                                                                                       // Colorize: green
            "theoretically support, and not the actual number of logical processors that are\n"                                                                                                          // Colorize: green
            "implemented or enabled in the package, as indicated by CPUID\n"                                                                                                                             // Colorize: green
            "Fn8000_0008_ECX[NC]. A value of zero indicates that legacy methods must be\n"                                                                                                               // Colorize: green
            "used to determine the maximum number of logical processors, as indicated by\n"                                                                                                              // Colorize: green
            "CPUID Fn8000_0008_ECX[NC].\n"                                                                                                                                                               // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "15:12 ApicIdSize\n"                                                                                                                                                                         // Colorize: green
            "if (ApicIdSize[3:0] == 0) {\n"                                                                                                                                                              // Colorize: green
            "// Used by legacy dual-core/single-core processors\n"                                                                                                                                       // Colorize: green
            "MNLP = CPUID Fn8000_0008_ECX[NC] + 1;\n"                                                                                                                                                    // Colorize: green
            "} else {\n"                                                                                                                                                                                 // Colorize: green
            "// use ApicIdSize[3:0] field\n"                                                                                                                                                             // Colorize: green
            "MNLP = (2 raised to the power of ApicIdSize[3:0]);\n"                                                                                                                                       // Colorize: green
            "}\n"                                                                                                                                                                                        // Colorize: green
            "11:8\n"                                                                                                                                                                                     // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "â€”\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Reserved.\n"                                                                                                                                                                                // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "7:0\n"                                                                                                                                                                                      // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "NT\n"                                                                                                                                                                                       // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Number of physical threads - 1. The number of threads in the processor is NT+1\n"                                                                                                           // Colorize: green
            "(e.g., if NT = 0, then there is one thread). See â€œLegacy Methodâ€ on page 633.";                                                                                                             // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            !specContent.contains(cpuidText1)                                                                                                                                                            // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            !specContent.contains(cpuidText2)                                                                                                                                                            // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("CPUID 80000008 ECX specification didn't match with the stored one");                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList cpuidLines;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        cpuidLines.append(QString("// Verified with AmdCpuidSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                    .arg(AMD_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        cpuidLines.append("struct Cpuid80000008Ecx");                                                                                                                                                    // Colorize: green
        cpuidLines.append("{");                                                                                                                                                                          // Colorize: green
        cpuidLines.append("    inline good_U16 physicalCoresReal() const");                                                                                                                              // Colorize: green
        cpuidLines.append("    {");                                                                                                                                                                      // Colorize: green
        cpuidLines.append("        COMMON_LT((\"\"));");                                                                                                                                                 // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("        return physicalCores + 1;");                                                                                                                                          // Colorize: green
        cpuidLines.append("    }");                                                                                                                                                                      // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("    inline good_U8 apicIdBitsReal() const");                                                                                                                                  // Colorize: green
        cpuidLines.append("    {");                                                                                                                                                                      // Colorize: green
        cpuidLines.append("        COMMON_LT((\"\"));");                                                                                                                                                 // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("        if (apicIdBits == 0)");                                                                                                                                               // Colorize: green
        cpuidLines.append("        {");                                                                                                                                                                  // Colorize: green
        cpuidLines.append("            return 1;");                                                                                                                                                      // Colorize: green
        cpuidLines.append("        }");                                                                                                                                                                  // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("        return apicIdBits;");                                                                                                                                                 // Colorize: green
        cpuidLines.append("    }");                                                                                                                                                                      // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("    union");                                                                                                                                                                  // Colorize: green
        cpuidLines.append("    {");                                                                                                                                                                      // Colorize: green
        cpuidLines.append("        struct");                                                                                                                                                             // Colorize: green
        cpuidLines.append("        {");                                                                                                                                                                  // Colorize: green
        cpuidLines.append("            good_U32                physicalCores:      8;");                                                                                                                 // Colorize: green
        cpuidLines.append("            good_U32                _reserved:          4;");                                                                                                                 // Colorize: green
        cpuidLines.append("            good_U32                apicIdBits:         4;");                                                                                                                 // Colorize: green
        cpuidLines.append("            CpuidPerformanceTscSize performanceTscSize: 2;");                                                                                                                 // Colorize: green
        cpuidLines.append("            good_U32                _reserved2:         14;");                                                                                                                // Colorize: green
        cpuidLines.append("        };");                                                                                                                                                                 // Colorize: green
        cpuidLines.append("");                                                                                                                                                                           // Colorize: green
        cpuidLines.append("        good_U32 value32;");                                                                                                                                                  // Colorize: green
        cpuidLines.append("    };");                                                                                                                                                                     // Colorize: green
        cpuidLines.append("} __attribute__((packed));");                                                                                                                                                 // Colorize: green
        cpuidLines.append(QString("// Verified with AmdCpuidSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                    .arg(AMD_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(cpuidLines, thread->getPath() + "/" + CPUID80000008ECX_H))                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check CPUID 80000008 ECX with specification");                                                                                                                         // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void AmdCpuidSpecVerifier::checkCpuidPerformanceTscSize(SpecVerifyThread *thread, const QString &specContent)                                                                                            // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString cpuidText;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init cpuidText                                                                                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        cpuidText =                                                                                                                                                                                    // Colorize: green
            "17:16 PerfTscSize\n"                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Performance time-stamp counter size. Indicates the size of\n"                                                                                                                               // Colorize: green
            "MSRC001_0280[PTSC].\n"                                                                                                                                                                      // Colorize: green
            "Bits\n"                                                                                                                                                                                     // Colorize: green
            "Description\n"                                                                                                                                                                              // Colorize: green
            "00b\n"                                                                                                                                                                                      // Colorize: green
            "40 bits\n"                                                                                                                                                                                  // Colorize: green
            "01b\n"                                                                                                                                                                                      // Colorize: green
            "48 bits\n"                                                                                                                                                                                  // Colorize: green
            "10b\n"                                                                                                                                                                                      // Colorize: green
            "56 bits\n"                                                                                                                                                                                  // Colorize: green
            "11b\n"                                                                                                                                                                                      // Colorize: green
            "64 bits";                                                                                                                                                                                   // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(cpuidText))                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("CPUID Performance TSC Size specification didn't match with the stored one");                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = cpuidText.split('\n');                                                                                                                                    // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (lines.at(4) != "Bits" || lines.at(5) != "Description")                                                                                                                              // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse CPUID Performance TSC Size specification");                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 6;                                                                                                                                                                                           // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList values;                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            values.append(QString::number(lines.at(i).left(2).toLongLong()));                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fields.append('_' + lines.at(i).toUpper().replace(' ', '_'));                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList cpuidLines;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        cpuidLines.append(QString("// Verified with AmdCpuidSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                    .arg(AMD_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        cpuidLines.append("enum class CpuidPerformanceTscSize: good_U8");                                                                                                                                                    // Colorize: green
        cpuidLines.append("{");                                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fields.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            cpuidLines.append(QString("    %1 = %2%3")                                                                                                                    // Colorize: green
                                        .arg(fields.at(i))                                                                                                                                               // Colorize: green
                                        .arg(values.at(i))                                                                                                                                               // Colorize: green
                                        .arg(i < fields.size() - 1 ? "," : "")                                                                                                                            // Colorize: green
            );                                                                                                                                                                                           // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        cpuidLines.append("};");                                                                                                                                                 // Colorize: green
        cpuidLines.append(QString("// Verified with AmdCpuidSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                    .arg(AMD_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(cpuidLines, thread->getPath() + "/" + CPUID_PERFORMANCE_TSC_SIZE_H))                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check CPUID Performance TSC Size with specification");                                                                                                                         // Colorize: green
    }                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void AmdCpuidSpecVerifier::checkCpuidLeaf(SpecVerifyThread *thread, const QString &specContent)                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void AmdCpuidSpecVerifier::checkCpuidSubLeaf(SpecVerifyThread *thread, const QString &specContent)                                                                                                       // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void AmdCpuidSpecVerifier::checkX86Feature(SpecVerifyThread *thread, const QString &specContent)                                                                                                         // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
AmdCpuidSpecVerifier amdCpuidSpecVerifier;                                                                                                                                                               // Colorize: green
