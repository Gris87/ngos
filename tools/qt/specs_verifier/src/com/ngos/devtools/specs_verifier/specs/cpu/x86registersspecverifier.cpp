#include "x86registersspecverifier.h"                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <QDebug>                                                                                                                                                                                        // Colorize: green
#include <QEventLoop>                                                                                                                                                                                    // Colorize: green
#include <QFile>                                                                                                                                                                                         // Colorize: green
#include <QHash>                                                                                                                                                                                         // Colorize: green
#include <QNetworkAccessManager>                                                                                                                                                                         // Colorize: green
#include <QNetworkReply>                                                                                                                                                                                 // Colorize: green
#include <QNetworkRequest>                                                                                                                                                                               // Colorize: green
#include <QProcess>                                                                                                                                                                                      // Colorize: green
#include <QTemporaryDir>                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define X86_REGISTERS_SPECIFICATION_URL_1 "https://cdrdv2.intel.com/v1/dl/getContent/671436" // Version: April 2022                                                                                                           // Colorize: green
#define X86_REGISTERS_SPECIFICATION_URL_2 "https://cdrdv2.intel.com/v1/dl/getContent/671190" // Version: April 2022                                                                                                           // Colorize: green
#define X86_REGISTERS_PDF                 "x86registers.pdf"                                                                                                                                                             // Colorize: green
#define X86_REGISTERS_TXT                 "x86registers.txt"                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define X86_CR0_FLAGS_H "src/os/shared/common/src/com/ngos/shared/common/cpu/lib/registers/x86cr0flags.h"                                                                                        // Colorize: green
#define X86_CR4_FLAGS_H "src/os/shared/common/src/com/ngos/shared/common/cpu/lib/registers/x86cr4flags.h"                                                                                        // Colorize: green
#define X86_CR8_H       "src/os/shared/common/src/com/ngos/shared/common/cpu/lib/registers/x86cr8.h"                                                                                        // Colorize: green
#define X86_FLAGS_H     "src/os/shared/common/src/com/ngos/shared/common/cpu/lib/registers/x86flags.h"                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
X86RegistersSpecVerifier::X86RegistersSpecVerifier()                                                                                                                                                             // Colorize: green
    : SpecVerifier()                                                                                                                                                                                     // Colorize: green
    , mRegisterRegExp("(.*)\\(bit *(\\d+)[^)]*\\) *- *([^.]*)")                                                                                                                                          // Colorize: green
    , mFlagsBitRegExp(".*\\(bit(?:s)? *(\\d+)[^)]*\\).*")                                                                                                                                                      // Colorize: green
    , mFlagsDescriptionRegExp("((?:Virtual-8086)?[^-]*|)- *([^.]*)")                                                                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // Nothing                                                                                                                                                                                           // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void X86RegistersSpecVerifier::verify(SpecVerifyThread *thread)                                                                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread != nullptr);                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString specContent;                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (                                                                                                                                                                                                 // Colorize: green
        !downloadSpecification(thread, X86_REGISTERS_SPECIFICATION_URL_1, specContent)                                                                                                                   // Colorize: green
        ||                                                                                                                                                                                               // Colorize: green
        !downloadSpecification(thread, X86_REGISTERS_SPECIFICATION_URL_2, specContent)                                                                                                                   // Colorize: green
       )                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        return;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Replace some special characters                                                                                                                                                           // Colorize: green
    {                                                                                                                                                                                            // Colorize: green
        specContent.replace(QChar(0x00AE), "(R)");  // Replace registered sign character    // https://www.compart.com/en/unicode/U+00AE                                                                 // Colorize: green
        specContent.replace(QChar(0x2014), '-');    // Replace em dash                      // https://www.compart.com/en/unicode/U+2014                                                                 // Colorize: green
        specContent.replace(QChar(0x2018), '\'');   // Replace left single quotation mark   // https://www.compart.com/en/unicode/U+2018                                                                 // Colorize: green
        specContent.replace(QChar(0x2019), '\'');   // Replace right double quotation mark  // https://www.compart.com/en/unicode/U+2019                                                                 // Colorize: green
        specContent.replace(QChar(0x201C), '\"');   // Replace left double quotation mark   // https://www.compart.com/en/unicode/U+201C                                                                 // Colorize: green
        specContent.replace(QChar(0x201D), '\"');   // Replace right double quotation mark  // https://www.compart.com/en/unicode/U+201D                                                                 // Colorize: green
        specContent.replace(QChar(0x2022), '*');    // Replace bullet                       // https://www.compart.com/en/unicode/U+2022                                                                 // Colorize: green
        specContent.replace(QChar(0x2122), "(TM)"); // Replace trade mark sign character    // https://www.compart.com/en/unicode/U+2122                                                                 // Colorize: green
    }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    checkWithSpecification(thread, specContent);                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool X86RegistersSpecVerifier::downloadSpecification(SpecVerifyThread *thread, const QString &url, QString &specContent)                                                                                                     // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(url    != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QTemporaryDir tempDir;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Create temporary directory                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!tempDir.isValid())                                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to create temporary directory for X86 Registers specification");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Download specification                                                                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QNetworkAccessManager  manager;                                                                                                                                                                  // Colorize: green
        QNetworkReply         *reply;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Send network request                                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QNetworkRequest request;                                                                                                                                                                     // Colorize: green
            request.setUrl(QUrl(url));                                                                                                                                                 // Colorize: green
            reply = manager.get(request);                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Wait for finish                                                                                                                                                                               // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QEventLoop waitLoop;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QObject::connect(reply, SIGNAL(finished()),                                 &waitLoop, SLOT(quit()));                                                                                        // Colorize: green
            QObject::connect(reply, SIGNAL(errorOccurred(QNetworkReply::NetworkError)), &waitLoop, SLOT(quit()));                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            waitLoop.exec();                                                                                                                                                                             // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Check status code                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QVariant statusCode = reply->attribute(QNetworkRequest::HttpStatusCodeAttribute);                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (statusCode.toInt() != 200)                                                                                                                                                               // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to get X86 Registers specification from: %1 (%2 - %3)")                                                                                                               // Colorize: green
                                            .arg(url)                                                                                                                                  // Colorize: green
                                            .arg(statusCode.toInt())                                                                                                                  // Colorize: green
                                            .arg(reply->errorString())                                                                                                                 // Colorize: green
                );                                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                delete reply;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return false;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        QByteArray content = reply->readAll();                                                                                                                                                           // Colorize: green
        delete reply;                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Write documentation to file                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QFile file(tempDir.path() + "/" + X86_REGISTERS_PDF);                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (!file.open(QIODevice::WriteOnly))                                                                                                                                                        // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError("Failed to create temporary file for X86 Registers specification");                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return false;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            file.write(content);                                                                                                                                                                         // Colorize: green
            file.close();                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Convert PDF to text                                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QProcess process;                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        process.setWorkingDirectory(tempDir.path());                                                                                                                                                     // Colorize: green
        process.start("pdftotext", QStringList() << X86_REGISTERS_PDF << X86_REGISTERS_TXT);                                                                                                                                 // Colorize: green
        process.waitForFinished(-1);                                                                                                                                                                     // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Read specification text                                                                                                                                                                           // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QFile file(tempDir.path() + "/" + X86_REGISTERS_TXT);                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (!file.open(QIODevice::ReadOnly))                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to open X86 Registers specification");                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        specContent += QString::fromUtf8(file.readAll());                                                                                                                                                 // Colorize: green
        file.close();                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return true;                                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void X86RegistersSpecVerifier::checkWithSpecification(SpecVerifyThread *thread, const QString &specContent)                                                                                                  // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    qint64 errorsBefore = thread->getErrors().size();                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check code with specification                                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        checkX86RegistersSpecification(thread, specContent);                                                                                                                                             // Colorize: green
        checkX86Cr0Flags(thread, specContent);                                                                                                                                             // Colorize: green
        checkX86Cr4Flags(thread, specContent);                                                                                                                                             // Colorize: green
        checkX86Cr8(thread, specContent);                                                                                                                                             // Colorize: green
        checkX86Flags(thread, specContent);                                                                                                                                             // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (thread->getErrors().size() == errorsBefore)                                                                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addMessage("Code verified with X86 Registers specification");                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
    else                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addMessage("Found error in code with X86 Registers specification");                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void X86RegistersSpecVerifier::checkX86RegistersSpecification(SpecVerifyThread *thread, const QString &specContent)                                                                                                   // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString versionText1;                                                                                                                                                                                 // Colorize: green
    QString versionText2;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init versionText1 and versionText2                                                                                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        versionText1 =                                                                                                                                                                                    // Colorize: green
            "Intel(R) 64 and IA-32 Architectures\n"                                                                                                                                                        // Colorize: green
            "Software Developer's Manual\n"                                                                                                                                                              // Colorize: green
            "Volume 1:\n"                                                                                                                                                                                // Colorize: green
            "Basic Architecture\n"                                                                                                                                                                       // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "NOTE: The Intel(R) 64 and IA-32 Architectures Software Developer's Manual consists of ten volumes:\n"                                                                                         // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Basic Architecture, Order Number 253665; Instruction Set Reference A-L, Order Number 253666;\n"                                                                                             // Colorize: green
            "Instruction Set Reference M-U, Order Number 253667; Instruction Set Reference V-Z, Order Number\n"                                                                                          // Colorize: green
            "326018; Instruction Set Reference, Order Number 334569; System Programming Guide, Part 1, Order\n"                                                                                          // Colorize: green
            "Number 253668; System Programming Guide, Part 2, Order Number 253669; System Programming\n"                                                                                                 // Colorize: green
            "Guide, Part 3, Order Number 326019; System Programming Guide, Part 4, Order Number 332831;\n"                                                                                               // Colorize: green
            "Model-Specific Registers, Order Number 335592. Refer to all ten volumes when evaluating your design\n"                                                                                      // Colorize: green
            "needs.\n"                                                                                                                                                                                   // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Order Number: 253665-077US\n"                                                                                                                                                               // Colorize: green
            "April 2022";                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        versionText2 =                                                                                                                                                                                   // Colorize: green
            "Intel(R) 64 and IA-32 Architectures\n"                                                                                                                                                        // Colorize: green
            "Software Developer's Manual\n"                                                                                                                                                              // Colorize: green
            "Volume 3A:\n"                                                                                                                                                                               // Colorize: green
            "System Programming Guide, Part 1\n"                                                                                                                                                         // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "NOTE: The Intel(R) 64 and IA-32 Architectures Software Developer's Manual consists of ten volumes:\n"                                                                                       // Colorize: green
            "Basic Architecture, Order Number 253665; Instruction Set Reference A-L, Order Number 253666;\n"                                                                                             // Colorize: green
            "Instruction Set Reference M-U, Order Number 253667; Instruction Set Reference V-Z, Order Number\n"                                                                                          // Colorize: green
            "326018; Instruction Set Reference, Order Number 334569; System Programming Guide, Part 1, Order\n"                                                                                          // Colorize: green
            "Number 253668; System Programming Guide, Part 2, Order Number 253669; System Programming\n"                                                                                                 // Colorize: green
            "Guide, Part 3, Order Number 326019; System Programming Guide, Part 4, Order Number 332831;\n"                                                                                               // Colorize: green
            "Model-Specific Registers, Order Number 335592. Refer to all ten volumes when evaluating your design\n"                                                                                      // Colorize: green
            "needs.\n"                                                                                                                                                                                   // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Order Number: 253668-077US\n"                                                                                                                                                               // Colorize: green
            "April 2022";                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            !specContent.contains(versionText1)                                                                                                                                                           // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            !specContent.contains(versionText2)                                                                                                                                                          // Colorize: green
           )                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("X86 Registers specification version didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void X86RegistersSpecVerifier::checkX86Cr0Flags(SpecVerifyThread *thread, const QString &specContent)                                                                                                    // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString registersText1;                                                                                                                                                                          // Colorize: green
    QString registersText2;                                                                                                                                                                          // Colorize: green
    QString registersText3;                                                                                                                                                                          // Colorize: green
    QString registersText4;                                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init registersText1, registersText2, registersText3 and registersText4                                                                                                                                                                           // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        registersText1 =                                                                                                                                                                                  // Colorize: green
            "CR0.PG\n"                                                                                                                                                                                   // Colorize: green
            "Paging (bit 31 of CR0) - Enables paging when set; disables paging when clear. When paging is\n"                                                                                             // Colorize: green
            "disabled, all linear addresses are treated as physical addresses. The PG flag has no effect if the PE flag (bit\n"                                                                          // Colorize: green
            "0 of register CR0) is not also set; setting the PG flag when the PE flag is clear causes a general-protection\n"                                                                            // Colorize: green
            "exception (#GP). See also: Chapter 4, \"Paging.\"\n"                                                                                                                                        // Colorize: green
            "On Intel 64 processors, enabling and disabling IA-32e mode operation also requires modifying CR0.PG.";                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        registersText2 =                                                                                                                                                                                 // Colorize: green
            "CR0.CD\n"                                                                                                                                                                                   // Colorize: green
            "Cache Disable (bit 30 of CR0) - When the CD and NW flags are clear, caching of memory locations for\n"                                                                                      // Colorize: green
            "the whole of physical memory in the processor's internal (and external) caches is enabled. When the CD\n"                                                                                   // Colorize: green
            "flag is set, caching is restricted as described in Table 11-5. To prevent the processor from accessing and\n"                                                                               // Colorize: green
            "updating its caches, the CD flag must be set and the caches must be invalidated so that no cache hits can\n"                                                                                // Colorize: green
            "occur.\n"                                                                                                                                                                                   // Colorize: green
            "See also: Section 11.5.3, \"Preventing Caching,\" and Section 11.5, \"Cache Control.\"\n"                                                                                                   // Colorize: green
            "CR0.NW\n"                                                                                                                                                                                   // Colorize: green
            "Not Write-through (bit 29 of CR0) - When the NW and CD flags are clear, write-back (for Pentium 4,\n"                                                                                       // Colorize: green
            "Intel Xeon, P6 family, and Pentium processors) or write-through (for Intel486 processors) is enabled for\n"                                                                                 // Colorize: green
            "writes that hit the cache and invalidation cycles are enabled. See Table 11-5 for detailed information about\n"                                                                             // Colorize: green
            "the effect of the NW flag on caching for other settings of the CD and NW flags.\n"                                                                                                          // Colorize: green
            "CR0.AM\n"                                                                                                                                                                                   // Colorize: green
            "Alignment Mask (bit 18 of CR0) - Enables automatic alignment checking when set; disables alignment\n"                                                                                       // Colorize: green
            "checking when clear. Alignment checking is performed only when the AM flag is set, the AC flag in the\n"                                                                                    // Colorize: green
            "EFLAGS register is set, CPL is 3, and the processor is operating in either protected or virtual-8086 mode.\n"                                                                               // Colorize: green
            "CR0.WP\n"                                                                                                                                                                                   // Colorize: green
            "Write Protect (bit 16 of CR0) - When set, inhibits supervisor-level procedures from writing into readonly pages; when clear, allows supervisor-level procedures to write into read-only pages (regardless of the\n" // Colorize: green
            "U/S bit setting; see Section 4.1.3 and Section 4.6). This flag facilitates implementation of the copy-onwrite method of creating a new process (forking) used by operating systems such as UNIX. This flag must\n" // Colorize: green
            "be set before software can set CR4.CET, and it cannot be cleared as long as CR4.CET = 1 (see below).\n"                                                                                     // Colorize: green
            "CR0.NE\n"                                                                                                                                                                                   // Colorize: green
            "Numeric Error (bit 5 of CR0) - Enables the native (internal) mechanism for reporting x87 FPU errors\n"                                                                                      // Colorize: green
            "when set; enables the PC-style x87 FPU error reporting mechanism when clear. When the NE flag is clear\n"                                                                                   // Colorize: green
            "and the IGNNE# input is asserted, x87 FPU errors are ignored. When the NE flag is clear and the IGNNE#\n"                                                                                   // Colorize: green
            "input is deasserted, an unmasked x87 FPU error causes the processor to assert the FERR# pin to generate\n"                                                                                  // Colorize: green
            "an external interrupt and to stop instruction execution immediately before executing the next waiting\n"                                                                                    // Colorize: green
            "floating-point instruction or WAIT/FWAIT instruction.\n"                                                                                                                                    // Colorize: green
            "The FERR# pin is intended to drive an input to an external interrupt controller (the FERR# pin emulates the\n"                                                                              // Colorize: green
            "ERROR# pin of the Intel 287 and Intel 387 DX math coprocessors). The NE flag, IGNNE# pin, and FERR#\n"                                                                                      // Colorize: green
            "pin are used with external logic to implement PC-style error reporting. Using FERR# and IGNNE# to handle\n"                                                                                 // Colorize: green
            "floating-point exceptions is deprecated by modern operating systems; this non-native approach also limits\n"                                                                                // Colorize: green
            "newer processors to operate with one logical processor active.\n"                                                                                                                           // Colorize: green
            "See also: Section 8.7, \"Handling x87 FPU Exceptions in Software\" in Chapter 8, \"Programming with the x87\n"                                                                              // Colorize: green
            "FPU,\" and Appendix A, \"EFLAGS Cross-Reference,\" in the Intel(R) 64 and IA-32 Architectures Software\n"                                                                                     // Colorize: green
            "Developer's Manual, Volume 1.\n"                                                                                                                                                            // Colorize: green
            "CR0.ET\n"                                                                                                                                                                                   // Colorize: green
            "Extension Type (bit 4 of CR0) - Reserved in the Pentium 4, Intel Xeon, P6 family, and Pentium processors. In the Pentium 4, Intel Xeon, and P6 family processors, this flag is hardcoded to 1. In the Intel386\n" // Colorize: green
            "and Intel486 processors, this flag indicates support of Intel 387 DX math coprocessor instructions when\n"                                                                                  // Colorize: green
            "set.\n"                                                                                                                                                                                     // Colorize: green
            "CR0.TS\n"                                                                                                                                                                                   // Colorize: green
            "Task Switched (bit 3 of CR0) - Allows the saving of the x87 FPU/MMX/SSE/SSE2/SSE3/SSSE3/SSE4\n"                                                                                             // Colorize: green
            "context on a task switch to be delayed until an x87 FPU/MMX/SSE/SSE2/SSE3/SSSE3/SSE4 instruction is\n"                                                                                      // Colorize: green
            "actually executed by the new task. The processor sets this flag on every task switch and tests it when\n"                                                                                   // Colorize: green
            "executing x87 FPU/MMX/SSE/SSE2/SSE3/SSSE3/SSE4 instructions.\n"                                                                                                                             // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "*\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "If the TS flag is set and the EM flag (bit 2 of CR0) is clear, a device-not-available exception (#NM) is\n"                                                                                 // Colorize: green
            "raised prior to the execution of any x87 FPU/MMX/SSE/SSE2/SSE3/SSSE3/SSE4 instruction; with the\n"                                                                                          // Colorize: green
            "exception of PAUSE, PREFETCHh, SFENCE, LFENCE, MFENCE, MOVNTI, CLFLUSH, CRC32, and POPCNT.\n"                                                                                               // Colorize: green
            "See the paragraph below for the special case of the WAIT/FWAIT instructions.\n"                                                                                                             // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "*\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "If the TS flag is set and the MP flag (bit 1 of CR0) and EM flag are clear, an #NM exception is not raised\n"                                                                               // Colorize: green
            "prior to the execution of an x87 FPU WAIT/FWAIT instruction.";                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        registersText3 =                                                                                                                                                                                 // Colorize: green
            "If the EM flag is set, the setting of the TS flag has no effect on the execution of x87\n"                                                                                                  // Colorize: green
            "FPU/MMX/SSE/SSE2/SSE3/SSSE3/SSE4 instructions.\n"                                                                                                                                           // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Table 2-2 shows the actions taken when the processor encounters an x87 FPU instruction based on the\n"                                                                                      // Colorize: green
            "settings of the TS, EM, and MP flags. Table 12-1 and 13-1 show the actions taken when the processor\n"                                                                                      // Colorize: green
            "encounters an MMX/SSE/SSE2/SSE3/SSSE3/SSE4 instruction.\n"                                                                                                                                  // Colorize: green
            "The processor does not automatically save the context of the x87 FPU, XMM, and MXCSR registers on a\n"                                                                                      // Colorize: green
            "task switch. Instead, it sets the TS flag, which causes the processor to raise an #NM exception whenever it\n"                                                                              // Colorize: green
            "encounters an x87 FPU/MMX/SSE/SSE2/SSE3/SSSE3/SSE4 instruction in the instruction stream for the\n"                                                                                         // Colorize: green
            "new task (with the exception of the instructions listed above).\n"                                                                                                                          // Colorize: green
            "The fault handler for the #NM exception can then be used to clear the TS flag (with the CLTS instruction)\n"                                                                                // Colorize: green
            "and save the context of the x87 FPU, XMM, and MXCSR registers. If the task never encounters an x87\n"                                                                                       // Colorize: green
            "FPU/MMX/SSE/SSE2/SSE3/SSSE3/SSE4 instruction, the x87 FPU/MMX/SSE/SSE2/SSE3/SSSE3/SSE4\n"                                                                                                   // Colorize: green
            "context is never saved.\n"                                                                                                                                                                  // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Table 2-2. Action Taken By x87 FPU Instructions for Different Combinations of EM, MP, and TS\n"                                                                                             // Colorize: green
            "CR0 Flags\n"                                                                                                                                                                                // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "x87 FPU Instruction Type\n"                                                                                                                                                                 // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "EM\n"                                                                                                                                                                                       // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "MP\n"                                                                                                                                                                                       // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "TS\n"                                                                                                                                                                                       // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Floating-Point\n"                                                                                                                                                                           // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "WAIT/FWAIT\n"                                                                                                                                                                               // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "0\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "0\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "0\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Execute\n"                                                                                                                                                                                  // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Execute.\n"                                                                                                                                                                                 // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "0\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "0\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "1\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "#NM Exception\n"                                                                                                                                                                            // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Execute.\n"                                                                                                                                                                                 // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "0\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "1\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "0\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Execute\n"                                                                                                                                                                                  // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Execute.\n"                                                                                                                                                                                 // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "0\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "1\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "1\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "#NM Exception\n"                                                                                                                                                                            // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "#NM exception.\n"                                                                                                                                                                           // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "1\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "0\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "0\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "#NM Exception\n"                                                                                                                                                                            // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Execute.\n"                                                                                                                                                                                 // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "1\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "0\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "1\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "#NM Exception\n"                                                                                                                                                                            // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Execute.\n"                                                                                                                                                                                 // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "1\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "1\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "0\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "#NM Exception\n"                                                                                                                                                                            // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Execute.\n"                                                                                                                                                                                 // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "1\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "1\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "1\n"                                                                                                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "#NM Exception\n"                                                                                                                                                                            // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "#NM exception.\n"                                                                                                                                                                           // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "CR0.EM\n"                                                                                                                                                                                   // Colorize: green
            "Emulation (bit 2 of CR0) - Indicates that the processor does not have an internal or external x87 FPU when set;\n"                                                                          // Colorize: green
            "indicates an x87 FPU is present when clear. This flag also affects the execution of\n"                                                                                                      // Colorize: green
            "MMX/SSE/SSE2/SSE3/SSSE3/SSE4 instructions.\n"                                                                                                                                               // Colorize: green
            "When the EM flag is set, execution of an x87 FPU instruction generates a device-not-available exception\n"                                                                                  // Colorize: green
            "(#NM). This flag must be set when the processor does not have an internal x87 FPU or is not connected to\n"                                                                                 // Colorize: green
            "an external math coprocessor. Setting this flag forces all floating-point instructions to be handled by software emulation. Table 9-3 shows the recommended setting of this flag, depending on the IA-32 processor\n" // Colorize: green
            "and x87 FPU or math coprocessor present in the system. Table 2-2 shows the interaction of the EM, MP, and\n"                                                                                // Colorize: green
            "TS flags.\n"                                                                                                                                                                                // Colorize: green
            "Also, when the EM flag is set, execution of an MMX instruction causes an invalid-opcode exception (#UD)\n"                                                                                  // Colorize: green
            "to be generated (see Table 12-1). Thus, if an IA-32 or Intel 64 processor incorporates MMX technology, the\n"                                                                               // Colorize: green
            "EM flag must be set to 0 to enable execution of MMX instructions.\n"                                                                                                                        // Colorize: green
            "Similarly for SSE/SSE2/SSE3/SSSE3/SSE4 extensions, when the EM flag is set, execution of most\n"                                                                                            // Colorize: green
            "SSE/SSE2/SSE3/SSSE3/SSE4 instructions causes an invalid opcode exception (#UD) to be generated (see\n"                                                                                      // Colorize: green
            "Table 13-1). If an IA-32 or Intel 64 processor incorporates the SSE/SSE2/SSE3/SSSE3/SSE4 extensions,\n"                                                                                     // Colorize: green
            "the EM flag must be set to 0 to enable execution of these extensions. SSE/SSE2/SSE3/SSSE3/SSE4\n"                                                                                           // Colorize: green
            "instructions not affected by the EM flag include: PAUSE, PREFETCHh, SFENCE, LFENCE, MFENCE, MOVNTI,\n"                                                                                      // Colorize: green
            "CLFLUSH, CRC32, and POPCNT.\n"                                                                                                                                                              // Colorize: green
            "CR0.MP\n"                                                                                                                                                                                   // Colorize: green
            "Monitor Coprocessor (bit 1 of CR0) - Controls the interaction of the WAIT (or FWAIT) instruction with\n"                                                                                    // Colorize: green
            "the TS flag (bit 3 of CR0). If the MP flag is set, a WAIT instruction generates a device-not-available exception\n"                                                                         // Colorize: green
            "(#NM) if the TS flag is also set. If the MP flag is clear, the WAIT instruction ignores the setting of the TS flag.";                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        registersText4 =                                                                                                                                                                                 // Colorize: green
            "Table 9-3 shows the recommended setting of this flag, depending on the IA-32 processor and x87 FPU or\n"                                                                                    // Colorize: green
            "math coprocessor present in the system. Table 2-2 shows the interaction of the MP, EM, and TS flags.\n"                                                                                     // Colorize: green
            "CR0.PE\n"                                                                                                                                                                                   // Colorize: green
            "Protection Enable (bit 0 of CR0) - Enables protected mode when set; enables real-address mode when\n"                                                                                       // Colorize: green
            "clear. This flag does not enable paging directly. It only enables segment-level protection. To enable paging,\n"                                                                            // Colorize: green
            "both the PE and PG flags must be set.\n"                                                                                                                                                    // Colorize: green
            "See also: Section 9.9, \"Mode Switching.\"";                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            !specContent.contains(registersText1)                                                                                                                                                         // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            !specContent.contains(registersText2)                                                                                                                                                        // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            !specContent.contains(registersText3)                                                                                                                                                        // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            !specContent.contains(registersText4)                                                                                                                                                        // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("CR0 Register specification didn't match with the stored one");                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList registers;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Parse registers                                                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString registerText;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        QStringList lines = (registersText1 + "\n" + registersText2 + "\n" + registersText3 + "\n" + registersText4).split('\n');                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < lines.size(); ++i)                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line.startsWith("CR0."))                                                                                                                                                                 // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                registers.append(registerText);                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                registerText = "";                                                                                                                                                                       // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
            else                                                                                                                                                                                         // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                registerText.append(' ');                                                                                                                                                                // Colorize: green
                registerText.append(line);                                                                                                                                                               // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        registers.append(registerText);                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList values;                                                                                                                                                                                  // Colorize: green
    QStringList descriptions;                                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        for (qint64 i = 0; i < registers.size(); ++i)                                                                                                                                                    // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QRegularExpressionMatch match = mRegisterRegExp.match(registers.at(i).simplified());                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (match.hasMatch())                                                                                                                                                                        // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                QString field       = match.captured(1).simplified().toUpper().replace(' ', '_').replace('-', '_');                                                                                                                                                 // Colorize: green
                QString value       = match.captured(2);                                                                                                                                                 // Colorize: green
                QString description = match.captured(3);                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                fields.append(field);                                                                                                                                        // Colorize: green
                values.append(value);                                                                                                                                                                    // Colorize: green
                descriptions.append(description);                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList registersLines;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        registersLines.append(QString("// Verified with X86RegistersSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                        .arg(X86_REGISTERS_SPECIFICATION_URL_2)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        registersLines.append("typedef good_U32 x86_cr0_flags;");                                                                                                                                        // Colorize: green
        registersLines.append("");                                                                                                                                                                       // Colorize: green
        registersLines.append("enum class X86Cr0Flag: x86_cr0_flags");                                                                                                                                   // Colorize: green
        registersLines.append("{");                                                                                                                                                                      // Colorize: green
        registersLines.append("    NONE                = 0,");                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = fields.size() - 1; i >= 0; --i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            registersLines.append(QString("    %1 = BIT_%2%3%4 // %5")                                                                                                                                               // Colorize: green
                                            .arg(fields.at(i), -19, QChar(' '))                                                                                                                                  // Colorize: green
                                            .arg(values.at(i))                                                                                                                                           // Colorize: green
                                            .arg(i > 0 ? "," : " ")                                                                                                                                           // Colorize: green
                                            .arg("", 2 - values.at(i).length(), QChar(' '))                                                                                                                                           // Colorize: green
                                            .arg(descriptions.at(i))                                                                                                                                           // Colorize: green
            );                                                                                                                                                                                           // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        registersLines.append("};");                                                                                                                                                                     // Colorize: green
        registersLines.append("");                                                                                                                                                                       // Colorize: green
        registersLines.append("DEFINE_FLAGS(X86Cr0Flags, x86_cr0_flags); // TEST: NO");                                                                                                                  // Colorize: green
        registersLines.append(QString("// Verified with X86RegistersSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                        .arg(X86_REGISTERS_SPECIFICATION_URL_2)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(registersLines, thread->getPath() + "/" + X86_CR0_FLAGS_H))                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check CR0 Register with specification");                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void X86RegistersSpecVerifier::checkX86Cr4Flags(SpecVerifyThread *thread, const QString &specContent)                                                                                                    // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString registersText1;                                                                                                                                                                          // Colorize: green
    QString registersText2;                                                                                                                                                                          // Colorize: green
    QString registersText3;                                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init registersText1, registersText2 and registersText3                                                                                                                                                                           // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        registersText1 =                                                                                                                                                                                  // Colorize: green
            "CR4.VME\n"                                                                                                                                                                                  // Colorize: green
            "Virtual-8086 Mode Extensions (bit 0 of CR4) - Enables interrupt- and exception-handling extensions\n"                                                                                       // Colorize: green
            "in virtual-8086 mode when set; disables the extensions when clear. Use of the virtual mode extensions can\n"                                                                                // Colorize: green
            "improve the performance of virtual-8086 applications by eliminating the overhead of calling the virtual8086 monitor to handle interrupts and exceptions that occur while executing an 8086 program and,\n" // Colorize: green
            "instead, redirecting the interrupts and exceptions back to the 8086 program's handlers. It also provides\n"                                                                                 // Colorize: green
            "hardware support for a virtual interrupt flag (VIF) to improve reliability of running 8086 programs in multitasking and multiple-processor environments.\n"                                 // Colorize: green
            "See also: Section 20.3, \"Interrupt and Exception Handling in Virtual-8086 Mode.\"\n"                                                                                                       // Colorize: green
            "CR4.PVI\n"                                                                                                                                                                                  // Colorize: green
            "Protected-Mode Virtual Interrupts (bit 1 of CR4) - Enables hardware support for a virtual interrupt\n"                                                                                      // Colorize: green
            "flag (VIF) in protected mode when set; disables the VIF flag in protected mode when clear.\n"                                                                                               // Colorize: green
            "See also: Section 20.4, \"Protected-Mode Virtual Interrupts.\"\n"                                                                                                                           // Colorize: green
            "CR4.TSD\n"                                                                                                                                                                                  // Colorize: green
            "Time Stamp Disable (bit 2 of CR4) - Restricts the execution of the RDTSC instruction to procedures\n"                                                                                       // Colorize: green
            "running at privilege level 0 when set; allows RDTSC instruction to be executed at any privilege level when\n"                                                                               // Colorize: green
            "clear. This bit also applies to the RDTSCP instruction if supported (if CPUID.80000001H:EDX[27] = 1).\n"                                                                                    // Colorize: green
            "CR4.DE\n"                                                                                                                                                                                   // Colorize: green
            "Debugging Extensions (bit 3 of CR4) - References to debug registers DR4 and DR5 cause an undefined opcode (#UD) exception to be generated when set; when clear, processor aliases references to registers DR4 and DR5 for compatibility with software written to run on earlier IA-32 processors.\n" // Colorize: green
            "See also: Section 17.2.2, \"Debug Registers DR4 and DR5.\"\n"                                                                                                                               // Colorize: green
            "CR4.PSE\n"                                                                                                                                                                                  // Colorize: green
            "Page Size Extensions (bit 4 of CR4) - Enables 4-MByte pages with 32-bit paging when set; restricts\n"                                                                                       // Colorize: green
            "32-bit paging to pages of 4 KBytes when clear.\n"                                                                                                                                           // Colorize: green
            "See also: Section 4.3, \"32-Bit Paging.\"\n"                                                                                                                                                // Colorize: green
            "CR4.PAE\n"                                                                                                                                                                                  // Colorize: green
            "Physical Address Extension (bit 5 of CR4) - When set, enables paging to produce physical addresses\n"                                                                                       // Colorize: green
            "with more than 32 bits. When clear, restricts physical addresses to 32 bits. PAE must be set before entering\n"                                                                             // Colorize: green
            "IA-32e mode.\n"                                                                                                                                                                             // Colorize: green
            "See also: Chapter 4, \"Paging.\"\n"                                                                                                                                                         // Colorize: green
            "CR4.MCE\n"                                                                                                                                                                                  // Colorize: green
            "Machine-Check Enable (bit 6 of CR4) - Enables the machine-check exception when set; disables the\n"                                                                                         // Colorize: green
            "machine-check exception when clear.\n"                                                                                                                                                      // Colorize: green
            "1. Earlier versions of this manual used the term \"IA-32e paging\" to identify 4-level paging.";                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        registersText2 =                                                                                                                                                                                 // Colorize: green
            "See also: Chapter 15, \"Machine-Check Architecture.\"\n"                                                                                                                                    // Colorize: green
            "CR4.PGE\n"                                                                                                                                                                                  // Colorize: green
            "Page Global Enable (bit 7 of CR4) - (Introduced in the P6 family processors.) Enables the global page\n"                                                                                    // Colorize: green
            "feature when set; disables the global page feature when clear. The global page feature allows frequently\n"                                                                                 // Colorize: green
            "used or shared pages to be marked as global to all users (done with the global flag, bit 8, in a page-directory-pointer-table entry, a page-directory entry, or a page-table entry). Global pages are not flushed from\n" // Colorize: green
            "the translation-lookaside buffer (TLB) on a task switch or a write to register CR3.\n"                                                                                                      // Colorize: green
            "When enabling the global page feature, paging must be enabled (by setting the PG flag in control register\n"                                                                                // Colorize: green
            "CR0) before the PGE flag is set. Reversing this sequence may affect program correctness, and processor\n"                                                                                   // Colorize: green
            "performance will be impacted.\n"                                                                                                                                                            // Colorize: green
            "See also: Section 4.10, \"Caching Translation Information.\"\n"                                                                                                                             // Colorize: green
            "CR4.PCE\n"                                                                                                                                                                                  // Colorize: green
            "Performance-Monitoring Counter Enable (bit 8 of CR4) - Enables execution of the RDPMC instruction for programs or procedures running at any protection level when set; RDPMC instruction can be\n" // Colorize: green
            "executed only at protection level 0 when clear.\n"                                                                                                                                          // Colorize: green
            "CR4.OSFXSR\n"                                                                                                                                                                               // Colorize: green
            "Operating System Support for FXSAVE and FXRSTOR instructions (bit 9 of CR4) - When set, this\n"                                                                                             // Colorize: green
            "flag: (1) indicates to software that the operating system supports the use of the FXSAVE and FXRSTOR\n"                                                                                     // Colorize: green
            "instructions, (2) enables the FXSAVE and FXRSTOR instructions to save and restore the contents of the\n"                                                                                    // Colorize: green
            "XMM and MXCSR registers along with the contents of the x87 FPU and MMX registers, and (3) enables the\n"                                                                                    // Colorize: green
            "processor to execute SSE/SSE2/SSE3/SSSE3/SSE4 instructions, with the exception of the PAUSE,\n"                                                                                             // Colorize: green
            "PREFETCHh, SFENCE, LFENCE, MFENCE, MOVNTI, CLFLUSH, CRC32, and POPCNT.\n"                                                                                                                   // Colorize: green
            "If this flag is clear, the FXSAVE and FXRSTOR instructions will save and restore the contents of the x87 FPU\n"                                                                             // Colorize: green
            "and MMX registers, but they may not save and restore the contents of the XMM and MXCSR registers. Also,\n"                                                                                  // Colorize: green
            "the processor will generate an invalid opcode exception (#UD) if it attempts to execute any\n"                                                                                              // Colorize: green
            "SSE/SSE2/SSE3 instruction, with the exception of PAUSE, PREFETCHh, SFENCE, LFENCE, MFENCE,\n"                                                                                               // Colorize: green
            "MOVNTI, CLFLUSH, CRC32, and POPCNT. The operating system or executive must explicitly set this flag.\n"                                                                                     // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "NOTE\n"                                                                                                                                                                                     // Colorize: green
            "CPUID feature flag FXSR indicates availability of the FXSAVE/FXRSTOR instructions. The OSFXSR\n"                                                                                            // Colorize: green
            "bit provides operating system software with a means of enabling FXSAVE/FXRSTOR to save/restore\n"                                                                                           // Colorize: green
            "the contents of the X87 FPU, XMM and MXCSR registers. Consequently OSFXSR bit indicates that\n"                                                                                             // Colorize: green
            "the operating system provides context switch support for SSE/SSE2/SSE3/SSSE3/SSE4.\n"                                                                                                       // Colorize: green
            "CR4.OSXMMEXCPT\n"                                                                                                                                                                           // Colorize: green
            "Operating System Support for Unmasked SIMD Floating-Point Exceptions (bit 10 of CR4) -\n"                                                                                                   // Colorize: green
            "When set, indicates that the operating system supports the handling of unmasked SIMD floating-point\n"                                                                                      // Colorize: green
            "exceptions through an exception handler that is invoked when a SIMD floating-point exception (#XM) is\n"                                                                                    // Colorize: green
            "generated. SIMD floating-point exceptions are only generated by SSE/SSE2/SSE3/SSE4.1 SIMD floatingpoint instructions.\n"                                                                    // Colorize: green
            "The operating system or executive must explicitly set this flag. If this flag is not set, the processor will\n"                                                                             // Colorize: green
            "generate an invalid opcode exception (#UD) whenever it detects an unmasked SIMD floating-point exception.\n"                                                                                // Colorize: green
            "CR4.UMIP\n"                                                                                                                                                                                 // Colorize: green
            "User-Mode Instruction Prevention (bit 11 of CR4) - When set, the following instructions cannot be\n"                                                                                        // Colorize: green
            "executed if CPL > 0: SGDT, SIDT, SLDT, SMSW, and STR. An attempt at such execution causes a generalprotection exception (#GP).\n"                                                           // Colorize: green
            "CR4.LA57\n"                                                                                                                                                                                 // Colorize: green
            "57-bit linear addresses (bit 12 of CR4) - When set in IA-32e mode, the processor uses 5-level paging\n"                                                                                     // Colorize: green
            "to translate 57-bit linear addresses. When clear in IA-32e mode, the processor uses 4-level paging to\n"                                                                                    // Colorize: green
            "translate 48-bit linear addresses. This bit cannot be modified in IA-32e mode.\n"                                                                                                           // Colorize: green
            "See also: Chapter 4, \"Paging.\"";                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        registersText3 =                                                                                                                                                                                 // Colorize: green
            "CR4.VMXE\n"                                                                                                                                                                                 // Colorize: green
            "VMX-Enable Bit (bit 13 of CR4) - Enables VMX operation when set. See Chapter 23, \"Introduction to\n"                                                                                       // Colorize: green
            "Virtual Machine Extensions.\"\n"                                                                                                                                                            // Colorize: green
            "CR4.SMXE\n"                                                                                                                                                                                 // Colorize: green
            "SMX-Enable Bit (bit 14 of CR4) - Enables SMX operation when set. See Chapter 6, \"Safer Mode Extensions Reference\" of Intel(R) 64 and IA-32 Architectures Software Developer's Manual, Volume 2D.\n" // Colorize: green
            "CR4.FSGSBASE\n"                                                                                                                                                                             // Colorize: green
            "FSGSBASE-Enable Bit (bit 16 of CR4) - Enables the instructions RDFSBASE, RDGSBASE, WRFSBASE,\n"                                                                                             // Colorize: green
            "and WRGSBASE.\n"                                                                                                                                                                            // Colorize: green
            "CR4.PCIDE\n"                                                                                                                                                                                // Colorize: green
            "PCID-Enable Bit (bit 17 of CR4) - Enables process-context identifiers (PCIDs) when set. See Section\n"                                                                                      // Colorize: green
            "4.10.1, \"Process-Context Identifiers (PCIDs)\". Applies only in IA-32e mode (if IA32_EFER.LMA = 1).\n"                                                                                     // Colorize: green
            "CR4.OSXSAVE\n"                                                                                                                                                                              // Colorize: green
            "XSAVE and Processor Extended States-Enable Bit (bit 18 of CR4) - When set, this flag: (1) indicates (via CPUID.01H:ECX.OSXSAVE[bit 27]) that the operating system supports the use of the XGETBV,\n" // Colorize: green
            "XSAVE and XRSTOR instructions by general software; (2) enables the XSAVE and XRSTOR instructions to\n"                                                                                      // Colorize: green
            "save and restore the x87 FPU state (including MMX registers), the SSE state (XMM registers and MXCSR),\n"                                                                                   // Colorize: green
            "along with other processor extended states enabled in XCR0; (3) enables the processor to execute XGETBV\n"                                                                                  // Colorize: green
            "and XSETBV instructions in order to read and write XCR0. See Section 2.6 and Chapter 13, \"System\n"                                                                                        // Colorize: green
            "Programming for Instruction Set Extensions and Processor Extended States\".\n"                                                                                                              // Colorize: green
            "CR4.KL\n"                                                                                                                                                                                   // Colorize: green
            "Key-Locker-Enable Bit (bit 19 of CR4) - When set, the LOADIWKEY instruction is enabled; in addition,\n"                                                                                     // Colorize: green
            "if support for the AES Key Locker instructions has been activated by system firmware,\n"                                                                                                    // Colorize: green
            "CPUID.19H:EBX.AESKLE[bit 0] is enumerated as 1 and the AES Key Locker instructions are enabled.1\n"                                                                                         // Colorize: green
            "When clear, CPUID.19H:EBX.AESKLE[bit 0] is enumerated as 0 and execution of any Key Locker instruction\n"                                                                                   // Colorize: green
            "causes an invalid-opcode exception (#UD).\n"                                                                                                                                                // Colorize: green
            "CR4.SMEP\n"                                                                                                                                                                                 // Colorize: green
            "SMEP-Enable Bit (bit 20 of CR4) - Enables supervisor-mode execution prevention (SMEP) when set.\n"                                                                                          // Colorize: green
            "See Section 4.6, \"Access Rights\".\n"                                                                                                                                                      // Colorize: green
            "CR4.SMAP\n"                                                                                                                                                                                 // Colorize: green
            "SMAP-Enable Bit (bit 21 of CR4) - Enables supervisor-mode access prevention (SMAP) when set. See\n"                                                                                         // Colorize: green
            "Section 4.6, \"Access Rights.\"\n"                                                                                                                                                          // Colorize: green
            "CR4.PKE\n"                                                                                                                                                                                  // Colorize: green
            "Enable protection keys for user-mode pages (bit 22 of CR4) - 4-level paging and 5-level paging\n"                                                                                           // Colorize: green
            "associate each user-mode linear address with a protection key. When set, this flag indicates (via\n"                                                                                        // Colorize: green
            "CPUID.(EAX=07H,ECX=0H):ECX.OSPKE [bit 4]) that the operating system supports use of the PKRU\n"                                                                                             // Colorize: green
            "register to specify, for each protection key, whether user-mode linear addresses with that protection key\n"                                                                                // Colorize: green
            "can be read or written. This bit also enables access to the PKRU register using the RDPKRU and WRPKRU\n"                                                                                    // Colorize: green
            "instructions.\n"                                                                                                                                                                            // Colorize: green
            "CR4.CET\n"                                                                                                                                                                                  // Colorize: green
            "Control-flow Enforcement Technology (bit 23 of CR4) - Enables control-flow enforcement technology when set. See Chapter 18, \"Control-flow Enforcement Technology (CET)\" of the IA-32 Intel(R) Architecture Software Developer's Manual, Volume 1. This flag can be set only if CR0.WP is set, and it must be\n" // Colorize: green
            "clear before CR0.WP can be cleared (see below).\n"                                                                                                                                          // Colorize: green
            "CR4.PKS\n"                                                                                                                                                                                  // Colorize: green
            "Enable protection keys for supervisor-mode pages (bit 24 of CR4) - 4-level paging and 5-level\n"                                                                                            // Colorize: green
            "paging associate each supervisor-mode linear address with a protection key. When set, this flag allows use\n"                                                                               // Colorize: green
            "of the IA32_PKRS MSR to specify, for each protection key, whether supervisor-mode linear addresses with\n"                                                                                  // Colorize: green
            "that protection key can be read or written.\n"                                                                                                                                              // Colorize: green
            "1. Software can check CPUID.19H:EBX.AESKLE[bit 0] after setting CR4.KL to determine whether the AES Key Locker instructions have\n"                                                         // Colorize: green
            "been enabled. Note that some processors may allow enabling of those instructions without activation by system firmware. Some\n"                                                             // Colorize: green
            "processors may not support use of the AES Key Locker instructions in system-management mode (SMM). Those processors enumerate CPUID.19H:EBX.AESKLE[bit 0] as 0 in SMM regardless of the setting of CR4.KL."; // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            !specContent.contains(registersText1)                                                                                                                                                         // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            !specContent.contains(registersText2)                                                                                                                                                        // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            !specContent.contains(registersText3)                                                                                                                                                        // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("CR4 Register specification didn't match with the stored one");                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList registers;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Parse registers                                                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString registerText;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        QStringList lines = (registersText1 + "\n" + registersText2 + "\n" + registersText3).split('\n');                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < lines.size(); ++i)                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line.startsWith("CR4."))                                                                                                                                                                 // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                registers.append(registerText);                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                registerText = "";                                                                                                                                                                       // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
            else                                                                                                                                                                                         // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                registerText.append(' ');                                                                                                                                                                // Colorize: green
                registerText.append(line);                                                                                                                                                               // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        registers.append(registerText);                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList values;                                                                                                                                                                                  // Colorize: green
    QStringList descriptions;                                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        for (qint64 i = 0; i < registers.size(); ++i)                                                                                                                                                    // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QRegularExpressionMatch match = mRegisterRegExp.match(registers.at(i).simplified());                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (match.hasMatch())                                                                                                                                                                        // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                QString field       = match.captured(1).simplified().toUpper().replace(' ', '_').replace('-', '_');                                                                                                                                                 // Colorize: green
                QString value       = match.captured(2);                                                                                                                                                 // Colorize: green
                QString description = match.captured(3);                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                if (field.at(0).isDigit())                                                                                                                                                               // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    field.prepend('_');                                                                                                                                                                  // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                fields.append(field);                                                                                                                                        // Colorize: green
                values.append(value);                                                                                                                                                                    // Colorize: green
                descriptions.append(description);                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QHash<QString, QString> x86FieldNamesToNgosFieldNames; // X86 field name => NGOS field name                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill elfFieldNamesToNgosFieldNames                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("VIRTUAL_8086_MODE_EXTENSIONS",                                         "VIRTUAL_8086_MODE_EXTENSIONS");                                                    // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("PROTECTED_MODE_VIRTUAL_INTERRUPTS",                                    "PROTECTED_MODE_VIRTUAL_INTERRUPTS");                                               // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("TIME_STAMP_DISABLE",                                                   "TIME_STAMP_DISABLE");                                                              // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("DEBUGGING_EXTENSIONS",                                                 "DEBUGGING_EXTENSIONS");                                                            // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("PAGE_SIZE_EXTENSIONS",                                                 "PAGE_SIZE_EXTENSIONS");                                                            // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("PHYSICAL_ADDRESS_EXTENSION",                                           "PHYSICAL_ADDRESS_EXTENSION");                                                      // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("MACHINE_CHECK_ENABLE",                                                 "MACHINE_CHECK_ENABLE");                                                            // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("PAGE_GLOBAL_ENABLE",                                                   "PAGE_GLOBAL_ENABLE");                                                              // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("PERFORMANCE_MONITORING_COUNTER_ENABLE",                                "PERFORMANCE_MONITORING_COUNTER_ENABLE");                                           // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("OPERATING_SYSTEM_SUPPORT_FOR_FXSAVE_AND_FXRSTOR_INSTRUCTIONS",         "SUPPORT_FXSAVE");                                                                  // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("OPERATING_SYSTEM_SUPPORT_FOR_UNMASKED_SIMD_FLOATING_POINT_EXCEPTIONS", "SUPPORT_UNMASKED_SSE_EXCEPTIONS");                                                 // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("USER_MODE_INSTRUCTION_PREVENTION",                                     "USER_MODE_INSTRUCTION_PREVENTION");                                                // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("_57_BIT_LINEAR_ADDRESSES",                                             "_57_BIT_LINEAR_ADDRESSES");                                                        // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("VMX_ENABLE_BIT",                                                       "VIRTUAL_MACHINE_EXTENSIONS_ENABLE");                                               // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("SMX_ENABLE_BIT",                                                       "SAFER_MODE_EXTENSIONS_ENABLE");                                                    // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("FSGSBASE_ENABLE_BIT",                                                  "FSGSBASE");                                                                        // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("PCID_ENABLE_BIT",                                                      "PROCESS_CONTEXT_ID_ENABLE");                                                       // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("XSAVE_AND_PROCESSOR_EXTENDED_STATES_ENABLE_BIT",                       "SUPPORT_XSAVE");                                                                   // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("KEY_LOCKER_ENABLE_BIT",                                                "KEY_LOCKER_ENABLE_BIT");                                                           // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("SMEP_ENABLE_BIT",                                                      "SUPERVISOR_MODE_EXECUTION_PROTECTION_ENABLE");                                     // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("SMAP_ENABLE_BIT",                                                      "SUPERVISOR_MODE_ACCESS_PROTECTION_ENABLE");                                        // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("ENABLE_PROTECTION_KEYS_FOR_USER_MODE_PAGES",                           "ENABLE_PROTECTION_KEYS_FOR_USER_MODE_PAGES");                                      // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("CONTROL_FLOW_ENFORCEMENT_TECHNOLOGY",                                  "CONTROL_FLOW_ENFORCEMENT_TECHNOLOGY");                                             // Colorize: green
        x86FieldNamesToNgosFieldNames.insert("ENABLE_PROTECTION_KEYS_FOR_SUPERVISOR_MODE_PAGES",                     "ENABLE_PROTECTION_KEYS_FOR_SUPERVISOR_MODE_PAGES");                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList registersLines;                                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        registersLines.append(QString("// Verified with X86RegistersSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                        .arg(X86_REGISTERS_SPECIFICATION_URL_2)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        registersLines.append("typedef good_U64 x86_cr4_flags;");                                                                                                                                        // Colorize: green
        registersLines.append("");                                                                                                                                                                       // Colorize: green
        registersLines.append("enum class X86Cr4Flag: x86_cr4_flags");                                                                                                                                   // Colorize: green
        registersLines.append("{");                                                                                                                                                                      // Colorize: green
        registersLines.append("    NONE                                             = 0,");                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fields.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString fieldName = fields.at(i);                                                                                                                                                            // Colorize: green
            QString name      = x86FieldNamesToNgosFieldNames.value(fieldName, "");                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (name == "")                                                                                                                                                                              // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert X86 field name: %1")                                                                                                                         // Colorize: green
                                            .arg(fieldName)                                                                                                                                              // Colorize: green
                );                                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            registersLines.append(QString("    %1 = BIT_%2%3%4 // %5")                                                                                                                             // Colorize: green
                                            .arg(name, -48, QChar(' '))                                                                                                                                  // Colorize: green
                                            .arg(values.at(i))                                                                                                                                           // Colorize: green
                                            .arg(i < fields.size() - 1 ? "," : " ")                                                                                                                                           // Colorize: green
                                            .arg("", 2 - values.at(i).length(), QChar(' '))                                                                                                                                           // Colorize: green
                                            .arg(descriptions.at(i))                                                                                                                                           // Colorize: green
            );                                                                                                                                                                                           // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        registersLines.append("};");                                                                                                                                                                     // Colorize: green
        registersLines.append("");                                                                                                                                                                       // Colorize: green
        registersLines.append("DEFINE_FLAGS(X86Cr4Flags, x86_cr4_flags); // TEST: NO");                                                                                                                  // Colorize: green
        registersLines.append(QString("// Verified with X86RegistersSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                        .arg(X86_REGISTERS_SPECIFICATION_URL_2)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(registersLines, thread->getPath() + "/" + X86_CR4_FLAGS_H))                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check CR4 Register with specification");                                                                                                                          // Colorize: green
    }                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void X86RegistersSpecVerifier::checkX86Cr8(SpecVerifyThread *thread, const QString &specContent)                                                                                                         // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString registersText;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init registersText                                                                                                                                                                              // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        registersText =                                                                                                                                                                                // Colorize: green
            "CR8.TPL\n"                                                                                                                                                                                    // Colorize: green
            "Task Priority Level (bit 3:0 of CR8) - This sets the threshold value corresponding to the highestpriority interrupt to be blocked. A value of 0 means all interrupts are enabled. This field is available in 64bit mode. A value of 15 means all interrupts will be disabled.";                                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(registersText))                                                                                                                                                      // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("CR8 Register specification didn't match with the stored one");                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList registersLines;                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        registersLines.append(QString("// Verified with X86RegistersSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                        .arg(X86_REGISTERS_SPECIFICATION_URL_2)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        registersLines.append("struct X86Cr8");                                                                                                                                                          // Colorize: green
        registersLines.append("{");                                                                                                                                                                      // Colorize: green
        registersLines.append("    union");                                                                                                                                                              // Colorize: green
        registersLines.append("    {");                                                                                                                                                                  // Colorize: green
        registersLines.append("        struct");                                                                                                                                                         // Colorize: green
        registersLines.append("        {");                                                                                                                                                              // Colorize: green
        registersLines.append("            good_U64 taskPriorityLevel: 4;  // This sets the threshold value corresponding to the highest priority interrupt to be blocked");                             // Colorize: green
        registersLines.append("            good_U64 _reserved:         60;");                                                                                                                            // Colorize: green
        registersLines.append("        };");                                                                                                                                                             // Colorize: green
        registersLines.append("");                                                                                                                                                                       // Colorize: green
        registersLines.append("        good_U64 value64;");                                                                                                                                              // Colorize: green
        registersLines.append("    };");                                                                                                                                                                 // Colorize: green
        registersLines.append("} __attribute__((packed));");                                                                                                                                             // Colorize: green
        registersLines.append(QString("// Verified with X86RegistersSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                        .arg(X86_REGISTERS_SPECIFICATION_URL_2)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(registersLines, thread->getPath() + "/" + X86_CR8_H))                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check CR8 Register with specification");                                                                                                                         // Colorize: green
    }                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void X86RegistersSpecVerifier::checkX86Flags(SpecVerifyThread *thread, const QString &specContent)                                                                                                        // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString registersText1;                                                                                                                                                                          // Colorize: green
    QString registersText2;                                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init registersText1 and registersText2                                                                                                                                                                           // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        registersText1 =                                                                                                                                                                                 // Colorize: green
            "CF (bit 0)\n"                                                                                                                                                                               // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Carry flag - Set if an arithmetic operation generates a carry or a borrow out of the mostsignificant bit of the result; cleared otherwise. This flag indicates an overflow condition for\n" // Colorize: green
            "unsigned-integer arithmetic. It is also used in multiple-precision arithmetic.\n"                                                                                                           // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "PF (bit 2)\n"                                                                                                                                                                               // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Parity flag - Set if the least-significant byte of the result contains an even number of 1 bits;\n"                                                                                         // Colorize: green
            "cleared otherwise.\n"                                                                                                                                                                       // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "AF (bit 4)\n"                                                                                                                                                                               // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Auxiliary Carry flag - Set if an arithmetic operation generates a carry or a borrow out of bit\n"                                                                                           // Colorize: green
            "3 of the result; cleared otherwise. This flag is used in binary-coded decimal (BCD) arithmetic.\n"                                                                                          // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "ZF (bit 6)\n"                                                                                                                                                                               // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Zero flag - Set if the result is zero; cleared otherwise.\n"                                                                                                                                // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "SF (bit 7)\n"                                                                                                                                                                               // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Sign flag - Set equal to the most-significant bit of the result, which is the sign bit of a signed\n"                                                                                       // Colorize: green
            "integer. (0 indicates a positive value and 1 indicates a negative value.)\n"                                                                                                                // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "OF (bit 11)\n"                                                                                                                                                                              // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Overflow flag - Set if the integer result is too large a positive number or too small a negative\n"                                                                                         // Colorize: green
            "number (excluding the sign-bit) to fit in the destination operand; cleared otherwise. This flag\n"                                                                                          // Colorize: green
            "indicates an overflow condition for signed-integer (two's complement) arithmetic.\n"                                                                                                        // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Of these status flags, only the CF flag can be modified directly, using the STC, CLC, and CMC instructions. Also the\n"                                                                     // Colorize: green
            "bit instructions (BT, BTS, BTR, and BTC) copy a specified bit into the CF flag.";                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        registersText2 =                                                                                                                                                                                 // Colorize: green
            "The status flags allow a single arithmetic operation to produce results for three different data types: unsigned integers, signed integers, and BCD integers. If the result of an arithmetic operation is treated as an unsigned integer,\n" // Colorize: green
            "the CF flag indicates an out-of-range condition (carry or a borrow); if treated as a signed integer (two's complement number), the OF flag indicates a carry or borrow; and if treated as a BCD digit, the AF flag indicates a carry\n" // Colorize: green
            "or borrow. The SF flag indicates the sign of a signed integer. The ZF flag indicates either a signed- or an unsignedinteger zero.\n"                                                        // Colorize: green
            "When performing multiple-precision arithmetic on integers, the CF flag is used in conjunction with the add with\n"                                                                          // Colorize: green
            "carry (ADC) and subtract with borrow (SBB) instructions to propagate a carry or borrow from one computation to\n"                                                                           // Colorize: green
            "the next.\n"                                                                                                                                                                                // Colorize: green
            "The condition instructions Jcc (jump on condition code cc), SETcc (byte set on condition code cc), LOOPcc, and\n"                                                                           // Colorize: green
            "CMOVcc (conditional move) use one or more of the status flags as condition codes and test them for branch, setbyte, or end-loop conditions.\n"                                              // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "3.4.3.2\n"                                                                                                                                                                                  // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "DF Flag\n"                                                                                                                                                                                  // Colorize: green
            "\n"                                                                                                                                                                                        // Colorize: green
            "The direction flag (DF, located in bit 10 of the EFLAGS register) controls string instructions (MOVS, CMPS, SCAS,\n"                                                                        // Colorize: green
            "LODS, and STOS). Setting the DF flag causes the string instructions to auto-decrement (to process strings from\n"                                                                           // Colorize: green
            "high addresses to low addresses). Clearing the DF flag causes the string instructions to auto-increment\n"                                                                                  // Colorize: green
            "(process strings from low addresses to high addresses).\n"                                                                                                                                  // Colorize: green
            "The STD and CLD instructions set and clear the DF flag, respectively.\n"                                                                                                                    // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "3.4.3.3\n"                                                                                                                                                                                  // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "System Flags and IOPL Field\n"                                                                                                                                                              // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "The system flags and IOPL field in the EFLAGS register control operating-system or executive operations. They\n"                                                                            // Colorize: green
            "should not be modified by application programs. The functions of the system flags are as follows:\n"                                                                                        // Colorize: green
            "TF (bit 8)\n"                                                                                                                                                                               // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Trap flag - Set to enable single-step mode for debugging; clear to disable single-step mode.\n"                                                                                             // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "IF (bit 9)\n"                                                                                                                                                                               // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Interrupt enable flag - Controls the response of the processor to maskable interrupt\n"                                                                                                     // Colorize: green
            "requests. Set to respond to maskable interrupts; cleared to inhibit maskable interrupts.\n"                                                                                                 // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "IOPL (bits 12 and 13)\n"                                                                                                                                                                    // Colorize: green
            "I/O privilege level field - Indicates the I/O privilege level of the currently running program\n"                                                                                           // Colorize: green
            "or task. The current privilege level (CPL) of the currently running program or task must be less\n"                                                                                         // Colorize: green
            "than or equal to the I/O privilege level to access the I/O address space. The POPF and IRET\n"                                                                                              // Colorize: green
            "instructions can modify this field only when operating at a CPL of 0.\n"                                                                                                                    // Colorize: green
            "NT (bit 14)\n"                                                                                                                                                                              // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Nested task flag - Controls the chaining of interrupted and called tasks. Set when the\n"                                                                                                   // Colorize: green
            "current task is linked to the previously executed task; cleared when the current task is not\n"                                                                                             // Colorize: green
            "linked to another task.\n"                                                                                                                                                                  // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "RF (bit 16)\n"                                                                                                                                                                              // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Resume flag - Controls the processor's response to debug exceptions.\n"                                                                                                                     // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "VM (bit 17)\n"                                                                                                                                                                              // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Virtual-8086 mode flag - Set to enable virtual-8086 mode; clear to return to protected\n"                                                                                                   // Colorize: green
            "mode without virtual-8086 mode semantics.\n"                                                                                                                                                // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "AC (bit 18)\n"                                                                                                                                                                              // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Alignment check (or access control) flag - If the AM bit is set in the CR0 register, alignment checking of user-mode data accesses is enabled if and only if this flag is 1.\n"             // Colorize: green
            "If the SMAP bit is set in the CR4 register, explicit supervisor-mode data accesses to user-mode\n"                                                                                          // Colorize: green
            "pages are allowed if and only if this bit is 1. See Section 4.6, \"Access Rights,\" in the Intel(R) 64\n"                                                                                       // Colorize: green
            "and IA-32 Architectures Software Developer's Manual, Volume 3A.\n"                                                                                                                          // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "VIF (bit 19)\n"                                                                                                                                                                             // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Virtual interrupt flag - Virtual image of the IF flag. Used in conjunction with the VIP flag.\n"                                                                                            // Colorize: green
            "(To use this flag and the VIP flag the virtual mode extensions are enabled by setting the VME\n"                                                                                            // Colorize: green
            "flag in control register CR4.)\n"                                                                                                                                                           // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "VIP (bit 20)\n"                                                                                                                                                                             // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Virtual interrupt pending flag - Set to indicate that an interrupt is pending; clear when no\n"                                                                                             // Colorize: green
            "interrupt is pending. (Software sets and clears this flag; the processor only reads it.) Used in\n"                                                                                         // Colorize: green
            "conjunction with the VIF flag.\n"                                                                                                                                                           // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "ID (bit 21)\n"                                                                                                                                                                              // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "Identification flag - The ability of a program to set or clear this flag indicates support for\n"                                                                                           // Colorize: green
            "the CPUID instruction.";                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            !specContent.contains(registersText1)                                                                                                                                                         // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            !specContent.contains(registersText2)                                                                                                                                                        // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("FLAGS Register specification didn't match with the stored one");                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList bits;                                                                                                                                                                               // Colorize: green
    QStringList registers;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Parse registers                                                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString registerText;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        QStringList lines = (registersText1 + "\n" + registersText2).split('\n');                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < lines.size(); ++i)                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line != "")                                                                                                                                                                              // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                QRegularExpressionMatch match = mFlagsBitRegExp.match(line);                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                if (match.hasMatch())                                                                                                                                                                    // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    bits.append(match.captured(1));                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    if (registerText != "")                                                                                                                                                              // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        registers.append(registerText);                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        registerText = "";                                                                                                                                                               // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    registerText.append(' ');                                                                                                                                                            // Colorize: green
                    registerText.append(line);                                                                                                                                                           // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        registers.append(registerText);                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList descriptions;                                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        for (qint64 i = 0; i < registers.size(); ++i)                                                                                                                                                    // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QRegularExpressionMatch match = mFlagsDescriptionRegExp.match(registers.at(i).simplified());                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (match.hasMatch())                                                                                                                                                                        // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                QString field       = match.captured(1).simplified().toUpper().replace(' ', '_').replace('-', '_').remove('(').remove(')');                                                                                                                                                 // Colorize: green
                QString description = match.captured(2);                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                fields.append(field);                                                                                                                                        // Colorize: green
                descriptions.append(description);                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Update fields                                                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        bits.insert(1, "1");                                                                                                                                                                            // Colorize: green
        fields.insert(1, "FIXED");                                                                                                                                                    // Colorize: green
        descriptions.insert(1, "Reserved, always 1 in EFLAGS");                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        bits.insert(9, "10");                                                                                                                                                                            // Colorize: green
        fields.insert(9, "DIRECTION_FLAG");                                                                                                                                                    // Colorize: green
        descriptions.insert(9, "Controls string instructions (MOVS, CMPS, SCAS, LODS, and STOS). Setting the DF flag causes the string instructions to auto-decrement (to process strings from high addresses to low addresses)"); // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Move OVERFLOW_FLAG                                                                                                                                                                                                 // Colorize: green
        bits.move(6, 9);                                                                                                                                                                                 // Colorize: green
        fields.move(6, 9);                                                                                                                                                                               // Colorize: green
        descriptions.move(6, 9);                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        fields[10] = "IO_PRIVELEGE_LEVEL_BIT_0";                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        bits.insert(11, "13");                                                                                                                                                                            // Colorize: green
        fields.insert(11, "IO_PRIVELEGE_LEVEL_BIT_1");                                                                                                                                                    // Colorize: green
        descriptions.insert(11, descriptions.at(10));                                                                                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList registersLines;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        registersLines.append(QString("// Verified with X86RegistersSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                        .arg(X86_REGISTERS_SPECIFICATION_URL_1)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        registersLines.append("typedef good_U64 x86_flags;");                                                                                                                                            // Colorize: green
        registersLines.append("");                                                                                                                                                                       // Colorize: green
        registersLines.append("enum class X86Flag: x86_flags");                                                                                                                                          // Colorize: green
        registersLines.append("{");                                                                                                                                                                      // Colorize: green
        registersLines.append("    NONE                                   = 0,");                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fields.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            registersLines.append(QString("    %1 = BIT_%2%3%4 // %5")                                                                                                                                               // Colorize: green
                                            .arg(fields.at(i), -38, QChar(' '))                                                                                                                                  // Colorize: green
                                            .arg(bits.at(i))                                                                                                                                           // Colorize: green
                                            .arg(i < fields.size() - 1 ? "," : " ")                                                                                                                                           // Colorize: green
                                            .arg("", 2 - bits.at(i).length(), QChar(' '))                                                                                                                                           // Colorize: green
                                            .arg(descriptions.at(i))                                                                                                                                           // Colorize: green
            );                                                                                                                                                                                           // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        registersLines.append("};");                                                                                                                                                                     // Colorize: green
        registersLines.append("");                                                                                                                                                                       // Colorize: green
        registersLines.append("DEFINE_FLAGS(X86Flags, x86_flags); // TEST: NO");                                                                                                                  // Colorize: green
        registersLines.append(QString("// Verified with X86RegistersSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                        .arg(X86_REGISTERS_SPECIFICATION_URL_1)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(registersLines, thread->getPath() + "/" + X86_FLAGS_H))                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check FLAGS Register with specification");                                                                                                                          // Colorize: green
    }                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
X86RegistersSpecVerifier x86RegistersSpecVerifier;                                                                                                                                                               // Colorize: green
