#include "intelmsrspecverifier.h"                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <QDebug>                                                                                                                                                                                        // Colorize: green
#include <QEventLoop>                                                                                                                                                                                    // Colorize: green
#include <QFile>                                                                                                                                                                                         // Colorize: green
#include <QNetworkAccessManager>                                                                                                                                                                         // Colorize: green
#include <QNetworkReply>                                                                                                                                                                                 // Colorize: green
#include <QNetworkRequest>                                                                                                                                                                               // Colorize: green
#include <QProcess>                                                                                                                                                                                      // Colorize: green
#include <QTemporaryDir>                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define INTEL_SPECIFICATION_URL "https://cdrdv2.intel.com/v1/dl/getContent/671098" // Version: April 2022                                                                                                           // Colorize: green
#define INTEL_PDF               "intelmsr.pdf"                                                                                                                                                             // Colorize: green
#define INTEL_XML               "intelmsr.xml"                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define MSRREGISTER_H                  "src/os/shared/common/src/com/ngos/shared/common/msr/lib/msrregister.h"                                                                                                   // Colorize: green
#define MSRIA32ARCHCAPABILITIESFLAGS_H "src/os/shared/common/src/com/ngos/shared/common/msr/lib/registers/msria32archcapabilitiesflags.h"                                                                // Colorize: green
#define MSRIA32BIOSSIGNID_H            "src/os/shared/common/src/com/ngos/shared/common/msr/lib/registers/msria32biossignid.h"                                                                           // Colorize: green
#define MSRIA32EFERFLAGS_H             "src/os/shared/common/src/com/ngos/shared/common/msr/lib/registers/msria32eferflags.h"                                                                             // Colorize: green
#define MSRIA32MISCENABLEFLAGS_H       "src/os/shared/common/src/com/ngos/shared/common/msr/lib/registers/msria32miscenableflags.h"                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define HEX_COLUMN_LEFT  50                                                                                                                                                                               // Colorize: green
#define HEX_COLUMN_RIGHT 120                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define NAME_COLUMN_LEFT  170                                                                                                                                                                              // Colorize: green
#define NAME_COLUMN_RIGHT 400                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define DESCRIPTION_COLUMN_LEFT  400                                                                                                                                                                       // Colorize: green
#define DESCRIPTION_COLUMN_RIGHT 650                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
IntelMsrSpecVerifier::IntelMsrSpecVerifier()                                                                                                                                                             // Colorize: green
    : SpecVerifier()                                                                                                                                                                                     // Colorize: green
    , mMsrRegisterHexRegExp("^[0-9A-F_]+H(-[0-9A-F_]+H)?$")                                                                                                                                              // Colorize: green
    , mMsrRegisterNameRegExp("^(IA32_\\w+).*")                                                                                                                                                             // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // Nothing                                                                                                                                                                                           // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void IntelMsrSpecVerifier::verify(SpecVerifyThread *thread)                                                                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread != nullptr);                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString specContent;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!downloadSpecification(thread, INTEL_SPECIFICATION_URL, specContent))                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        return;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Replace some special characters                                                                                                                                                           // Colorize: green
    {                                                                                                                                                                                            // Colorize: green
        specContent.replace(QChar(0x00AE), "(R)");  // Replace registered sign character            // https://www.compart.com/en/unicode/U+00AE                                                                 // Colorize: green
        specContent.replace(QChar(0x2018), '\'');   // Replace left single quotation mark           // https://www.compart.com/en/unicode/U+2018                                                                    // Colorize: green
        specContent.replace(QChar(0x2019), '\'');   // Replace right double quotation mark          // https://www.compart.com/en/unicode/U+2019                                                                    // Colorize: green
        specContent.replace(QChar(0x201C), '\"');   // Replace left double quotation mark           // https://www.compart.com/en/unicode/U+201C                                                                    // Colorize: green
        specContent.replace(QChar(0x201D), '\"');   // Replace right double quotation mark          // https://www.compart.com/en/unicode/U+201D                                                                    // Colorize: green
        specContent.replace(QChar(0x2122), "(TM)"); // Replace trade mark sign character            // https://www.compart.com/en/unicode/U+2122                                                                 // Colorize: green
        specContent.replace(QChar(0x2265), ">=");   // Replace greater-than or equal to character   // https://www.compart.com/en/unicode/U+201D                                                                    // Colorize: green
    }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QDomDocument xml;                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare XML document                                                                                                                                                                              // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString errorMessage;                                                                                                                                                                            // Colorize: green
        int     errorLine;                                                                                                                                                                               // Colorize: green
        int     errorColumn;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (!xml.setContent(specContent, &errorMessage, &errorLine, &errorColumn))                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError(QString("Failed to parse XML document for INTEL MSR %1:%2 : %3")                                                                                                            // Colorize: green
                                    .arg(errorLine)                                                                                                                                                      // Colorize: green
                                    .arg(errorColumn)                                                                                                                                                    // Colorize: green
                                    .arg(errorMessage)                                                                                                                                                   // Colorize: green
            );                                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    checkWithSpecification(thread, specContent, xml);                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool IntelMsrSpecVerifier::downloadSpecification(SpecVerifyThread *thread, const QString &url, QString &specContent)                                                                                           // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    QTemporaryDir tempDir;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Create temporary directory                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!tempDir.isValid())                                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to create temporary directory for INTEL MSR specification");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Download specification                                                                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QNetworkAccessManager  manager;                                                                                                                                                                  // Colorize: green
        QNetworkReply         *reply;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Send network request                                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QNetworkRequest request;                                                                                                                                                                     // Colorize: green
            request.setUrl(QUrl(url));                                                                                                                                                 // Colorize: green
            reply = manager.get(request);                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Wait for finish                                                                                                                                                                               // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QEventLoop waitLoop;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QObject::connect(reply, SIGNAL(finished()),                                 &waitLoop, SLOT(quit()));                                                                                        // Colorize: green
            QObject::connect(reply, SIGNAL(errorOccurred(QNetworkReply::NetworkError)), &waitLoop, SLOT(quit()));                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            waitLoop.exec();                                                                                                                                                                             // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Check status code                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QVariant statusCode = reply->attribute(QNetworkRequest::HttpStatusCodeAttribute);                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (statusCode.toInt() != 200)                                                                                                                                                               // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to get INTEL MSR specification from: %1")                                                                                                               // Colorize: green
                                            .arg(url)                                                                                                                                  // Colorize: green
                );                                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                delete reply;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return false;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        QByteArray content = reply->readAll();                                                                                                                                                           // Colorize: green
        delete reply;                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Write documentation to file                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QFile file(tempDir.path() + "/" + INTEL_PDF);                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (!file.open(QIODevice::WriteOnly))                                                                                                                                                        // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError("Failed to create temporary file for INTEL MSR specification");                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return false;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            file.write(content);                                                                                                                                                                         // Colorize: green
            file.close();                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Convert PDF to text                                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QProcess process;                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        process.setWorkingDirectory(tempDir.path());                                                                                                                                                     // Colorize: green
        process.start("pdftohtml", QStringList() << "-xml" << INTEL_PDF << INTEL_XML);                                                                                                                                 // Colorize: green
        process.waitForFinished(-1);                                                                                                                                                                     // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Read specification text                                                                                                                                                                           // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QFile file(tempDir.path() + "/" + INTEL_XML);                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (!file.open(QIODevice::ReadOnly))                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to open INTEL MSR specification");                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        specContent += QString::fromUtf8(file.readAll());                                                                                                                                                 // Colorize: green
        file.close();                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return true;                                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void IntelMsrSpecVerifier::checkWithSpecification(SpecVerifyThread *thread, const QString &specContent, QDomDocument &xml)                                                                                                  // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    qint64 errorsBefore = thread->getErrors().size();                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check code with specification                                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        checkIntelSpecification(thread, specContent, xml);                                                                                                                                                      // Colorize: green
        checkMsrRegisters(thread, specContent, xml);                                                                                                                                                      // Colorize: green
        checkMsrIa32ArchCapabilitiesFlags(thread, specContent, xml);                                                                                                                                                      // Colorize: green
        checkMsrIa32BiosSignId(thread, specContent, xml);                                                                                                                                                      // Colorize: green
        checkMsrIa32EferFlags(thread, specContent, xml);                                                                                                                                                      // Colorize: green
        checkMsrIa32MiscEnableFlags(thread, specContent, xml);                                                                                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (thread->getErrors().size() == errorsBefore)                                                                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addMessage("Code verified with INTEL MSR specification");                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
    else                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addMessage("Found error in code with INTEL MSR specification");                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void IntelMsrSpecVerifier::checkIntelSpecification(SpecVerifyThread *thread, const QString &specContent, QDomDocument & /*xml*/)                                                                                                   // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString versionText;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init versionText                                                                                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        versionText =                                                                                                                                                                                    // Colorize: green
            "<text top=\"207\" left=\"326\" width=\"510\" height=\"43\" font=\"0\">Intel(R) 64 and IA-32 Architectures</text>\n"                                                                           // Colorize: green
            "<text top=\"243\" left=\"385\" width=\"451\" height=\"43\" font=\"0\">Software Developer's Manual</text>\n"                                                                                 // Colorize: green
            "<text top=\"303\" left=\"724\" width=\"113\" height=\"34\" font=\"1\">Volume 4:</text>\n"                                                                                                   // Colorize: green
            "<text top=\"333\" left=\"558\" width=\"279\" height=\"34\" font=\"1\">Model-Specific Registers</text>\n"                                                                                    // Colorize: green
            "<text top=\"465\" left=\"122\" width=\"41\" height=\"21\" font=\"2\">NOTE:</text>\n"                                                                                                        // Colorize: green
            "<text top=\"465\" left=\"163\" width=\"39\" height=\"21\" font=\"3\"> The </text>\n"                                                                                                        // Colorize: green
            "<text top=\"465\" left=\"202\" width=\"31\" height=\"21\" font=\"4\"><i>Intel</i></text>\n"                                                                                                 // Colorize: green
            "<text top=\"463\" left=\"233\" width=\"10\" height=\"15\" font=\"5\"><i>(R)</i></text>\n"                                                                                                     // Colorize: green
            "<text top=\"465\" left=\"242\" width=\"417\" height=\"21\" font=\"4\"><i> 64 and IA-32 Architectures Software Developer's Manual</i></text>\n"                                              // Colorize: green
            "<text top=\"465\" left=\"659\" width=\"177\" height=\"21\" font=\"3\"> consists of ten volumes:</text>\n"                                                                                   // Colorize: green
            "<text top=\"484\" left=\"122\" width=\"130\" height=\"21\" font=\"4\"><i>Basic Architecture</i></text>\n"                                                                                   // Colorize: green
            "<text top=\"484\" left=\"252\" width=\"188\" height=\"21\" font=\"3\">, Order Number 253665; </text>\n"                                                                                     // Colorize: green
            "<text top=\"484\" left=\"440\" width=\"216\" height=\"21\" font=\"4\"><i>Instruction Set Reference A-L</i></text>\n"                                                                        // Colorize: green
            "<text top=\"484\" left=\"656\" width=\"181\" height=\"21\" font=\"3\">, Order Number 253666;</text>\n"                                                                                      // Colorize: green
            "<text top=\"504\" left=\"122\" width=\"215\" height=\"21\" font=\"4\"><i>Instruction Set Reference M-U</i></text>\n"                                                                        // Colorize: green
            "<text top=\"504\" left=\"337\" width=\"180\" height=\"21\" font=\"3\">, Order Number 253667; </text>\n"                                                                                     // Colorize: green
            "<text top=\"504\" left=\"517\" width=\"212\" height=\"21\" font=\"4\"><i>Instruction Set Reference V-Z</i></text>\n"                                                                        // Colorize: green
            "<text top=\"504\" left=\"728\" width=\"108\" height=\"21\" font=\"3\">, Order Number</text>\n"                                                                                              // Colorize: green
            "<text top=\"523\" left=\"122\" width=\"65\" height=\"21\" font=\"3\">326018; </text>\n"                                                                                                     // Colorize: green
            "<text top=\"523\" left=\"188\" width=\"179\" height=\"21\" font=\"4\"><i>Instruction Set Reference</i></text>\n"                                                                            // Colorize: green
            "<text top=\"523\" left=\"366\" width=\"178\" height=\"21\" font=\"3\">, Order Number 334569; </text>\n"                                                                                     // Colorize: green
            "<text top=\"523\" left=\"544\" width=\"246\" height=\"21\" font=\"4\"><i>System Programming Guide, Part 1</i></text>\n"                                                                     // Colorize: green
            "<text top=\"523\" left=\"790\" width=\"47\" height=\"21\" font=\"3\">, Order</text>\n"                                                                                                      // Colorize: green
            "<text top=\"543\" left=\"122\" width=\"128\" height=\"21\" font=\"3\">Number 253668; </text>\n"                                                                                             // Colorize: green
            "<text top=\"543\" left=\"250\" width=\"253\" height=\"21\" font=\"4\"><i>System Programming Guide, Part 2</i></text>\n"                                                                     // Colorize: green
            "<text top=\"543\" left=\"503\" width=\"183\" height=\"21\" font=\"3\">, Order Number 253669; </text>\n"                                                                                     // Colorize: green
            "<text top=\"543\" left=\"686\" width=\"151\" height=\"21\" font=\"4\"><i>System Programming</i></text>\n"                                                                                   // Colorize: green
            "<text top=\"562\" left=\"122\" width=\"96\" height=\"21\" font=\"4\"><i>Guide, Part 3</i></text>\n"                                                                                         // Colorize: green
            "<text top=\"562\" left=\"218\" width=\"185\" height=\"21\" font=\"3\">, Order Number 326019; </text>\n"                                                                                     // Colorize: green
            "<text top=\"562\" left=\"403\" width=\"255\" height=\"21\" font=\"4\"><i>System Programming Guide, Part 4</i></text>\n"                                                                     // Colorize: green
            "<text top=\"562\" left=\"659\" width=\"178\" height=\"21\" font=\"3\">, Order Number 332831;</text>\n"                                                                                      // Colorize: green
            "<text top=\"582\" left=\"122\" width=\"178\" height=\"21\" font=\"4\"><i>Model-Specific Registers, </i></text>\n"                                                                           // Colorize: green
            "<text top=\"582\" left=\"300\" width=\"537\" height=\"21\" font=\"3\">Order Number 335592. Refer to all ten volumes when evaluating your design</text>\n"                                   // Colorize: green
            "<text top=\"601\" left=\"122\" width=\"45\" height=\"21\" font=\"3\">needs.</text>\n"                                                                                                       // Colorize: green
            "<text top=\"1030\" left=\"616\" width=\"221\" height=\"21\" font=\"3\">Order Number:  335592-077US</text>\n"                                                                                // Colorize: green
            "<text top=\"1048\" left=\"762\" width=\"75\" height=\"21\" font=\"3\">April 2022</text>";                                                                                                   // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(versionText))                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("INTEL MSR specification version didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void IntelMsrSpecVerifier::checkMsrRegisters(SpecVerifyThread *thread, const QString &specContent, QDomDocument &xml)                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QDomElement doc = xml.documentElement();                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    qint64 pageIndex  = 18;                                                                                                                                                                              // Colorize: green
    qint64 childIndex = 57;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QDomNodeList pages    = doc.childNodes();                                                                                                                                                            // Colorize: green
    QDomNodeList children = pages.at(pageIndex).childNodes();                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip pages and its children                                                                                                                                                                       // Colorize: green
    {                                                                                                                                                                                             // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            children.at(childIndex).toElement().text()     != "Table 2-2.  IA-32 Architectural MSRs"                                                                                                                                         // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 1).toElement().text() != "Register"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 2).toElement().text() != "Address"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 3).toElement().text() != "Architectural MSR Name / Bit Fields"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 4).toElement().text() != "(Former MSR Name)"                                                                                                                                                             // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 5).toElement().text() != "MSR/Bit Description"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 6).toElement().text() != "Comment"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 7).toElement().text() != "Hex"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 8).toElement().text() != "Decimal"                                                                                                                                                                    // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to find start position to parse INTEL MSR Registers");                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        childIndex += 9;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList hexes;                                                                                                                                                                              // Colorize: green
    QStringList names;                                                                                                                                                                              // Colorize: green
    QStringList descriptions;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Parse fields from XML                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString hex;                                                                                                                                                                     // Colorize: green
        QString name;                                                                                                                                                                    // Colorize: green
        QString description;                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                     // Colorize: green
        // Parse pages                                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            while (pageIndex < pages.size())                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                                // Colorize: green
                // Parse children                                                                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    children = pages.at(pageIndex).childNodes();                                                                                                                                         // Colorize: green
                                                                                                                                                                                                                 // Colorize: green
                    bool finish = false;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                                 // Colorize: green
                    while (childIndex < children.size())                                                                                                                                                         // Colorize: green
                    {                                                                                                                                                                                            // Colorize: green
                        QDomElement element = children.at(childIndex).toElement();                                                                                                                               // Colorize: green
                        QString     text    = element.text();                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                                // Colorize: green
                        // Check for end line                                                                                                                                                            // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            if (text == "Table 2-3.  MSRs in Processors Based on Intel(R) Core(TM) Microarchitecture")                                                                                   // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                finish = true;                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                hexes.append(hex);                                                                                                                                                       // Colorize: green
                                names.append(name);                                                                                                                                                      // Colorize: green
                                descriptions.append(description);                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                break;                                                                                                                                                                   // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Parse fields                                                                                                                                                                  // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            qint64 left = element.attribute("left", "-1").toLongLong();                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            if (left >= HEX_COLUMN_LEFT && left < HEX_COLUMN_RIGHT)                                                                                                                      // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                if (name == "" && description == "")                                                                                                                                     // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    hex.append(text);                                                                                                                                                    // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                                else                                                                                                                                                                     // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    if (hex != "")                                                                                                                                                       // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        hexes.append(hex);                                                                                                                                               // Colorize: green
                                        names.append(name);                                                                                                                                              // Colorize: green
                                        descriptions.append(description);                                                                                                                                // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    hex         = text;                                                                                                                                                  // Colorize: green
                                    name        = "";                                                                                                                                                    // Colorize: green
                                    description = "";                                                                                                                                                    // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                            else                                                                                                                                                                         // Colorize: green
                            if (left >= NAME_COLUMN_LEFT && left < NAME_COLUMN_RIGHT)                                                                                                                    // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                if (description == "")                                                                                                                                                   // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    name.append(' ');                                                                                                                                                    // Colorize: green
                                    name.append(text);                                                                                                                                                   // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                                else                                                                                                                                                                     // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    if (hex != "")                                                                                                                                                       // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        hexes.append(hex);                                                                                                                                               // Colorize: green
                                        names.append(name);                                                                                                                                              // Colorize: green
                                        descriptions.append(description);                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        hex = "";                                                                                                                                                        // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                            else                                                                                                                                                                         // Colorize: green
                            if (left >= DESCRIPTION_COLUMN_LEFT && left < DESCRIPTION_COLUMN_RIGHT)                                                                                                      // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                description.append(' ');                                                                                                                                                 // Colorize: green
                                description.append(text);                                                                                                                                                // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        ++childIndex;                                                                                                                                                                            // Colorize: green
                    }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                                 // Colorize: green
                    if (finish)                                                                                                                                                                                  // Colorize: green
                    {                                                                                                                                                                                            // Colorize: green
                        break;                                                                                                                                                                           // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                ++pageIndex;                                                                                                                                                                             // Colorize: green
                childIndex = 0;                                                                                                                                                                              // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (pageIndex >= pages.size())                                                                                                                                                                    // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to find end position to parse INTEL MSR Registers");                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fieldNames;                                                                                                                                                                              // Colorize: green
    QStringList fieldValues;                                                                                                                                                                             // Colorize: green
    QStringList fieldComments;                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        for (qint64 i = 0; i < names.size(); ++i)                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString hex         = hexes.at(i).simplified();                                                                                                                                              // Colorize: green
            QString name        = names.at(i).simplified();                                                                                                                                              // Colorize: green
            QString description = descriptions.at(i).simplified();                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            // Update hex                                                                                                                                                                                // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                qint64 index = hex.indexOf("Vol. 4MODEL-SPECIFIC REGISTERS (MSRS)");                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                if (index >= 0)                                                                                                                                                                          // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    hex = hex.mid(index + 37);                                                                                                                                                           // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                hex.remove(' ');                                                                                                                                                                         // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QRegularExpressionMatch match = mMsrRegisterHexRegExp.match(hex);                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (match.hasMatch())                                                                                                                                                                        // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                QRegularExpressionMatch match2 = mMsrRegisterNameRegExp.match(name);                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                if (match2.hasMatch())                                                                                                                                                                   // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    name = match2.captured(1).toUpper();                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    hex.remove('_');                                                                                                                                                                     // Colorize: green
                    hex.remove('H');                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    qint64 start;                                                                                                                                                                        // Colorize: green
                    qint64 end;                                                                                                                                                                          // Colorize: green
                    qint64 index = hex.indexOf('-');                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    if (index >= 0)                                                                                                                                                                      // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        start = hex.left(index).toLongLong(nullptr, 16);                                                                                                                                 // Colorize: green
                        end   = hex.mid(index + 1).toLongLong(nullptr, 16);                                                                                                                              // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                    else                                                                                                                                                                                 // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        start = hex.toLongLong(nullptr, 16);                                                                                                                                             // Colorize: green
                        end   = start;                                                                                                                                                                   // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    for (qint64 i = start; i <= end; ++i)                                                                                                                                                // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        QString fieldName        = name;                                                                                                                                                 // Colorize: green
                        QString fieldDescription = description;                                                                                                                                          // Colorize: green
                        QString hexNumber        = QString::number(i, 16).toUpper();                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        if (start != end)                                                                                                                                                                // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            fieldName.replace('X', hexNumber);                                                                                                                              // Colorize: green
                            fieldDescription.replace('X', hexNumber);                                                                                                                       // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        fieldNames.append(fieldName);                                                                                                                                                  // Colorize: green
                        fieldValues.append(QString("0x%1")                                                                                                                                               // Colorize: green
                                                    .arg(hexNumber, 8, QChar('0'))                                                                                                         // Colorize: green
                        );                                                                                                                                                 // Colorize: green
                        fieldComments.append(fieldDescription);                                                                                                                                               // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList msrRegistersLines;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        msrRegistersLines.append(QString("// Verified with IntelMsrSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                            .arg(INTEL_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        msrRegistersLines.append("enum class MsrRegister: good_U32");                                                                                                                                    // Colorize: green
        msrRegistersLines.append("{");                                                                                                                                                                // Colorize: green
        msrRegistersLines.append("    NONE                          = 0,");                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fieldNames.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            msrRegistersLines.append(QString("    %1 = %2, // %3")                                                                                                                                                   // Colorize: green
                                        .arg(fieldNames.at(i), -29, QChar(' '))                                                                                                                                                         // Colorize: green
                                        .arg(fieldValues.at(i))                                                                                                                                                                          // Colorize: green
                                        .arg(fieldComments.at(i))                                                                                                                                     // Colorize: green
            );                                                                                                                                                               // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        msrRegistersLines.append("};");                                                                                                                                                               // Colorize: green
        msrRegistersLines.append(QString("// Verified with IntelMsrSpecVerifier [END] // %1")                                                                                                               // Colorize: green
                                            .arg(INTEL_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Insert some specific fields                                                                                                                                                                       // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        msrRegistersLines.insert(504, "");                                                                                                                                                               // Colorize: green
        msrRegistersLines.insert(505, "    //");                                                                                                                                                         // Colorize: green
        msrRegistersLines.insert(506, "    // KVM");                                                                                                                                                     // Colorize: green
        msrRegistersLines.insert(507, "    //");                                                                                                                                                         // Colorize: green
        msrRegistersLines.insert(508, "");                                                                                                                                                               // Colorize: green
        msrRegistersLines.insert(509, "    KVM_CLOCKSOURCE_WALL_CLOCK    = 0x00000011, // KVM clock 1 wall clock");                                                                                       // Colorize: green
        msrRegistersLines.insert(510, "    KVM_CLOCKSOURCE_SYSTEM_TIME   = 0x00000012, // KVM clock 1 system time");                                                                                      // Colorize: green
        msrRegistersLines.insert(511, "    KVM_CLOCKSOURCE2_WALL_CLOCK   = 0x4B564D00, // KVM clock 2 wall clock");                                                                                       // Colorize: green
        msrRegistersLines.insert(512, "    KVM_CLOCKSOURCE2_SYSTEM_TIME  = 0x4B564D01  // KVM clock 2 system time");                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(msrRegistersLines, thread->getPath() + "/" + MSRREGISTER_H))                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check INTEL MSR Registers with specification");                                                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void IntelMsrSpecVerifier::checkMsrIa32ArchCapabilitiesFlags(SpecVerifyThread *thread, const QString &specContent, QDomDocument &xml)                                                                    // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QDomElement doc = xml.documentElement();                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    qint64 pageIndex  = 25;                                                                                                                                                                              // Colorize: green
    qint64 childIndex = 45;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QDomNodeList pages    = doc.childNodes();                                                                                                                                                            // Colorize: green
    QDomNodeList children = pages.at(pageIndex).childNodes();                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip pages and its children                                                                                                                                                                       // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            children.at(childIndex).toElement().text()     != "10AH"                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 1).toElement().text() != "266"                                                                                                                                      // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 2).toElement().text() != "IA32_ARCH_CAPABILITIES"                                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 3).toElement().text() != "Enumeration of Architectural Features "                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 4).toElement().text() != "(R/O)"                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 5).toElement().text() != "If CPUID.(EAX=07H, "                                                                                                                      // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 6).toElement().text() != "ECX=0):EDX[29]=1"                                                                                                                         // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to find start position to parse INTEL MSR IA32 Arch Capabilities");                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        childIndex += 7;                                                                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList names;                                                                                                                                                                                   // Colorize: green
    QStringList descriptions;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Parse fields from XML                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString name;                                                                                                                                                                                    // Colorize: green
        QString description;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Parse pages                                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            while (pageIndex < pages.size())                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                // Parse children                                                                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    children = pages.at(pageIndex).childNodes();                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    bool finish = false;                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    while (childIndex < children.size())                                                                                                                                                 // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        QDomElement element = children.at(childIndex).toElement();                                                                                                                       // Colorize: green
                        QString     text    = element.text();                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Check for end line                                                                                                                                                            // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            if (text == "10BH")                                                                                                                                                          // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                finish = true;                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                names.append(name);                                                                                                                                                      // Colorize: green
                                descriptions.append(description);                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                break;                                                                                                                                                                   // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Parse fields                                                                                                                                                                  // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            qint64 left = element.attribute("left", "-1").toLongLong();                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            if (left >= NAME_COLUMN_LEFT && left < NAME_COLUMN_RIGHT)                                                                                                                    // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                if (description == "")                                                                                                                                                   // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    name.append(' ');                                                                                                                                                    // Colorize: green
                                    name.append(text);                                                                                                                                                   // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                                else                                                                                                                                                                     // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    if (name != "")                                                                                                                                                      // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        names.append(name);                                                                                                                                              // Colorize: green
                                        descriptions.append(description);                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        name        = text;                                                                                                                                              // Colorize: green
                                        description = "";                                                                                                                                                // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                            else                                                                                                                                                                         // Colorize: green
                            if (left >= DESCRIPTION_COLUMN_LEFT && left < DESCRIPTION_COLUMN_RIGHT)                                                                                                      // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                description.append(' ');                                                                                                                                                 // Colorize: green
                                description.append(text);                                                                                                                                                // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        ++childIndex;                                                                                                                                                                    // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    if (finish)                                                                                                                                                                          // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        break;                                                                                                                                                                           // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                ++pageIndex;                                                                                                                                                                             // Colorize: green
                childIndex = 0;                                                                                                                                                                          // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (pageIndex >= pages.size())                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to find end position to parse INTEL MSR IA32 Arch Capabilities");                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fieldBits;                                                                                                                                                                             // Colorize: green
    QStringList fieldNames;                                                                                                                                                                              // Colorize: green
    QStringList fieldComments;                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        for (qint64 i = 0; i < names.size(); ++i)                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString name        = names.at(i).simplified();                                                                                                                                              // Colorize: green
            QString description = descriptions.at(i).simplified();                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            qint64 index = description.indexOf(':');                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (index >= 0)                                                                                                                                                                              // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                fieldBits.append(name);                                                                                                                                                                  // Colorize: green
                fieldNames.append(description.left(index).trimmed());                                                                                                                                    // Colorize: green
                fieldComments.append(description.mid(index + 1).trimmed());                                                                                                                              // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList msrRegistersLines;                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        msrRegistersLines.append(QString("// Verified with IntelMsrSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                            .arg(INTEL_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        msrRegistersLines.append("typedef good_U64 msr_ia32_arch_capabilities_flags;");                                                                                                                                                                          // Colorize: green
        msrRegistersLines.append("");                                                                                                                                                                                                         // Colorize: green
        msrRegistersLines.append("enum class MsrIa32ArchCapabilitiesFlag: msr_ia32_arch_capabilities_flags");                                                                                                                             // Colorize: green
        msrRegistersLines.append("{");                                                                                                                                                                // Colorize: green
        msrRegistersLines.append("    NONE                 = 0,");                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fieldNames.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            msrRegistersLines.append(QString("    %1 = (1ULL << %2)%3%4 // %5")                                                                                                                                                   // Colorize: green
                                        .arg(fieldNames.at(i), -20, QChar(' '))                                                                                                                                                         // Colorize: green
                                        .arg(fieldBits.at(i))                                                                                                                                            // Colorize: green
                                        .arg(i < fieldNames.size() - 1 ? "," : " ")                                                                                                                           // Colorize: green
                                        .arg(fieldBits.at(i).length() < 2 ? " " : "")                                                                                                                           // Colorize: green
                                        .arg(fieldComments.at(i))                                                                                                                                     // Colorize: green
            );                                                                                                                                                               // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        msrRegistersLines.append("};");                                                                                                                                                                  // Colorize: green
        msrRegistersLines.append("");                                                                                                                                                                    // Colorize: green
        msrRegistersLines.append("DEFINE_FLAGS(MsrIa32ArchCapabilitiesFlags, msr_ia32_arch_capabilities_flags); // TEST: NO");                                                                           // Colorize: green
        msrRegistersLines.append(QString("// Verified with IntelMsrSpecVerifier [END] // %1")                                                                                                            // Colorize: green
                                            .arg(INTEL_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(msrRegistersLines, thread->getPath() + "/" + MSRIA32ARCHCAPABILITIESFLAGS_H))                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check INTEL MSR IA32 Arch Capabilities");                                                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void IntelMsrSpecVerifier::checkMsrIa32BiosSignId(SpecVerifyThread *thread, const QString &specContent, QDomDocument &xml)                                                                               // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QDomElement doc = xml.documentElement();                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    qint64 pageIndex  = 22;                                                                                                                                                                              // Colorize: green
    qint64 childIndex = 55;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QDomNodeList pages    = doc.childNodes();                                                                                                                                                            // Colorize: green
    QDomNodeList children = pages.at(pageIndex).childNodes();                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip pages and its children                                                                                                                                                                       // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            children.at(childIndex).toElement().text()     != "8BH"                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 1).toElement().text() != "139"                                                                                                                                      // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 2).toElement().text() != "IA32_BIOS_SIGN_ID"                                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 3).toElement().text() != "(BIOS_SIGN/BBL_CR_D3)"                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 4).toElement().text() != "BIOS Update Signature (R/W)"                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 5).toElement().text() != "Returns the microcode update signature "                                                                                                                      // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 6).toElement().text() != "following the execution of CPUID.01H."                                                                                                                         // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 7).toElement().text() != "A processor may prevent writing to this "                                                                                                                      // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 8).toElement().text() != "MSR when loading guest states on VM "                                                                                                                         // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 9).toElement().text() != "entries or saving guest states on VM exits."                                                                                                                         // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 10).toElement().text() != "06_01H"                                                                                                                         // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to find start position to parse INTEL MSR IA32 BIOS Sign ID");                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        childIndex += 11;                                                                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList names;                                                                                                                                                                                   // Colorize: green
    QStringList descriptions;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Parse fields from XML                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString name;                                                                                                                                                                                    // Colorize: green
        QString description;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Parse pages                                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            while (pageIndex < pages.size())                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                // Parse children                                                                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    children = pages.at(pageIndex).childNodes();                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    bool finish = false;                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    while (childIndex < children.size())                                                                                                                                                 // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        QDomElement element = children.at(childIndex).toElement();                                                                                                                       // Colorize: green
                        QString     text    = element.text();                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Check for end line                                                                                                                                                            // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            if (text == "8CH")                                                                                                                                                          // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                finish = true;                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                names.append(name);                                                                                                                                                      // Colorize: green
                                descriptions.append(description);                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                break;                                                                                                                                                                   // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Parse fields                                                                                                                                                                  // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            qint64 left = element.attribute("left", "-1").toLongLong();                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            if (left >= NAME_COLUMN_LEFT && left < NAME_COLUMN_RIGHT)                                                                                                                    // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                if (description == "")                                                                                                                                                   // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    name.append(' ');                                                                                                                                                    // Colorize: green
                                    name.append(text);                                                                                                                                                   // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                                else                                                                                                                                                                     // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    if (name != "")                                                                                                                                                      // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        names.append(name);                                                                                                                                              // Colorize: green
                                        descriptions.append(description);                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        name        = text;                                                                                                                                              // Colorize: green
                                        description = "";                                                                                                                                                // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                            else                                                                                                                                                                         // Colorize: green
                            if (left >= DESCRIPTION_COLUMN_LEFT && left < DESCRIPTION_COLUMN_RIGHT)                                                                                                      // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                description.append(' ');                                                                                                                                                 // Colorize: green
                                description.append(text);                                                                                                                                                // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        ++childIndex;                                                                                                                                                                    // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    if (finish)                                                                                                                                                                          // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        break;                                                                                                                                                                           // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                ++pageIndex;                                                                                                                                                                             // Colorize: green
                childIndex = 0;                                                                                                                                                                          // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (pageIndex >= pages.size())                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to find end position to parse INTEL MSR IA32 BIOS Sign ID");                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check for fields                                                                                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            names.length() != 3                                                                                                                                                                          // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            descriptions.length() != 3                                                                                                                                                                   // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            names.at(0) != " 31:0"                                                                                                                                                                       // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            names.at(1) != "Table 2-2.  IA-32 Architectural MSRs (Contd.) Architectural MSR Name / Bit Fields  (Former MSR Name)"                                                                        // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            names.at(2) != "63:32"                                                                                                                                                                       // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            descriptions.at(0) != " Reserved"                                                                                                                                                            // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            descriptions.at(1) != " MSR/Bit Description"                                                                                                                                                 // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            descriptions.at(2) != " It is recommended that this field be pre- loaded with zero prior to executing CPUID.  If the field remains zero following the  execution of CPUID, this indicates that no  microcode update is loaded. Any non-zero  value is the microcode update signature." // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to check INTEL MSR IA32 BIOS Sign ID");                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList msrRegistersLines;                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        msrRegistersLines.append(QString("// Verified with IntelMsrSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                            .arg(INTEL_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        msrRegistersLines.append("struct MsrIa32BiosSignId");                                                                                                                                            // Colorize: green
        msrRegistersLines.append("{");                                                                                                                                                                   // Colorize: green
        msrRegistersLines.append("    union");                                                                                                                                                           // Colorize: green
        msrRegistersLines.append("    {");                                                                                                                                                               // Colorize: green
        msrRegistersLines.append("        struct");                                                                                                                                                      // Colorize: green
        msrRegistersLines.append("        {");                                                                                                                                                           // Colorize: green
        msrRegistersLines.append(QString("            good_U64 _reserved:         32; // %1")                                                                                                            // Colorize: green
                                            .arg(descriptions.at(0).simplified())                                                                                                                        // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        msrRegistersLines.append(QString("            good_U64 microcodeRevision: 32; // %1")                                                                                                            // Colorize: green
                                            .arg(descriptions.at(2).simplified())                                                                                                                        // Colorize: green
        );                                                                                                                         // Colorize: green
        msrRegistersLines.append("        };");                                                                                                                                                          // Colorize: green
        msrRegistersLines.append("");                                                                                                                                                                    // Colorize: green
        msrRegistersLines.append("        good_U64 value64;");                                                                                                                                           // Colorize: green
        msrRegistersLines.append("    };");                                                                                                                                                              // Colorize: green
        msrRegistersLines.append("} __attribute__((packed));");                                                                                                                                          // Colorize: green
        msrRegistersLines.append(QString("// Verified with IntelMsrSpecVerifier [END] // %1")                                                                                                            // Colorize: green
                                            .arg(INTEL_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(msrRegistersLines, thread->getPath() + "/" + MSRIA32BIOSSIGNID_H))                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check INTEL MSR IA32 BIOS Sign ID");                                                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void IntelMsrSpecVerifier::checkMsrIa32EferFlags(SpecVerifyThread *thread, const QString &specContent, QDomDocument &xml)                                                                                // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QDomElement doc = xml.documentElement();                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    qint64 pageIndex  = 75;                                                                                                                                                                              // Colorize: green
    qint64 childIndex = 43;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QDomNodeList pages    = doc.childNodes();                                                                                                                                                            // Colorize: green
    QDomNodeList children = pages.at(pageIndex).childNodes();                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip pages and its children                                                                                                                                                                       // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            children.at(childIndex).toElement().text()     != "C000_"                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 1).toElement().text() != "0080H"                                                                                                                                      // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 2).toElement().text() != "IA32_EFER"                                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 3).toElement().text() != "Extended Feature Enables"                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 4).toElement().text() != "If ( "                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 5).toElement().text() != "CPUID.80000001H:EDX.[2"                                                                                                                      // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 6).toElement().text() != "0] || "                                                                                                                         // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 7).toElement().text() != "CPUID.80000001H:EDX.[2"                                                                                                                      // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 8).toElement().text() != "9])"                                                                                                                         // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to find start position to parse INTEL MSR IA32 EFER");                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        childIndex += 9;                                                                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList names;                                                                                                                                                                                   // Colorize: green
    QStringList descriptions;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Parse fields from XML                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString name;                                                                                                                                                                                    // Colorize: green
        QString description;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Parse pages                                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            while (pageIndex < pages.size())                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                // Parse children                                                                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    children = pages.at(pageIndex).childNodes();                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    bool finish = false;                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    while (childIndex < children.size())                                                                                                                                                 // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        QDomElement element = children.at(childIndex).toElement();                                                                                                                       // Colorize: green
                        QString     text    = element.text();                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Check for end line                                                                                                                                                            // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            if (text == "C000_")                                                                                                                                                          // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                finish = true;                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                names.append(name);                                                                                                                                                      // Colorize: green
                                descriptions.append(description);                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                break;                                                                                                                                                                   // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Parse fields                                                                                                                                                                  // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            qint64 left = element.attribute("left", "-1").toLongLong();                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            if (left >= NAME_COLUMN_LEFT && left < NAME_COLUMN_RIGHT)                                                                                                                    // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                if (description == "")                                                                                                                                                   // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    name.append(' ');                                                                                                                                                    // Colorize: green
                                    name.append(text);                                                                                                                                                   // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                                else                                                                                                                                                                     // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    if (name != "")                                                                                                                                                      // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        names.append(name);                                                                                                                                              // Colorize: green
                                        descriptions.append(description);                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        name        = text;                                                                                                                                              // Colorize: green
                                        description = "";                                                                                                                                                // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                            else                                                                                                                                                                         // Colorize: green
                            if (left >= DESCRIPTION_COLUMN_LEFT && left < DESCRIPTION_COLUMN_RIGHT)                                                                                                      // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                description.append(' ');                                                                                                                                                 // Colorize: green
                                description.append(text);                                                                                                                                                // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        ++childIndex;                                                                                                                                                                    // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    if (finish)                                                                                                                                                                          // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        break;                                                                                                                                                                           // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                ++pageIndex;                                                                                                                                                                             // Colorize: green
                childIndex = 0;                                                                                                                                                                          // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (pageIndex >= pages.size())                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to find end position to parse INTEL MSR IA32 EFER");                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fieldBits;                                                                                                                                                                             // Colorize: green
    QStringList fieldNames;                                                                                                                                                                              // Colorize: green
    QStringList fieldComments;                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        for (qint64 i = 0; i < names.size(); ++i)                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString name        = names.at(i).simplified();                                                                                                                                              // Colorize: green
            QString description = descriptions.at(i).simplified();                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            qint64 index = description.indexOf(':');                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (index >= 0)                                                                                                                                                                              // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                fieldBits.append(name);                                                                                                                                                                  // Colorize: green
                fieldNames.append(description.left(index).trimmed());                                                                                                                                    // Colorize: green
                fieldComments.append(description.mid(index + 1).trimmed());                                                                                                                              // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QHash<QString, QString> msrFieldNamesToNgosFieldNames;  // MSR field name => NGOS field name                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill msrFieldNamesToNgosFieldNames                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        msrFieldNamesToNgosFieldNames.insert("SYSCALL Enable",             "SYSCALL_ENABLE");                                                                                                            // Colorize: green
        msrFieldNamesToNgosFieldNames.insert("IA-32e Mode Enable",         "LONG_MODE_ENABLE");                                                                                                          // Colorize: green
        msrFieldNamesToNgosFieldNames.insert("IA-32e Mode Active",         "LONG_MODE_ACTIVE");                                                                                                          // Colorize: green
        msrFieldNamesToNgosFieldNames.insert("Execute Disable Bit Enable", "NO_EXECUTE_ENABLE");                                                                                                         // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList msrRegistersLines;                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        msrRegistersLines.append(QString("// Verified with IntelMsrSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                            .arg(INTEL_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        msrRegistersLines.append("typedef good_U64 msr_ia32_efer_flags;");                                                                                                                                                                          // Colorize: green
        msrRegistersLines.append("");                                                                                                                                                                                                         // Colorize: green
        msrRegistersLines.append("enum class MsrIa32EferFlag: msr_ia32_efer_flags");                                                                                                                             // Colorize: green
        msrRegistersLines.append("{");                                                                                                                                                                // Colorize: green
        msrRegistersLines.append("    NONE              = 0,");                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fieldNames.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString field = fieldNames.at(i);                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            field = msrFieldNamesToNgosFieldNames.value(field, "");                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert MSR field name: %1")                                                                                                                          // Colorize: green
                                            .arg(fieldNames.at(i))                                                                                                                                           // Colorize: green
                );                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            msrRegistersLines.append(QString("    %1 = (1ULL << %2)%3%4 // %5")                                                                                                                                                   // Colorize: green
                                        .arg(field, -17, QChar(' '))                                                                                                                                                         // Colorize: green
                                        .arg(fieldBits.at(i))                                                                                                                                            // Colorize: green
                                        .arg(i < fieldNames.size() - 1 ? "," : " ")                                                                                                                           // Colorize: green
                                        .arg(fieldBits.at(i).length() < 2 ? " " : "")                                                                                                                           // Colorize: green
                                        .arg(fieldComments.at(i))                                                                                                                                     // Colorize: green
            );                                                                                                                                                               // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        msrRegistersLines.append("};");                                                                                                                                                                  // Colorize: green
        msrRegistersLines.append("");                                                                                                                                                                    // Colorize: green
        msrRegistersLines.append("DEFINE_FLAGS(MsrIa32EferFlags, msr_ia32_efer_flags); // TEST: NO");                                                                           // Colorize: green
        msrRegistersLines.append(QString("// Verified with IntelMsrSpecVerifier [END] // %1")                                                                                                            // Colorize: green
                                            .arg(INTEL_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(msrRegistersLines, thread->getPath() + "/" + MSRIA32EFERFLAGS_H))                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check INTEL MSR IA32 EFER");                                                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void IntelMsrSpecVerifier::checkMsrIa32MiscEnableFlags(SpecVerifyThread *thread, const QString &specContent, QDomDocument &xml)                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QDomElement doc = xml.documentElement();                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    qint64 pageIndex  = 31;                                                                                                                                                                              // Colorize: green
    qint64 childIndex = 45;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QDomNodeList pages    = doc.childNodes();                                                                                                                                                            // Colorize: green
    QDomNodeList children = pages.at(pageIndex).childNodes();                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip pages and its children                                                                                                                                                                       // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            children.at(childIndex).toElement().text()     != "1A0H"                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 1).toElement().text() != "416"                                                                                                                                      // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 2).toElement().text() != "IA32_MISC_ENABLE"                                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 3).toElement().text() != "Enable Misc. Processor Features (R/W)"                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 4).toElement().text() != " "                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 5).toElement().text() != "Allows a variety of processor functions to "                                                                                                                      // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            children.at(childIndex + 6).toElement().text() != "be enabled and disabled."                                                                                                                         // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to find start position to parse INTEL MSR IA32 Misc Enable");                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        childIndex += 7;                                                                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList names;                                                                                                                                                                                   // Colorize: green
    QStringList descriptions;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Parse fields from XML                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString name;                                                                                                                                                                                    // Colorize: green
        QString description;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Parse pages                                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            while (pageIndex < pages.size())                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                // Parse children                                                                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    children = pages.at(pageIndex).childNodes();                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    bool finish = false;                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    while (childIndex < children.size())                                                                                                                                                 // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        QDomElement element = children.at(childIndex).toElement();                                                                                                                       // Colorize: green
                        QString     text    = element.text();                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Check for end line                                                                                                                                                            // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            if (text == "1B0H")                                                                                                                                                          // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                finish = true;                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                names.append(name);                                                                                                                                                      // Colorize: green
                                descriptions.append(description);                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                break;                                                                                                                                                                   // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Parse fields                                                                                                                                                                  // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            qint64 left = element.attribute("left", "-1").toLongLong();                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            if (left >= NAME_COLUMN_LEFT && left < NAME_COLUMN_RIGHT)                                                                                                                    // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                if (description == "")                                                                                                                                                   // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    name.append(' ');                                                                                                                                                    // Colorize: green
                                    name.append(text);                                                                                                                                                   // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                                else                                                                                                                                                                     // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    if (name != "")                                                                                                                                                      // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        names.append(name);                                                                                                                                              // Colorize: green
                                        descriptions.append(description);                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        name        = text;                                                                                                                                              // Colorize: green
                                        description = "";                                                                                                                                                // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                            else                                                                                                                                                                         // Colorize: green
                            if (left >= DESCRIPTION_COLUMN_LEFT && left < DESCRIPTION_COLUMN_RIGHT)                                                                                                      // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                description.append(' ');                                                                                                                                                 // Colorize: green
                                description.append(text);                                                                                                                                                // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        ++childIndex;                                                                                                                                                                    // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    if (finish)                                                                                                                                                                          // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        break;                                                                                                                                                                           // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                ++pageIndex;                                                                                                                                                                             // Colorize: green
                childIndex = 0;                                                                                                                                                                          // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (pageIndex >= pages.size())                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to find end position to parse INTEL MSR IA32 Misc Enable");                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fieldBits;                                                                                                                                                                             // Colorize: green
    QStringList fieldNames;                                                                                                                                                                              // Colorize: green
    QStringList fieldComments;                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        for (qint64 i = 0; i < names.size(); ++i)                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString name        = names.at(i).simplified();                                                                                                                                              // Colorize: green
            QString description = descriptions.at(i).simplified();                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldBits.append(name);                                                                                                                                                                  // Colorize: green
            fieldNames.append(description);                                                                                                                                    // Colorize: green
            fieldComments.append(description);                                                                                                                              // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList msrRegistersLines;                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        msrRegistersLines.append(QString("// Verified with IntelMsrSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                            .arg(INTEL_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        msrRegistersLines.append("typedef good_U64 msr_ia32_misc_enable_flags;");                                                                                                                                                                          // Colorize: green
        msrRegistersLines.append("");                                                                                                                                                                                                         // Colorize: green
        msrRegistersLines.append("enum class MsrIa32MiscEnableFlag: msr_ia32_misc_enable_flags");                                                                                                                             // Colorize: green
        msrRegistersLines.append("{");                                                                                                                                                                // Colorize: green
        msrRegistersLines.append("    NONE                                       = 0,");                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fieldNames.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString field = fieldNames.at(i);                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            // Convert field name                                                                                                                                                                                   // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                if (field.startsWith("Fast-Strings Enable"))                                                                                                                                             // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    field = "FAST_STRINGS";                                                                                                                                                       // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                if (field.startsWith("Automatic Thermal Control Circuit Enable"))                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    field = "AUTOMATIC_THERMAL_CONTROL_CIRCUIT";                                                                                                                                  // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                if (field.startsWith("Performance Monitoring Available"))                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    field = "PERFORMANCE_MONITORING";                                                                                                                                  // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                if (field.startsWith("Branch Trace Storage Unavailable"))                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    field = "BRANCH_TRACE_STORAGE_UNAVAILABLE";                                                                                                                                  // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                if (field.startsWith("Processor Event Based Sampling (PEBS) Unavailable"))                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    field = "PROCESSOR_EVENT_BASED_SAMPLING_UNAVAILABLE";                                                                                                                                  // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                if (field.startsWith("Enhanced Intel SpeedStep Technology Enable"))                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    field = "ENHANCED_INTEL_SPEEDSTEP_TECHNOLOGY";                                                                                                                                  // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                if (field.startsWith("ENABLE MONITOR FSM"))                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    field = "MWAIT";                                                                                                                                  // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                if (field.startsWith("Limit CPUID Maxval"))                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    field = "LIMIT_CPUID";                                                                                                                                  // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                if (field.startsWith("xTPR Message Disable"))                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    field = "XTPR_DISABLE";                                                                                                                                  // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                if (field.startsWith("XD Bit Disable"))                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    field = "XD_DISABLE";                                                                                                                                  // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    continue;                                                                                                                                                                            // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            msrRegistersLines.append(QString("    %1 = (1ULL << %2)%3%4 // %5")                                                                                                                          // Colorize: green
                                        .arg(field, -42, QChar(' '))                                                                                                                                                         // Colorize: green
                                        .arg(fieldBits.at(i))                                                                                                                                            // Colorize: green
                                        .arg(i < fieldNames.size() - 1 ? "," : " ")                                                                                                                           // Colorize: green
                                        .arg(fieldBits.at(i).length() < 2 ? " " : "")                                                                                                                           // Colorize: green
                                        .arg(fieldComments.at(i))                                                                                                                                     // Colorize: green
            );                                                                                                                                                               // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        msrRegistersLines.append("};");                                                                                                                                                                  // Colorize: green
        msrRegistersLines.append("");                                                                                                                                                                    // Colorize: green
        msrRegistersLines.append("DEFINE_FLAGS(MsrIa32MiscEnableFlags, msr_ia32_misc_enable_flags); // TEST: NO");                                                                           // Colorize: green
        msrRegistersLines.append(QString("// Verified with IntelMsrSpecVerifier [END] // %1")                                                                                                            // Colorize: green
                                            .arg(INTEL_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(msrRegistersLines, thread->getPath() + "/" + MSRIA32MISCENABLEFLAGS_H))                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check INTEL MSR IA32 Misc Enable");                                                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
IntelMsrSpecVerifier intelMsrSpecVerifier;                                                                                                                                                               // Colorize: green
