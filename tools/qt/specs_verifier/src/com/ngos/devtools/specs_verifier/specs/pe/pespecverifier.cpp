#include "pespecverifier.h"                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <QDebug>                                                                                                                                                                                        // Colorize: green
#include <QEventLoop>                                                                                                                                                                                    // Colorize: green
#include <QNetworkAccessManager>                                                                                                                                                                         // Colorize: green
#include <QNetworkReply>                                                                                                                                                                                 // Colorize: green
#include <QNetworkRequest>                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define PE_SPECIFICATION_URL "https://docs.microsoft.com/en-us/windows/win32/debug/pe-format" // Version: 05/09/2022                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define PE_HEADER_H                              "tools/qt/image_builder/src/com/ngos/devtools/image_builder/pe/peheader.h"                                                                              // Colorize: green
#define PE_COFF_HEADER_H                         "tools/qt/image_builder/src/com/ngos/devtools/image_builder/pe/coffheader.h"                                                                            // Colorize: green
#define PE_COFF_HEADER_MACHINE_H                 "tools/qt/image_builder/src/com/ngos/devtools/image_builder/other/coffheadermachine.h"                                                                  // Colorize: green
#define PE_COFF_HEADER_CHARACTERISTICS_H         "tools/qt/image_builder/src/com/ngos/devtools/image_builder/other/coffheadercharacteristicsflags.h"                                                     // Colorize: green
#define PE_OPTIONAL_HEADER_H                     "tools/qt/image_builder/src/com/ngos/devtools/image_builder/pe/peoptionalheader.h"                                                                      // Colorize: green
#define PE_OPTIONAL_HEADER_MAGIC_H               "tools/qt/image_builder/src/com/ngos/devtools/image_builder/other/peoptionalheadermagic.h"                                                              // Colorize: green
#define PE_OPTIONAL_HEADER_SUBSYSTEM_H           "tools/qt/image_builder/src/com/ngos/devtools/image_builder/other/peoptionalheadersubsystem.h"                                                          // Colorize: green
#define PE_OPTIONAL_HEADER_DLL_CHARACTERISTICS_H "tools/qt/image_builder/src/com/ngos/devtools/image_builder/other/peoptionalheaderdllcharacteristicsflags.h"                                            // Colorize: green
#define PE_DATA_DIRECTORY_H                      "tools/qt/image_builder/src/com/ngos/devtools/image_builder/pe/datadirectory.h"                                                                         // Colorize: green
#define PE_DATA_DIRECTORY_TYPE_H                 "tools/qt/image_builder/src/com/ngos/devtools/image_builder/other/datadirectorytype.h"                                                                  // Colorize: green
#define PE_SECTION_HEADER_H                      "tools/qt/image_builder/src/com/ngos/devtools/image_builder/pe/sectionheader.h"                                                                         // Colorize: green
#define PE_SECTION_HEADER_CHARACTERISTICS_H      "tools/qt/image_builder/src/com/ngos/devtools/image_builder/other/sectionheadercharacteristicsflags.h"                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
PeSpecVerifier::PeSpecVerifier()                                                                                                                                                                         // Colorize: green
    : SpecVerifier()                                                                                                                                                                                     // Colorize: green
    , mPeTypeToNgosTypeMap()                                                                                                                                                                             // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    mPeTypeToNgosTypeMap.insert("1", "quint8");                                                                                                                                                          // Colorize: green
    mPeTypeToNgosTypeMap.insert("2", "quint16");                                                                                                                                                         // Colorize: green
    mPeTypeToNgosTypeMap.insert("4", "quint32");                                                                                                                                                         // Colorize: green
    mPeTypeToNgosTypeMap.insert("8", "quint64");                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::verify(SpecVerifyThread *thread)                                                                                                                                                    // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread != nullptr);                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString specContent;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!downloadSpecification(thread, PE_SPECIFICATION_URL, specContent))                                                                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        return;                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Replace some special characters                                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        specContent.replace('\t',          "    "); // Replace tabulation                                                                                                                                         // Colorize: green
        specContent.replace("&gt;",        ">");    // Replace >                                                                                                                                         // Colorize: green
        specContent.replace(QChar(0x00A0), ' ');    // Replace no-break space // https://www.compart.com/en/unicode/U+00A0                                                                           // Colorize: green
        specContent.remove('\r');                   // Remove \r                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    checkWithSpecification(thread, specContent);                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool PeSpecVerifier::downloadSpecification(SpecVerifyThread *thread, const QString &url, QString &specContent)                                                                                           // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(url    != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QNetworkAccessManager  manager;                                                                                                                                                                  // Colorize: green
    QNetworkReply         *reply;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                     // Colorize: green
    // Send network request                                                                                                                                                                          // Colorize: green
    {                                                                                                                                                                                                // Colorize: green
        QNetworkRequest request;                                                                                                                                                                     // Colorize: green
        request.setUrl(QUrl(url));                                                                                                                                                  // Colorize: green
        reply = manager.get(request);                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                     // Colorize: green
    // Wait for finish                                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                // Colorize: green
        QEventLoop waitLoop;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                     // Colorize: green
        QObject::connect(reply, SIGNAL(finished()),                                 &waitLoop, SLOT(quit()));                                                                                        // Colorize: green
        QObject::connect(reply, SIGNAL(errorOccurred(QNetworkReply::NetworkError)), &waitLoop, SLOT(quit()));                                                                                        // Colorize: green
                                                                                                                                                                                                     // Colorize: green
        waitLoop.exec();                                                                                                                                                                             // Colorize: green
    }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                     // Colorize: green
    // Check status code                                                                                                                                                                             // Colorize: green
    {                                                                                                                                                                                                // Colorize: green
        QVariant statusCode = reply->attribute(QNetworkRequest::HttpStatusCodeAttribute);                                                                                                            // Colorize: green
                                                                                                                                                                                                     // Colorize: green
        if (statusCode.toInt() != 200)                                                                                                                                                               // Colorize: green
        {                                                                                                                                                                                            // Colorize: green
            thread->addError(QString("Failed to get PE specification from: %1")                                                                                                                      // Colorize: green
                                        .arg(url)                                                                                                                                   // Colorize: green
            );                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                     // Colorize: green
            delete reply;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                     // Colorize: green
            return false;                                                                                                                                                                                  // Colorize: green
        }                                                                                                                                                                                            // Colorize: green
    }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                     // Colorize: green
    specContent = QString::fromUtf8(reply->readAll());                                                                                                                                               // Colorize: green
    delete reply;                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return true;                                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkWithSpecification(SpecVerifyThread *thread, const QString &specContent)                                                                                                        // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    qint64 errorsBefore = thread->getErrors().size();                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check code with specification                                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        checkPeSpecification(thread, specContent);                                                                                                                                                       // Colorize: green
        checkPeHeader(thread, specContent);                                                                                                                                                              // Colorize: green
        checkPeHeaderSignature(thread, specContent);                                                                                                                                                     // Colorize: green
        checkPeCoffHeader(thread, specContent);                                                                                                                                                          // Colorize: green
        checkPeCoffHeaderMachine(thread, specContent);                                                                                                                                                   // Colorize: green
        checkPeCoffHeaderCharacteristics(thread, specContent);                                                                                                                                           // Colorize: green
        checkPeOptionalHeader(thread, specContent);                                                                                                                                                      // Colorize: green
        checkPeOptionalHeaderMagic(thread, specContent);                                                                                                                                             // Colorize: green
        checkPeOptionalHeaderSubsystem(thread, specContent);                                                                                                                                             // Colorize: green
        checkPeOptionalHeaderDllCharacteristics(thread, specContent);                                                                                                                                    // Colorize: green
        checkPeDataDirectory(thread, specContent);                                                                                                                                                       // Colorize: green
        checkPeDataDirectoryType(thread, specContent);                                                                                                                                                       // Colorize: green
        checkPeSectionHeader(thread, specContent);                                                                                                                                                       // Colorize: green
        checkPeSectionHeaderCharacteristics(thread, specContent);                                                                                                                                        // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (thread->getErrors().size() == errorsBefore)                                                                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addMessage("Code verified with PE specification");                                                                                                                                       // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
    else                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addMessage("Found error in code with PE specification");                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeSpecification(SpecVerifyThread *thread, const QString &specContent)                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString versionText;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init versionText                                                                                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        versionText =                                                                                                                                                                                    // Colorize: green
            "                                <h1 id=\"pe-format\">PE Format</h1>\n"                                                                                                                      // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "                                        <div class=\"display-flex-tablet justify-content-space-between-tablet page-metadata-container\">\n"                                                 // Colorize: green
            "\n"                                                                                                                                                                                         // Colorize: green
            "                                            <ul class=\"metadata page-metadata\" data-bi-name=\"page info\" lang=\"en-us\" dir=\"ltr\">\n"                                                  // Colorize: green
            "                                                        <li>\n"                                                                                                                             // Colorize: green
            "Article                                                        </li>\n"                                                                                                                     // Colorize: green
            "                                                        <li>\n"                                                                                                                             // Colorize: green
            "                                                            <time class=\"is-invisible\" data-article-date aria-label=\"Article review date\" datetime=\"2022-05-09T17:16:00Z\" data-article-date-source=\"git\">05/09/2022</time>\n" // Colorize: green
            "                                                        </li>";                                                                                                                             // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(versionText))                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE specification version didn't match with the stored one");                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeHeader(SpecVerifyThread *thread, const QString &specContent)                                                                                                                 // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString headerText;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init headerText                                                                                                                                                                              // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerText =                                                                                                                                                                                // Colorize: green
            "<h2 id=\"file-headers\">File Headers</h2>\n"                                                                                                                                                // Colorize: green
            "<ul>\n"                                                                                                                                                                                     // Colorize: green
            "<li><a href=\"#ms-dos-stub-image-only\" data-linktype=\"self-bookmark\">MS-DOS Stub (Image Only)</a></li>\n"                                                                                // Colorize: green
            "<li><a href=\"#signature-image-only\" data-linktype=\"self-bookmark\">Signature (Image Only)</a></li>\n"                                                                                    // Colorize: green
            "<li><a href=\"#coff-file-header-object-and-image\" data-linktype=\"self-bookmark\">COFF File Header (Object and Image)</a>\n"                                                               // Colorize: green
            "<ul>\n"                                                                                                                                                                                     // Colorize: green
            "<li><a href=\"#machine-types\" data-linktype=\"self-bookmark\">Machine Types</a></li>\n"                                                                                                    // Colorize: green
            "<li><a href=\"#characteristics\" data-linktype=\"self-bookmark\">Characteristics</a></li>\n"                                                                                                // Colorize: green
            "</ul>\n"                                                                                                                                                                                    // Colorize: green
            "</li>\n"                                                                                                                                                                                    // Colorize: green
            "<li><a href=\"#optional-header-image-only\" data-linktype=\"self-bookmark\">Optional Header (Image Only)</a>\n"                                                                             // Colorize: green
            "<ul>\n"                                                                                                                                                                                     // Colorize: green
            "<li><a href=\"#optional-header-standard-fields-image-only\" data-linktype=\"self-bookmark\">Optional Header Standard Fields (Image Only)</a></li>\n"                                        // Colorize: green
            "<li><a href=\"#optional-header-windows-specific-fields-image-only\" data-linktype=\"self-bookmark\">Optional Header Windows-Specific Fields (Image Only)</a></li>\n"                        // Colorize: green
            "<li><a href=\"#optional-header-data-directories-image-only\" data-linktype=\"self-bookmark\">Optional Header Data Directories (Image Only)</a></li>\n"                                      // Colorize: green
            "</ul>\n"                                                                                                                                                                                    // Colorize: green
            "</li>\n"                                                                                                                                                                                    // Colorize: green
            "</ul>\n"                                                                                                                                                                                    // Colorize: green
            "<p>The PE file header consists of a Microsoft MS-DOS stub, the PE signature, the COFF file header, and an optional header. A COFF object file header consists of a COFF file header and an optional header. In both cases, the file headers are followed immediately by section headers.</p>"; // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(headerText))                                                                                                                                                      // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE Header specification didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList headerLines;                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.append(QString("// Verified with PeSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                    .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        headerLines.append("struct PEHeader");                                                                                                                                                           // Colorize: green
        headerLines.append("{");                                                                                                                                                                       // Colorize: green
        headerLines.append("    void print(); // TEST: NO");                                                                                                                                           // Colorize: green
        headerLines.append("    bool verify(); // TEST: NO");                                                                                                                                          // Colorize: green
        headerLines.append("");                                                                                                                                                                        // Colorize: green
        headerLines.append("    quint32          signature;");                                                                                                                                       // Colorize: green
        headerLines.append("    COFFHeader       coffHeader;");                                                                                                                                      // Colorize: green
        headerLines.append("    PeOptionalHeader optionalHeader;");                                                                                                                                  // Colorize: green
        headerLines.append("    SectionHeader    sections[static_cast<good_Enum_t>(Section::MAXIMUM)];");                                                                                                             // Colorize: green
        headerLines.append("};");                                                                                                                                                                        // Colorize: green
        headerLines.append(QString("// Verified with PeSpecVerifier [END] // %1")                                                                                                                        // Colorize: green
                                    .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(headerLines, thread->getPath() + "/" + PE_HEADER_H))                                                                                                                         // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Header with specification");                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeHeaderSignature(SpecVerifyThread *thread, const QString &specContent)                                                                                                        // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString signatureText;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init signatureText                                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        signatureText =                                                                                                                                                                                  // Colorize: green
            "<h3 id=\"signature-image-only\">Signature (Image Only)</h3>\n"                                                                                                                              // Colorize: green
            "<p>After the MS-DOS stub, at the file offset specified at offset 0x3c, is a 4-byte signature that identifies the file as a PE format image file. This signature is &quot;PE\0\0&quot; (the letters &quot;P&quot; and &quot;E&quot; followed by two null bytes).</p>"; // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(signatureText))                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE Header Signature specification didn't match with the stored one");                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList signatureLines;                                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        signatureLines.append(QString("// Verified with PeSpecVerifier // %1")                                                                                                                      // Colorize: green
                                        .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        signatureLines.append("#define PE_HEADER_SIGNATURE 0x00004550 // PE\\0\\0");                                                                                                                     // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(signatureLines, thread->getPath() + "/" + PE_HEADER_H))                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Header Signature with specification");                                                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeCoffHeader(SpecVerifyThread *thread, const QString &specContent)                                                                                                             // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString headerText;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init headerText                                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerText =                                                                                                                                                                                 // Colorize: green
            "<h3 id=\"coff-file-header-object-and-image\">COFF File Header (Object and Image)</h3>\n"                                                                                                    // Colorize: green
            "<p>At the beginning of an object file, or immediately after the signature of an image file, is a standard COFF file header in the following format. Note that the Windows loader limits the number of sections to 96.</p>\n" // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Offset</th>\n"                                                                                                                                                                          // Colorize: green
            "<th>Size</th>\n"                                                                                                                                                                            // Colorize: green
            "<th>Field</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Machine <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>The number that identifies the type of target machine. For more information, see <a href=\"#machine-types\" data-linktype=\"self-bookmark\">Machine Types</a>. <br/></td>\n"            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>NumberOfSections <br/></td>\n"                                                                                                                                                          // Colorize: green
            "<td>The number of sections. This indicates the size of the section table, which immediately follows the headers. <br/></td>\n"                                                              // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>TimeDateStamp <br/></td>\n"                                                                                                                                                             // Colorize: green
            "<td>The low 32 bits of the number of seconds since 00:00 January 1, 1970 (a C run-time time_t value), which indicates when the file was created. <br/></td>\n"                              // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>PointerToSymbolTable <br/></td>\n"                                                                                                                                                      // Colorize: green
            "<td>The file offset of the COFF symbol table, or zero if no COFF symbol table is present. This value should be zero for an image because COFF debugging information is deprecated. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>12 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>NumberOfSymbols <br/></td>\n"                                                                                                                                                           // Colorize: green
            "<td>The number of entries in the symbol table. This data can be used to locate the string table, which immediately follows the symbol table. This value should be zero for an image because COFF debugging information is deprecated. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>16 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SizeOfOptionalHeader <br/></td>\n"                                                                                                                                                      // Colorize: green
            "<td>The size of the optional header, which is required for executable files but not for object files. This value should be zero for an object file. For a description of the header format, see <a href=\"#optional-header-image-only\" data-linktype=\"self-bookmark\">Optional Header (Image Only)</a>. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>18 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Characteristics <br/></td>\n"                                                                                                                                                           // Colorize: green
            "<td>The flags that indicate the attributes of the file. For specific flag values, see <a href=\"#characteristics\" data-linktype=\"self-bookmark\">Characteristics</a>. <br/></td>\n"       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(headerText))                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE COFF Header specification didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = headerText.split('\n');                                                                                                                                                      // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(2) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(3) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(4) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(5) != "<th>Offset</th>"                                                                                                                                                             // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(6) != "<th>Size</th>"                                                                                                                                                               // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(7) != "<th>Field</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(8) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(9) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(10) != "</thead>"                                                                                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(11) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(12) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE COFF Header specification");                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 13;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fieldTypes;                                                                                                                                                                              // Colorize: green
    QStringList fieldNames;                                                                                                                                                                              // Colorize: green
    QStringList fieldDescriptions;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldTypes.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldNames.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldDescriptions.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 3;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList headerLines;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.append(QString("// Verified with PeSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                    .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        headerLines.append("struct COFFHeader");                                                                                                                                                     // Colorize: green
        headerLines.append("{");                                                                                                                                                                     // Colorize: green
        headerLines.append("    void print(); // TEST: NO");                                                                                                                                         // Colorize: green
        headerLines.append("    bool verify(); // TEST: NO");                                                                                                                                        // Colorize: green
        headerLines.append("");                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fieldTypes.size(); ++i)                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString type = mPeTypeToNgosTypeMap.value(fieldTypes.at(i), "");                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (type == "")                                                                                                                                                                              // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE type: %1")                                                                                                                                // Colorize: green
                                            .arg(fieldTypes.at(i))                                                                                                                                       // Colorize: green
                );                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString name = fieldNames.at(i);                                                                                                                                                             // Colorize: green
            name = name.at(0).toLower() + name.mid(1);                                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            headerLines.append(QString("    %1 %2;%3 // %4")                                                                                                                                                     // Colorize: green
                                        .arg(type, -30, QChar(' '))                                                                                                                                       // Colorize: green
                                        .arg(name)                                                                                                                                                       // Colorize: green
                                        .arg("", 20 - name.length(), QChar(' '))                                                                                                                         // Colorize: green
                                        .arg(fieldDescriptions.at(i))                                                                                                                                    // Colorize: green
            );                                                                                                                                                                        // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        headerLines.append("};");                                                                                                                                                                    // Colorize: green
        headerLines.append(QString("// Verified with PeSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                    .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Replace well known types for fields                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.replaceInStrings("    quint16                        machine;",         "    COFFHeaderMachine              machine;");                                                          // Colorize: green
        headerLines.replaceInStrings("    quint16                        characteristics;", "    COFFHeaderCharacteristicsFlags characteristics;");                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(headerLines, thread->getPath() + "/" + PE_COFF_HEADER_H))                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE COFF Header with specification");                                                                                                                           // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeCoffHeaderMachine(SpecVerifyThread *thread, const QString &specContent)                                                                                                      // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString machinesText;                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init machinesText                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        machinesText =                                                                                                                                                                                   // Colorize: green
            "<h4 id=\"machine-types\">Machine Types</h4>\n"                                                                                                                                              // Colorize: green
            "<p>The Machine field has one of the following values, which specify the CPU type. An image file can be run only on the specified machine or on a system that emulates the specified machine.</p>\n" // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Constant</th>\n"                                                                                                                                                                        // Colorize: green
            "<th>Value</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_UNKNOWN <br/></td>\n"                                                                                                                                                // Colorize: green
            "<td>0x0 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "<td>The content of this field is assumed to be applicable to any machine type <br/></td>\n"                                                                                                 // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_AM33 <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0x1d3 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Matsushita AM33 <br/></td>\n"                                                                                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_AMD64 <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x8664 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>x64 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_ARM <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0x1c0 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>ARM little endian <br/></td>\n"                                                                                                                                                         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_ARM64 <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0xaa64 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>ARM64 little endian <br/></td>\n"                                                                                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_ARMNT <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x1c4 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>ARM Thumb-2 little endian <br/></td>\n"                                                                                                                                                 // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_EBC <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0xebc <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>EFI byte code <br/></td>\n"                                                                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_I386 <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0x14c <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Intel 386 or later processors and compatible processors <br/></td>\n"                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_IA64 <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0x200 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Intel Itanium processor family <br/></td>\n"                                                                                                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_LOONGARCH32 <br/></td>\n"                                                                                                                                            // Colorize: green
            "<td>0x6232 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>LoongArch 32-bit processor family <br/></td>\n"                                                                                                                                         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_LOONGARCH64 <br/></td>\n"                                                                                                                                            // Colorize: green
            "<td>0x6264 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>LoongArch 64-bit processor family <br/></td>\n"                                                                                                                                         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_M32R <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0x9041 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Mitsubishi M32R little endian <br/></td>\n"                                                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_MIPS16 <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x266 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>MIPS16 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_MIPSFPU <br/></td>\n"                                                                                                                                                // Colorize: green
            "<td>0x366 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>MIPS with FPU <br/></td>\n"                                                                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_MIPSFPU16 <br/></td>\n"                                                                                                                                              // Colorize: green
            "<td>0x466 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>MIPS16 with FPU <br/></td>\n"                                                                                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_POWERPC <br/></td>\n"                                                                                                                                                // Colorize: green
            "<td>0x1f0 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Power PC little endian <br/></td>\n"                                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_POWERPCFP <br/></td>\n"                                                                                                                                              // Colorize: green
            "<td>0x1f1 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Power PC with floating point support <br/></td>\n"                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_R4000 <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x166 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>MIPS little endian <br/></td>\n"                                                                                                                                                        // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_RISCV32 <br/></td>\n"                                                                                                                                                // Colorize: green
            "<td>0x5032 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>RISC-V 32-bit address space <br/></td>\n"                                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_RISCV64 <br/></td>\n"                                                                                                                                                // Colorize: green
            "<td>0x5064 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>RISC-V 64-bit address space <br/></td>\n"                                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_RISCV128 <br/></td>\n"                                                                                                                                               // Colorize: green
            "<td>0x5128 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>RISC-V 128-bit address space <br/></td>\n"                                                                                                                                              // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_SH3 <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0x1a2 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Hitachi SH3 <br/></td>\n"                                                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_SH3DSP <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x1a3 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Hitachi SH3 DSP <br/></td>\n"                                                                                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_SH4 <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0x1a6 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Hitachi SH4 <br/></td>\n"                                                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_SH5 <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0x1a8 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Hitachi SH5 <br/></td>\n"                                                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_THUMB <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x1c2 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Thumb <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_WCEMIPSV2 <br/></td>\n"                                                                                                                                              // Colorize: green
            "<td>0x169 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>MIPS little-endian WCE v2 <br/></td>\n"                                                                                                                                                 // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(machinesText))                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE COFF Header Machines specification didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = machinesText.split('\n');                                                                                                                                                        // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(2) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(3) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(4) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(5) != "<th>Constant</th>"                                                                                                                                                           // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(6) != "<th>Value</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(7) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(8) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(9) != "</thead>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(10) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(11) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE COFF Header Machines specification");                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 12;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList values;                                                                                                                                                                                  // Colorize: green
    QStringList descriptions;                                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fields.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            values.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            descriptions.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 3;                                                                                                                                                                                     // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldNamesToNgosFieldNames; // PE field name => NGOS field name                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill peFieldNamesToNgosFieldNames                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_UNKNOWN",     "UNKNOWN");                                                                                                                // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_AM33",        "MATSUSHITA_AM33");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_AMD64",       "X64");                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_ARM",         "ARM");                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_ARM64",       "ARM64");                                                                                                                  // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_ARMNT",       "ARMV7");                                                                                                                  // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_EBC",         "UEFI_BYTE_CODE");                                                                                                         // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_I386",        "INTEL_386");                                                                                                              // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_IA64",        "INTEL_IA64");                                                                                                             // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_LOONGARCH32", "LOONG_ARCH32");                                                                                                           // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_LOONGARCH64", "LOONG_ARCH64");                                                                                                           // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_M32R",        "MITSUBISHI_M32R");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_MIPS16",      "MIPS16");                                                                                                                 // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_MIPSFPU",     "MIPS_WITH_FPU");                                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_MIPSFPU16",   "MIPS16_WITH_FPU");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_POWERPC",     "POWERPC");                                                                                                                // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_POWERPCFP",   "POWERPC_WITH_FLOATING_POINT_SUPPORT");                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_R4000",       "MIPS_R4000");                                                                                                             // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_RISCV32",     "RISC_V32");                                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_RISCV64",     "RISC_V64");                                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_RISCV128",    "RISC_V128");                                                                                                              // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_SH3",         "HITACHI_SH3");                                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_SH3DSP",      "HITACHI_SH3_DSP");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_SH4",         "HITACHI_SH4");                                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_SH5",         "HITACHI_SH5");                                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_THUMB",       "THUMB");                                                                                                                  // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_WCEMIPSV2",   "MIPS_WCE_V2");                                                                                                            // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList machinesLines;                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        machinesLines.append(QString("// Verified with PeSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                        .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        machinesLines.append("enum class COFFHeaderMachine: quint16");                                                                                                                                   // Colorize: green
        machinesLines.append("{");                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fields.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString field = peFieldNamesToNgosFieldNames.value(fields.at(i), "");                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field name: %1")                                                                                                                          // Colorize: green
                                            .arg(fields.at(i))                                                                                                                                           // Colorize: green
                );                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString value = "0x" + QString("%1")                                                                                                                                                         // Colorize: green
                            .arg(values.at(i).toUShort(nullptr, 16), 4, 16, QChar('0'))                                                                                                                  // Colorize: green
                            .toUpper();                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (value == "0x0000")                                                                                                                                                                       // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                value = "0";                                                                                                                                                                             // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            machinesLines.append(QString("    %1 = %2%3%4 // %5")                                                                                                                                                 // Colorize: green
                                        .arg(field, -35, QChar(' '))                                                                                                                                     // Colorize: green
                                        .arg(value)                                                                                                                                                      // Colorize: green
                                        .arg(i < fields.size() - 1 ? "," : " ")                                                                                                                                                      // Colorize: green
                                        .arg("", 6 - value.length(), QChar(' '))                                                                                                                                                      // Colorize: green
                                        .arg(descriptions.at(i))                                                                                                                                                      // Colorize: green
            );                                                                                                                                                    // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        machinesLines.append("};");                                                                                                                                                                      // Colorize: green
        machinesLines.append(QString("// Verified with PeSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                        .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(machinesLines, thread->getPath() + "/" + PE_COFF_HEADER_MACHINE_H))                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE COFF Header Machines with specification");                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeCoffHeaderCharacteristics(SpecVerifyThread *thread, const QString &specContent)                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString characteristicsText;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init characteristicsText                                                                                                                                                                          // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        characteristicsText =                                                                                                                                                                            // Colorize: green
            "<h4 id=\"characteristics\">Characteristics</h4>\n"                                                                                                                                          // Colorize: green
            "<p>The Characteristics field contains flags that indicate attributes of the object or image file. The following flags are currently defined:</p>\n"                                         // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Flag</th>\n"                                                                                                                                                                            // Colorize: green
            "<th>Value</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_RELOCS_STRIPPED <br/></td>\n"                                                                                                                                                // Colorize: green
            "<td>0x0001 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Image only, Windows CE, and Microsoft Windows NT and later. This indicates that the file does not contain base relocations and must therefore be loaded at its preferred base address. If the base address is not available, the loader reports an error. The default behavior of the linker is to strip base relocations from executable (EXE) files. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_EXECUTABLE_IMAGE <br/></td>\n"                                                                                                                                               // Colorize: green
            "<td>0x0002 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Image only. This indicates that the image file is valid and can be run. If this flag is not set, it indicates a linker error. <br/></td>\n"                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_LINE_NUMS_STRIPPED <br/></td>\n"                                                                                                                                             // Colorize: green
            "<td>0x0004 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>COFF line numbers have been removed. This flag is deprecated and should be zero. <br/></td>\n"                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_LOCAL_SYMS_STRIPPED <br/></td>\n"                                                                                                                                            // Colorize: green
            "<td>0x0008 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>COFF symbol table entries for local symbols have been removed. This flag is deprecated and should be zero. <br/></td>\n"                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_AGGRESSIVE_WS_TRIM <br/></td>\n"                                                                                                                                             // Colorize: green
            "<td>0x0010 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Obsolete. Aggressively trim working set. This flag is deprecated for Windows 2000 and later and must be zero. <br/></td>\n"                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_LARGE_ADDRESS_ AWARE <br/></td>\n"                                                                                                                                           // Colorize: green
            "<td>0x0020 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Application can handle > 2-GB addresses. <br/></td>\n"                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x0040 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>This flag is reserved for future use. <br/></td>\n"                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_BYTES_REVERSED_LO <br/></td>\n"                                                                                                                                              // Colorize: green
            "<td>0x0080 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Little endian: the least significant bit (LSB) precedes the most significant bit (MSB) in memory. This flag is deprecated and should be zero. <br/></td>\n"                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_32BIT_MACHINE <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x0100 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Machine is based on a 32-bit-word architecture. <br/></td>\n"                                                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_DEBUG_STRIPPED <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x0200 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Debugging information is removed from the image file. <br/></td>\n"                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_REMOVABLE_RUN_ FROM_SWAP <br/></td>\n"                                                                                                                                       // Colorize: green
            "<td>0x0400 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>If the image is on removable media, fully load it and copy it to the swap file. <br/></td>\n"                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_NET_RUN_FROM_SWAP <br/></td>\n"                                                                                                                                              // Colorize: green
            "<td>0x0800 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>If the image is on network media, fully load it and copy it to the swap file. <br/></td>\n"                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_SYSTEM <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>0x1000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>The image file is a system file, not a user program. <br/></td>\n"                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_DLL <br/></td>\n"                                                                                                                                                            // Colorize: green
            "<td>0x2000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>The image file is a dynamic-link library (DLL). Such files are considered executable files for almost all purposes, although they cannot be directly run. <br/></td>\n"                 // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_UP_SYSTEM_ONLY <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x4000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>The file should be run only on a uniprocessor machine. <br/></td>\n"                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_BYTES_REVERSED_HI <br/></td>\n"                                                                                                                                              // Colorize: green
            "<td>0x8000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Big endian: the MSB precedes the LSB in memory. This flag is deprecated and should be zero. <br/></td>\n"                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(characteristicsText))                                                                                                                                                  // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE COFF Header Characteristics specification didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = characteristicsText.split('\n');                                                                                                                                                 // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(2) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(3) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(4) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(5) != "<th>Flag</th>"                                                                                                                                                               // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(6) != "<th>Value</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(7) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(8) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(9) != "</thead>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(10) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(11) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE COFF Header Characteristics specification");                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 12;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList values;                                                                                                                                                                                  // Colorize: green
    QStringList descriptions;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fields.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            values.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            descriptions.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 3;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldNamesToNgosFieldNames;   // PE field name  => NGOS field name                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldValuesToNgosFieldValues; // PE field value => NGOS field value                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill peFieldNamesToNgosFieldNames and peFieldValuesToNgosFieldValues                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_RELOCS_STRIPPED",          "RELOCS_STRIPPED");                                                                                                   // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_EXECUTABLE_IMAGE",         "EXECUTABLE_IMAGE");                                                                                                  // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_LINE_NUMS_STRIPPED",       "LINE_NUMS_STRIPPED");                                                                                                // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_LOCAL_SYMS_STRIPPED",      "LOCAL_SYMS_STRIPPED");                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_AGGRESSIVE_WS_TRIM",       "AGGRESSIVE_WS_TRIM");                                                                                                // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_LARGE_ADDRESS_ AWARE",     "LARGE_ADDRESS_AWARE");                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_BYTES_REVERSED_LO",        "BYTES_REVERSED_LO");                                                                                                 // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_32BIT_MACHINE",            "_32BIT_MACHINE");                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_DEBUG_STRIPPED",           "DEBUG_STRIPPED");                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_REMOVABLE_RUN_ FROM_SWAP", "REMOVABLE_RUN_FROM_SWAP");                                                                                           // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_NET_RUN_FROM_SWAP",        "NET_RUN_FROM_SWAP");                                                                                                 // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_SYSTEM",                   "SYSTEM");                                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_DLL",                      "DLL");                                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_UP_SYSTEM_ONLY",           "UP_SYSTEM_ONLY");                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_BYTES_REVERSED_HI",        "BYTES_REVERSED_HI");                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0001", "BIT_0");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0002", "BIT_1");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0004", "BIT_2");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0008", "BIT_3");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0010", "BIT_4");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0020", "BIT_5");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0040", "BIT_6");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0080", "BIT_7");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0100", "BIT_8");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0200", "BIT_9");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0400", "BIT_10");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0800", "BIT_11");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x1000", "BIT_12");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x2000", "BIT_13");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x4000", "BIT_14");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x8000", "BIT_15");                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList characteristicsLines;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        characteristicsLines.append(QString("// Verified with PeSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                            .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        characteristicsLines.append("typedef quint16 coff_header_characteristics_flags;");                                                                                                               // Colorize: green
        characteristicsLines.append("");                                                                                                                                                                 // Colorize: green
        characteristicsLines.append("enum class COFFHeaderCharacteristicsFlag: coff_header_characteristics_flags");                                                                                      // Colorize: green
        characteristicsLines.append("{");                                                                                                                                                                // Colorize: green
        characteristicsLines.append("    NONE                    = 0,");                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fields.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString field = fields.at(i);                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                continue;                                                                                                                                                                                // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            field = peFieldNamesToNgosFieldNames.value(field, "");                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field name: %1")                                                                                                                          // Colorize: green
                                            .arg(fields.at(i))                                                                                                                                           // Colorize: green
                );                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString value = peFieldValuesToNgosFieldValues.value(values.at(i), "");                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (value == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field value: %1")                                                                                                                         // Colorize: green
                                            .arg(values.at(i))                                                                                                                                           // Colorize: green
                );                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            characteristicsLines.append(QString("    %1 = %2%3%4 // %5")                                                                                                                                                   // Colorize: green
                                                .arg(field, -23, QChar(' '))                                                                                                                                                         // Colorize: green
                                                .arg(value)                                                                                                                                                                          // Colorize: green
                                                .arg(i < fields.size() - 1 ? "," : " ")                                                                                                                  // Colorize: green
                                                .arg("", 6 - value.length(), QChar(' '))                                                                                                            // Colorize: green
                                                .arg(descriptions.at(i))                                                                                                                                 // Colorize: green
            );                                                                                                                                                               // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        characteristicsLines.append("};");                                                                                                                                                               // Colorize: green
        characteristicsLines.append("");                                                                                                                                                                 // Colorize: green
        characteristicsLines.append("DEFINE_FLAGS(COFFHeaderCharacteristicsFlags, coff_header_characteristics_flags); // TEST: NO");                                                                     // Colorize: green
        characteristicsLines.append(QString("// Verified with PeSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                            .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(characteristicsLines, thread->getPath() + "/" + PE_COFF_HEADER_CHARACTERISTICS_H))                                                                                             // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE COFF Header Characteristics with specification");                                                                                                           // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeOptionalHeader(SpecVerifyThread *thread, const QString &specContent)                                                                                                         // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString headerText;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init headerText                                                                                                                                                                              // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerText =                                                                                                                                                                                     // Colorize: green
            "<h3 id=\"optional-header-image-only\">Optional Header (Image Only)</h3>\n"                                                                                                                  // Colorize: green
            "<p>Every image file has an optional header that provides information to the loader. This header is optional in the sense that some files (specifically, object files) do not have it. For image files, this header is required. An object file can have an optional header, but generally this header has no function in an object file except to increase its size.</p>\n" // Colorize: green
            "<p>Note that the size of the optional header is not fixed. The <strong>SizeOfOptionalHeader</strong> field in the COFF header must be used to validate that a probe into the file for a particular data directory does not go beyond <strong>SizeOfOptionalHeader</strong>. For more information, see <a href=\"#coff-file-header-object-and-image\" data-linktype=\"self-bookmark\">COFF File Header (Object and Image)</a>.</p>\n" // Colorize: green
            "<p>The <strong>NumberOfRvaAndSizes</strong> field of the optional header should also be used to ensure that no probe for a particular data directory entry goes beyond the optional header. In addition, it is important to validate the optional header magic number for format compatibility.</p>\n" // Colorize: green
            "<p>The optional header magic number determines whether an image is a PE32 or PE32+ executable.</p>\n"                                                                                       // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Magic number</th>\n"                                                                                                                                                                    // Colorize: green
            "<th>PE format</th>\n"                                                                                                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0x10b <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>PE32 <br/></td>\n"                                                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0x20b <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>PE32+ <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>\n"                                                                                                                                                                                 // Colorize: green
            "<p>PE32+ images allow for a 64-bit address space while limiting the image size to 2 gigabytes. Other PE32+ modifications are addressed in their respective sections.</p>\n"                // Colorize: green
            "<p>The optional header itself has three major parts.</p>\n"                                                                                                                                 // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Offset (PE32/PE32+)</th>\n"                                                                                                                                                             // Colorize: green
            "<th>Size (PE32/PE32+)</th>\n"                                                                                                                                                               // Colorize: green
            "<th>Header part</th>\n"                                                                                                                                                                     // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>28/24 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Standard fields <br/></td>\n"                                                                                                                                                           // Colorize: green
            "<td>Fields that are defined for all implementations of COFF, including UNIX. <br/></td>\n"                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>28/24 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>68/88 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Windows-specific fields <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>Additional fields to support specific features of Windows (for example, subsystems). <br/></td>\n"                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>96/112 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Variable <br/></td>\n"                                                                                                                                                                  // Colorize: green
            "<td>Data directories <br/></td>\n"                                                                                                                                                          // Colorize: green
            "<td>Address/size pairs for special tables that are found in the image file and are used by the operating system (for example, the import table and the export table). <br/></td>\n"         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>\n"                                                                                                                                                                                 // Colorize: green
            "<h4 id=\"optional-header-standard-fields-image-only\">Optional Header Standard Fields (Image Only)</h4>\n"                                                                                  // Colorize: green
            "<p>The first eight fields of the optional header are standard fields that are defined for every implementation of COFF. These fields contain general information that is useful for loading and running an executable file. They are unchanged for the PE32+ format.</p>\n" // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Offset</th>\n"                                                                                                                                                                          // Colorize: green
            "<th>Size</th>\n"                                                                                                                                                                            // Colorize: green
            "<th>Field</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Magic <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>The unsigned integer that identifies the state of the image file. The most common number is 0x10B, which identifies it as a normal executable file. 0x107 identifies it as a ROM image, and 0x20B identifies it as a PE32+ executable. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>1 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MajorLinkerVersion <br/></td>\n"                                                                                                                                                        // Colorize: green
            "<td>The linker major version number. <br/></td>\n"                                                                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>3 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>1 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MinorLinkerVersion <br/></td>\n"                                                                                                                                                        // Colorize: green
            "<td>The linker minor version number. <br/></td>\n"                                                                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SizeOfCode <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The size of the code (text) section, or the sum of all code sections if there are multiple sections. <br/></td>\n"                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SizeOfInitializedData <br/></td>\n"                                                                                                                                                     // Colorize: green
            "<td>The size of the initialized data section, or the sum of all such sections if there are multiple data sections. <br/></td>\n"                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>12 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SizeOfUninitializedData <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>The size of the uninitialized data section (BSS), or the sum of all such sections if there are multiple BSS sections. <br/></td>\n"                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>16 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>AddressOfEntryPoint <br/></td>\n"                                                                                                                                                       // Colorize: green
            "<td>The address of the entry point relative to the image base when the executable file is loaded into memory. For program images, this is the starting address. For device drivers, this is the address of the initialization function. An entry point is optional for DLLs. When no entry point is present, this field must be zero. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>20 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>BaseOfCode <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The address that is relative to the image base of the beginning-of-code section when it is loaded into memory. <br/></td>\n"                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>\n"                                                                                                                                                                                 // Colorize: green
            "<p>PE32 contains this additional field, which is absent in PE32+, following BaseOfCode.</p>\n"                                                                                              // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Offset</th>\n"                                                                                                                                                                          // Colorize: green
            "<th>Size</th>\n"                                                                                                                                                                            // Colorize: green
            "<th>Field</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>24 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>BaseOfData <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The address that is relative to the image base of the beginning-of-data section when it is loaded into memory. <br/></td>\n"                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>\n"                                                                                                                                                                                 // Colorize: green
            "<h4 id=\"optional-header-windows-specific-fields-image-only\">Optional Header Windows-Specific Fields (Image Only)</h4>\n"                                                                  // Colorize: green
            "<p>The next 21 fields are an extension to the COFF optional header format. They contain additional information that is required by the linker and loader in Windows.</p>\n"                 // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Offset (PE32/ PE32+)</th>\n"                                                                                                                                                            // Colorize: green
            "<th>Size (PE32/ PE32+)</th>\n"                                                                                                                                                              // Colorize: green
            "<th>Field</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>28/24 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4/8 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "<td>ImageBase <br/></td>\n"                                                                                                                                                                 // Colorize: green
            "<td>The preferred address of the first byte of image when loaded into memory; must be a multiple of 64 K. The default for DLLs is 0x10000000. The default for Windows CE EXEs is 0x00010000. The default for Windows NT, Windows 2000, Windows XP, Windows 95, Windows 98, and Windows Me is 0x00400000. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>32/32 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SectionAlignment <br/></td>\n"                                                                                                                                                          // Colorize: green
            "<td>The alignment (in bytes) of sections when they are loaded into memory. It must be greater than or equal to FileAlignment. The default is the page size for the architecture. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>36/36 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>FileAlignment <br/></td>\n"                                                                                                                                                             // Colorize: green
            "<td>The alignment factor (in bytes) that is used to align the raw data of sections in the image file. The value should be a power of 2 between 512 and 64 K, inclusive. The default is 512. If the SectionAlignment is less than the architecture's page size, then FileAlignment must match SectionAlignment. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>40/40 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MajorOperatingSystemVersion <br/></td>\n"                                                                                                                                               // Colorize: green
            "<td>The major version number of the required operating system. <br/></td>\n"                                                                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>42/42 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MinorOperatingSystemVersion <br/></td>\n"                                                                                                                                               // Colorize: green
            "<td>The minor version number of the required operating system. <br/></td>\n"                                                                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>44/44 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MajorImageVersion <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>The major version number of the image. <br/></td>\n"                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>46/46 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MinorImageVersion <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>The minor version number of the image. <br/></td>\n"                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>48/48 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MajorSubsystemVersion <br/></td>\n"                                                                                                                                                     // Colorize: green
            "<td>The major version number of the subsystem. <br/></td>\n"                                                                                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>50/50 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MinorSubsystemVersion <br/></td>\n"                                                                                                                                                     // Colorize: green
            "<td>The minor version number of the subsystem. <br/></td>\n"                                                                                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>52/52 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Win32VersionValue <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>Reserved, must be zero. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>56/56 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SizeOfImage <br/></td>\n"                                                                                                                                                               // Colorize: green
            "<td>The size (in bytes) of the image, including all headers, as the image is loaded in memory. It must be a multiple of SectionAlignment. <br/></td>\n"                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>60/60 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SizeOfHeaders <br/></td>\n"                                                                                                                                                             // Colorize: green
            "<td>The combined size of an MS-DOS stub, PE header, and section headers rounded up to a multiple of FileAlignment. <br/></td>\n"                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>64/64 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>CheckSum <br/></td>\n"                                                                                                                                                                  // Colorize: green
            "<td>The image file checksum. The algorithm for computing the checksum is incorporated into IMAGHELP.DLL. The following are checked for validation at load time: all drivers, any DLL loaded at boot time, and any DLL that is loaded into a critical Windows process. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>68/68 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Subsystem <br/></td>\n"                                                                                                                                                                 // Colorize: green
            "<td>The subsystem that is required to run this image. For more information, see <a href=\"#windows-subsystem\" data-linktype=\"self-bookmark\">Windows Subsystem</a>. <br/></td>\n"         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>70/70 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>DllCharacteristics <br/></td>\n"                                                                                                                                                        // Colorize: green
            "<td>For more information, see <a href=\"#dll-characteristics\" data-linktype=\"self-bookmark\">DLL Characteristics</a> later in this specification. <br/></td>\n"                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>72/72 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4/8 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "<td>SizeOfStackReserve <br/></td>\n"                                                                                                                                                        // Colorize: green
            "<td>The size of the stack to reserve. Only SizeOfStackCommit is committed; the rest is made available one page at a time until the reserve size is reached. <br/></td>\n"                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>76/80 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4/8 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "<td>SizeOfStackCommit <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>The size of the stack to commit. <br/></td>\n"                                                                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>80/88 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4/8 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "<td>SizeOfHeapReserve <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>The size of the local heap space to reserve. Only SizeOfHeapCommit is committed; the rest is made available one page at a time until the reserve size is reached. <br/></td>\n"         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>84/96 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4/8 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "<td>SizeOfHeapCommit <br/></td>\n"                                                                                                                                                          // Colorize: green
            "<td>The size of the local heap space to commit. <br/></td>\n"                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>88/104 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>LoaderFlags <br/></td>\n"                                                                                                                                                               // Colorize: green
            "<td>Reserved, must be zero. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>92/108 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>NumberOfRvaAndSizes <br/></td>\n"                                                                                                                                                       // Colorize: green
            "<td>The number of data-directory entries in the remainder of the optional header. Each describes a location and size. <br/></td>\n"                                                         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(headerText))                                                                                                                                                      // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE Optional Header specification didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = headerText.split('\n');                                                                                                                                                      // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(57) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(58) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(59) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(60) != "<th>Offset</th>"                                                                                                                                                             // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(61) != "<th>Size</th>"                                                                                                                                                               // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(62) != "<th>Field</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(63) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(64) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(65) != "</thead>"                                                                                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(66) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(67) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE Optional Header specification");                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 68;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fieldTypes;                                                                                                                                                                              // Colorize: green
    QStringList fieldNames;                                                                                                                                                                              // Colorize: green
    QStringList fieldDescriptions;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldTypes.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldNames.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldDescriptions.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 3;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(i + 21) != "<p>The next 21 fields are an extension to the COFF optional header format. They contain additional information that is required by the linker and loader in Windows.</p>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 22) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 23) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 24) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 25) != "<th>Offset (PE32/ PE32+)</th>"                                                                                                                                                             // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 26) != "<th>Size (PE32/ PE32+)</th>"                                                                                                                                                               // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 27) != "<th>Field</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 28) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 29) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 30) != "</thead>"                                                                                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 31) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 32) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE Optional Header specification");                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i += 33;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString type = lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed();                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldTypes.append(type.mid(type.indexOf('/') + 1));                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldNames.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldDescriptions.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 3;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList headerLines;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.append(QString("// Verified with PeSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                    .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        headerLines.append("struct PeOptionalHeader");                                                                                                                                                     // Colorize: green
        headerLines.append("{");                                                                                                                                                                     // Colorize: green
        headerLines.append("    void print(); // TEST: NO");                                                                                                                                         // Colorize: green
        headerLines.append("    bool verify(); // TEST: NO");                                                                                                                                        // Colorize: green
        headerLines.append("");                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fieldTypes.size(); ++i)                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString type = mPeTypeToNgosTypeMap.value(fieldTypes.at(i), "");                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (type == "")                                                                                                                                                                              // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE type: %1")                                                                                                                                // Colorize: green
                                            .arg(fieldTypes.at(i))                                                                                                                                       // Colorize: green
                );                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString name = fieldNames.at(i);                                                                                                                                                             // Colorize: green
            name = name.at(0).toLower() + name.mid(1);                                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            headerLines.append(QString("    %1 %2;%3 // %4")                                                                                                                                                     // Colorize: green
                                        .arg(type, -39, QChar(' '))                                                                                                                                      // Colorize: green
                                        .arg(name)                                                                                                                                                       // Colorize: green
                                        .arg("", 40 - name.length(), QChar(' '))                                                                                                                         // Colorize: green
                                        .arg(fieldDescriptions.at(i))                                                                                                                                    // Colorize: green
            );                                                                                                                                                                        // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        headerLines.append("};");                                                                                                                                                                    // Colorize: green
        headerLines.append(QString("// Verified with PeSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                    .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Replace well known types for fields                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.replaceInStrings("    quint16                                 magic;",              "    PeOptionalHeaderMagic                   magic;");                                       // Colorize: green
        headerLines.replaceInStrings("    quint16                                 subsystem;",          "    PeOptionalHeaderSubsystem               subsystem;");                                       // Colorize: green
        headerLines.replaceInStrings("    quint16                                 dllCharacteristics;", "    PeOptionalHeaderDllCharacteristicsFlags dllCharacteristics;");                              // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Insert some specific fields                                                                                                                                                                       // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.insert(35, "    DataDirectory                           dataDirectories[NUMBER_OF_RVA_AND_SIZES];");                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(headerLines, thread->getPath() + "/" + PE_OPTIONAL_HEADER_H))                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Optional Header with specification");                                                                                                                       // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeOptionalHeaderMagic(SpecVerifyThread *thread, const QString &specContent)                                                                                                // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString magicText;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init magicText                                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        magicText =                                                                                                                                                                                  // Colorize: green
            "<p>The optional header magic number determines whether an image is a PE32 or PE32+ executable.</p>\n"                                                                                       // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Magic number</th>\n"                                                                                                                                                                    // Colorize: green
            "<th>PE format</th>\n"                                                                                                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0x10b <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>PE32 <br/></td>\n"                                                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0x20b <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>PE32+ <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(magicText))                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE Optional Header Magic specification didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList magicLines;                                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        magicLines.append(QString("// Verified with PeSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                        .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        magicLines.append("enum class PeOptionalHeaderMagic: quint16");                                                                                                                              // Colorize: green
        magicLines.append("{");                                                                                                                                                                      // Colorize: green
        magicLines.append("    NONE = 0,");                                                                                                                                                          // Colorize: green
        magicLines.append("    PE32 = 0x010B, // 32 bit executable image");                                                                                                                          // Colorize: green
        magicLines.append("    PE64 = 0x020B  // 64 bit executable image");                                                                                                                          // Colorize: green
        magicLines.append("};");                                                                                                                                                                     // Colorize: green
        magicLines.append(QString("// Verified with PeSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                        .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(magicLines, thread->getPath() + "/" + PE_OPTIONAL_HEADER_MAGIC_H))                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Optional Header Magic with specification");                                                                                                             // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeOptionalHeaderSubsystem(SpecVerifyThread *thread, const QString &specContent)                                                                                                // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString subsystemsText;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init subsystemsText                                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        subsystemsText =                                                                                                                                                                                 // Colorize: green
            "<h5 id=\"windows-subsystem\">Windows Subsystem</h5>\n"                                                                                                                                      // Colorize: green
            "<p>The following values defined for the Subsystem field of the optional header determine which Windows subsystem (if any) is required to run the image.</p>\n"                              // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Constant</th>\n"                                                                                                                                                                        // Colorize: green
            "<th>Value</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_UNKNOWN <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>An unknown subsystem <br/></td>\n"                                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_NATIVE <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>1 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Device drivers and native Windows processes <br/></td>\n"                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_WINDOWS_GUI <br/></td>\n"                                                                                                                                               // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>The Windows graphical user interface (GUI) subsystem <br/></td>\n"                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_WINDOWS_CUI <br/></td>\n"                                                                                                                                               // Colorize: green
            "<td>3 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>The Windows character subsystem <br/></td>\n"                                                                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_OS2_CUI <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>5 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>The OS/2 character subsystem <br/></td>\n"                                                                                                                                              // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_POSIX_CUI <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>7 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>The Posix character subsystem <br/></td>\n"                                                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_NATIVE_WINDOWS <br/></td>\n"                                                                                                                                            // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Native Win9x driver <br/></td>\n"                                                                                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_WINDOWS_CE_GUI <br/></td>\n"                                                                                                                                            // Colorize: green
            "<td>9 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Windows CE <br/></td>\n"                                                                                                                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_EFI_APPLICATION <br/></td>\n"                                                                                                                                           // Colorize: green
            "<td>10 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>An Extensible Firmware Interface (EFI) application <br/></td>\n"                                                                                                                        // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_EFI_BOOT_ SERVICE_DRIVER <br/></td>\n"                                                                                                                                  // Colorize: green
            "<td>11 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>An EFI driver with boot services <br/></td>\n"                                                                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_EFI_RUNTIME_ DRIVER <br/></td>\n"                                                                                                                                       // Colorize: green
            "<td>12 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>An EFI driver with run-time services <br/></td>\n"                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_EFI_ROM <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>13 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>An EFI ROM image <br/></td>\n"                                                                                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_XBOX <br/></td>\n"                                                                                                                                                      // Colorize: green
            "<td>14 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>XBOX <br/></td>\n"                                                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_WINDOWS_BOOT_APPLICATION <br/></td>\n"                                                                                                                                  // Colorize: green
            "<td>16 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>Windows boot application. <br/></td>\n"                                                                                                                                                 // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(subsystemsText))                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE Optional Header Subsystems specification didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = subsystemsText.split('\n');                                                                                                                                                      // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(2) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(3) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(4) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(5) != "<th>Constant</th>"                                                                                                                                                           // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(6) != "<th>Value</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(7) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(8) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(9) != "</thead>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(10) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(11) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE Optional Header Subsystems specification");                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 12;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList values;                                                                                                                                                                                  // Colorize: green
    QStringList descriptions;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fields.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            values.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            descriptions.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 3;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldNamesToNgosFieldNames; // PE field name => NGOS field name                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill peFieldNamesToNgosFieldNames                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_UNKNOWN",                  "UNKNOWN");                                                                                                      // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_NATIVE",                   "NATIVE");                                                                                                       // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_WINDOWS_GUI",              "WINDOWS_GUI");                                                                                                  // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_WINDOWS_CUI",              "WINDOWS_CUI");                                                                                                  // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_OS2_CUI",                  "OS2_CUI");                                                                                                      // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_POSIX_CUI",                "POSIX_CUI");                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_NATIVE_WINDOWS",           "NATIVE_WINDOWS");                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_WINDOWS_CE_GUI",           "WINDOWS_CE_GUI");                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_EFI_APPLICATION",          "UEFI_APPLICATION");                                                                                             // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_EFI_BOOT_ SERVICE_DRIVER", "UEFI_BOOT_SERVICE_DRIVER");                                                                                     // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_EFI_RUNTIME_ DRIVER",      "UEFI_RUNTIME_DRIVER");                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_EFI_ROM",                  "UEFI_ROM");                                                                                                     // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_XBOX",                     "XBOX");                                                                                                         // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_WINDOWS_BOOT_APPLICATION", "WINDOWS_BOOT_APPLICATION");                                                                                     // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList subsystemsLines;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        subsystemsLines.append(QString("// Verified with PeSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                        .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        subsystemsLines.append("enum class PeOptionalHeaderSubsystem: quint16");                                                                                                                         // Colorize: green
        subsystemsLines.append("{");                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fields.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString field = peFieldNamesToNgosFieldNames.value(fields.at(i), "");                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field name: %1")                                                                                                                          // Colorize: green
                                            .arg(fields.at(i))                                                                                                                                           // Colorize: green
                );                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString value = "0x" + QString("%1")                                                                                                                                                         // Colorize: green
                            .arg(values.at(i).toUShort(nullptr), 4, 16, QChar('0'))                                                                                                                      // Colorize: green
                            .toUpper();                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (value == "0x0000")                                                                                                                                                                       // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                value = "0";                                                                                                                                                                             // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            subsystemsLines.append(QString("    %1 = %2%3%4 // %5")                                                                                                                                                   // Colorize: green
                                            .arg(field, -24, QChar(' '))                                                                                                                                                         // Colorize: green
                                            .arg(value)                                                                                                                                                                          // Colorize: green
                                            .arg(i < fields.size() - 1 ? "," : " ")                                                                                                                       // Colorize: green
                                            .arg("", 6 - value.length(), QChar(' '))                                                                                                                               // Colorize: green
                                            .arg(descriptions.at(i))                                                                                                                                     // Colorize: green
            );                                                                                                                                                               // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        subsystemsLines.append("};");                                                                                                                                                                    // Colorize: green
        subsystemsLines.append(QString("// Verified with PeSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                        .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(subsystemsLines, thread->getPath() + "/" + PE_OPTIONAL_HEADER_SUBSYSTEM_H))                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Optional Header Subsystems with specification");                                                                                                            // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeOptionalHeaderDllCharacteristics(SpecVerifyThread *thread, const QString &specContent)                                                                                       // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString characteristicsText;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init characteristicsText                                                                                                                                                                          // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        characteristicsText =                                                                                                                                                                            // Colorize: green
            "<h5 id=\"dll-characteristics\">DLL Characteristics</h5>\n"                                                                                                                                  // Colorize: green
            "<p>The following values are defined for the DllCharacteristics field of the optional header.</p>\n"                                                                                         // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Constant</th>\n"                                                                                                                                                                        // Colorize: green
            "<th>Value</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x0001 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Reserved, must be zero. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x0002 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Reserved, must be zero. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x0004 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Reserved, must be zero. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x0008 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Reserved, must be zero. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_HIGH_ENTROPY_VA <br/></td>\n"                                                                                                                                  // Colorize: green
            "<td>0x0020 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Image can handle a high entropy 64-bit virtual address space. <br/></td>\n"                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ <br/> DYNAMIC_BASE <br/></td>\n"                                                                                                                              // Colorize: green
            "<td>0x0040 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>DLL can be relocated at load time. <br/></td>\n"                                                                                                                                        // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ <br/> FORCE_INTEGRITY <br/></td>\n"                                                                                                                           // Colorize: green
            "<td>0x0080 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Code Integrity checks are enforced. <br/></td>\n"                                                                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ <br/> NX_COMPAT <br/></td>\n"                                                                                                                                 // Colorize: green
            "<td>0x0100 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Image is NX compatible. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ NO_ISOLATION <br/></td>\n"                                                                                                                                    // Colorize: green
            "<td>0x0200 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Isolation aware, but do not isolate the image. <br/></td>\n"                                                                                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ NO_SEH <br/></td>\n"                                                                                                                                          // Colorize: green
            "<td>0x0400 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Does not use structured exception (SE) handling. No SE handler may be called in this image. <br/></td>\n"                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ NO_BIND <br/></td>\n"                                                                                                                                         // Colorize: green
            "<td>0x0800 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Do not bind the image. <br/></td>\n"                                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_APPCONTAINER <br/></td>\n"                                                                                                                                     // Colorize: green
            "<td>0x1000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Image must execute in an AppContainer. <br/></td>\n"                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ WDM_DRIVER <br/></td>\n"                                                                                                                                      // Colorize: green
            "<td>0x2000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>A WDM driver. <br/></td>\n"                                                                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_GUARD_CF <br/></td>\n"                                                                                                                                         // Colorize: green
            "<td>0x4000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Image supports Control Flow Guard. <br/></td>\n"                                                                                                                                        // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ TERMINAL_SERVER_AWARE <br/></td>\n"                                                                                                                           // Colorize: green
            "<td>0x8000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Terminal Server aware. <br/></td>\n"                                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(characteristicsText))                                                                                                                                                  // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE Optional Header DLL Characteristics specification didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = characteristicsText.split('\n');                                                                                                                                                 // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(2) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(3) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(4) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(5) != "<th>Flag</th>"                                                                                                                                                               // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(6) != "<th>Value</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(7) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(8) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(9) != "</thead>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(10) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(11) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE Optional Header DLL Characteristics specification");                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 12;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList values;                                                                                                                                                                                  // Colorize: green
    QStringList descriptions;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fields.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            values.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            descriptions.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 3;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldNamesToNgosFieldNames;   // PE field name  => NGOS field name                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldValuesToNgosFieldValues; // PE field value => NGOS field value                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill peFieldNamesToNgosFieldNames                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_HIGH_ENTROPY_VA",        "HIGH_ENTROPY_VA");                                                                                       // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_  DYNAMIC_BASE",         "DYNAMIC_BASE");                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_  FORCE_INTEGRITY",      "FORCE_INTEGRITY");                                                                                       // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_  NX_COMPAT",            "NX_COMPAT");                                                                                             // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_ NO_ISOLATION",          "NO_ISOLATION");                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_ NO_SEH",                "NO_SEH");                                                                                                // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_ NO_BIND",               "NO_BIND");                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_APPCONTAINER",           "APPCONTAINER");                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_ WDM_DRIVER",            "WDM_DRIVER");                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_GUARD_CF",               "GUARD_CF");                                                                                              // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_ TERMINAL_SERVER_AWARE", "TERMINAL_SERVER_AWARE");                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0001", "BIT_0");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0002", "BIT_1");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0004", "BIT_2");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0008", "BIT_3");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0010", "BIT_4");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0020", "BIT_5");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0040", "BIT_6");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0080", "BIT_7");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0100", "BIT_8");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0200", "BIT_9");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0400", "BIT_10");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0800", "BIT_11");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x1000", "BIT_12");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x2000", "BIT_13");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x4000", "BIT_14");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x8000", "BIT_15");                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList characteristicsLines;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        characteristicsLines.append(QString("// Verified with PeSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                            .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        characteristicsLines.append("typedef quint16 pe_optional_header_dll_characteristics_flags;");                                                                                                    // Colorize: green
        characteristicsLines.append("");                                                                                                                                                                 // Colorize: green
        characteristicsLines.append("enum class PeOptionalHeaderDllCharacteristicsFlag: pe_optional_header_dll_characteristics_flags");                                                                  // Colorize: green
        characteristicsLines.append("{");                                                                                                                                                                // Colorize: green
        characteristicsLines.append("    NONE                  = 0,");                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fields.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString field = fields.at(i);                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                continue;                                                                                                                                                                                // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            field = peFieldNamesToNgosFieldNames.value(field, "");                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field name: %1")                                                                                                                          // Colorize: green
                                            .arg(fields.at(i))                                                                                                                                           // Colorize: green
                );                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString value = peFieldValuesToNgosFieldValues.value(values.at(i), "");                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (value == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field value: %1")                                                                                                                         // Colorize: green
                                            .arg(values.at(i))                                                                                                                                           // Colorize: green
                );                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            characteristicsLines.append(QString("    %1 = %2%3%4 // %5")                                                                                                                                                   // Colorize: green
                                                .arg(field, -21, QChar(' '))                                                                                                                             // Colorize: green
                                                .arg(value)                                                                                                                                              // Colorize: green
                                                .arg(i < fields.size() - 1 ? "," : " ")                                                                                                                  // Colorize: green
                                                .arg("", 6 - value.length(), QChar(' '))                                                                                                                // Colorize: green
                                                .arg(descriptions.at(i))                                                                                                                                     // Colorize: green
            );                                                                                                                                                               // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        characteristicsLines.append("};");                                                                                                                                                               // Colorize: green
        characteristicsLines.append("");                                                                                                                                                                 // Colorize: green
        characteristicsLines.append("DEFINE_FLAGS(PeOptionalHeaderDllCharacteristicsFlags, pe_optional_header_dll_characteristics_flags); // TEST: NO");                                                 // Colorize: green
        characteristicsLines.append(QString("// Verified with PeSpecVerifier [END] // %1")                                                                                                               // Colorize: green
                                            .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(characteristicsLines, thread->getPath() + "/" + PE_OPTIONAL_HEADER_DLL_CHARACTERISTICS_H))                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Optional Header DLL Characteristics with specification");                                                                                                   // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeDataDirectory(SpecVerifyThread *thread, const QString &specContent)                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString dataDirectoryText;                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init dataDirectoryText                                                                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        dataDirectoryText =                                                                                                                                                                              // Colorize: green
            "<h4 id=\"optional-header-data-directories-image-only\">Optional Header Data Directories (Image Only)</h4>\n"                                                                                // Colorize: green
            "<p>Each data directory gives the address and size of a table or string that Windows uses. These data directory entries are all loaded into memory so that the system can use them at run time. A data directory is an 8-byte field that has the following declaration:</p>\n" // Colorize: green
            "<pre><code class=\"lang-cpp\">typedef struct _IMAGE_DATA_DIRECTORY {\n"                                                                                                                     // Colorize: green
            "    DWORD   VirtualAddress;\n"                                                                                                                                                              // Colorize: green
            "    DWORD   Size;\n"                                                                                                                                                                        // Colorize: green
            "} IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;\n"                                                                                                                                          // Colorize: green
            "</code></pre>\n"                                                                                                                                                                            // Colorize: green
            "<p>The first field, VirtualAddress, is actually the RVA of the table. The RVA is the address of the table relative to the base address of the image when the table is loaded. The second field gives the size in bytes. The data directories, which form the last part of the optional header, are listed in the following table.</p>\n" // Colorize: green
            "<p>Note that the number of directories is not fixed. Before looking for a specific directory, check the NumberOfRvaAndSizes field in the optional header.</p>\n"                            // Colorize: green
            "<p>Also, do not assume that the RVAs in this table point to the beginning of a section or that the sections that contain specific tables have specific names.</p>";                         // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(dataDirectoryText))                                                                                                                                                    // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE Data Directory specification didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList dataDirectoryLines;                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        dataDirectoryLines.append(QString("// Verified with PeSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                            .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        dataDirectoryLines.append("struct DataDirectory");                                                                                                                                               // Colorize: green
        dataDirectoryLines.append("{");                                                                                                                                                                  // Colorize: green
        dataDirectoryLines.append("    void print(DataDirectoryType type); // TEST: NO");                                                                                                                                      // Colorize: green
        dataDirectoryLines.append("    bool verify(DataDirectoryType type); // TEST: NO");                                                                                                                                     // Colorize: green
        dataDirectoryLines.append("");                                                                                                                                                                   // Colorize: green
        dataDirectoryLines.append("    quint32 virtualAddress;");                                                                                                                                        // Colorize: green
        dataDirectoryLines.append("    quint32 size;");                                                                                                                                                  // Colorize: green
        dataDirectoryLines.append("};");                                                                                                                                                                 // Colorize: green
        dataDirectoryLines.append(QString("// Verified with PeSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                            .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(dataDirectoryLines, thread->getPath() + "/" + PE_DATA_DIRECTORY_H))                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Data Directory with specification");                                                                                                                        // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeDataDirectoryType(SpecVerifyThread *thread, const QString &specContent)                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString dataDirectoryTypeText;                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init dataDirectoryTypeText                                                                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        dataDirectoryTypeText =                                                                                                                                                                          // Colorize: green
            "<p>Also, do not assume that the RVAs in this table point to the beginning of a section or that the sections that contain specific tables have specific names.</p>\n"                        // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Offset (PE/PE32+)</th>\n"                                                                                                                                                               // Colorize: green
            "<th>Size</th>\n"                                                                                                                                                                            // Colorize: green
            "<th>Field</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>96/112 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Export Table <br/></td>\n"                                                                                                                                                              // Colorize: green
            "<td>The export table address and size. For more information see <a href=\"#the-edata-section-image-only\" data-linktype=\"self-bookmark\">.edata Section (Image Only)</a>. <br/></td>\n"    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>104/120 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Import Table <br/></td>\n"                                                                                                                                                              // Colorize: green
            "<td>The import table address and size. For more information, see <a href=\"#the-idata-section\" data-linktype=\"self-bookmark\">The .idata Section</a>.<br/></td>\n"                        // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>112/128 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Resource Table <br/></td>\n"                                                                                                                                                            // Colorize: green
            "<td>The resource table address and size. For more information, see <a href=\"#the-rsrc-section\" data-linktype=\"self-bookmark\">The .rsrc Section</a>.<br/></td>\n"                        // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>120/136 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Exception Table <br/></td>\n"                                                                                                                                                           // Colorize: green
            "<td>The exception table address and size. For more information, see <a href=\"#the-pdata-section\" data-linktype=\"self-bookmark\">The .pdata Section</a>. <br/></td>\n"                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>128/144 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Certificate Table <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>The attribute certificate table address and size. For more information, see <a href=\"#the-attribute-certificate-table-image-only\" data-linktype=\"self-bookmark\">The Attribute Certificate Table (Image Only)</a>. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>136/152 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Base Relocation Table <br/></td>\n"                                                                                                                                                     // Colorize: green
            "<td>The base relocation table address and size. For more information, see <a href=\"#the-reloc-section-image-only\" data-linktype=\"self-bookmark\">The .reloc Section (Image Only)</a>.<br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>144/160 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Debug <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>The debug data starting address and size. For more information, see <a href=\"#the-debug-section\" data-linktype=\"self-bookmark\">The .debug Section</a>.<br/></td>\n"                 // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>152/168 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Architecture <br/></td>\n"                                                                                                                                                              // Colorize: green
            "<td>Reserved, must be 0 <br/></td>\n"                                                                                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>160/176 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Global Ptr <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The RVA of the value to be stored in the global pointer register. The size member of this structure must be set to zero. <br/></td>\n"                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>168/184 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>TLS Table <br/></td>\n"                                                                                                                                                                 // Colorize: green
            "<td>The thread local storage (TLS) table address and size. For more information, see <a href=\"#the-tls-section\" data-linktype=\"self-bookmark\">The .tls Section</a>.<br/></td>\n"        // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>176/192 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Load Config Table <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>The load configuration table address and size. For more information, see <a href=\"#the-load-configuration-structure-image-only\" data-linktype=\"self-bookmark\">The Load Configuration Structure (Image Only)</a>.<br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>184/200 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Bound Import <br/></td>\n"                                                                                                                                                              // Colorize: green
            "<td>The bound import table address and size. <br/></td>\n"                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>192/208 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>IAT <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "<td>The import address table address and size. For more information, see <a href=\"#import-address-table\" data-linktype=\"self-bookmark\">Import Address Table</a>.<br/></td>\n"           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>200/216 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Delay Import Descriptor <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>The delay import descriptor address and size. For more information, see <a href=\"#delay-load-import-tables-image-only\" data-linktype=\"self-bookmark\">Delay-Load Import Tables (Image Only)</a>.<br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>208/224 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>CLR Runtime Header <br/></td>\n"                                                                                                                                                        // Colorize: green
            "<td>The CLR runtime header address and size. For more information, see <a href=\"#the-cormeta-section-object-only\" data-linktype=\"self-bookmark\">The .cormeta Section (Object Only)</a>.<br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>216/232 <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Reserved, must be zero <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>\n";                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(dataDirectoryTypeText))                                                                                                                                                    // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE Data Directory Type specification didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = dataDirectoryTypeText.split('\n');                                                                                                                                                 // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(1) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(2) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(3) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(4) != "<th>Offset (PE/PE32+)</th>"                                                                                                                                                               // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(5) != "<th>Size</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(6) != "<th>Field</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(7) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(8) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(9) != "</thead>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(10) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(11) != "<tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(12) != "<td>96/112 <br/></td>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(13) != "<td>8 <br/></td>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE Data Directory Type specification");                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 14;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList descriptions;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString field = lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed();                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "Reserved, must be zero")                                                                                                                                                       // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                i += 6;                                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                continue;                                                                                                                                                                                // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                        // Colorize: green
            fields.append(field);                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            descriptions.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 5;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldNamesToNgosFieldNames;   // PE field name => NGOS field name                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill peFieldNamesToNgosFieldNames                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("Export Table",            "EXPORT_TABLE");                                                                                                         // Colorize: green
        peFieldNamesToNgosFieldNames.insert("Import Table",            "IMPORT_TABLE");                                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("Resource Table",          "RESOURCE_TABLE");                                                                                                // Colorize: green
        peFieldNamesToNgosFieldNames.insert("Exception Table",         "EXCEPTION_TABLE");                                                                                              // Colorize: green
        peFieldNamesToNgosFieldNames.insert("Certificate Table",       "CERTIFICATE_TABLE");                                                                                                           // Colorize: green
        peFieldNamesToNgosFieldNames.insert("Base Relocation Table",   "BASE_RELOCATION_TABLE");                                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("Debug",                   "DEBUG");                                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("Architecture",            "ARCHITECTURE");                                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("Global Ptr",              "GLOBAL_PTR");                                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("TLS Table",               "TLS_TABLE");                                                                                                       // Colorize: green
        peFieldNamesToNgosFieldNames.insert("Load Config Table",       "LOAD_CONFIG_TABLE");                                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("Bound Import",            "BOUND_IMPORT");                                                                                                         // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IAT",                     "IMPORT_ADDRESS_TABLE");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("Delay Import Descriptor", "DELAY_IMPORT_DESCRIPTOR");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("CLR Runtime Header",      "CLR_RUNTIME_HEADER");                                                                                                           // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList dataDirectoryTypeLines;                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        dataDirectoryTypeLines.append(QString("// Verified with PeSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                                .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        dataDirectoryTypeLines.append("enum class DataDirectoryType: quint32");                                                                                                                                   // Colorize: green
        dataDirectoryTypeLines.append("{");                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fields.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString field = peFieldNamesToNgosFieldNames.value(fields.at(i), "");                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field name: %1")                                                                                                                          // Colorize: green
                                            .arg(fields.at(i))                                                                                                                                           // Colorize: green
                );                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            dataDirectoryTypeLines.append(QString("    %1,%2// %3")                                                                                                                                                 // Colorize: green
                                                    .arg(field)                                                                                                                          // Colorize: green
                                                    .arg("" , 24 - field.length(), QChar(' '))                                                                                                                             // Colorize: green
                                                    .arg(descriptions.at(i))                                                                                                                             // Colorize: green
            );                                                                                                                                                    // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        dataDirectoryTypeLines.append("    MAXIMUM");                                                                                                                                                                      // Colorize: green
        dataDirectoryTypeLines.append("};");                                                                                                                                                                      // Colorize: green
        dataDirectoryTypeLines.append(QString("// Verified with PeSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                                .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(dataDirectoryTypeLines, thread->getPath() + "/" + PE_DATA_DIRECTORY_TYPE_H))                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Data Directory Type with specification");                                                                                                                        // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeSectionHeader(SpecVerifyThread *thread, const QString &specContent)                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString headerText;                                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init headerText                                                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerText =                                                                                                                                                                                     // Colorize: green
            "<h2 id=\"section-table-section-headers\">Section Table (Section Headers)</h2>\n"                                                                                                            // Colorize: green
            "<ul>\n"                                                                                                                                                                                     // Colorize: green
            "<li><a href=\"#section-flags\" data-linktype=\"self-bookmark\">Section Flags</a></li>\n"                                                                                                    // Colorize: green
            "<li><a href=\"#grouped-sections-object-only\" data-linktype=\"self-bookmark\">Grouped Sections (Object Only)</a></li>\n"                                                                    // Colorize: green
            "</ul>\n"                                                                                                                                                                                    // Colorize: green
            "<p>Each row of the section table is, in effect, a section header. This table immediately follows the optional header, if any. This positioning is required because the file header does not contain a direct pointer to the section table. Instead, the location of the section table is determined by calculating the location of the first byte after the headers. Make sure to use the size of the optional header as specified in the file header.</p>\n" // Colorize: green
            "<p>The number of entries in the section table is given by the NumberOfSections field in the file header. Entries in the section table are numbered starting from one (1). The code and data memory section entries are in the order chosen by the linker.</p>\n" // Colorize: green
            "<p>In an image file, the VAs for sections must be assigned by the linker so that they are in ascending order and adjacent, and they must be a multiple of the SectionAlignment value in the optional header.</p>\n" // Colorize: green
            "<p>Each section header (section table entry) has the following format, for a total of 40 bytes per entry.</p>\n"                                                                            // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Offset</th>\n"                                                                                                                                                                          // Colorize: green
            "<th>Size</th>\n"                                                                                                                                                                            // Colorize: green
            "<th>Field</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Name <br/></td>\n"                                                                                                                                                                      // Colorize: green
            "<td>An 8-byte, null-padded UTF-8 encoded string. If the string is exactly 8 characters long, there is no terminating null. For longer names, this field contains a slash (/) that is followed by an ASCII representation of a decimal number that is an offset into the string table. Executable images do not use a string table and do not support section names longer than 8 characters. Long names in object files are truncated if they are emitted to an executable file. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>VirtualSize <br/></td>\n"                                                                                                                                                               // Colorize: green
            "<td>The total size of the section when loaded into memory. If this value is greater than SizeOfRawData, the section is zero-padded. This field is valid only for executable images and should be set to zero for object files. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>12 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>VirtualAddress <br/></td>\n"                                                                                                                                                            // Colorize: green
            "<td>For executable images, the address of the first byte of the section relative to the image base when the section is loaded into memory. For object files, this field is the address of the first byte before relocation is applied; for simplicity, compilers should set this to zero. Otherwise, it is an arbitrary value that is subtracted from offsets during relocation. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>16 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SizeOfRawData <br/></td>\n"                                                                                                                                                             // Colorize: green
            "<td>The size of the section (for object files) or the size of the initialized data on disk (for image files). For executable images, this must be a multiple of FileAlignment from the optional header. If this is less than VirtualSize, the remainder of the section is zero-filled. Because the SizeOfRawData field is rounded but the VirtualSize field is not, it is possible for SizeOfRawData to be greater than VirtualSize as well. When a section contains only uninitialized data, this field should be zero. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>20 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>PointerToRawData <br/></td>\n"                                                                                                                                                          // Colorize: green
            "<td>The file pointer to the first page of the section within the COFF file. For executable images, this must be a multiple of FileAlignment from the optional header. For object files, the value should be aligned on a 4-byte boundary for best performance. When a section contains only uninitialized data, this field should be zero. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>24 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>PointerToRelocations <br/></td>\n"                                                                                                                                                      // Colorize: green
            "<td>The file pointer to the beginning of relocation entries for the section. This is set to zero for executable images or if there are no relocations. <br/></td>\n"                        // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>28 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>PointerToLinenumbers <br/></td>\n"                                                                                                                                                      // Colorize: green
            "<td>The file pointer to the beginning of line-number entries for the section. This is set to zero if there are no COFF line numbers. This value should be zero for an image because COFF debugging information is deprecated. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>32 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>NumberOfRelocations <br/></td>\n"                                                                                                                                                       // Colorize: green
            "<td>The number of relocation entries for the section. This is set to zero for executable images. <br/></td>\n"                                                                              // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>34 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>NumberOfLinenumbers <br/></td>\n"                                                                                                                                                       // Colorize: green
            "<td>The number of line-number entries for the section. This value should be zero for an image because COFF debugging information is deprecated. <br/></td>\n"                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>36 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Characteristics <br/></td>\n"                                                                                                                                                           // Colorize: green
            "<td>The flags that describe the characteristics of the section. For more information, see <a href=\"#section-flags\" data-linktype=\"self-bookmark\">Section Flags</a>.<br/></td>\n"        // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(headerText))                                                                                                                                                           // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE Section Header specification didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = headerText.split('\n');                                                                                                                                                          // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(9) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(10) != "<thead>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(11) != "<tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(12) != "<th>Offset</th>"                                                                                                                                                            // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(13) != "<th>Size</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(14) != "<th>Field</th>"                                                                                                                                                             // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(15) != "<th>Description</th>"                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(16) != "</tr>"                                                                                                                                                                      // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(17) != "</thead>"                                                                                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(18) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(19) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE Section Header specification");                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 20;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fieldTypes;                                                                                                                                                                              // Colorize: green
    QStringList fieldNames;                                                                                                                                                                              // Colorize: green
    QStringList fieldDescriptions;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldTypes.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldNames.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldDescriptions.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 3;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList headerLines;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.append(QString("// Verified with PeSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                    .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        headerLines.append("struct SectionHeader");                                                                                                                                                      // Colorize: green
        headerLines.append("{");                                                                                                                                                                         // Colorize: green
        headerLines.append("    void print(); // TEST: NO");                                                                                                                                             // Colorize: green
        headerLines.append("    bool verify(); // TEST: NO");                                                                                                                                            // Colorize: green
        headerLines.append("    bool verifySection(SectionHeaderCharacteristicsFlags expectedCharacteristics); // TEST: NO");                                                                                                                                            // Colorize: green
        headerLines.append("");                                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fieldTypes.size(); ++i)                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString type = mPeTypeToNgosTypeMap.value(fieldTypes.at(i), "");                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (type == "")                                                                                                                                                                              // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE type: %1")                                                                                                                                // Colorize: green
                                            .arg(fieldTypes.at(i))                                                                                                                                       // Colorize: green
                );                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString name = fieldNames.at(i);                                                                                                                                                             // Colorize: green
            name = name.at(0).toLower() + name.mid(1);                                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            headerLines.append(QString("    %1 %2;%3 // %4")                                                                                                                                                     // Colorize: green
                                        .arg(type, -33, QChar(' '))                                                                                                                                       // Colorize: green
                                        .arg(name)                                                                                                                                                       // Colorize: green
                                        .arg("", 20 - name.length(), QChar(' '))                                                                                                                         // Colorize: green
                                        .arg(fieldDescriptions.at(i))                                                                                                                                    // Colorize: green
            );                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        headerLines.append("};");                                                                                                                                                                        // Colorize: green
        headerLines.append(QString("// Verified with PeSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                    .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Replace well known types for fields                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.replaceInStrings("    quint64                           name;   ",             "    char                              name[8];");                                                    // Colorize: green
        headerLines.replaceInStrings("    quint16                           numberOfLinenumbers;", "    quint16                           numberOfLineNumbers;");                                        // Colorize: green
        headerLines.replaceInStrings("    quint32                           characteristics;",     "    SectionHeaderCharacteristicsFlags characteristics;");                                            // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(headerLines, thread->getPath() + "/" + PE_SECTION_HEADER_H))                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Section Header with specification");                                                                                                                        // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeSectionHeaderCharacteristics(SpecVerifyThread *thread, const QString &specContent)                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString characteristicsText;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init characteristicsText                                                                                                                                                                          // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        characteristicsText =                                                                                                                                                                            // Colorize: green
            "<h3 id=\"section-flags\">Section Flags</h3>\n"                                                                                                                                              // Colorize: green
            "<p>The section flags in the Characteristics field of the section header indicate characteristics of the section.</p>\n"                                                                     // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Flag</th>\n"                                                                                                                                                                            // Colorize: green
            "<th>Value</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x00000000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Reserved for future use. <br/></td>\n"                                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x00000001 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Reserved for future use. <br/></td>\n"                                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x00000002 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Reserved for future use. <br/></td>\n"                                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x00000004 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Reserved for future use. <br/></td>\n"                                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_TYPE_NO_PAD <br/></td>\n"                                                                                                                                                     // Colorize: green
            "<td>0x00000008 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section should not be padded to the next boundary. This flag is obsolete and is replaced by IMAGE_SCN_ALIGN_1BYTES. This is valid only for object files. <br/></td>\n"              // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x00000010 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Reserved for future use. <br/></td>\n"                                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_CNT_CODE <br/></td>\n"                                                                                                                                                        // Colorize: green
            "<td>0x00000020 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section contains executable code. <br/></td>\n"                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_CNT_INITIALIZED_DATA <br/></td>\n"                                                                                                                                            // Colorize: green
            "<td>0x00000040 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section contains initialized data. <br/></td>\n"                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_CNT_UNINITIALIZED_ DATA <br/></td>\n"                                                                                                                                         // Colorize: green
            "<td>0x00000080 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section contains uninitialized data. <br/></td>\n"                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_LNK_OTHER <br/></td>\n"                                                                                                                                                       // Colorize: green
            "<td>0x00000100 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Reserved for future use. <br/></td>\n"                                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_LNK_INFO <br/></td>\n"                                                                                                                                                        // Colorize: green
            "<td>0x00000200 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section contains comments or other information. The .drectve section has this type. This is valid for object files only. <br/></td>\n"                                              // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x00000400 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Reserved for future use. <br/></td>\n"                                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_LNK_REMOVE <br/></td>\n"                                                                                                                                                      // Colorize: green
            "<td>0x00000800 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section will not become part of the image. This is valid only for object files. <br/></td>\n"                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_LNK_COMDAT <br/></td>\n"                                                                                                                                                      // Colorize: green
            "<td>0x00001000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section contains COMDAT data. For more information, see <a href=\"#comdat-sections-object-only\" data-linktype=\"self-bookmark\">COMDAT Sections (Object Only)</a>. This is valid only for object files. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_GPREL <br/></td>\n"                                                                                                                                                           // Colorize: green
            "<td>0x00008000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section contains data referenced through the global pointer (GP). <br/></td>\n"                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_MEM_PURGEABLE <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0x00020000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Reserved for future use. <br/></td>\n"                                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_MEM_16BIT <br/></td>\n"                                                                                                                                                       // Colorize: green
            "<td>0x00020000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Reserved for future use. <br/></td>\n"                                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_MEM_LOCKED <br/></td>\n"                                                                                                                                                      // Colorize: green
            "<td>0x00040000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Reserved for future use. <br/></td>\n"                                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_MEM_PRELOAD <br/></td>\n"                                                                                                                                                     // Colorize: green
            "<td>0x00080000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Reserved for future use. <br/></td>\n"                                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_1BYTES <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0x00100000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on a 1-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_2BYTES <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0x00200000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on a 2-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_4BYTES <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0x00300000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on a 4-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_8BYTES <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0x00400000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on an 8-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_16BYTES <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0x00500000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on a 16-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_32BYTES <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0x00600000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on a 32-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_64BYTES <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0x00700000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on a 64-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_128BYTES <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x00800000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on a 128-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_256BYTES <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x00900000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on a 256-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_512BYTES <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x00A00000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on a 512-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_1024BYTES <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x00B00000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on a 1024-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_2048BYTES <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x00C00000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on a 2048-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_4096BYTES <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x00D00000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on a 4096-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_ALIGN_8192BYTES <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x00E00000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>Align data on an 8192-byte boundary. Valid only for object files. <br/></td>\n"                                                                                                         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_LNK_NRELOC_OVFL <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x01000000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section contains extended relocations. <br/></td>\n"                                                                                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_MEM_DISCARDABLE <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x02000000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section can be discarded as needed. <br/></td>\n"                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_MEM_NOT_CACHED <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x04000000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section cannot be cached. <br/></td>\n"                                                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_MEM_NOT_PAGED <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0x08000000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section is not pageable. <br/></td>\n"                                                                                                                                              // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_MEM_SHARED <br/></td>\n"                                                                                                                                                      // Colorize: green
            "<td>0x10000000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section can be shared in memory. <br/></td>\n"                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_MEM_EXECUTE <br/></td>\n"                                                                                                                                                     // Colorize: green
            "<td>0x20000000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section can be executed as code. <br/></td>\n"                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_MEM_READ <br/></td>\n"                                                                                                                                                        // Colorize: green
            "<td>0x40000000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section can be read. <br/></td>\n"                                                                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SCN_MEM_WRITE <br/></td>\n"                                                                                                                                                       // Colorize: green
            "<td>0x80000000 <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The section can be written to. <br/></td>\n"                                                                                                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(characteristicsText))                                                                                                                                                  // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE Section Header Characteristics specification didn't match with the stored one");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = characteristicsText.split('\n');                                                                                                                                                 // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(2) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(3) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(4) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(5) != "<th>Flag</th>"                                                                                                                                                               // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(6) != "<th>Value</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(7) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(8) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(9) != "</thead>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(10) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(11) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE Section Header Characteristics specification");                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 12;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList values;                                                                                                                                                                                  // Colorize: green
    QStringList descriptions;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "<td>IMAGE_SCN_MEM_16BIT <br/></td>")                                                                                                                                            // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                i += 5;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                        // Colorize: green
            fields.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            values.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            descriptions.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 3;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldNamesToNgosFieldNames;   // PE field name  => NGOS field name                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldValuesToNgosFieldValues; // PE field value => NGOS field value                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill peFieldNamesToNgosFieldNames and peFieldValuesToNgosFieldValues                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_TYPE_NO_PAD",             "TYPE_NO_PAD");                                                                                                         // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_CNT_CODE",                "CNT_CODE");                                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_CNT_INITIALIZED_DATA",    "CNT_INITIALIZED_DATA");                                                                                                // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_CNT_UNINITIALIZED_ DATA", "CNT_UNINITIALIZED_DATA");                                                                                              // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_LNK_OTHER",               "LNK_OTHER");                                                                                                           // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_LNK_INFO",                "LNK_INFO");                                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_LNK_REMOVE",              "LNK_REMOVE");                                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_LNK_COMDAT",              "LNK_COMDAT");                                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_GPREL",                   "GPREL");                                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_MEM_PURGEABLE",           "MEM_PURGEABLE");                                                                                                       // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_MEM_LOCKED",              "MEM_LOCKED");                                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_MEM_PRELOAD",             "MEM_PRELOAD");                                                                                                         // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_1BYTES",            "ALIGN_1BYTES");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_2BYTES",            "ALIGN_2BYTES");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_4BYTES",            "ALIGN_4BYTES");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_8BYTES",            "ALIGN_8BYTES");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_16BYTES",           "ALIGN_16BYTES");                                                                                                       // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_32BYTES",           "ALIGN_32BYTES");                                                                                                       // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_64BYTES",           "ALIGN_64BYTES");                                                                                                       // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_128BYTES",          "ALIGN_128BYTES");                                                                                                      // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_256BYTES",          "ALIGN_256BYTES");                                                                                                      // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_512BYTES",          "ALIGN_512BYTES");                                                                                                      // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_1024BYTES",         "ALIGN_1024BYTES");                                                                                                     // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_2048BYTES",         "ALIGN_2048BYTES");                                                                                                     // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_4096BYTES",         "ALIGN_4096BYTES");                                                                                                     // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_ALIGN_8192BYTES",         "ALIGN_8192BYTES");                                                                                                     // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_LNK_NRELOC_OVFL",         "LNK_NRELOC_OVFL");                                                                                                     // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_MEM_DISCARDABLE",         "MEM_DISCARDABLE");                                                                                                     // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_MEM_NOT_CACHED",          "MEM_NOT_CACHED");                                                                                                      // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_MEM_NOT_PAGED",           "MEM_NOT_PAGED");                                                                                                       // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_MEM_SHARED",              "MEM_SHARED");                                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_MEM_EXECUTE",             "MEM_EXECUTE");                                                                                                         // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_MEM_READ",                "MEM_READ");                                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SCN_MEM_WRITE",               "MEM_WRITE");                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00000001", "BIT_0");                                                                                                                              // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00000002", "BIT_1");                                                                                                                              // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00000004", "BIT_2");                                                                                                                              // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00000008", "BIT_3");                                                                                                                              // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00000010", "BIT_4");                                                                                                                              // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00000020", "BIT_5");                                                                                                                              // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00000040", "BIT_6");                                                                                                                              // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00000080", "BIT_7");                                                                                                                              // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00000100", "BIT_8");                                                                                                                              // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00000200", "BIT_9");                                                                                                                              // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00000400", "BIT_10");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00000800", "BIT_11");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00001000", "BIT_12");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00002000", "BIT_13");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00004000", "BIT_14");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00008000", "BIT_15");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00010000", "BIT_16");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00020000", "BIT_17");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00040000", "BIT_18");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x00080000", "BIT_19");                                                                                                                             // Colorize: green
        // peFieldValuesToNgosFieldValues.insert("0x00100000", "BIT_20"); // Removed align bit                                                                                                     // Colorize: green
        // peFieldValuesToNgosFieldValues.insert("0x00200000", "BIT_21");                                                                                                                          // Colorize: green
        // peFieldValuesToNgosFieldValues.insert("0x00400000", "BIT_22");                                                                                                                          // Colorize: green
        // peFieldValuesToNgosFieldValues.insert("0x00800000", "BIT_23");                                                                                                                          // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x01000000", "BIT_24");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x02000000", "BIT_25");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x04000000", "BIT_26");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x08000000", "BIT_27");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x10000000", "BIT_28");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x20000000", "BIT_29");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x40000000", "BIT_30");                                                                                                                             // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x80000000", "BIT_31");                                                                                                                             // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList characteristicsLines;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        characteristicsLines.append(QString("// Verified with PeSpecVerifier [BEGIN] // %1")                                                                                                                      // Colorize: green
                                            .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        characteristicsLines.append("typedef quint32 section_header_characteristics_flags;");                                                                                                            // Colorize: green
        characteristicsLines.append("");                                                                                                                                                                 // Colorize: green
        characteristicsLines.append("enum class SectionHeaderCharacteristicsFlag: section_header_characteristics_flags");                                                                                // Colorize: green
        characteristicsLines.append("{");                                                                                                                                                                // Colorize: green
        characteristicsLines.append("    NONE                   = 0,");                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fields.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString field = fields.at(i);                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                continue;                                                                                                                                                                                // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            field = peFieldNamesToNgosFieldNames.value(field, "");                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field name: %1")                                                                                                                          // Colorize: green
                                            .arg(fields.at(i))                                                                                                                                           // Colorize: green
                );                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString value = peFieldValuesToNgosFieldValues.value(values.at(i), values.at(i));                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            characteristicsLines.append(QString("    %1 = %2%3%4 // %5")                                                                                                                                                   // Colorize: green
                                                .arg(field, -22, QChar(' '))                                                                                                                             // Colorize: green
                                                .arg(value)                                                                                                                                              // Colorize: green
                                                .arg(i < fields.size() - 1 ? "," : " ")                                                                                                                  // Colorize: green
                                                .arg("", 10 - value.length(), QChar(' '))                                                                                                                // Colorize: green
                                                .arg(descriptions.at(i))                                                                                                                                 // Colorize: green
            );                                                                                                                                                               // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        characteristicsLines.append("};");                                                                                                                                                               // Colorize: green
        characteristicsLines.append("");                                                                                                                                                                 // Colorize: green
        characteristicsLines.append("DEFINE_FLAGS(SectionHeaderCharacteristicsFlags, section_header_characteristics_flags); // TEST: NO");                                                               // Colorize: green
        characteristicsLines.append(QString("// Verified with PeSpecVerifier [END] // %1")                                                                                                                      // Colorize: green
                                            .arg(PE_SPECIFICATION_URL)                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Insert some specific fields                                                                                                                                                                       // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        characteristicsLines.insert(14, "    NO_DEFER_SPEC_EXC      = BIT_14,     // Reset speculative exceptions handling bits in the TLB entries for this section");                                 // Colorize: green
        characteristicsLines.insert(19, "    ALIGN_BIT_0            = BIT_20,     // Align bit");                                                                                                      // Colorize: green
        characteristicsLines.insert(20, "    ALIGN_BIT_1            = BIT_21,     // Align bit");                                                                                                      // Colorize: green
        characteristicsLines.insert(21, "    ALIGN_BIT_2            = BIT_22,     // Align bit");                                                                                                      // Colorize: green
        characteristicsLines.insert(22, "    ALIGN_BIT_3            = BIT_23,     // Align bit");                                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(characteristicsLines, thread->getPath() + "/" + PE_SECTION_HEADER_CHARACTERISTICS_H))                                                                                          // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Section Header Characteristics with specification");                                                                                                        // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
PeSpecVerifier peSpecVerifierInstance;                                                                                                                                                                   // Colorize: green
