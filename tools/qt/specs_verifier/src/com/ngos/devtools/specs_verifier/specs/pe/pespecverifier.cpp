#include "pespecverifier.h"                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <QDebug>                                                                                                                                                                                        // Colorize: green
#include <QEventLoop>                                                                                                                                                                                    // Colorize: green
#include <QNetworkAccessManager>                                                                                                                                                                         // Colorize: green
#include <QNetworkReply>                                                                                                                                                                                 // Colorize: green
#include <QNetworkRequest>                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define PE_SPECIFICATION_URL "https://docs.microsoft.com/en-us/windows/win32/debug/pe-format" // Version 11/11/2021                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define PE_HEADER_H                              "tools/qt/image_builder/src/com/ngos/devtools/image_builder/pe/peheader.h"                                                                              // Colorize: green
#define PE_COFF_HEADER_H                         "tools/qt/image_builder/src/com/ngos/devtools/image_builder/pe/coffheader.h"                                                                            // Colorize: green
#define PE_COFF_HEADER_MACHINE_H                 "tools/qt/image_builder/src/com/ngos/devtools/image_builder/other/coffheadermachine.h"                                                                  // Colorize: green
#define PE_COFF_HEADER_CHARACTERISTICS_H         "tools/qt/image_builder/src/com/ngos/devtools/image_builder/other/coffheadercharacteristicsflags.h"                                                     // Colorize: green
#define PE_OPTIONAL_HEADER_H                     "tools/qt/image_builder/src/com/ngos/devtools/image_builder/pe/peoptionalheader.h"                                                                      // Colorize: green
#define PE_OPTIONAL_HEADER_SUBSYSTEM_H           "tools/qt/image_builder/src/com/ngos/devtools/image_builder/other/peoptionalheadersubsystem.h"                                                          // Colorize: green
#define PE_OPTIONAL_HEADER_DLL_CHARACTERISTICS_H "tools/qt/image_builder/src/com/ngos/devtools/image_builder/other/peoptionalheaderdllcharacteristicsflags.h"                                            // Colorize: green
#define PE_DATA_DIRECTORY_H                      "tools/qt/image_builder/src/com/ngos/devtools/image_builder/pe/datadirectory.h"                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
PeSpecVerifier::PeSpecVerifier()                                                                                                                                                                         // Colorize: green
    : SpecVerifier()                                                                                                                                                                                     // Colorize: green
    , mPeTypeToNgosTypeMap()                                                                                                                                                                             // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    mPeTypeToNgosTypeMap.insert("1", "quint8");                                                                                                                                                          // Colorize: green
    mPeTypeToNgosTypeMap.insert("2", "quint16");                                                                                                                                                         // Colorize: green
    mPeTypeToNgosTypeMap.insert("4", "quint32");                                                                                                                                                         // Colorize: green
    mPeTypeToNgosTypeMap.insert("8", "quint64");                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::verify(SpecVerifyThread *thread)                                                                                                                                                    // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread != nullptr);                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString specContent;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Download specification                                                                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QNetworkAccessManager  manager;                                                                                                                                                                  // Colorize: green
        QNetworkReply         *reply;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Send network request                                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QNetworkRequest request;                                                                                                                                                                     // Colorize: green
            request.setUrl(QUrl(PE_SPECIFICATION_URL));                                                                                                                                                  // Colorize: green
            reply = manager.get(request);                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Wait for finish                                                                                                                                                                               // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QEventLoop waitLoop;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QObject::connect(reply, SIGNAL(finished()),                                 &waitLoop, SLOT(quit()));                                                                                        // Colorize: green
            QObject::connect(reply, SIGNAL(errorOccurred(QNetworkReply::NetworkError)), &waitLoop, SLOT(quit()));                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            waitLoop.exec();                                                                                                                                                                             // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Check status code                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QVariant statusCode = reply->attribute(QNetworkRequest::HttpStatusCodeAttribute);                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (statusCode.toInt() != 200)                                                                                                                                                               // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to get PE specification from: %1").arg(PE_SPECIFICATION_URL));                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                delete reply;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        specContent = QString::fromUtf8(reply->readAll());                                                                                                                                               // Colorize: green
        delete reply;                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Replace some special characters                                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        specContent.replace('\t',          "    "); // Replace tabulation                                                                                                                                         // Colorize: green
        specContent.replace("&gt;",        ">");    // Replace >                                                                                                                                         // Colorize: green
        specContent.replace(QChar(0x00A0), ' ');    // Replace no-break space // https://www.compart.com/en/unicode/U+00A0                                                                           // Colorize: green
        specContent.remove('\r');                   // Remove \r                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    checkWithSpecification(thread, specContent);                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkWithSpecification(SpecVerifyThread *thread, const QString &specContent)                                                                                                        // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    qint64 errorsBefore = thread->getErrors().size();                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check code with specification                                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        checkPeSpecification(thread, specContent);                                                                                                                                                       // Colorize: green
        checkPeHeader(thread, specContent);                                                                                                                                                              // Colorize: green
        checkPeHeaderSignature(thread, specContent);                                                                                                                                                     // Colorize: green
        checkPeCoffHeader(thread, specContent);                                                                                                                                                          // Colorize: green
        checkPeCoffHeaderMachine(thread, specContent);                                                                                                                                                   // Colorize: green
        checkPeCoffHeaderCharacteristics(thread, specContent);                                                                                                                                           // Colorize: green
        checkPeOptionalHeader(thread, specContent);                                                                                                                                                      // Colorize: green
        checkPeOptionalHeaderSignature(thread, specContent);                                                                                                                                             // Colorize: green
        checkPeOptionalHeaderSubsystem(thread, specContent);                                                                                                                                             // Colorize: green
        checkPeOptionalHeaderDllCharacteristics(thread, specContent);                                                                                                                                    // Colorize: green
        checkPeDataDirectory(thread, specContent);                                                                                                                                                       // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (thread->getErrors().size() == errorsBefore)                                                                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addMessage("Code verified with PE specification");                                                                                                                                       // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
    else                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addMessage("Found error in code with PE specification");                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeSpecification(SpecVerifyThread *thread, const QString &specContent)                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString versionText;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init versionText                                                                                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        versionText =                                                                                                                                                                                    // Colorize: green
            "                                                    <li>\n"                                                                                                                                 // Colorize: green
            "Article                                                    </li>\n"                                                                                                                         // Colorize: green
            "                                                    <li>\n"                                                                                                                                 // Colorize: green
            "                                                        <time class=\"is-invisible\" data-article-date aria-label=\"Article review date\" datetime=\"2021-11-11T19:51:00Z\" data-article-date-source=\"git\">11/11/2021</time>\n" // Colorize: green
            "                                                    </li>";                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(versionText))                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("PE specification version didn't match with the stored one");                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeHeader(SpecVerifyThread *thread, const QString &specContent)                                                                                                                 // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString headerText;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init headerText                                                                                                                                                                              // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerText =                                                                                                                                                                                // Colorize: green
            "<h2 id=\"file-headers\">File Headers</h2>\n"                                                                                                                                                // Colorize: green
            "<ul>\n"                                                                                                                                                                                     // Colorize: green
            "<li><a href=\"#ms-dos-stub-image-only\" data-linktype=\"self-bookmark\">MS-DOS Stub (Image Only)</a></li>\n"                                                                                // Colorize: green
            "<li><a href=\"#signature-image-only\" data-linktype=\"self-bookmark\">Signature (Image Only)</a></li>\n"                                                                                    // Colorize: green
            "<li><a href=\"#coff-file-header-object-and-image\" data-linktype=\"self-bookmark\">COFF File Header (Object and Image)</a>\n"                                                               // Colorize: green
            "<ul>\n"                                                                                                                                                                                     // Colorize: green
            "<li><a href=\"#machine-types\" data-linktype=\"self-bookmark\">Machine Types</a></li>\n"                                                                                                    // Colorize: green
            "<li><a href=\"#characteristics\" data-linktype=\"self-bookmark\">Characteristics</a></li>\n"                                                                                                // Colorize: green
            "</ul>\n"                                                                                                                                                                                    // Colorize: green
            "</li>\n"                                                                                                                                                                                    // Colorize: green
            "<li><a href=\"#optional-header-image-only\" data-linktype=\"self-bookmark\">Optional Header (Image Only)</a>\n"                                                                             // Colorize: green
            "<ul>\n"                                                                                                                                                                                     // Colorize: green
            "<li><a href=\"#optional-header-standard-fields-image-only\" data-linktype=\"self-bookmark\">Optional Header Standard Fields (Image Only)</a></li>\n"                                        // Colorize: green
            "<li><a href=\"#optional-header-windows-specific-fields-image-only\" data-linktype=\"self-bookmark\">Optional Header Windows-Specific Fields (Image Only)</a></li>\n"                        // Colorize: green
            "<li><a href=\"#optional-header-data-directories-image-only\" data-linktype=\"self-bookmark\">Optional Header Data Directories (Image Only)</a></li>\n"                                      // Colorize: green
            "</ul>\n"                                                                                                                                                                                    // Colorize: green
            "</li>\n"                                                                                                                                                                                    // Colorize: green
            "</ul>\n"                                                                                                                                                                                    // Colorize: green
            "<p>The PE file header consists of a Microsoft MS-DOS stub, the PE signature, the COFF file header, and an optional header. A COFF object file header consists of a COFF file header and an optional header. In both cases, the file headers are followed immediately by section headers.</p>"; // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(headerText))                                                                                                                                                      // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to check PE Header with specification");                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList headerLines;                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.append("struct PEHeader");                                                                                                                                                         // Colorize: green
        headerLines.append("{");                                                                                                                                                                       // Colorize: green
        headerLines.append("    void print(); // TEST: NO");                                                                                                                                           // Colorize: green
        headerLines.append("    bool verify(); // TEST: NO");                                                                                                                                          // Colorize: green
        headerLines.append("");                                                                                                                                                                        // Colorize: green
        headerLines.append("    quint32            signature;");                                                                                                                                       // Colorize: green
        headerLines.append("    COFFHeader         coffHeader;");                                                                                                                                      // Colorize: green
        headerLines.append("    PeOptionalHeader   optionalHeader;");                                                                                                                                  // Colorize: green
        headerLines.append("    ImageSectionHeader sections[(quint64)Section::MAXIMUM];");                                                                                                             // Colorize: green
        headerLines.append("};");                                                                                                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(headerLines, thread->getPath() + "/" + PE_HEADER_H))                                                                                                                         // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Header with specification");                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeHeaderSignature(SpecVerifyThread *thread, const QString &specContent)                                                                                                        // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString signatureText;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init signatureText                                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        signatureText =                                                                                                                                                                                  // Colorize: green
            "<h3 id=\"signature-image-only\">Signature (Image Only)</h3>\n"                                                                                                                              // Colorize: green
            "<p>After the MS-DOS stub, at the file offset specified at offset 0x3c, is a 4-byte signature that identifies the file as a PE format image file. This signature is &quot;PE\0\0&quot; (the letters &quot;P&quot; and &quot;E&quot; followed by two null bytes).</p>"; // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(signatureText))                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to check PE Header signature with specification");                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList signatureLines;                                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        signatureLines.append("#define PE_HEADER_SIGNATURE 0x00004550 // PE\\0\\0");                                                                                                                     // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(signatureLines, thread->getPath() + "/" + PE_HEADER_H))                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Header signature with specification");                                                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeCoffHeader(SpecVerifyThread *thread, const QString &specContent)                                                                                                             // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString headerText;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init headerText                                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerText =                                                                                                                                                                                 // Colorize: green
            "<h3 id=\"coff-file-header-object-and-image\">COFF File Header (Object and Image)</h3>\n"                                                                                                    // Colorize: green
            "<p>At the beginning of an object file, or immediately after the signature of an image file, is a standard COFF file header in the following format. Note that the Windows loader limits the number of sections to 96.</p>\n" // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Offset</th>\n"                                                                                                                                                                          // Colorize: green
            "<th>Size</th>\n"                                                                                                                                                                            // Colorize: green
            "<th>Field</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Machine <br/></td>\n"                                                                                                                                                                   // Colorize: green
            "<td>The number that identifies the type of target machine. For more information, see <a href=\"#machine-types\" data-linktype=\"self-bookmark\">Machine Types</a>. <br/></td>\n"            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>NumberOfSections <br/></td>\n"                                                                                                                                                          // Colorize: green
            "<td>The number of sections. This indicates the size of the section table, which immediately follows the headers. <br/></td>\n"                                                              // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>TimeDateStamp <br/></td>\n"                                                                                                                                                             // Colorize: green
            "<td>The low 32 bits of the number of seconds since 00:00 January 1, 1970 (a C run-time time_t value), which indicates when the file was created. <br/></td>\n"                              // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>PointerToSymbolTable <br/></td>\n"                                                                                                                                                      // Colorize: green
            "<td>The file offset of the COFF symbol table, or zero if no COFF symbol table is present. This value should be zero for an image because COFF debugging information is deprecated. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>12 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>NumberOfSymbols <br/></td>\n"                                                                                                                                                           // Colorize: green
            "<td>The number of entries in the symbol table. This data can be used to locate the string table, which immediately follows the symbol table. This value should be zero for an image because COFF debugging information is deprecated. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>16 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SizeOfOptionalHeader <br/></td>\n"                                                                                                                                                      // Colorize: green
            "<td>The size of the optional header, which is required for executable files but not for object files. This value should be zero for an object file. For a description of the header format, see <a href=\"#optional-header-image-only\" data-linktype=\"self-bookmark\">Optional Header (Image Only)</a>. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>18 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Characteristics <br/></td>\n"                                                                                                                                                           // Colorize: green
            "<td>The flags that indicate the attributes of the file. For specific flag values, see <a href=\"#characteristics\" data-linktype=\"self-bookmark\">Characteristics</a>. <br/></td>\n"       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(headerText))                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to check PE COFF Header with specification");                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = headerText.split('\n');                                                                                                                                                      // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(2) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(3) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(4) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(5) != "<th>Offset</th>"                                                                                                                                                             // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(6) != "<th>Size</th>"                                                                                                                                                               // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(7) != "<th>Field</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(8) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(9) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(10) != "</thead>"                                                                                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(11) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(12) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE COFF Header specification");                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 13;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fieldTypes;                                                                                                                                                                              // Colorize: green
    QStringList fieldNames;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldTypes.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldNames.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 4;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList headerLines;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.append("struct COFFHeader");                                                                                                                                                     // Colorize: green
        headerLines.append("{");                                                                                                                                                                     // Colorize: green
        headerLines.append("    void print(); // TEST: NO");                                                                                                                                         // Colorize: green
        headerLines.append("    bool verify(); // TEST: NO");                                                                                                                                        // Colorize: green
        headerLines.append("");                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (i = 0; i < fieldTypes.size(); ++i)                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString type = mPeTypeToNgosTypeMap.value(fieldTypes.at(i), "");                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (type == "")                                                                                                                                                                              // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE type: %1").arg(fieldTypes.at(i)));                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString name = fieldNames.at(i);                                                                                                                                                             // Colorize: green
            name = name.at(0).toLower() + name.mid(1);                                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            headerLines.append(QString("    %1 %2;").arg(type, -30, QChar(' ')).arg(name));                                                                                                          // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        headerLines.append("};");                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Replace well known types for fields                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.replaceInStrings("    quint16                        machine;",         "    COFFHeaderMachine              machine;");                                                          // Colorize: green
        headerLines.replaceInStrings("    quint16                        characteristics;", "    COFFHeaderCharacteristicsFlags characteristics;");                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(headerLines, thread->getPath() + "/" + PE_COFF_HEADER_H))                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE COFF Header with specification");                                                                                                                           // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeCoffHeaderMachine(SpecVerifyThread *thread, const QString &specContent)                                                                                                      // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString machinesText;                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init machinesText                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        machinesText =                                                                                                                                                                                   // Colorize: green
            "<h4 id=\"machine-types\">Machine Types</h4>\n"                                                                                                                                              // Colorize: green
            "<p>The Machine field has one of the following values, which specify the CPU type. An image file can be run only on the specified machine or on a system that emulates the specified machine.</p>\n" // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Constant</th>\n"                                                                                                                                                                        // Colorize: green
            "<th>Value</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_UNKNOWN <br/></td>\n"                                                                                                                                                // Colorize: green
            "<td>0x0 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "<td>The content of this field is assumed to be applicable to any machine type <br/></td>\n"                                                                                                 // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_AM33 <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0x1d3 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Matsushita AM33 <br/></td>\n"                                                                                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_AMD64 <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x8664 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>x64 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_ARM <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0x1c0 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>ARM little endian <br/></td>\n"                                                                                                                                                         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_ARM64 <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0xaa64 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>ARM64 little endian <br/></td>\n"                                                                                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_ARMNT <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x1c4 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>ARM Thumb-2 little endian <br/></td>\n"                                                                                                                                                 // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_EBC <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0xebc <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>EFI byte code <br/></td>\n"                                                                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_I386 <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0x14c <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Intel 386 or later processors and compatible processors <br/></td>\n"                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_IA64 <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0x200 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Intel Itanium processor family <br/></td>\n"                                                                                                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_LOONGARCH32 <br/></td>\n"                                                                                                                                            // Colorize: green
            "<td>0x6232 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>LoongArch 32-bit processor family <br/></td>\n"                                                                                                                                         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_LOONGARCH64 <br/></td>\n"                                                                                                                                            // Colorize: green
            "<td>0x6264 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>LoongArch 64-bit processor family <br/></td>\n"                                                                                                                                         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_M32R <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0x9041 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Mitsubishi M32R little endian <br/></td>\n"                                                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_MIPS16 <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x266 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>MIPS16 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_MIPSFPU <br/></td>\n"                                                                                                                                                // Colorize: green
            "<td>0x366 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>MIPS with FPU <br/></td>\n"                                                                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_MIPSFPU16 <br/></td>\n"                                                                                                                                              // Colorize: green
            "<td>0x466 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>MIPS16 with FPU <br/></td>\n"                                                                                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_POWERPC <br/></td>\n"                                                                                                                                                // Colorize: green
            "<td>0x1f0 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Power PC little endian <br/></td>\n"                                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_POWERPCFP <br/></td>\n"                                                                                                                                              // Colorize: green
            "<td>0x1f1 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Power PC with floating point support <br/></td>\n"                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_R4000 <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x166 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>MIPS little endian <br/></td>\n"                                                                                                                                                        // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_RISCV32 <br/></td>\n"                                                                                                                                                // Colorize: green
            "<td>0x5032 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>RISC-V 32-bit address space <br/></td>\n"                                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_RISCV64 <br/></td>\n"                                                                                                                                                // Colorize: green
            "<td>0x5064 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>RISC-V 64-bit address space <br/></td>\n"                                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_RISCV128 <br/></td>\n"                                                                                                                                               // Colorize: green
            "<td>0x5128 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>RISC-V 128-bit address space <br/></td>\n"                                                                                                                                              // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_SH3 <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0x1a2 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Hitachi SH3 <br/></td>\n"                                                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_SH3DSP <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x1a3 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Hitachi SH3 DSP <br/></td>\n"                                                                                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_SH4 <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0x1a6 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Hitachi SH4 <br/></td>\n"                                                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_SH5 <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>0x1a8 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Hitachi SH5 <br/></td>\n"                                                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_THUMB <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x1c2 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Thumb <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_MACHINE_WCEMIPSV2 <br/></td>\n"                                                                                                                                              // Colorize: green
            "<td>0x169 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>MIPS little-endian WCE v2 <br/></td>\n"                                                                                                                                                 // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(machinesText))                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to check PE COFF Header Machines with specification");                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = machinesText.split('\n');                                                                                                                                                        // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(2) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(3) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(4) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(5) != "<th>Constant</th>"                                                                                                                                                           // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(6) != "<th>Value</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(7) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(8) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(9) != "</thead>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(10) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(11) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE COFF Header Machines specification");                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 12;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList values;                                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fields.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            values.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 4;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldNamesToNgosFieldNames; // PE field name => NGOS field name                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill peFieldNamesToNgosFieldNames                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_UNKNOWN",     "UNKNOWN");                                                                                                                // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_AM33",        "MATSUSHITA_AM33");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_AMD64",       "X64");                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_ARM",         "ARM");                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_ARM64",       "ARM64");                                                                                                                  // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_ARMNT",       "ARMV7");                                                                                                                  // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_EBC",         "UEFI_BYTE_CODE");                                                                                                         // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_I386",        "INTEL_386");                                                                                                              // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_IA64",        "INTEL_IA64");                                                                                                             // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_LOONGARCH32", "LOONG_ARCH32");                                                                                                           // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_LOONGARCH64", "LOONG_ARCH64");                                                                                                           // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_M32R",        "MITSUBISHI_M32R");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_MIPS16",      "MIPS16");                                                                                                                 // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_MIPSFPU",     "MIPS_WITH_FPU");                                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_MIPSFPU16",   "MIPS16_WITH_FPU");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_POWERPC",     "POWERPC");                                                                                                                // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_POWERPCFP",   "POWERPC_WITH_FLOATING_POINT_SUPPORT");                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_R4000",       "MIPS_R4000");                                                                                                             // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_RISCV32",     "RISC_V32");                                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_RISCV64",     "RISC_V64");                                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_RISCV128",    "RISC_V128");                                                                                                              // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_SH3",         "HITACHI_SH3");                                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_SH3DSP",      "HITACHI_SH3_DSP");                                                                                                        // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_SH4",         "HITACHI_SH4");                                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_SH5",         "HITACHI_SH5");                                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_THUMB",       "THUMB");                                                                                                                  // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_MACHINE_WCEMIPSV2",   "MIPS_WCE_V2");                                                                                                            // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList machinesLines;                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        machinesLines.append("enum class COFFHeaderMachine: quint16");                                                                                                                                   // Colorize: green
        machinesLines.append("{");                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fields.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString field = peFieldNamesToNgosFieldNames.value(fields.at(i), "");                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field name: %1").arg(fields.at(i)));                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString value = "0x" + QString("%1").arg(values.at(i).toUShort(nullptr, 16), 4, 16, QChar('0')).toUpper();                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (value == "0x0000")                                                                                                                                                                       // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                value = "0";                                                                                                                                                                             // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            machinesLines.append(QString("    %1 = %2,")                                                                                                                                                 // Colorize: green
                                        .arg(field, -35, QChar(' '))                                                                                                                                     // Colorize: green
                                        .arg(value));                                                                                                                                                    // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        machinesLines.append("};");                                                                                                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Insert some specific fields                                                                                                                                                                       // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        machinesLines.insert(29, "    MIPS_R3000                          = 0x0162,");                                                                                                                   // Colorize: green
        machinesLines.insert(30, "    MIPS_R10000                         = 0x0168,");                                                                                                                   // Colorize: green
        machinesLines.insert(31, "    OLD_ALPHA_AXP                       = 0x0183,");                                                                                                                   // Colorize: green
        machinesLines.insert(32, "    ALPHA_AXP                           = 0x0184,");                                                                                                                   // Colorize: green
        machinesLines.insert(33, "    ALPHA_AXP_64_BIT                    = 0x0284,");                                                                                                                   // Colorize: green
        machinesLines.insert(34, "    MOTOROLA_68000_SERIES               = 0x0268,");                                                                                                                   // Colorize: green
        machinesLines.insert(35, "    CLR_PURE_MSIL                       = 0xC0EE");                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(machinesLines, thread->getPath() + "/" + PE_COFF_HEADER_MACHINE_H))                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE COFF Header Machines with specification");                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeCoffHeaderCharacteristics(SpecVerifyThread *thread, const QString &specContent)                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString characteristicsText;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init characteristicsText                                                                                                                                                                          // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        characteristicsText =                                                                                                                                                                            // Colorize: green
            "<h4 id=\"characteristics\">Characteristics</h4>\n"                                                                                                                                          // Colorize: green
            "<p>The Characteristics field contains flags that indicate attributes of the object or image file. The following flags are currently defined:</p>\n"                                         // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Flag</th>\n"                                                                                                                                                                            // Colorize: green
            "<th>Value</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_RELOCS_STRIPPED <br/></td>\n"                                                                                                                                                // Colorize: green
            "<td>0x0001 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Image only, Windows CE, and Microsoft Windows NT and later. This indicates that the file does not contain base relocations and must therefore be loaded at its preferred base address. If the base address is not available, the loader reports an error. The default behavior of the linker is to strip base relocations from executable (EXE) files. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_EXECUTABLE_IMAGE <br/></td>\n"                                                                                                                                               // Colorize: green
            "<td>0x0002 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Image only. This indicates that the image file is valid and can be run. If this flag is not set, it indicates a linker error. <br/></td>\n"                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_LINE_NUMS_STRIPPED <br/></td>\n"                                                                                                                                             // Colorize: green
            "<td>0x0004 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>COFF line numbers have been removed. This flag is deprecated and should be zero. <br/></td>\n"                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_LOCAL_SYMS_STRIPPED <br/></td>\n"                                                                                                                                            // Colorize: green
            "<td>0x0008 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>COFF symbol table entries for local symbols have been removed. This flag is deprecated and should be zero. <br/></td>\n"                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_AGGRESSIVE_WS_TRIM <br/></td>\n"                                                                                                                                             // Colorize: green
            "<td>0x0010 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Obsolete. Aggressively trim working set. This flag is deprecated for Windows 2000 and later and must be zero. <br/></td>\n"                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_LARGE_ADDRESS_ AWARE <br/></td>\n"                                                                                                                                           // Colorize: green
            "<td>0x0020 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Application can handle > 2-GB addresses. <br/></td>\n"                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x0040 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>This flag is reserved for future use. <br/></td>\n"                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_BYTES_REVERSED_LO <br/></td>\n"                                                                                                                                              // Colorize: green
            "<td>0x0080 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Little endian: the least significant bit (LSB) precedes the most significant bit (MSB) in memory. This flag is deprecated and should be zero. <br/></td>\n"                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_32BIT_MACHINE <br/></td>\n"                                                                                                                                                  // Colorize: green
            "<td>0x0100 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Machine is based on a 32-bit-word architecture. <br/></td>\n"                                                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_DEBUG_STRIPPED <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x0200 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Debugging information is removed from the image file. <br/></td>\n"                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_REMOVABLE_RUN_ FROM_SWAP <br/></td>\n"                                                                                                                                       // Colorize: green
            "<td>0x0400 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>If the image is on removable media, fully load it and copy it to the swap file. <br/></td>\n"                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_NET_RUN_FROM_SWAP <br/></td>\n"                                                                                                                                              // Colorize: green
            "<td>0x0800 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>If the image is on network media, fully load it and copy it to the swap file. <br/></td>\n"                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_SYSTEM <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>0x1000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>The image file is a system file, not a user program. <br/></td>\n"                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_DLL <br/></td>\n"                                                                                                                                                            // Colorize: green
            "<td>0x2000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>The image file is a dynamic-link library (DLL). Such files are considered executable files for almost all purposes, although they cannot be directly run. <br/></td>\n"                 // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_UP_SYSTEM_ONLY <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>0x4000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>The file should be run only on a uniprocessor machine. <br/></td>\n"                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_FILE_BYTES_REVERSED_HI <br/></td>\n"                                                                                                                                              // Colorize: green
            "<td>0x8000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Big endian: the MSB precedes the LSB in memory. This flag is deprecated and should be zero. <br/></td>\n"                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(characteristicsText))                                                                                                                                                  // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to check PE COFF Header Characteristics with specification");                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = characteristicsText.split('\n');                                                                                                                                                 // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(2) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(3) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(4) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(5) != "<th>Flag</th>"                                                                                                                                                               // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(6) != "<th>Value</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(7) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(8) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(9) != "</thead>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(10) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(11) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE COFF Header Characteristics specification");                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 12;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList values;                                                                                                                                                                                  // Colorize: green
    QStringList descriptions;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fields.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            values.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            descriptions.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 3;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldNamesToNgosFieldNames;   // PE field name  => NGOS field name                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldValuesToNgosFieldValues; // PE field value => NGOS field value                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill peFieldNamesToNgosFieldNames                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_RELOCS_STRIPPED",          "RELOCS_STRIPPED");                                                                                                   // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_EXECUTABLE_IMAGE",         "EXECUTABLE_IMAGE");                                                                                                  // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_LINE_NUMS_STRIPPED",       "LINE_NUMS_STRIPPED");                                                                                                // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_LOCAL_SYMS_STRIPPED",      "LOCAL_SYMS_STRIPPED");                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_AGGRESSIVE_WS_TRIM",       "AGGRESSIVE_WS_TRIM");                                                                                                // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_LARGE_ADDRESS_ AWARE",     "LARGE_ADDRESS_AWARE");                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_BYTES_REVERSED_LO",        "BYTES_REVERSED_LO");                                                                                                 // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_32BIT_MACHINE",            "_32BIT_MACHINE");                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_DEBUG_STRIPPED",           "DEBUG_STRIPPED");                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_REMOVABLE_RUN_ FROM_SWAP", "REMOVABLE_RUN_FROM_SWAP");                                                                                           // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_NET_RUN_FROM_SWAP",        "NET_RUN_FROM_SWAP");                                                                                                 // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_SYSTEM",                   "SYSTEM");                                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_DLL",                      "DLL");                                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_UP_SYSTEM_ONLY",           "UP_SYSTEM_ONLY");                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_FILE_BYTES_REVERSED_HI",        "BYTES_REVERSED_HI");                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0001", "(1ULL << 0)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0002", "(1ULL << 1)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0004", "(1ULL << 2)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0008", "(1ULL << 3)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0010", "(1ULL << 4)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0020", "(1ULL << 5)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0040", "(1ULL << 6)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0080", "(1ULL << 7)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0100", "(1ULL << 8)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0200", "(1ULL << 9)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0400", "(1ULL << 10)");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0800", "(1ULL << 11)");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x1000", "(1ULL << 12)");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x2000", "(1ULL << 13)");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x4000", "(1ULL << 14)");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x8000", "(1ULL << 15)");                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList characteristicsLines;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        characteristicsLines.append("typedef quint16 coff_header_characteristics_flags;");                                                                                                               // Colorize: green
        characteristicsLines.append("");                                                                                                                                                                 // Colorize: green
        characteristicsLines.append("enum class COFFHeaderCharacteristicsFlag: coff_header_characteristics_flags");                                                                                      // Colorize: green
        characteristicsLines.append("{");                                                                                                                                                                // Colorize: green
        characteristicsLines.append("    NONE                    = 0,");                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fields.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString field = fields.at(i);                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                continue;                                                                                                                                                                                // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            field = peFieldNamesToNgosFieldNames.value(field, "");                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field name: %1").arg(fields.at(i)));                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString value = peFieldValuesToNgosFieldValues.value(values.at(i), "");                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (value == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field value: %1").arg(values.at(i)));                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString newLine = QString("    %1 = %2%3")                                                                                                                                                   // Colorize: green
                    .arg(field, -23, QChar(' '))                                                                                                                                                         // Colorize: green
                    .arg(value)                                                                                                                                                                          // Colorize: green
                    .arg(i < fields.size() - 1 ? "," : "");                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            characteristicsLines.append(QString("%1 // %2")                                                                                                                                              // Colorize: green
                                            .arg(newLine, -43, QChar(' '))                                                                                                                               // Colorize: green
                                            .arg(descriptions.at(i))                                                                                                                                     // Colorize: green
                                        );                                                                                                                                                               // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        characteristicsLines.append("};");                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(characteristicsLines, thread->getPath() + "/" + PE_COFF_HEADER_CHARACTERISTICS_H))                                                                                             // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE COFF Header Characteristics with specification");                                                                                                           // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeOptionalHeader(SpecVerifyThread *thread, const QString &specContent)                                                                                                         // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString headerText;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init headerText                                                                                                                                                                              // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerText =                                                                                                                                                                                     // Colorize: green
            "<h3 id=\"optional-header-image-only\">Optional Header (Image Only)</h3>\n"                                                                                                                  // Colorize: green
            "<p>Every image file has an optional header that provides information to the loader. This header is optional in the sense that some files (specifically, object files) do not have it. For image files, this header is required. An object file can have an optional header, but generally this header has no function in an object file except to increase its size.</p>\n" // Colorize: green
            "<p>Note that the size of the optional header is not fixed. The <strong>SizeOfOptionalHeader</strong> field in the COFF header must be used to validate that a probe into the file for a particular data directory does not go beyond <strong>SizeOfOptionalHeader</strong>. For more information, see <a href=\"#coff-file-header-object-and-image\" data-linktype=\"self-bookmark\">COFF File Header (Object and Image)</a>.</p>\n" // Colorize: green
            "<p>The <strong>NumberOfRvaAndSizes</strong> field of the optional header should also be used to ensure that no probe for a particular data directory entry goes beyond the optional header. In addition, it is important to validate the optional header magic number for format compatibility.</p>\n" // Colorize: green
            "<p>The optional header magic number determines whether an image is a PE32 or PE32+ executable.</p>\n"                                                                                       // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Magic number</th>\n"                                                                                                                                                                    // Colorize: green
            "<th>PE format</th>\n"                                                                                                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0x10b <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>PE32 <br/></td>\n"                                                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0x20b <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>PE32+ <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>\n"                                                                                                                                                                                 // Colorize: green
            "<p>PE32+ images allow for a 64-bit address space while limiting the image size to 2 gigabytes. Other PE32+ modifications are addressed in their respective sections.</p>\n"                // Colorize: green
            "<p>The optional header itself has three major parts.</p>\n"                                                                                                                                 // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Offset (PE32/PE32+)</th>\n"                                                                                                                                                             // Colorize: green
            "<th>Size (PE32/PE32+)</th>\n"                                                                                                                                                               // Colorize: green
            "<th>Header part</th>\n"                                                                                                                                                                     // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>28/24 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Standard fields <br/></td>\n"                                                                                                                                                           // Colorize: green
            "<td>Fields that are defined for all implementations of COFF, including UNIX. <br/></td>\n"                                                                                                  // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>28/24 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>68/88 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>Windows-specific fields <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>Additional fields to support specific features of Windows (for example, subsystems). <br/></td>\n"                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>96/112 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Variable <br/></td>\n"                                                                                                                                                                  // Colorize: green
            "<td>Data directories <br/></td>\n"                                                                                                                                                          // Colorize: green
            "<td>Address/size pairs for special tables that are found in the image file and are used by the operating system (for example, the import table and the export table). <br/></td>\n"         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>\n"                                                                                                                                                                                 // Colorize: green
            "<h4 id=\"optional-header-standard-fields-image-only\">Optional Header Standard Fields (Image Only)</h4>\n"                                                                                  // Colorize: green
            "<p>The first eight fields of the optional header are standard fields that are defined for every implementation of COFF. These fields contain general information that is useful for loading and running an executable file. They are unchanged for the PE32+ format.</p>\n" // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Offset</th>\n"                                                                                                                                                                          // Colorize: green
            "<th>Size</th>\n"                                                                                                                                                                            // Colorize: green
            "<th>Field</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Magic <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>The unsigned integer that identifies the state of the image file. The most common number is 0x10B, which identifies it as a normal executable file. 0x107 identifies it as a ROM image, and 0x20B identifies it as a PE32+ executable. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>1 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MajorLinkerVersion <br/></td>\n"                                                                                                                                                        // Colorize: green
            "<td>The linker major version number. <br/></td>\n"                                                                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>3 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>1 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MinorLinkerVersion <br/></td>\n"                                                                                                                                                        // Colorize: green
            "<td>The linker minor version number. <br/></td>\n"                                                                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SizeOfCode <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The size of the code (text) section, or the sum of all code sections if there are multiple sections. <br/></td>\n"                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SizeOfInitializedData <br/></td>\n"                                                                                                                                                     // Colorize: green
            "<td>The size of the initialized data section, or the sum of all such sections if there are multiple data sections. <br/></td>\n"                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>12 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SizeOfUninitializedData <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>The size of the uninitialized data section (BSS), or the sum of all such sections if there are multiple BSS sections. <br/></td>\n"                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>16 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>AddressOfEntryPoint <br/></td>\n"                                                                                                                                                       // Colorize: green
            "<td>The address of the entry point relative to the image base when the executable file is loaded into memory. For program images, this is the starting address. For device drivers, this is the address of the initialization function. An entry point is optional for DLLs. When no entry point is present, this field must be zero. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>20 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>BaseOfCode <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The address that is relative to the image base of the beginning-of-code section when it is loaded into memory. <br/></td>\n"                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>\n"                                                                                                                                                                                 // Colorize: green
            "<p>PE32 contains this additional field, which is absent in PE32+, following BaseOfCode.</p>\n"                                                                                              // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Offset</th>\n"                                                                                                                                                                          // Colorize: green
            "<th>Size</th>\n"                                                                                                                                                                            // Colorize: green
            "<th>Field</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>24 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>BaseOfData <br/></td>\n"                                                                                                                                                                // Colorize: green
            "<td>The address that is relative to the image base of the beginning-of-data section when it is loaded into memory. <br/></td>\n"                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>\n"                                                                                                                                                                                 // Colorize: green
            "<h4 id=\"optional-header-windows-specific-fields-image-only\">Optional Header Windows-Specific Fields (Image Only)</h4>\n"                                                                  // Colorize: green
            "<p>The next 21 fields are an extension to the COFF optional header format. They contain additional information that is required by the linker and loader in Windows.</p>\n"                 // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Offset (PE32/ PE32+)</th>\n"                                                                                                                                                            // Colorize: green
            "<th>Size (PE32/ PE32+)</th>\n"                                                                                                                                                              // Colorize: green
            "<th>Field</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>28/24 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4/8 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "<td>ImageBase <br/></td>\n"                                                                                                                                                                 // Colorize: green
            "<td>The preferred address of the first byte of image when loaded into memory; must be a multiple of 64 K. The default for DLLs is 0x10000000. The default for Windows CE EXEs is 0x00010000. The default for Windows NT, Windows 2000, Windows XP, Windows 95, Windows 98, and Windows Me is 0x00400000. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>32/32 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SectionAlignment <br/></td>\n"                                                                                                                                                          // Colorize: green
            "<td>The alignment (in bytes) of sections when they are loaded into memory. It must be greater than or equal to FileAlignment. The default is the page size for the architecture. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>36/36 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>FileAlignment <br/></td>\n"                                                                                                                                                             // Colorize: green
            "<td>The alignment factor (in bytes) that is used to align the raw data of sections in the image file. The value should be a power of 2 between 512 and 64 K, inclusive. The default is 512. If the SectionAlignment is less than the architecture's page size, then FileAlignment must match SectionAlignment. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>40/40 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MajorOperatingSystemVersion <br/></td>\n"                                                                                                                                               // Colorize: green
            "<td>The major version number of the required operating system. <br/></td>\n"                                                                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>42/42 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MinorOperatingSystemVersion <br/></td>\n"                                                                                                                                               // Colorize: green
            "<td>The minor version number of the required operating system. <br/></td>\n"                                                                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>44/44 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MajorImageVersion <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>The major version number of the image. <br/></td>\n"                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>46/46 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MinorImageVersion <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>The minor version number of the image. <br/></td>\n"                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>48/48 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MajorSubsystemVersion <br/></td>\n"                                                                                                                                                     // Colorize: green
            "<td>The major version number of the subsystem. <br/></td>\n"                                                                                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>50/50 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>MinorSubsystemVersion <br/></td>\n"                                                                                                                                                     // Colorize: green
            "<td>The minor version number of the subsystem. <br/></td>\n"                                                                                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>52/52 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Win32VersionValue <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>Reserved, must be zero. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>56/56 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SizeOfImage <br/></td>\n"                                                                                                                                                               // Colorize: green
            "<td>The size (in bytes) of the image, including all headers, as the image is loaded in memory. It must be a multiple of SectionAlignment. <br/></td>\n"                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>60/60 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>SizeOfHeaders <br/></td>\n"                                                                                                                                                             // Colorize: green
            "<td>The combined size of an MS-DOS stub, PE header, and section headers rounded up to a multiple of FileAlignment. <br/></td>\n"                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>64/64 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>CheckSum <br/></td>\n"                                                                                                                                                                  // Colorize: green
            "<td>The image file checksum. The algorithm for computing the checksum is incorporated into IMAGHELP.DLL. The following are checked for validation at load time: all drivers, any DLL loaded at boot time, and any DLL that is loaded into a critical Windows process. <br/></td>\n" // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>68/68 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Subsystem <br/></td>\n"                                                                                                                                                                 // Colorize: green
            "<td>The subsystem that is required to run this image. For more information, see <a href=\"#windows-subsystem\" data-linktype=\"self-bookmark\">Windows Subsystem</a>. <br/></td>\n"         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>70/70 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>DllCharacteristics <br/></td>\n"                                                                                                                                                        // Colorize: green
            "<td>For more information, see <a href=\"#dll-characteristics\" data-linktype=\"self-bookmark\">DLL Characteristics</a> later in this specification. <br/></td>\n"                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>72/72 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4/8 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "<td>SizeOfStackReserve <br/></td>\n"                                                                                                                                                        // Colorize: green
            "<td>The size of the stack to reserve. Only SizeOfStackCommit is committed; the rest is made available one page at a time until the reserve size is reached. <br/></td>\n"                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>76/80 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4/8 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "<td>SizeOfStackCommit <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>The size of the stack to commit. <br/></td>\n"                                                                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>80/88 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4/8 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "<td>SizeOfHeapReserve <br/></td>\n"                                                                                                                                                         // Colorize: green
            "<td>The size of the local heap space to reserve. Only SizeOfHeapCommit is committed; the rest is made available one page at a time until the reserve size is reached. <br/></td>\n"         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>84/96 <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>4/8 <br/></td>\n"                                                                                                                                                                       // Colorize: green
            "<td>SizeOfHeapCommit <br/></td>\n"                                                                                                                                                          // Colorize: green
            "<td>The size of the local heap space to commit. <br/></td>\n"                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>88/104 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>LoaderFlags <br/></td>\n"                                                                                                                                                               // Colorize: green
            "<td>Reserved, must be zero. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>92/108 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>4 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>NumberOfRvaAndSizes <br/></td>\n"                                                                                                                                                       // Colorize: green
            "<td>The number of data-directory entries in the remainder of the optional header. Each describes a location and size. <br/></td>\n"                                                         // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(headerText))                                                                                                                                                      // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to check PE Optional Header with specification");                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = headerText.split('\n');                                                                                                                                                      // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(57) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(58) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(59) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(60) != "<th>Offset</th>"                                                                                                                                                             // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(61) != "<th>Size</th>"                                                                                                                                                               // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(62) != "<th>Field</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(63) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(64) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(65) != "</thead>"                                                                                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(66) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(67) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE Optional Header specification");                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 68;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fieldTypes;                                                                                                                                                                              // Colorize: green
    QStringList fieldNames;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldTypes.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldNames.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 4;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(i + 21) != "<p>The next 21 fields are an extension to the COFF optional header format. They contain additional information that is required by the linker and loader in Windows.</p>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 22) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 23) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 24) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 25) != "<th>Offset (PE32/ PE32+)</th>"                                                                                                                                                             // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 26) != "<th>Size (PE32/ PE32+)</th>"                                                                                                                                                               // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 27) != "<th>Field</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 28) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 29) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 30) != "</thead>"                                                                                                                                                                   // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 31) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(i + 32) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE Optional Header specification");                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i += 33;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString type = lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed();                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldTypes.append(type.mid(type.indexOf('/') + 1));                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fieldNames.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 4;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList headerLines;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.append("struct PeOptionalHeader");                                                                                                                                                     // Colorize: green
        headerLines.append("{");                                                                                                                                                                     // Colorize: green
        headerLines.append("    void print(); // TEST: NO");                                                                                                                                         // Colorize: green
        headerLines.append("    bool verify(); // TEST: NO");                                                                                                                                        // Colorize: green
        headerLines.append("");                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (i = 0; i < fieldTypes.size(); ++i)                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString type = mPeTypeToNgosTypeMap.value(fieldTypes.at(i), "");                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (type == "")                                                                                                                                                                              // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE type: %1").arg(fieldTypes.at(i)));                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString name = fieldNames.at(i);                                                                                                                                                             // Colorize: green
            name = name.at(0).toLower() + name.mid(1);                                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            headerLines.append(QString("    %1 %2;").arg(type, -39, QChar(' ')).arg(name));                                                                                                          // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        headerLines.append("};");                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Replace well known types for fields                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.replaceInStrings("    quint16                                 subsystem;",          "    PeOptionalHeaderSubsystem               subsystem;");                                       // Colorize: green
        headerLines.replaceInStrings("    quint16                                 dllCharacteristics;", "    PeOptionalHeaderDllCharacteristicsFlags dllCharacteristics;");                              // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Insert some specific fields                                                                                                                                                                       // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        headerLines.insert(34, "    DataDirectory                           dataDirectories[NUMBER_OF_RVA_AND_SIZES];");                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(headerLines, thread->getPath() + "/" + PE_OPTIONAL_HEADER_H))                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Optional Header with specification");                                                                                                                       // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeOptionalHeaderSignature(SpecVerifyThread *thread, const QString &specContent)                                                                                                // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString signatureText;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init signatureText                                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        signatureText =                                                                                                                                                                                  // Colorize: green
            "<p>The optional header magic number determines whether an image is a PE32 or PE32+ executable.</p>\n"                                                                                       // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Magic number</th>\n"                                                                                                                                                                    // Colorize: green
            "<th>PE format</th>\n"                                                                                                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0x10b <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>PE32 <br/></td>\n"                                                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>0x20b <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "<td>PE32+ <br/></td>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(signatureText))                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to check PE Optional Header signature with specification");                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList signatureLines;                                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        signatureLines.append("#define PE32_OPTIONAL_HEADER_MAGIC 0x010B // 32 bit executable image");                                                                                               // Colorize: green
        signatureLines.append("#define PE64_OPTIONAL_HEADER_MAGIC 0x020B // 64 bit executable image");                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(signatureLines, thread->getPath() + "/" + PE_OPTIONAL_HEADER_H))                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Optional Header signature with specification");                                                                                                             // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeOptionalHeaderSubsystem(SpecVerifyThread *thread, const QString &specContent)                                                                                                // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString subsystemsText;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init subsystemsText                                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        subsystemsText =                                                                                                                                                                                 // Colorize: green
            "<h5 id=\"windows-subsystem\">Windows Subsystem</h5>\n"                                                                                                                                      // Colorize: green
            "<p>The following values defined for the Subsystem field of the optional header determine which Windows subsystem (if any) is required to run the image.</p>\n"                              // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Constant</th>\n"                                                                                                                                                                        // Colorize: green
            "<th>Value</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_UNKNOWN <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>0 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>An unknown subsystem <br/></td>\n"                                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_NATIVE <br/></td>\n"                                                                                                                                                    // Colorize: green
            "<td>1 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Device drivers and native Windows processes <br/></td>\n"                                                                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_WINDOWS_GUI <br/></td>\n"                                                                                                                                               // Colorize: green
            "<td>2 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>The Windows graphical user interface (GUI) subsystem <br/></td>\n"                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_WINDOWS_CUI <br/></td>\n"                                                                                                                                               // Colorize: green
            "<td>3 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>The Windows character subsystem <br/></td>\n"                                                                                                                                           // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_OS2_CUI <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>5 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>The OS/2 character subsystem <br/></td>\n"                                                                                                                                              // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_POSIX_CUI <br/></td>\n"                                                                                                                                                 // Colorize: green
            "<td>7 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>The Posix character subsystem <br/></td>\n"                                                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_NATIVE_WINDOWS <br/></td>\n"                                                                                                                                            // Colorize: green
            "<td>8 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Native Win9x driver <br/></td>\n"                                                                                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_WINDOWS_CE_GUI <br/></td>\n"                                                                                                                                            // Colorize: green
            "<td>9 <br/></td>\n"                                                                                                                                                                         // Colorize: green
            "<td>Windows CE <br/></td>\n"                                                                                                                                                                // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_EFI_APPLICATION <br/></td>\n"                                                                                                                                           // Colorize: green
            "<td>10 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>An Extensible Firmware Interface (EFI) application <br/></td>\n"                                                                                                                        // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_EFI_BOOT_ SERVICE_DRIVER <br/></td>\n"                                                                                                                                  // Colorize: green
            "<td>11 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>An EFI driver with boot services <br/></td>\n"                                                                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_EFI_RUNTIME_ DRIVER <br/></td>\n"                                                                                                                                       // Colorize: green
            "<td>12 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>An EFI driver with run-time services <br/></td>\n"                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_EFI_ROM <br/></td>\n"                                                                                                                                                   // Colorize: green
            "<td>13 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>An EFI ROM image <br/></td>\n"                                                                                                                                                          // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_XBOX <br/></td>\n"                                                                                                                                                      // Colorize: green
            "<td>14 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>XBOX <br/></td>\n"                                                                                                                                                                      // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_SUBSYSTEM_WINDOWS_BOOT_APPLICATION <br/></td>\n"                                                                                                                                  // Colorize: green
            "<td>16 <br/></td>\n"                                                                                                                                                                        // Colorize: green
            "<td>Windows boot application. <br/></td>\n"                                                                                                                                                 // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(subsystemsText))                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to check PE Optional Header Subsystems with specification");                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = subsystemsText.split('\n');                                                                                                                                                      // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(2) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(3) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(4) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(5) != "<th>Constant</th>"                                                                                                                                                           // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(6) != "<th>Value</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(7) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(8) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(9) != "</thead>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(10) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(11) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE Optional Header Subsystems specification");                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 12;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList values;                                                                                                                                                                                  // Colorize: green
    QStringList descriptions;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fields.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            values.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            descriptions.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 3;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldNamesToNgosFieldNames; // PE field name => NGOS field name                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill peFieldNamesToNgosFieldNames                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_UNKNOWN",                  "UNKNOWN");                                                                                                      // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_NATIVE",                   "NATIVE");                                                                                                       // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_WINDOWS_GUI",              "WINDOWS_GUI");                                                                                                  // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_WINDOWS_CUI",              "WINDOWS_CUI");                                                                                                  // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_OS2_CUI",                  "OS2_CUI");                                                                                                      // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_POSIX_CUI",                "POSIX_CUI");                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_NATIVE_WINDOWS",           "NATIVE_WINDOWS");                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_WINDOWS_CE_GUI",           "WINDOWS_CE_GUI");                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_EFI_APPLICATION",          "UEFI_APPLICATION");                                                                                             // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_EFI_BOOT_ SERVICE_DRIVER", "UEFI_BOOT_SERVICE_DRIVER");                                                                                     // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_EFI_RUNTIME_ DRIVER",      "UEFI_RUNTIME_DRIVER");                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_EFI_ROM",                  "UEFI_ROM");                                                                                                     // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_XBOX",                     "XBOX");                                                                                                         // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_SUBSYSTEM_WINDOWS_BOOT_APPLICATION", "WINDOWS_BOOT_APPLICATION");                                                                                     // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList subsystemsLines;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        subsystemsLines.append("enum class PeOptionalHeaderSubsystem: quint16");                                                                                                                         // Colorize: green
        subsystemsLines.append("{");                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fields.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString field = peFieldNamesToNgosFieldNames.value(fields.at(i), "");                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field name: %1").arg(fields.at(i)));                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString value = "0x" + QString("%1").arg(values.at(i).toUShort(nullptr), 4, 16, QChar('0')).toUpper();                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (value == "0x0000")                                                                                                                                                                       // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                value = "0";                                                                                                                                                                             // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString newLine = QString("    %1 = %2%3")                                                                                                                                                   // Colorize: green
                    .arg(field, -24, QChar(' '))                                                                                                                                                         // Colorize: green
                    .arg(value)                                                                                                                                                                          // Colorize: green
                    .arg(i < fields.size() - 1 ? "," : "");                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            subsystemsLines.append(QString("%1 // %2")                                                                                                                                              // Colorize: green
                                        .arg(newLine, -38, QChar(' '))                                                                                                                               // Colorize: green
                                        .arg(descriptions.at(i))                                                                                                                                     // Colorize: green
                                    );                                                                                                                                                               // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        subsystemsLines.append("};");                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(subsystemsLines, thread->getPath() + "/" + PE_OPTIONAL_HEADER_SUBSYSTEM_H))                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Optional Header Subsystems with specification");                                                                                                            // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeOptionalHeaderDllCharacteristics(SpecVerifyThread *thread, const QString &specContent)                                                                                       // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString characteristicsText;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init characteristicsText                                                                                                                                                                          // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        characteristicsText =                                                                                                                                                                            // Colorize: green
            "<h5 id=\"dll-characteristics\">DLL Characteristics</h5>\n"                                                                                                                                  // Colorize: green
            "<p>The following values are defined for the DllCharacteristics field of the optional header.</p>\n"                                                                                         // Colorize: green
            "<table>\n"                                                                                                                                                                                  // Colorize: green
            "<thead>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<th>Constant</th>\n"                                                                                                                                                                        // Colorize: green
            "<th>Value</th>\n"                                                                                                                                                                           // Colorize: green
            "<th>Description</th>\n"                                                                                                                                                                     // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</thead>\n"                                                                                                                                                                                 // Colorize: green
            "<tbody>\n"                                                                                                                                                                                  // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x0001 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Reserved, must be zero. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x0002 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Reserved, must be zero. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x0004 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Reserved, must be zero. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td></td>\n"                                                                                                                                                                                // Colorize: green
            "<td>0x0008 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Reserved, must be zero. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_HIGH_ENTROPY_VA <br/></td>\n"                                                                                                                                  // Colorize: green
            "<td>0x0020 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Image can handle a high entropy 64-bit virtual address space. <br/></td>\n"                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ <br/> DYNAMIC_BASE <br/></td>\n"                                                                                                                              // Colorize: green
            "<td>0x0040 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>DLL can be relocated at load time. <br/></td>\n"                                                                                                                                        // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ <br/> FORCE_INTEGRITY <br/></td>\n"                                                                                                                           // Colorize: green
            "<td>0x0080 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Code Integrity checks are enforced. <br/></td>\n"                                                                                                                                       // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ <br/> NX_COMPAT <br/></td>\n"                                                                                                                                 // Colorize: green
            "<td>0x0100 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Image is NX compatible. <br/></td>\n"                                                                                                                                                   // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ NO_ISOLATION <br/></td>\n"                                                                                                                                    // Colorize: green
            "<td>0x0200 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Isolation aware, but do not isolate the image. <br/></td>\n"                                                                                                                            // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ NO_SEH <br/></td>\n"                                                                                                                                          // Colorize: green
            "<td>0x0400 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Does not use structured exception (SE) handling. No SE handler may be called in this image. <br/></td>\n"                                                                               // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ NO_BIND <br/></td>\n"                                                                                                                                         // Colorize: green
            "<td>0x0800 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Do not bind the image. <br/></td>\n"                                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_APPCONTAINER <br/></td>\n"                                                                                                                                     // Colorize: green
            "<td>0x1000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Image must execute in an AppContainer. <br/></td>\n"                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ WDM_DRIVER <br/></td>\n"                                                                                                                                      // Colorize: green
            "<td>0x2000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>A WDM driver. <br/></td>\n"                                                                                                                                                             // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_GUARD_CF <br/></td>\n"                                                                                                                                         // Colorize: green
            "<td>0x4000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Image supports Control Flow Guard. <br/></td>\n"                                                                                                                                        // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "<tr>\n"                                                                                                                                                                                     // Colorize: green
            "<td>IMAGE_DLLCHARACTERISTICS_ TERMINAL_SERVER_AWARE <br/></td>\n"                                                                                                                           // Colorize: green
            "<td>0x8000 <br/></td>\n"                                                                                                                                                                    // Colorize: green
            "<td>Terminal Server aware. <br/></td>\n"                                                                                                                                                    // Colorize: green
            "</tr>\n"                                                                                                                                                                                    // Colorize: green
            "</tbody>\n"                                                                                                                                                                                 // Colorize: green
            "</table>";                                                                                                                                                                                  // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(characteristicsText))                                                                                                                                                  // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to check PE Optional Header DLL Characteristics with specification");                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList lines = characteristicsText.split('\n');                                                                                                                                                 // Colorize: green
    qint64      i     = 0;                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            lines.at(2) != "<table>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(3) != "<thead>"                                                                                                                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(4) != "<tr>"                                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(5) != "<th>Flag</th>"                                                                                                                                                               // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(6) != "<th>Value</th>"                                                                                                                                                              // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(7) != "<th>Description</th>"                                                                                                                                                        // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(8) != "</tr>"                                                                                                                                                                       // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(9) != "</thead>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(10) != "<tbody>"                                                                                                                                                                    // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            lines.at(11) != "<tr>"                                                                                                                                                                       // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to parse PE Optional Header DLL Characteristics specification");                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        i = 12;                                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList fields;                                                                                                                                                                                  // Colorize: green
    QStringList values;                                                                                                                                                                                  // Colorize: green
    QStringList descriptions;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get fields                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == "</table>")                                                                                                                                                                      // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            fields.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            values.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            descriptions.append(lines[i].remove("<td>").remove("</td>").remove("<br/>").trimmed());                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            i += 3;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldNamesToNgosFieldNames;   // PE field name  => NGOS field name                                                                                                         // Colorize: green
    QHash<QString, QString> peFieldValuesToNgosFieldValues; // PE field value => NGOS field value                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill peFieldNamesToNgosFieldNames                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_HIGH_ENTROPY_VA",        "HIGH_ENTROPY_VA");                                                                                       // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_  DYNAMIC_BASE",         "DYNAMIC_BASE");                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_  FORCE_INTEGRITY",      "FORCE_INTEGRITY");                                                                                       // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_  NX_COMPAT",            "NX_COMPAT");                                                                                             // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_ NO_ISOLATION",          "NO_ISOLATION");                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_ NO_SEH",                "NO_SEH");                                                                                                // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_ NO_BIND",               "NO_BIND");                                                                                               // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_APPCONTAINER",           "APPCONTAINER");                                                                                          // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_ WDM_DRIVER",            "WDM_DRIVER");                                                                                            // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_GUARD_CF",               "GUARD_CF");                                                                                              // Colorize: green
        peFieldNamesToNgosFieldNames.insert("IMAGE_DLLCHARACTERISTICS_ TERMINAL_SERVER_AWARE", "TERMINAL_SERVER_AWARE");                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0001", "(1ULL << 0)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0002", "(1ULL << 1)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0004", "(1ULL << 2)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0008", "(1ULL << 3)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0010", "(1ULL << 4)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0020", "(1ULL << 5)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0040", "(1ULL << 6)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0080", "(1ULL << 7)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0100", "(1ULL << 8)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0200", "(1ULL << 9)");                                                                                                                                  // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0400", "(1ULL << 10)");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x0800", "(1ULL << 11)");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x1000", "(1ULL << 12)");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x2000", "(1ULL << 13)");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x4000", "(1ULL << 14)");                                                                                                                                 // Colorize: green
        peFieldValuesToNgosFieldValues.insert("0x8000", "(1ULL << 15)");                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList characteristicsLines;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        characteristicsLines.append("typedef quint16 pe_optional_header_dll_characteristics_flags;");                                                                                                    // Colorize: green
        characteristicsLines.append("");                                                                                                                                                                 // Colorize: green
        characteristicsLines.append("enum class PeOptionalHeaderDllCharacteristicsFlag: pe_optional_header_dll_characteristics_flags");                                                                  // Colorize: green
        characteristicsLines.append("{");                                                                                                                                                                // Colorize: green
        characteristicsLines.append("    NONE                    = 0,");                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fields.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString field = fields.at(i);                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                continue;                                                                                                                                                                                // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            field = peFieldNamesToNgosFieldNames.value(field, "");                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (field == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field name: %1").arg(fields.at(i)));                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString value = peFieldValuesToNgosFieldValues.value(values.at(i), "");                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (value == "")                                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                thread->addError(QString("Failed to convert PE field value: %1").arg(values.at(i)));                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                return;                                                                                                                                                                                  // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            QString newLine = QString("    %1 = %2%3")                                                                                                                                                   // Colorize: green
                    .arg(field, -21, QChar(' '))                                                                                                                                                         // Colorize: green
                    .arg(value)                                                                                                                                                                          // Colorize: green
                    .arg(i < fields.size() - 1 ? "," : "");                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            characteristicsLines.append(QString("%1 // %2")                                                                                                                                              // Colorize: green
                                            .arg(newLine, -41, QChar(' '))                                                                                                                               // Colorize: green
                                            .arg(descriptions.at(i))                                                                                                                                     // Colorize: green
                                        );                                                                                                                                                               // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        characteristicsLines.append("};");                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(characteristicsLines, thread->getPath() + "/" + PE_OPTIONAL_HEADER_DLL_CHARACTERISTICS_H))                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Optional Header DLL Characteristics with specification");                                                                                                   // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void PeSpecVerifier::checkPeDataDirectory(SpecVerifyThread *thread, const QString &specContent)                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread      != nullptr);                                                                                                                                                                    // Colorize: green
    Q_ASSERT(specContent != "");                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString dataDirectoryText;                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Init dataDirectoryText                                                                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        dataDirectoryText =                                                                                                                                                                              // Colorize: green
            "<h4 id=\"optional-header-data-directories-image-only\">Optional Header Data Directories (Image Only)</h4>\n"                                                                                // Colorize: green
            "<p>Each data directory gives the address and size of a table or string that Windows uses. These data directory entries are all loaded into memory so that the system can use them at run time. A data directory is an 8-byte field that has the following declaration:</p>\n" // Colorize: green
            "<pre><code class=\"lang-cpp\">typedef struct _IMAGE_DATA_DIRECTORY {\n"                                                                                                                     // Colorize: green
            "    DWORD   VirtualAddress;\n"                                                                                                                                                              // Colorize: green
            "    DWORD   Size;\n"                                                                                                                                                                        // Colorize: green
            "} IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;\n"                                                                                                                                          // Colorize: green
            "</code></pre>\n"                                                                                                                                                                            // Colorize: green
            "<p>The first field, VirtualAddress, is actually the RVA of the table. The RVA is the address of the table relative to the base address of the image when the table is loaded. The second field gives the size in bytes. The data directories, which form the last part of the optional header, are listed in the following table.</p>\n" // Colorize: green
            "<p>Note that the number of directories is not fixed. Before looking for a specific directory, check the NumberOfRvaAndSizes field in the optional header.</p>\n"                            // Colorize: green
            "<p>Also, do not assume that the RVAs in this table point to the beginning of a section or that the sections that contain specific tables have specific names.</p>";                         // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check that specification contains required text                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!specContent.contains(dataDirectoryText))                                                                                                                                                    // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            thread->addError("Failed to check PE Data Directory with specification");                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QStringList dataDirectoryLines;                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare lines for comparison with source code                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        dataDirectoryLines.append("struct DataDirectory");                                                                                                                                               // Colorize: green
        dataDirectoryLines.append("{");                                                                                                                                                                  // Colorize: green
        dataDirectoryLines.append("    void print(); // TEST: NO");                                                                                                                                      // Colorize: green
        dataDirectoryLines.append("    bool verify(); // TEST: NO");                                                                                                                                     // Colorize: green
        dataDirectoryLines.append("");                                                                                                                                                                   // Colorize: green
        dataDirectoryLines.append("    quint32 virtualAddress;");                                                                                                                                        // Colorize: green
        dataDirectoryLines.append("    quint32 size;");                                                                                                                                                  // Colorize: green
        dataDirectoryLines.append("};");                                                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (!checkLinesInFile(dataDirectoryLines, thread->getPath() + "/" + PE_DATA_DIRECTORY_H))                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        thread->addError("Failed to check PE Data Directory with specification");                                                                                                                        // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
PeSpecVerifier peSpecVerifierInstance;                                                                                                                                                                   // Colorize: green
