#include "specverifier.h"                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <QFile>                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
QList<SpecVerifier *> SpecVerifier::sSpecVerifiers;                                                                                                                                                      // Colorize: green
QMutex                SpecVerifier::sSpecVerifiersMutex;                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
SpecVerifier::SpecVerifier()                                                                                                                                                                             // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    sSpecVerifiers.append(this);                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
SpecVerifier* SpecVerifier::getSpecVerifier()                                                                                                                                                            // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    SpecVerifier *res = nullptr;                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QMutexLocker lock(&sSpecVerifiersMutex);                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (!sSpecVerifiers.isEmpty())                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            res = sSpecVerifiers.takeFirst();                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return res;                                                                                                                                                                                          // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void SpecVerifier::verify(SpecVerifyThread *thread)                                                                                                                                                      // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(thread != nullptr);                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
QStringList SpecVerifier::readLinesFromFile(const QString &path)                                                                                                                                         // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    QStringList res;                                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Read file lines                                                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QFile file(path);                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (!file.open(QIODevice::ReadOnly))                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            return res;                                                                                                                                                                                  // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        res = QString::fromUtf8(file.readAll()).split('\n');                                                                                                                                             // Colorize: green
        file.close();                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return res;                                                                                                                                                                                          // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool SpecVerifier::checkLinesInFile(const QStringList &lines, const QString &path)                                                                                                                       // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    return checkLinesInFileLines(lines, readLinesFromFile(path));                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool SpecVerifier::checkLinesInFileLines(const QStringList &lines, const QStringList &fileLines)                                                                                                         // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Q_ASSERT(!lines.isEmpty());                                                                                                                                                                          // Colorize: green
    Q_ASSERT(!fileLines.isEmpty());                                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check lines                                                                                                                                                                                       // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString firstLine = lines.constFirst();                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < fileLines.size(); ++i)                                                                                                                                                    // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = fileLines.at(i);                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line.startsWith(firstLine))                                                                                                                                                              // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                line = line.mid(firstLine.length()).trimmed();                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                if (                                                                                                                                                                                     // Colorize: green
                    line == ""                                                                                                                                                                           // Colorize: green
                    ||                                                                                                                                                                                   // Colorize: green
                    line.startsWith("//")                                                                                                                                                                // Colorize: green
                    ||                                                                                                                                                                                   // Colorize: green
                    line.startsWith("/*")                                                                                                                                                                // Colorize: green
                   )                                                                                                                                                                                     // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    bool good = true;                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    for (qint64 j = 1; j < lines.size(); ++j)                                                                                                                                            // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        if (i + j >= fileLines.size())                                                                                                                                                   // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            return false;                                                                                                                                                                // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        line = fileLines.at(i + j);                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        if (line.startsWith(lines.at(j)))                                                                                                                                                // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            line = line.mid(lines.at(j).length()).trimmed();                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            if (                                                                                                                                                                         // Colorize: green
                                line != ""                                                                                                                                                               // Colorize: green
                                &&                                                                                                                                                                       // Colorize: green
                                !line.startsWith("//")                                                                                                                                                   // Colorize: green
                                &&                                                                                                                                                                       // Colorize: green
                                !line.startsWith("/*")                                                                                                                                                   // Colorize: green
                               )                                                                                                                                                                         // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                good = false;                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                break;                                                                                                                                                                   // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                        else                                                                                                                                                                             // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            good = false;                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            break;                                                                                                                                                                       // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    if (good)                                                                                                                                                                            // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        return true;                                                                                                                                                                     // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return false;                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
