#include "sectionheader.h"                                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <com/ngos/devtools/shared/console/console.h>                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void SectionHeader::print()                                                                                                                                                                         // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    Console::out("Section Header:");                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    Console::out(QString("    name:                 %1").arg(name));                                                                                                                                     // Colorize: green
    Console::out(QString("    virtualSize:          0x%1").arg(virtualSize,          8, 16, QChar('0')));                                                                                                // Colorize: green
    Console::out(QString("    virtualAddress:       0x%1").arg(virtualAddress,       8, 16, QChar('0')));                                                                                                // Colorize: green
    Console::out(QString("    sizeOfRawData:        0x%1").arg(sizeOfRawData,        8, 16, QChar('0')));                                                                                                // Colorize: green
    Console::out(QString("    pointerToRawData:     0x%1").arg(pointerToRawData,     8, 16, QChar('0')));                                                                                                // Colorize: green
    Console::out(QString("    pointerToRelocations: 0x%1").arg(pointerToRelocations, 8, 16, QChar('0')));                                                                                                // Colorize: green
    Console::out(QString("    pointerToLinenumbers: 0x%1").arg(pointerToLinenumbers, 8, 16, QChar('0')));                                                                                                // Colorize: green
    Console::out(QString("    numberOfRelocations:  0x%1").arg(numberOfRelocations,  4, 16, QChar('0')));                                                                                                // Colorize: green
    Console::out(QString("    numberOfLineNumbers:  0x%1").arg(numberOfLineNumbers,  4, 16, QChar('0')));                                                                                                // Colorize: green
    Console::out(QString("    characteristics:      %1").arg(flagsToFullString(characteristics)));                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    Console::out("");                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool SectionHeader::verify()                                                                                                                                                                        // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    if (QString(name) == ".reloc")                                                                                                                                                                       // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        return verifySection(FLAGS(                                                                                                                                                                      // Colorize: green
                                SectionHeaderCharacteristicsFlag::MEM_READ                                                                                                                          // Colorize: green
                                , SectionHeaderCharacteristicsFlag::MEM_DISCARDABLE                                                                                                                 // Colorize: green
                                , SectionHeaderCharacteristicsFlag::ALIGN_1BYTES                                                                                                                    // Colorize: green
                                , SectionHeaderCharacteristicsFlag::CNT_INITIALIZED_DATA                                                                                                            // Colorize: green
                            ));                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (QString(name) == ".config")                                                                                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        return verifySection(FLAGS(                                                                                                                                                                      // Colorize: green
                                SectionHeaderCharacteristicsFlag::MEM_READ                                                                                                                          // Colorize: green
                                , SectionHeaderCharacteristicsFlag::MEM_EXECUTE                                                                                                                     // Colorize: green
                                , SectionHeaderCharacteristicsFlag::ALIGN_16BYTES                                                                                                                   // Colorize: green
                                , SectionHeaderCharacteristicsFlag::CNT_CODE                                                                                                                        // Colorize: green
                            ));                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (QString(name) == ".kernel")                                                                                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        return verifySection(FLAGS(                                                                                                                                                                      // Colorize: green
                                SectionHeaderCharacteristicsFlag::MEM_READ                                                                                                                          // Colorize: green
                                , SectionHeaderCharacteristicsFlag::MEM_EXECUTE                                                                                                                     // Colorize: green
                                , SectionHeaderCharacteristicsFlag::ALIGN_1BYTES                                                                                                                    // Colorize: green
                                , SectionHeaderCharacteristicsFlag::CNT_CODE                                                                                                                        // Colorize: green
                            ));                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (QString(name) == ".text")                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        return verifySection(FLAGS(                                                                                                                                                                      // Colorize: green
                                SectionHeaderCharacteristicsFlag::MEM_READ                                                                                                                          // Colorize: green
                                , SectionHeaderCharacteristicsFlag::MEM_EXECUTE                                                                                                                     // Colorize: green
                                , SectionHeaderCharacteristicsFlag::ALIGN_16BYTES                                                                                                                   // Colorize: green
                                , SectionHeaderCharacteristicsFlag::CNT_CODE                                                                                                                        // Colorize: green
                            ));                                                                                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    Console::err(QString("Wrong Section Header name: %1").arg(name));                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return false;                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool SectionHeader::verifySection(SectionHeaderCharacteristicsFlags expectedCharacteristics)                                                                                                   // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // Check virtualSize                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (virtualSize <= 0)                                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            Console::err(QString("Wrong Section Header %1 virtualSize: 0x%2").arg(name).arg(virtualSize, 8, 16, QChar('0')));                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check virtualAddress                                                                                                                                                                              // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (virtualAddress <= 0)                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            Console::err(QString("Wrong Section Header %1 virtualAddress: 0x%2").arg(name).arg(virtualAddress, 8, 16, QChar('0')));                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check sizeOfRawData                                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (sizeOfRawData <= 0)                                                                                                                                                                          // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            Console::err(QString("Wrong Section Header %1 sizeOfRawData: 0x%2").arg(name).arg(sizeOfRawData, 8, 16, QChar('0')));                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check pointerToRawData                                                                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (pointerToRawData <= 0)                                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            Console::err(QString("Wrong Section Header %1 pointerToRawData: 0x%2").arg(name).arg(pointerToRawData, 8, 16, QChar('0')));                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check pointerToRelocations                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (pointerToRelocations != 0)                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            Console::err(QString("Wrong Section Header %1 pointerToRelocations: 0x%2").arg(name).arg(pointerToRelocations, 8, 16, QChar('0')));                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check pointerToLinenumbers                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (pointerToLinenumbers != 0)                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            Console::err(QString("Wrong Section Header %1 pointerToLinenumbers: 0x%2").arg(name).arg(pointerToLinenumbers, 8, 16, QChar('0')));                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check numberOfRelocations                                                                                                                                                                         // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (numberOfRelocations != 0)                                                                                                                                                                    // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            Console::err(QString("Wrong Section Header %1 numberOfRelocations: 0x%2").arg(name).arg(numberOfRelocations, 4, 16, QChar('0')));                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check numberOfLineNumbers                                                                                                                                                                         // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (numberOfLineNumbers != 0)                                                                                                                                                                    // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            Console::err(QString("Wrong Section Header %1 numberOfLineNumbers: 0x%2").arg(name).arg(numberOfLineNumbers, 4, 16, QChar('0')));                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check characteristics                                                                                                                                                                             // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (characteristics != expectedCharacteristics)                                                                                                                                                  // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            Console::err(QString("Wrong Section Header %1 characteristics: %2").arg(name).arg(flagsToFullString(characteristics)));                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return true;                                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
