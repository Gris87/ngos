#include "testworkerthread.h"                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <QFile>                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
qint64             TestWorkerThread::sAmountOfFiles = 0;                                                                                                                                                 // Colorize: green
QStringList        TestWorkerThread::sFiles;                                                                                                                                                             // Colorize: green
QMutex             TestWorkerThread::sFilesMutex;                                                                                                                                                        // Colorize: green
QSemaphore         TestWorkerThread::sFilesSemaphore;                                                                                                                                                    // Colorize: green
QRegularExpression TestWorkerThread::sDefineRegexp("^#define +(\\w+)\\(([^)]*)\\) +(.+)$");                                                     // #define MAX(a, b) a > b ? a : b                       // Colorize: green
QRegularExpression TestWorkerThread::sFunctionRegexp("^(?:(?:static|const|inline) +)*(?:\\w[\\w<,>*& ]* )?(~?\\w+|operator.+)\\([^)]*\\).*$");  // [static ][const ][inline ] quint8 function(*)         // Colorize: green
QRegularExpression TestWorkerThread::sDefinitionRegExp("^(?:struct|class|union|enum(?: class)?) +(\\w+).*$");                                   // struct A | class B | union C | enum [class ] D        // Colorize: green
QRegularExpression TestWorkerThread::sBitsDefinitionRegExp("^ *\\w+ +\\w+ *: *\\d+;.*$");                                                       // quint8 bitEntry: 4;                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
TestWorkerThread::TestWorkerThread()                                                                                                                                                                     // Colorize: green
    : QThread()                                                                                                                                                                                          // Colorize: green
    , mTestStructureEntries()                                                                                                                                                                            // Colorize: green
    , mTestEntries()                                                                                                                                                                                     // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // Nothing                                                                                                                                                                                           // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
qint64 TestWorkerThread::getAmountOfFiles()                                                                                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    return sAmountOfFiles - 1;                                                                                                                                                                           // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void TestWorkerThread::pushFile(const QString &path)                                                                                                                                                     // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    QMutexLocker lock(&sFilesMutex);                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    ++sAmountOfFiles;                                                                                                                                                                                    // Colorize: green
    sFiles.append(path);                                                                                                                                                                                 // Colorize: green
    sFilesSemaphore.release();                                                                                                                                                                           // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
QString TestWorkerThread::popFile()                                                                                                                                                                      // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    sFilesSemaphore.acquire();                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QMutexLocker lock(&sFilesMutex);                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        QString res = sFiles.constFirst();                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (res == "")                                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            sFilesSemaphore.release();                                                                                                                                                                   // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
        else                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            sFiles.removeFirst();                                                                                                                                                                        // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        return res;                                                                                                                                                                                      // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void TestWorkerThread::noMoreFiles()                                                                                                                                                                     // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    pushFile("");                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
const QList<TestStructureEntry>& TestWorkerThread::getTestStructureEntries() const                                                                                                                       // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    return mTestStructureEntries;                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
const QList<TestEntry>& TestWorkerThread::getTestEntries() const                                                                                                                                         // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    return mTestEntries;                                                                                                                                                                                 // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void TestWorkerThread::run()                                                                                                                                                                             // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    do                                                                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString path = popFile();                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (path == "")                                                                                                                                                                                  // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            break;                                                                                                                                                                                       // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        processFile(path);                                                                                                                                                                               // Colorize: green
    } while(true);                                                                                                                                                                                       // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void TestWorkerThread::processFile(const QString &path)                                                                                                                                                  // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    QString content;                                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Read file content                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QFile file(path);                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (!file.open(QIODevice::ReadOnly))                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            return;                                                                                                                                                                                      // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        content = QString::fromUtf8(file.readAll());                                                                                                                                                     // Colorize: green
        file.close();                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Split content to lines and process them                                                                                                                                                           // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QStringList lines = content.split('\n');                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < lines.size(); ++i)                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            lines[i] = lines.at(i).trimmed();                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        processLines(path, lines);                                                                                                                                                                       // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void TestWorkerThread::processLines(const QString &path, const QStringList &lines)                                                                                                                       // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    QString testModule               = path.mid(path.lastIndexOf('/') + 1);                                                                                                                                            // Colorize: green
    bool    ignoreStructureDefintion = path.contains("/tools/qt/");                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Process lines                                                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        for (qint64 i = 0; i < lines.size(); ++i)                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            // Try to parse line as function                                                                                                                                                             // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                if (line == '{')                                                                                                                                                                         // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    if (i > 0)                                                                                                                                                                           // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        QString prevLine1 = lines.at(i - 1);                                                                                                                                             // Colorize: green
                        QString prevLine2 = (i >= 2) ? lines.at(i - 2) : "";                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        if (                                                                                                                                                                             // Colorize: green
                            !prevLine1.startsWith("#define ")                                                                                                                                            // Colorize: green
                            &&                                                                                                                                                                           // Colorize: green
                            !prevLine1.endsWith('\\')                                                                                                                                                    // Colorize: green
                            &&                                                                                                                                                                           // Colorize: green
                            !prevLine1.startsWith("namespace")                                                                                                                                           // Colorize: green
                            &&                                                                                                                                                                           // Colorize: green
                            !prevLine1.startsWith("struct")                                                                                                                                              // Colorize: green
                            &&                                                                                                                                                                           // Colorize: green
                            !prevLine1.startsWith("class")                                                                                                                                               // Colorize: green
                            &&                                                                                                                                                                           // Colorize: green
                            !prevLine1.startsWith("union")                                                                                                                                               // Colorize: green
                            &&                                                                                                                                                                           // Colorize: green
                            !prevLine1.startsWith("enum")                                                                                                                                                // Colorize: green
                           )                                                                                                                                                                             // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            qint64 lineNum = i - 1;                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            // Skip lines in order to find end of function                                                                                                                               // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                qint64 level = 1;                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                do                                                                                                                                                                       // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    ++i;                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    if (i >= lines.size())                                                                                                                                               // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        break;                                                                                                                                                           // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    QString anotherLine = lines.at(i);                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    if (anotherLine == '{')                                                                                                                                              // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        ++level;                                                                                                                                                         // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                    else                                                                                                                                                                 // Colorize: green
                                    if (anotherLine == '}')                                                                                                                                              // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        --level;                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        if (level <= 0)                                                                                                                                                  // Colorize: green
                                        {                                                                                                                                                                // Colorize: green
                                            break;                                                                                                                                                       // Colorize: green
                                        }                                                                                                                                                                // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                } while(true);                                                                                                                                                           // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            // Check that we have a valid function declaration                                                                                                                           // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                QRegularExpressionMatch match = sFunctionRegexp.match(prevLine1);                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                if (match.hasMatch())                                                                                                                                                    // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    QString name = match.captured(1);                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    addTestEntry(TestEntryType::INTERNAL_FUNCTION, path, lineNum, name, testModule, prevLine1, prevLine2);                                                               // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    continue;                                                                                                                                                                            // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            // Try to parse line as definition                                                                                                                                                           // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                if (line.startsWith("#define "))                                                                                                                                                         // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    QRegularExpressionMatch match = sDefineRegexp.match(line);                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    if (match.hasMatch())                                                                                                                                                                // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        QString prevLine = (i >= 1) ? lines.at(i - 1) : "";                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        QString name       = match.captured(1);                                                                                                                                          // Colorize: green
                        QString parameters = match.captured(2);                                                                                                                                          // Colorize: green
                        QString value      = match.captured(3);                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        qint64 lineNum = i;                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Skip multi-line definition                                                                                                                                                    // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            if (line.endsWith('\\'))                                                                                                                                                     // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                do                                                                                                                                                                       // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    ++i;                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    if (i >= lines.size())                                                                                                                                               // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        break;                                                                                                                                                           // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    QString anotherLine = lines.at(i);                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    value += '\n';                                                                                                                                                       // Colorize: green
                                    value += anotherLine;                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    if (!anotherLine.endsWith('\\'))                                                                                                                                     // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        break;                                                                                                                                                           // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                } while(true);                                                                                                                                                           // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Check that we have a valid definition                                                                                                                                         // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            if (                                                                                                                                                                         // Colorize: green
                                parameters != "..."                                                                                                                                                      // Colorize: green
                                &&                                                                                                                                                                       // Colorize: green
                                !value.contains(';')                                                                                                                                                     // Colorize: green
                                &&                                                                                                                                                                       // Colorize: green
                                !value.contains('{')                                                                                                                                                     // Colorize: green
                                &&                                                                                                                                                                       // Colorize: green
                                !value.contains('}')                                                                                                                                                     // Colorize: green
                                &&                                                                                                                                                                       // Colorize: green
                                value.contains('(')                                                                                                                                                      // Colorize: green
                                &&                                                                                                                                                                       // Colorize: green
                                value.contains(')')                                                                                                                                                      // Colorize: green
                               )                                                                                                                                                                         // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                addTestEntry(TestEntryType::DEFINE, path, lineNum, name, testModule, line, prevLine);                                                                                    // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                    else                                                                                                                                                                                 // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        // Skip multi-line definition                                                                                                                                                    // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            if (line.endsWith('\\'))                                                                                                                                                     // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                do                                                                                                                                                                       // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    ++i;                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    if (i >= lines.size())                                                                                                                                               // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        break;                                                                                                                                                           // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    QString anotherLine = lines.at(i);                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    if (!anotherLine.endsWith('\\'))                                                                                                                                     // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        break;                                                                                                                                                           // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                } while(true);                                                                                                                                                           // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    continue;                                                                                                                                                                            // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            // Try to parse line as function declaration                                                                                                                                                 // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                if (line.contains(';'))                                                                                                                                                                  // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    // Check that we have a valid function declaration                                                                                                                                   // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        QRegularExpressionMatch match = sFunctionRegexp.match(line);                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        if (match.hasMatch())                                                                                                                                                            // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            QString prevLine = (i >= 1) ? lines.at(i - 1) : "";                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            QString name = match.captured(1);                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            addTestEntry(TestEntryType::FUNCTION, path, i, name, testModule, line, prevLine);                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    continue;                                                                                                                                                                            // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            // Try to parse line as structure definition                                                                                                                                                 // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                if (!ignoreStructureDefintion)                                                                                                                                                           // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    QRegularExpressionMatch match = sDefinitionRegExp.match(line);                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    if (match.hasMatch())                                                                                                                                                                // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        QString name = match.captured(1);                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        bool bitsDefined = false;                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Iterate over structure declaration in order to find bit definition                                                                                                            // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            qint64 level = 0;                                                                                                                                                            // Colorize: green
                            qint64 j     = i;                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            do                                                                                                                                                                           // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                QString anotherLine;                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                // Iterate lines                                                                                                                                                         // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    ++j;                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    if (j >= lines.size())                                                                                                                                               // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        break;                                                                                                                                                           // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    anotherLine = lines.at(j);                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    if (anotherLine == '{')                                                                                                                                              // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        ++level;                                                                                                                                                         // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                    else                                                                                                                                                                 // Colorize: green
                                    if (                                                                                                                                                                 // Colorize: green
                                        anotherLine == '}'                                                                                                                                               // Colorize: green
                                        ||                                                                                                                                                               // Colorize: green
                                        anotherLine == "};"                                                                                                                                              // Colorize: green
                                        ||                                                                                                                                                               // Colorize: green
                                        anotherLine == "} __attribute__((packed));"                                                                                                                      // Colorize: green
                                       )                                                                                                                                                                 // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        --level;                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        if (level <= 0)                                                                                                                                                  // Colorize: green
                                        {                                                                                                                                                                // Colorize: green
                                            break;                                                                                                                                                       // Colorize: green
                                        }                                                                                                                                                                // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                // Check that current line contain bit definition                                                                                                                        // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    QRegularExpressionMatch match2 = sBitsDefinitionRegExp.match(anotherLine);                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    if (match2.hasMatch())                                                                                                                                               // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        bitsDefined = true;                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        break;                                                                                                                                                           // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                            } while(true);                                                                                                                                                               // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        addTestStructureEntry(path, i, name, bitsDefined);                                                                                                                               // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void TestWorkerThread::addTestStructureEntry(const QString &path, qint64 lineNum, const QString &name, bool bitsDefined)                                                                                 // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    mTestStructureEntries.append(TestStructureEntry(path, lineNum, name, bitsDefined));                                                                                                                  // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void TestWorkerThread::addTestEntry(TestEntryType type, const QString &path, qint64 lineNum, const QString &name, QString testModule, const QString &line, const QString &prevLine)                      // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    if (                                                                                                                                                                                                 // Colorize: green
        !line.contains("// TEST: NO")                                                                                                                                                                    // Colorize: green
        &&                                                                                                                                                                                               // Colorize: green
        !prevLine.startsWith("// TEST: NO")                                                                                                                                                              // Colorize: green
       )                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        // Update testModule from current line comment or from previous line comment                                                                                                                     // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            qint64 index = line.lastIndexOf("// TEST: MODULE=");                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (index >= 0)                                                                                                                                                                              // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                testModule = line.mid(index + 16);                                                                                                                                                       // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
            else                                                                                                                                                                                         // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                index = prevLine.lastIndexOf("// TEST: MODULE=");                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                if (index >= 0)                                                                                                                                                                          // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    testModule = prevLine.mid(index + 16);                                                                                                                                               // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        mTestEntries.append(TestEntry(type, path, lineNum, name + "()", testModule));                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
