#include "mdtopheadersverifier.h"                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <QDir>                                                                                                                                                                                          // Colorize: green
#include <QFile>                                                                                                                                                                                         // Colorize: green
#include <QFileInfo>                                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <com/ngos/devtools/docs_verifier/other/docsverificationfiletype.h>                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
MdTopHeadersVerifier::MdTopHeadersVerifier()                                                                                                                                                             // Colorize: green
    : BaseDocsVerifier(DocsVerificationFileType::MD)                                                                                                                                                     // Colorize: green
    , mSectionIdRegExp("^(\\d+\\.).*$")                                                                                                                                                                  // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // Nothing                                                                                                                                                                                           // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MdTopHeadersVerifier::verify(DocsWorkerThread *worker, const QString &path, const QStringList &lines)                                                                                               // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    qint64 index = path.lastIndexOf("/docs/");                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (index >= 0)                                                                                                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        checkForNgosHeader(worker, path, lines);                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        QString     relativePath = getRelativePath(worker, path.mid(index + 6));                                                                                                                         // Colorize: green
        QStringList pathParts    = relativePath.split('/');                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (                                                                                                                                                                                             // Colorize: green
            pathParts.size() != 1                                                                                                                                                                        // Colorize: green
            ||                                                                                                                                                                                           // Colorize: green
            pathParts.at(0) != ""                                                                                                                                                                        // Colorize: green
           )                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString subsectionName = getSubsectionName(worker, path, pathParts);                                                                                                                         // Colorize: green
            checkForSubsectionHeader(worker, path, lines, subsectionName);                                                                                                                               // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
    else                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString sectionName = !lines.isEmpty() ? lines.at(0) : "";                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (sectionName != "")                                                                                                                                                                           // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            checkForSectionHeader(worker, path, lines, sectionName);                                                                                                                                     // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
        else                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            worker->addError(path, 0, "First line should be a header");                                                                                                                                  // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
QString MdTopHeadersVerifier::getRelativePath(DocsWorkerThread *worker, QString path) const                                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    if (path.endsWith("README.md"))                                                                                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        path.remove(path.length() - 9, 9);                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
    else                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        worker->addError(path, -1, "File name should be README.md");                                                                                                                                     // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (path.endsWith('/'))                                                                                                                                                                              // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        path.remove(path.length() - 1, 1);                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return path;                                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
QString MdTopHeadersVerifier::getSubsectionName(DocsWorkerThread *worker, QString path, const QStringList &pathParts) const                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    QString subsectionName;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    for (qint64 i = 0; i < pathParts.size() - 1; ++i)                                                                                                                                                    // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString                 pathPart = pathParts.at(i);                                                                                                                                              // Colorize: green
        QRegularExpressionMatch match    = mSectionIdRegExp.match(pathPart);                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (match.hasMatch())                                                                                                                                                                            // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            subsectionName.append(match.captured(1));                                                                                                                                                    // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
        else                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            worker->addError(path, -1, QString("Subsection name %1 should start with digit").arg(pathPart));                                                                                             // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString                 lastPathPart = pathParts.at(pathParts.size() - 1);                                                                                                                           // Colorize: green
    QRegularExpressionMatch match        = mSectionIdRegExp.match(lastPathPart);                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (match.hasMatch())                                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        subsectionName.append(lastPathPart);                                                                                                                                                             // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
    else                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        worker->addError(path, -1, QString("Subsection name %1 should start with digit").arg(lastPathPart));                                                                                             // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return subsectionName;                                                                                                                                                                               // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MdTopHeadersVerifier::checkForNgosHeader(DocsWorkerThread *worker, const QString &path, const QStringList &lines) const                                                                             // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    if (                                                                                                                                                                                                 // Colorize: green
        lines.size() <= 0                                                                                                                                                                                // Colorize: green
        ||                                                                                                                                                                                               // Colorize: green
        lines.at(0) != "NGOS"                                                                                                                                                                            // Colorize: green
       )                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        worker->addError(path, 0, "Invalid line. Expected: NGOS");                                                                                                                                       // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (                                                                                                                                                                                                 // Colorize: green
        lines.size() <= 1                                                                                                                                                                                // Colorize: green
        ||                                                                                                                                                                                               // Colorize: green
        lines.at(1) != "===="                                                                                                                                                                            // Colorize: green
       )                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        worker->addError(path, 1, "Invalid line. Expected: ====");                                                                                                                                       // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (                                                                                                                                                                                                 // Colorize: green
        lines.size() <= 2                                                                                                                                                                                // Colorize: green
        ||                                                                                                                                                                                               // Colorize: green
        lines.at(2) != ""                                                                                                                                                                                // Colorize: green
       )                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        worker->addWarning(path, 2, "Expected blank line after section");                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MdTopHeadersVerifier::checkForSectionHeader(DocsWorkerThread *worker, const QString &path, const QStringList &lines, const QString &sectionName) const                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    QString sectionHeader(sectionName.length(), '=');                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (                                                                                                                                                                                                 // Colorize: green
        lines.size() <= 1                                                                                                                                                                                // Colorize: green
        ||                                                                                                                                                                                               // Colorize: green
        lines.at(1) != sectionHeader                                                                                                                                                                     // Colorize: green
       )                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        worker->addError(path, 1, QString("Invalid line. Expected: %1").arg(sectionHeader));                                                                                                             // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (                                                                                                                                                                                                 // Colorize: green
        lines.size() <= 2                                                                                                                                                                                // Colorize: green
        ||                                                                                                                                                                                               // Colorize: green
        lines.at(2) != ""                                                                                                                                                                                // Colorize: green
       )                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        worker->addWarning(path, 2, "Expected blank line after section");                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MdTopHeadersVerifier::checkForSubsectionHeader(DocsWorkerThread *worker, const QString &path, const QStringList &lines, const QString &subsectionName) const                                        // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    if (                                                                                                                                                                                                 // Colorize: green
        lines.size() <= 3                                                                                                                                                                                // Colorize: green
        ||                                                                                                                                                                                               // Colorize: green
        lines.at(3) != subsectionName                                                                                                                                                                    // Colorize: green
       )                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        worker->addError(path, 3, QString("Invalid line. Expected: %1").arg(subsectionName));                                                                                                            // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString subsectionHeader(subsectionName.length(), '-');                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (                                                                                                                                                                                                 // Colorize: green
        lines.size() <= 4                                                                                                                                                                                // Colorize: green
        ||                                                                                                                                                                                               // Colorize: green
        lines.at(4) != subsectionHeader                                                                                                                                                                  // Colorize: green
       )                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        worker->addError(path, 4, QString("Invalid line. Expected: %1").arg(subsectionHeader));                                                                                                          // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    if (                                                                                                                                                                                                 // Colorize: green
        lines.size() <= 5                                                                                                                                                                                // Colorize: green
        ||                                                                                                                                                                                               // Colorize: green
        lines.at(5) != ""                                                                                                                                                                                // Colorize: green
       )                                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        worker->addWarning(path, 5, "Expected blank line after section");                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
MdTopHeadersVerifier mdTopHeadersVerifierInstance;                                                                                                                                                       // Colorize: green
