#include "cpumodelgenerator.h"                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <QDomDocument>                                                                                                                                                                                  // Colorize: green
#include <QEventLoop>                                                                                                                                                                                    // Colorize: green
#include <QFile>                                                                                                                                                                                         // Colorize: green
#include <QNetworkAccessManager>                                                                                                                                                                         // Colorize: green
#include <QNetworkReply>                                                                                                                                                                                 // Colorize: green
#include <QNetworkRequest>                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <com/ngos/devtools/shared/console/console.h>                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define INTEL_FILE_PATH "/src/os/shared/common/src/com/ngos/shared/common/cpu/lib/generated/intelcpumodel.h"                                                                                             // Colorize: green
#define AMD_FILE_PATH   "/src/os/shared/common/src/com/ngos/shared/common/cpu/lib/generated/amdcpumodel.h"                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define INTEL_DATABASE_URL "https://en.wikichip.org/wiki/intel/cpuid"                                                                                                                                    // Colorize: green
#define AMD_DATABASE_URL   "https://en.wikichip.org/wiki/amd/cpuid"                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define INTEL_SEARCH_START_LINE "<h3><span class=\"mw-headline\" id=\"Family_6\">Family 6</span><span class=\"mw-editsection\"><span class=\"mw-editsection-bracket\">[</span><a href=\"/w/index.php?title=intel/cpuid&amp;action=edit&amp;section=4\" title=\"Edit section: Family 6\">edit</a><span class=\"mw-editsection-bracket\">]</span></span></h3>" // Colorize: green
#define INTEL_SEARCH_END_LINE   "<h3><span class=\"mw-headline\" id=\"Family_5\">Family 5</span><span class=\"mw-editsection\"><span class=\"mw-editsection-bracket\">[</span><a href=\"/w/index.php?title=intel/cpuid&amp;action=edit&amp;section=9\" title=\"Edit section: Family 5\">edit</a><span class=\"mw-editsection-bracket\">]</span></span></h3>" // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define AMD_SEARCH_START_LINE "<h3><span class=\"mw-headline\" id=\"Family_25_.2819h.29\">Family 25 (19h)</span><span class=\"mw-editsection\"><span class=\"mw-editsection-bracket\">[</span><a href=\"/w/index.php?title=amd/cpuid&amp;action=edit&amp;section=2\" title=\"Edit section: Family 25 (19h)\">edit</a><span class=\"mw-editsection-bracket\">]</span></span></h3>" // Colorize: green
#define AMD_SEARCH_END_LINE   "<h3><span class=\"mw-headline\" id=\"Family_22_.2816h.29\">Family 22 (16h)</span><span class=\"mw-editsection\"><span class=\"mw-editsection-bracket\">[</span><a href=\"/w/index.php?title=amd/cpuid&amp;action=edit&amp;section=5\" title=\"Edit section: Family 22 (16h)\">edit</a><span class=\"mw-editsection-bracket\">]</span></span></h3>" // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
CpuModelGenerator::CpuModelGenerator()                                                                                                                                                                   // Colorize: green
    : CommonGenerator()                                                                                                                                                                                  // Colorize: green
    , mFamilyRegExp(".*Family *(\\d+).*")                                                                                                                                                                // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    // Nothing                                                                                                                                                                                           // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool CpuModelGenerator::generate(const QString &path)                                                                                                                                                    // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    return generateVendorModels("intel", path + INTEL_FILE_PATH, INTEL_DATABASE_URL, INTEL_SEARCH_START_LINE, INTEL_SEARCH_END_LINE)                                                                     // Colorize: green
            &&                                                                                                                                                                                           // Colorize: green
            generateVendorModels("amd", path + AMD_FILE_PATH, AMD_DATABASE_URL, AMD_SEARCH_START_LINE, AMD_SEARCH_END_LINE);                                                                             // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool CpuModelGenerator::generateVendorModels(const QString &vendor, const QString &path, const QString &url, const QString &searchStartLine, const QString &searchEndLine)                               // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    QStringList lines;                                                                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Download database                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!prepareDatabase(url, lines))                                                                                                                                                                // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QList<CpuModel> models;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Parse downloaded database to internal structure                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if (!parseDatabase(vendor, lines, searchStartLine, searchEndLine, models))                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return generateModels(vendor, path, url, models);                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool CpuModelGenerator::prepareDatabase(const QString &url, QStringList &lines)                                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    QNetworkAccessManager  manager;                                                                                                                                                                      // Colorize: green
    QNetworkReply         *reply;                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Send network request                                                                                                                                                                              // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QNetworkRequest request;                                                                                                                                                                         // Colorize: green
        request.setUrl(QUrl(url));                                                                                                                                                                       // Colorize: green
        reply = manager.get(request);                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Wait for finish                                                                                                                                                                                   // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QEventLoop waitLoop;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        QObject::connect(reply, SIGNAL(finished()),                                 &waitLoop, SLOT(quit()));                                                                                            // Colorize: green
        QObject::connect(reply, SIGNAL(errorOccurred(QNetworkReply::NetworkError)), &waitLoop, SLOT(quit()));                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        waitLoop.exec();                                                                                                                                                                                 // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Check status code                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QVariant statusCode = reply->attribute(QNetworkRequest::HttpStatusCodeAttribute);                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (statusCode.toInt() != 200)                                                                                                                                                                   // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            Console::err(QString("Failed to get CPU models database from: %1 (%2 - %3)")                                                                                                                           // Colorize: green
                                    .arg(url)                                                                                                                                                            // Colorize: green
                                    .arg(statusCode.toInt())                                                                                                                  // Colorize: green
                                    .arg(reply->errorString())                                                                                                                 // Colorize: green
            );                                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            delete reply;                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString content = QString::fromUtf8(reply->readAll());                                                                                                                                               // Colorize: green
    delete reply;                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get lines of content                                                                                                                                                                              // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        lines = content.split('\n');                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < lines.size(); ++i)                                                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString &line = lines[i];                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line.endsWith('\r'))                                                                                                                                                                     // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                line.remove(line.length() - 1, 1);                                                                                                                                                       // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return true;                                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool CpuModelGenerator::parseDatabase(const QString &vendor, const QStringList &lines, const QString &searchStartLine, const QString &searchEndLine, QList<CpuModel> &models)                            // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    qint64 i = 0;                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Skip lines                                                                                                                                                                                        // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        while (i < lines.size() && lines.at(i) != searchStartLine)                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (i >= lines.size())                                                                                                                                                                           // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            Console::err(QString("Failed to find start position to parse %1 processors")                                                                                                                 // Colorize: green
                                    .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                                                         // Colorize: green
            );                                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QDomDocument xml;                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Prepare XML document                                                                                                                                                                              // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        QString xmlContent = "<html>\n";                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        while (i < lines.size())                                                                                                                                                                         // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QString line = lines.at(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (line == searchEndLine)                                                                                                                                                                   // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                break;                                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            xmlContent.append(line);                                                                                                                                                                     // Colorize: green
            xmlContent.append("\n");                                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            ++i;                                                                                                                                                                                         // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (i >= lines.size())                                                                                                                                                                           // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            Console::err(QString("Failed to find end position to parse %1 processors")                                                                                                                   // Colorize: green
                                    .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                                                         // Colorize: green
            );                                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        xmlContent.append("</html>");                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        QString errorMessage;                                                                                                                                                                            // Colorize: green
        int     errorLine;                                                                                                                                                                               // Colorize: green
        int     errorColumn;                                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (!xml.setContent(xmlContent, &errorMessage, &errorLine, &errorColumn))                                                                                                                        // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            Console::err(QString("Failed to parse XML document for %1 processors at %2:%3 : %4")                                                                                                         // Colorize: green
                                    .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                                                         // Colorize: green
                                    .arg(errorLine)                                                                                                                                                      // Colorize: green
                                    .arg(errorColumn)                                                                                                                                                    // Colorize: green
                                    .arg(errorMessage)                                                                                                                                                   // Colorize: green
            );                                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            return false;                                                                                                                                                                                // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Parse models from XML                                                                                                                                                                             // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        qint64 family = -1;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        QDomElement doc  = xml.documentElement();                                                                                                                                                        // Colorize: green
        QDomNode    node = doc.firstChild();                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        while (!node.isNull())                                                                                                                                                                           // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            QDomElement element = node.toElement();                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (!element.isNull())                                                                                                                                                                       // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                if (element.tagName() == "h3")                                                                                                                                                           // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    // Parse family                                                                                                                                                                      // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        QString elementText = element.text();                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        QRegularExpressionMatch match = mFamilyRegExp.match(elementText);                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        if (match.hasMatch())                                                                                                                                                            // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            family = match.captured(1).toLongLong();                                                                                                                                     // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                        else                                                                                                                                                                             // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            Console::err(QString("Failed to parse family for %1 processors: %2")                                                                                                         // Colorize: green
                                                    .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                                         // Colorize: green
                                                    .arg(elementText)                                                                                                                                    // Colorize: green
                            );                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            return false;                                                                                                                                                                // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                if (element.tagName() == "table")                                                                                                                                                        // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    // Parse table                                                                                                                                                                       // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        qint64 model = -1;                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        qint64 microArchitectureColumn = -1;                                                                                                                                             // Colorize: green
                        qint64 nameColumn              = -1;                                                                                                                                             // Colorize: green
                        qint64 modelColumn             = -1;                                                                                                                                             // Colorize: green
                        qint64 extendedModelColumn     = -1;                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        qint64 microArchitectureRowSpan = -1;                                                                                                                                            // Colorize: green
                        qint64 nameRowSpan              = -1;                                                                                                                                            // Colorize: green
                        qint64 modelRowSpan             = -1;                                                                                                                                            // Colorize: green
                        qint64 extendedModelRowSpan     = -1;                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        QString microArchitectureStr;                                                                                                                                                    // Colorize: green
                        QString nameStr;                                                                                                                                                                 // Colorize: green
                        QString modelStr;                                                                                                                                                                // Colorize: green
                        QString extendedModelStr;                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        QDomNodeList children = node.childNodes();                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Check that there is only tbody element inside table                                                                                                                           // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            if (                                                                                                                                                                         // Colorize: green
                                children.size() != 1                                                                                                                                                     // Colorize: green
                                ||                                                                                                                                                                       // Colorize: green
                                children.at(0).toElement().tagName() != "tbody"                                                                                                                          // Colorize: green
                               )                                                                                                                                                                         // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                Console::err(QString("Failed to parse table for %1 processors")                                                                                                          // Colorize: green
                                                        .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                                     // Colorize: green
                                );                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                return false;                                                                                                                                                            // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        QDomNode tableNode = children.at(0).firstChild();                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // First row contains header                                                                                                                                                     // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            children = tableNode.childNodes();                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            for (qint64 i = 0; i < children.size(); ++i)                                                                                                                                 // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                element = children.at(i).toElement();                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                if (!element.isNull())                                                                                                                                                   // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    QString elementText = element.text().remove(' ').remove('\n');                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    if (elementText == "Microarchitecture")                                                                                                                              // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        if (microArchitectureColumn >= 0)                                                                                                                                // Colorize: green
                                        {                                                                                                                                                                // Colorize: green
                                            Console::err(QString("Microarchitecture column already found for %1 processors")                                                                             // Colorize: green
                                                                    .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                         // Colorize: green
                                            );                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            return false;                                                                                                                                                // Colorize: green
                                        }                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        microArchitectureColumn = i;                                                                                                                                     // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                    else                                                                                                                                                                 // Colorize: green
                                    if (                                                                                                                                                                 // Colorize: green
                                        elementText == "Core"                                                                                                                                            // Colorize: green
                                        ||                                                                                                                                                               // Colorize: green
                                        elementText == "Products"                                                                                                                                        // Colorize: green
                                        ||                                                                                                                                                               // Colorize: green
                                        elementText == "Codename"                                                                                                                                        // Colorize: green
                                        ||                                                                                                                                                               // Colorize: green
                                        elementText == "Design"                                                                                                                                          // Colorize: green
                                       )                                                                                                                                                                 // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        if (nameColumn >= 0)                                                                                                                                             // Colorize: green
                                        {                                                                                                                                                                // Colorize: green
                                            Console::err(QString("Name column already found for %1 processors")                                                                                          // Colorize: green
                                                                    .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                         // Colorize: green
                                            );                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            return false;                                                                                                                                                // Colorize: green
                                        }                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        nameColumn = i;                                                                                                                                                  // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                    else                                                                                                                                                                 // Colorize: green
                                    if (                                                                                                                                                                 // Colorize: green
                                        elementText == "BaseModel"                                                                                                                                       // Colorize: green
                                        ||                                                                                                                                                               // Colorize: green
                                        elementText == "Model"                                                                                                                                           // Colorize: green
                                       )                                                                                                                                                                 // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        if (modelColumn >= 0)                                                                                                                                            // Colorize: green
                                        {                                                                                                                                                                // Colorize: green
                                            Console::err(QString("Model column already found for %1 processors")                                                                                         // Colorize: green
                                                                    .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                         // Colorize: green
                                            );                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            return false;                                                                                                                                                // Colorize: green
                                        }                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        modelColumn = i;                                                                                                                                                 // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                    else                                                                                                                                                                 // Colorize: green
                                    if (elementText == "ExtendedModel")                                                                                                                                  // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        if (extendedModelColumn >= 0)                                                                                                                                    // Colorize: green
                                        {                                                                                                                                                                // Colorize: green
                                            Console::err(QString("Extended model column already found for %1 processors")                                                                                // Colorize: green
                                                                    .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                         // Colorize: green
                                            );                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            return false;                                                                                                                                                // Colorize: green
                                        }                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        extendedModelColumn = i;                                                                                                                                         // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            tableNode = tableNode.nextSibling();                                                                                                                                         // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Check that all columns are found                                                                                                                                              // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            if (                                                                                                                                                                         // Colorize: green
                                microArchitectureColumn < 0                                                                                                                                              // Colorize: green
                                ||                                                                                                                                                                       // Colorize: green
                                nameColumn < 0                                                                                                                                                           // Colorize: green
                                ||                                                                                                                                                                       // Colorize: green
                                modelColumn < 0                                                                                                                                                          // Colorize: green
                                ||                                                                                                                                                                       // Colorize: green
                                extendedModelColumn < 0                                                                                                                                                  // Colorize: green
                               )                                                                                                                                                                         // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                Console::err(QString("Required columns not found for %1 processors")                                                                                                     // Colorize: green
                                                        .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                                     // Colorize: green
                                );                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                return false;                                                                                                                                                            // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        // Parse table rows with models                                                                                                                                                  // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            while (!tableNode.isNull())                                                                                                                                                  // Colorize: green
                            {                                                                                                                                                                            // Colorize: green
                                qint64 microArchitectureNewRowSpan = microArchitectureRowSpan;                                                                                                           // Colorize: green
                                qint64 nameNewRowSpan              = nameRowSpan;                                                                                                                        // Colorize: green
                                qint64 modelNewRowSpan             = modelRowSpan;                                                                                                                       // Colorize: green
                                qint64 extendedModelNewRowSpan     = extendedModelRowSpan;                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                // Get model parameters                                                                                                                                                  // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    children = tableNode.childNodes();                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    // Get Microarchitecture                                                                                                                                             // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        if (microArchitectureRowSpan <= 0)                                                                                                                               // Colorize: green
                                        {                                                                                                                                                                // Colorize: green
                                            qint64 realColumn = microArchitectureColumn;                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (nameColumn < microArchitectureColumn && nameRowSpan > 0)                                                                                                 // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                --realColumn;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (modelColumn < microArchitectureColumn && modelRowSpan > 0)                                                                                               // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                --realColumn;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (extendedModelColumn < microArchitectureColumn && extendedModelRowSpan > 0)                                                                               // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                --realColumn;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (realColumn < children.size())                                                                                                                            // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                element = children.at(realColumn).toElement();                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                microArchitectureStr        = element.text().simplified().toUpper();                                                                                     // Colorize: green
                                                microArchitectureNewRowSpan = element.attribute("rowspan", "1").toLongLong();                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                            else                                                                                                                                                         // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                microArchitectureStr        = "";                                                                                                                        // Colorize: green
                                                microArchitectureNewRowSpan = 1;                                                                                                                         // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                        }                                                                                                                                                                // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    // Get Name                                                                                                                                                          // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        if (nameRowSpan <= 0)                                                                                                                                            // Colorize: green
                                        {                                                                                                                                                                // Colorize: green
                                            qint64 realColumn = nameColumn;                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (microArchitectureColumn < nameColumn && microArchitectureRowSpan > 0)                                                                                    // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                --realColumn;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (modelColumn < nameColumn && modelRowSpan > 0)                                                                                                            // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                --realColumn;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (extendedModelColumn < nameColumn && extendedModelRowSpan > 0)                                                                                            // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                --realColumn;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (realColumn < children.size())                                                                                                                            // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                element = children.at(realColumn).toElement();                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                nameStr        = element.text().simplified().toUpper();                                                                                                  // Colorize: green
                                                nameNewRowSpan = element.attribute("rowspan", "1").toLongLong();                                                                                         // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                            else                                                                                                                                                         // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                nameStr        = "";                                                                                                                                     // Colorize: green
                                                nameNewRowSpan = 1;                                                                                                                                      // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                        }                                                                                                                                                                // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    // Get Model                                                                                                                                                         // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        if (modelRowSpan <= 0)                                                                                                                                           // Colorize: green
                                        {                                                                                                                                                                // Colorize: green
                                            qint64 realColumn = modelColumn;                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (microArchitectureColumn < modelColumn && microArchitectureRowSpan > 0)                                                                                   // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                --realColumn;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (nameColumn < modelColumn && nameRowSpan > 0)                                                                                                             // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                --realColumn;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (extendedModelColumn < modelColumn && extendedModelRowSpan > 0)                                                                                           // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                --realColumn;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (realColumn < children.size())                                                                                                                            // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                element = children.at(realColumn).toElement();                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                modelStr        = element.text().simplified();                                                                                                           // Colorize: green
                                                modelNewRowSpan = element.attribute("rowspan", "1").toLongLong();                                                                                        // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                            else                                                                                                                                                         // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                modelStr        = "";                                                                                                                                    // Colorize: green
                                                modelNewRowSpan = 1;                                                                                                                                     // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                        }                                                                                                                                                                // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                    // Get Extended Model                                                                                                                                                // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        if (extendedModelRowSpan <= 0)                                                                                                                                   // Colorize: green
                                        {                                                                                                                                                                // Colorize: green
                                            qint64 realColumn = extendedModelColumn;                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (microArchitectureColumn < extendedModelColumn && microArchitectureRowSpan > 0)                                                                           // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                --realColumn;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (nameColumn < extendedModelColumn && nameRowSpan > 0)                                                                                                     // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                --realColumn;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (modelColumn < extendedModelColumn && modelRowSpan > 0)                                                                                                   // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                --realColumn;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (realColumn < children.size())                                                                                                                            // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                element = children.at(realColumn).toElement();                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                extendedModelStr        = element.text().simplified();                                                                                                   // Colorize: green
                                                extendedModelNewRowSpan = element.attribute("rowspan", "1").toLongLong();                                                                                // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                            else                                                                                                                                                         // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                extendedModelStr        = "";                                                                                                                            // Colorize: green
                                                extendedModelNewRowSpan = 1;                                                                                                                             // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                        }                                                                                                                                                                // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                // Update row spans                                                                                                                                                      // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    microArchitectureRowSpan = microArchitectureNewRowSpan - 1;                                                                                                          // Colorize: green
                                    nameRowSpan              = nameNewRowSpan - 1;                                                                                                                       // Colorize: green
                                    modelRowSpan             = modelNewRowSpan - 1;                                                                                                                      // Colorize: green
                                    extendedModelRowSpan     = extendedModelNewRowSpan - 1;                                                                                                              // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                // Check row spans                                                                                                                                                       // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    if (                                                                                                                                                                 // Colorize: green
                                        microArchitectureRowSpan < 0                                                                                                                                     // Colorize: green
                                        ||                                                                                                                                                               // Colorize: green
                                        nameRowSpan < 0                                                                                                                                                  // Colorize: green
                                        ||                                                                                                                                                               // Colorize: green
                                        modelRowSpan < 0                                                                                                                                                 // Colorize: green
                                        ||                                                                                                                                                               // Colorize: green
                                        extendedModelRowSpan < 0                                                                                                                                         // Colorize: green
                                       )                                                                                                                                                                 // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        Console::err(QString("Error in row spans for %1 processors")                                                                                                     // Colorize: green
                                                                .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                             // Colorize: green
                                        );                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        return false;                                                                                                                                                    // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                // Create models                                                                                                                                                         // Colorize: green
                                {                                                                                                                                                                        // Colorize: green
                                    if (modelStr != "" && extendedModelStr != "")                                                                                                                        // Colorize: green
                                    {                                                                                                                                                                    // Colorize: green
                                        // Get and verify model value                                                                                                                                    // Colorize: green
                                        {                                                                                                                                                                // Colorize: green
                                            if (                                                                                                                                                         // Colorize: green
                                                !modelStr.startsWith("0x")                                                                                                                               // Colorize: green
                                                ||                                                                                                                                                       // Colorize: green
                                                !extendedModelStr.startsWith("0x")                                                                                                                       // Colorize: green
                                               )                                                                                                                                                         // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                Console::err(QString("Model value must be in HEX for %1 processors")                                                                                     // Colorize: green
                                                                        .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                     // Colorize: green
                                                );                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                return false;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            bool ok1;                                                                                                                                                    // Colorize: green
                                            bool ok2;                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            model = (extendedModelStr.mid(2).toLongLong(&ok1, 16) << 4) + modelStr.mid(2).toLongLong(&ok2, 16);                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (!ok1 || !ok2)                                                                                                                                            // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                Console::err(QString("Model value must be in HEX for %1 processors")                                                                                     // Colorize: green
                                                                        .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                     // Colorize: green
                                                );                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                return false;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (model > 255)                                                                                                                                             // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                Console::err(QString("Model value is more than 255 for %1 processors")                                                                                   // Colorize: green
                                                                        .arg(vendor.at(0).toUpper() + vendor.mid(1))                                                                                     // Colorize: green
                                                );                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                return false;                                                                                                                                            // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                        }                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                        // Get models names and create CpuModel for them                                                                                                                 // Colorize: green
                                        {                                                                                                                                                                // Colorize: green
                                            microArchitectureStr = microArchitectureStr.replace(' ', '_').remove('(').remove(')');                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            // Remove brackets from name                                                                                                                                 // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                do                                                                                                                                                       // Colorize: green
                                                {                                                                                                                                                        // Colorize: green
                                                    qint64 index = nameStr.indexOf('(');                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                    if (index < 0)                                                                                                                                       // Colorize: green
                                                    {                                                                                                                                                    // Colorize: green
                                                        break;                                                                                                                                           // Colorize: green
                                                    }                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                    qint64 index2 = nameStr.indexOf(')', index + 1);                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                    if (index2 < 0)                                                                                                                                      // Colorize: green
                                                    {                                                                                                                                                    // Colorize: green
                                                        break;                                                                                                                                           // Colorize: green
                                                    }                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                    nameStr.remove(index, index2 - index + 1);                                                                                                           // Colorize: green
                                                } while(true);                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                do                                                                                                                                                       // Colorize: green
                                                {                                                                                                                                                        // Colorize: green
                                                    qint64 index = nameStr.indexOf('[');                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                    if (index < 0)                                                                                                                                       // Colorize: green
                                                    {                                                                                                                                                    // Colorize: green
                                                        break;                                                                                                                                           // Colorize: green
                                                    }                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                    qint64 index2 = nameStr.indexOf(']', index + 1);                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                    if (index2 < 0)                                                                                                                                      // Colorize: green
                                                    {                                                                                                                                                    // Colorize: green
                                                        break;                                                                                                                                           // Colorize: green
                                                    }                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                    nameStr.remove(index, index2 - index + 1);                                                                                                           // Colorize: green
                                                } while(true);                                                                                                                                           // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            nameStr.remove('?');                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                            if (nameStr != "")                                                                                                                                           // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                QStringList names = nameStr.split(',');                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                for (qint64 i = 0; i < names.length(); ++i)                                                                                                              // Colorize: green
                                                {                                                                                                                                                        // Colorize: green
                                                    QString name = names.at(i).trimmed();                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                    // Update name                                                                                                                                       // Colorize: green
                                                    {                                                                                                                                                    // Colorize: green
                                                        qint64 index  = nameStr.indexOf('\"');                                                                                                           // Colorize: green
                                                        qint64 index2 = nameStr.indexOf('\"', index + 1);                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                        if (index >= 0 && index2 >= 0)                                                                                                                   // Colorize: green
                                                        {                                                                                                                                                // Colorize: green
                                                            name = name.mid(index + 1, index2 - index - 1);                                                                                              // Colorize: green
                                                        }                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                        name = name.replace(' ', '_');                                                                                                                   // Colorize: green
                                                    }                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                    if (name.length() > 3 && name != "GT3E")                                                                                                             // Colorize: green
                                                    {                                                                                                                                                    // Colorize: green
                                                        if (name != "ENGINEERING_SAMPLE")                                                                                                                // Colorize: green
                                                        {                                                                                                                                                // Colorize: green
                                                            CpuModel cpuModel;                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                            cpuModel.name = QString("FAMILY_%1_%2")                                                                                                      // Colorize: green
                                                                                    .arg(family)                                                                                                         // Colorize: green
                                                                                    .arg(name);                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                            cpuModel.family = family;                                                                                                                    // Colorize: green
                                                            cpuModel.model  = model;                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                            models.append(cpuModel);                                                                                                                     // Colorize: green
                                                        }                                                                                                                                                // Colorize: green
                                                    }                                                                                                                                                    // Colorize: green
                                                    else                                                                                                                                                 // Colorize: green
                                                    {                                                                                                                                                    // Colorize: green
                                                        CpuModel cpuModel;                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                        cpuModel.name = QString("FAMILY_%1_%2_%3")                                                                                                       // Colorize: green
                                                                                .arg(family)                                                                                                             // Colorize: green
                                                                                .arg(microArchitectureStr)                                                                                               // Colorize: green
                                                                                .arg(name);                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                        cpuModel.family = family;                                                                                                                        // Colorize: green
                                                        cpuModel.model  = model;                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                        models.append(cpuModel);                                                                                                                         // Colorize: green
                                                    }                                                                                                                                                    // Colorize: green
                                                }                                                                                                                                                        // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                            else                                                                                                                                                         // Colorize: green
                                            {                                                                                                                                                            // Colorize: green
                                                if (microArchitectureStr != "")                                                                                                                          // Colorize: green
                                                {                                                                                                                                                        // Colorize: green
                                                    CpuModel cpuModel;                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                    cpuModel.name = QString("FAMILY_%1_%2")                                                                                                              // Colorize: green
                                                                            .arg(family)                                                                                                                 // Colorize: green
                                                                            .arg(microArchitectureStr);                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                    cpuModel.family = family;                                                                                                                            // Colorize: green
                                                    cpuModel.model  = model;                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                    models.append(cpuModel);                                                                                                                             // Colorize: green
                                                }                                                                                                                                                        // Colorize: green
                                            }                                                                                                                                                            // Colorize: green
                                        }                                                                                                                                                                // Colorize: green
                                    }                                                                                                                                                                    // Colorize: green
                                }                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                tableNode = tableNode.nextSibling();                                                                                                                                     // Colorize: green
                            }                                                                                                                                                                            // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            node = node.nextSibling();                                                                                                                                                                   // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Sort and optimize models                                                                                                                                                                          // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        std::sort(models.begin(), models.end());                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < models.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            const CpuModel &cpuModel = models.at(i);                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            for (qint64 j = i + 1; j < models.size(); ++j)                                                                                                                                               // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                if (cpuModel.name == models.at(j).name)                                                                                                                                                  // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    models.removeAt(i);                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    --i;                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    break;                                                                                                                                                                               // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return true;                                                                                                                                                                                         // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
bool CpuModelGenerator::generateModels(const QString &vendor, const QString &path, const QString &url, const QList<CpuModel> &models)                                                                    // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    QStringList lines;                                                                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Add include lines                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        lines.append("#include <com/ngos/shared/common/cpu/lib/cpufamily.h>");                                                                                                                           // Colorize: green
        lines.append("#include <com/ngos/shared/common/log/assert.h>");                                                                                                                                  // Colorize: green
        lines.append("#include <com/ngos/shared/common/log/log.h>");                                                                                                                                     // Colorize: green
        lines.append("#include <com/ngos/shared/common/ngos/types.h>");                                                                                                                                  // Colorize: green
        lines.append("#include <com/ngos/shared/common/printf/printf.h>");                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        addThreeBlankLines(lines);                                                                                                                                                                       // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString enumName = QString("%1CpuModel")                                                                                                                                                             // Colorize: green
                                .arg(vendor.at(0).toUpper() + vendor.mid(1));                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    qint64 maxLen = 0;                                                                                                                                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Get maximum model name length                                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        for (qint64 i = 0; i < models.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            const CpuModel &cpuModel = models.at(i);                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            if (cpuModel.name.length() > maxLen)                                                                                                                                                         // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                maxLen = cpuModel.name.length();                                                                                                                                                         // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Generate CPU models enum                                                                                                                                                                          // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        lines.append(QString("// Taken from %1")                                                                                                                                                         // Colorize: green
                                .arg(url)                                                                                                                                                                // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        lines.append(QString("enum class %1: good_U8 // Ignore CppEnumVerifier")                                                                                                                         // Colorize: green
                                .arg(enumName)                                                                                                                                                           // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        lines.append("{");                                                                                                                                                                               // Colorize: green
        lines.append(QString("    %1 = 0,")                                                                                                                                                              // Colorize: green
                     .arg("NONE", -maxLen, QChar(' '))                                                                                                                                                   // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < models.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            const CpuModel &cpuModel = models.at(i);                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            lines.append(QString("    %1 = %2%3")                                                                                                                                                        // Colorize: green
                         .arg(cpuModel.name, -maxLen, QChar(' '))                                                                                                                                        // Colorize: green
                         .arg(cpuModel.model)                                                                                                                                                            // Colorize: green
                         .arg(i < models.size() - 1 ? "," : "")                                                                                                                                          // Colorize: green
            );                                                                                                                                                                                           // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        lines.append("};");                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        addThreeBlankLines(lines);                                                                                                                                                                       // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    qint64 maxCompactLen = 0;                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Generate enumToString function                                                                                                                                                                    // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        qint64 family = -1;                                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Add function declaration                                                                                                                                                                      // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            lines.append(QString("inline const good_Char8* enumToString(CpuFamily family, %1 model) // TEST: NO")                                                                                        // Colorize: green
                                    .arg(enumName)                                                                                                                                                       // Colorize: green
            );                                                                                                                                                                                           // Colorize: green
            lines.append("{");                                                                                                                                                                           // Colorize: green
            lines.append("    // COMMON_LT((\" | family = %u, model = %u\", family, model)); // Commented to avoid bad looking logs");                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            addThreeBlankLines(lines);                                                                                                                                                                   // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        // Add special case for NONE                                                                                                                                                                     // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            lines.append(QString("    if (model == %1::NONE)")                                                                                                                                           // Colorize: green
                                    .arg(enumName)                                                                                                                                                       // Colorize: green
            );                                                                                                                                                                                           // Colorize: green
            lines.append("    {");                                                                                                                                                                       // Colorize: green
            lines.append("        return \"NONE\";");                                                                                                                                                    // Colorize: green
            lines.append("    }");                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            addThreeBlankLines(lines);                                                                                                                                                                   // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        lines.append("    switch (family)");                                                                                                                                                             // Colorize: green
        lines.append("    {");                                                                                                                                                                           // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        for (qint64 i = 0; i < models.size(); ++i)                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            const CpuModel &cpuModel = models.at(i);                                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            // Switch to another family group                                                                                                                                                            // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                if (cpuModel.family != family)                                                                                                                                                           // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    if (family > 0)                                                                                                                                                                      // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        lines.append("");                                                                                                                                                                // Colorize: green
                        lines.append("                default: return \"UNKNOWN\";");                                                                                                                    // Colorize: green
                        lines.append("            }");                                                                                                                                                   // Colorize: green
                        lines.append("        }");                                                                                                                                                       // Colorize: green
                        lines.append("        break;");                                                                                                                                                  // Colorize: green
                        lines.append("");                                                                                                                                                                // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    family = cpuModel.family;                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    lines.append(QString("        case CpuFamily::%1_FAMILY_%2:")                                                                                                                        // Colorize: green
                                            .arg(vendor.toUpper())                                                                                                                                       // Colorize: green
                                            .arg(family)                                                                                                                                                 // Colorize: green
                    );                                                                                                                                                                                   // Colorize: green
                    lines.append("        {");                                                                                                                                                           // Colorize: green
                    lines.append("            switch (model)");                                                                                                                                          // Colorize: green
                    lines.append("            {");                                                                                                                                                       // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            // Insert case for uniq model value                                                                                                                                                          // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                if (                                                                                                                                                                                     // Colorize: green
                    i <= 0                                                                                                                                                                               // Colorize: green
                    ||                                                                                                                                                                                   // Colorize: green
                    cpuModel.family != models.at(i - 1).family                                                                                                                                           // Colorize: green
                    ||                                                                                                                                                                                   // Colorize: green
                    cpuModel.model != models.at(i - 1).model                                                                                                                                             // Colorize: green
                   )                                                                                                                                                                                     // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    if (cpuModel.name.length() > maxCompactLen)                                                                                                                                          // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        maxCompactLen = cpuModel.name.length();                                                                                                                                          // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    lines.append(QString("                case %1::%2:%3 return \"%2\";")                                                                                                                // Colorize: green
                                 .arg(enumName)                                                                                                                                                          // Colorize: green
                                 .arg(cpuModel.name)                                                                                                                                                     // Colorize: green
                                 .arg("", maxLen - cpuModel.name.length(), QChar(' '))                                                                                                                   // Colorize: green
                    );                                                                                                                                                                                   // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        lines.append("");                                                                                                                                                                                // Colorize: green
        lines.append("                default: return \"UNKNOWN\";");                                                                                                                                    // Colorize: green
        lines.append("            }");                                                                                                                                                                   // Colorize: green
        lines.append("        }");                                                                                                                                                                       // Colorize: green
        lines.append("        break;");                                                                                                                                                                  // Colorize: green
        lines.append("");                                                                                                                                                                                // Colorize: green
        lines.append("        default: return \"UNKNOWN\";");                                                                                                                                            // Colorize: green
        lines.append("    }");                                                                                                                                                                           // Colorize: green
        lines.append("}");                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        addThreeBlankLines(lines);                                                                                                                                                                       // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Generate enumToFullString function                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        // Add function declaration                                                                                                                                                                      // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            lines.append(QString("inline const good_Char8* enumToFullString(CpuFamily family, %1 model) // TEST: NO")                                                                                    // Colorize: green
                                    .arg(enumName)                                                                                                                                                       // Colorize: green
            );                                                                                                                                                                                           // Colorize: green
            lines.append("{");                                                                                                                                                                           // Colorize: green
            lines.append("    // COMMON_LT((\" | family = %u, model = %u\", family, model)); // Commented to avoid bad looking logs");                                                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            addThreeBlankLines(lines);                                                                                                                                                                   // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        lines.append(QString("    static good_Char8 res[%1];")                                                                                                                                           // Colorize: green
                                .arg(maxCompactLen + 7) // 7 = Length of "0xFF ()"                                                                                                                       // Colorize: green
        );                                                                                                                                                                                               // Colorize: green
        lines.append("");                                                                                                                                                                                // Colorize: green
        lines.append("    sprintf(res, \"0x%02X (%s)\", static_cast<good_U8>(model), enumToString(family, model));");                                                                                    // Colorize: green
        lines.append("");                                                                                                                                                                                // Colorize: green
        lines.append("    return res;");                                                                                                                                                                 // Colorize: green
        lines.append("}");                                                                                                                                                                               // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    return save(path, lines);                                                                                                                                                                            // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
CpuModelGenerator cpuModelGeneratorInstance;                                                                                                                                                             // Colorize: green
