#include "mainwindow.h"                                                                                                                                                                                  // Colorize: green
#include "ui_mainwindow.h"                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <QActionGroup>                                                                                                                                                                                  // Colorize: green
#include <QDateTime>                                                                                                                                                                                     // Colorize: green
#include <QDebug>                                                                                                                                                                                        // Colorize: green
#include <QDir>                                                                                                                                                                                          // Colorize: green
#include <QJsonArray>                                                                                                                                                                                    // Colorize: green
#include <QJsonDocument>                                                                                                                                                                                 // Colorize: green
#include <QJsonObject>                                                                                                                                                                                   // Colorize: green
#include <QMessageBox>                                                                                                                                                                                   // Colorize: green
#include <QNetworkRequest>                                                                                                                                                                               // Colorize: green
#include <QProcess>                                                                                                                                                                                      // Colorize: green
#include <QSettings>                                                                                                                                                                                     // Colorize: green
#include <QUrl>                                                                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#include <com/ngos/devtools/usb_boot_maker/main/aboutdialog.h>                                                                                                                                           // Colorize: green
#include <com/ngos/shared/common/macro/applications.h>                                                                                                                                                   // Colorize: green
#include <com/ngos/shared/common/macro/servers.h>                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
#define PROGRESS_BAR_INITIAL 5                                                                                                                                                                           // Colorize: green
#define PROGRESS_BAR_BURNING 40                                                                                                                                                                          // Colorize: green
#define PROGRESS_BAR_MAXIMUM 100                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
const QStringList servers =                                                                                                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
const QStringList applications =                                                                                                                                                                         // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
MainWindow::MainWindow(QWidget *parent)                                                                                                                                                                  // Colorize: green
    : QMainWindow(parent)                                                                                                                                                                                // Colorize: green
    , ui(new Ui::MainWindow())                                                                                                                                                                           // Colorize: green
    , mTranslator(new QTranslator(this))                                                                                                                                                                 // Colorize: green
    , mUpdateTimer(new QTimer(this))                                                                                                                                                                     // Colorize: green
    , mManager(new QNetworkAccessManager(this))                                                                                                                                                          // Colorize: green
    , mTemporaryDir(nullptr)                                                                                                                                                                             // Colorize: green
    , mBurnThread(nullptr)                                                                                                                                                                               // Colorize: green
#ifdef Q_OS_LINUX                                                                                                                                                                                        // Colorize: green
    , mUsbMonitorThread(new UsbMonitorThread())                                                                                                                                                          // Colorize: green
#endif                                                                                                                                                                                                   // Colorize: green
    , mState(UsbBootMakerState::INITIAL)                                                                                                                                                                 // Colorize: green
    , mRequestTime(0)                                                                                                                                                                                    // Colorize: green
    , mReplies()                                                                                                                                                                                         // Colorize: green
    , mLatestVersions()                                                                                                                                                                                  // Colorize: green
    , mSelectedVersionInfo()                                                                                                                                                                             // Colorize: green
    , mCurrentApplication(0)                                                                                                                                                                             // Colorize: green
    , mVersionFiles()                                                                                                                                                                                    // Colorize: green
    , mLanguage()                                                                                                                                                                                        // Colorize: green
    , mLanguageActions()                                                                                                                                                                                 // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
MainWindow::~MainWindow()                                                                                                                                                                                // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::on_actionExit_triggered()                                                                                                                                                               // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::on_actionAbout_triggered()                                                                                                                                                              // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::on_startButton_clicked()                                                                                                                                                                // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::languageToggled(bool checked)                                                                                                                                                           // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::updateUsbDevices()                                                                                                                                                                      // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::usbStatusChanged(quint16 delay)                                                                                                                                                         // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::ignoreSslErrors(QNetworkReply *reply, const QList<QSslError> &/*errors*/)                                                                                                               // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::latestVersionReplyFinished()                                                                                                                                                            // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::fileListReplyFinished()                                                                                                                                                                 // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::downloadReplyFinished()                                                                                                                                                                 // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::burnFinished()                                                                                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::burnProgress(quint8 current, quint8 maximum)                                                                                                                                            // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    ui->statusProgressBar->setValue(PROGRESS_BAR_BURNING + (PROGRESS_BAR_MAXIMUM - PROGRESS_BAR_BURNING) * current / maximum);                                                                           // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::addLog(const QString &text)                                                                                                                                                             // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::prepareLanguages()                                                                                                                                                                      // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::switchToState(UsbBootMakerState state)                                                                                                                                                  // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::handleGetLatestVersionState()                                                                                                                                                           // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    ui->statusProgressBar->setValue(PROGRESS_BAR_INITIAL + (PROGRESS_BAR_BURNING - PROGRESS_BAR_INITIAL) * (0 + mCurrentApplication * 3) / applications.length() / 3);                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QString application = applications.at(mCurrentApplication);                                                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    addLog("");                                                                                                                                                                                          // Colorize: green
    addLog(tr("Getting information about latest version of %1 from servers").arg(application));                                                                                                          // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    mLatestVersions.clear();                                                                                                                                                                             // Colorize: green
    mRequestTime = QDateTime::currentMSecsSinceEpoch();                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Send requests to servers in order to obtain latest application version from them                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::handleGetFileListState()                                                                                                                                                                // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    ui->statusProgressBar->setValue(PROGRESS_BAR_INITIAL + (PROGRESS_BAR_BURNING - PROGRESS_BAR_INITIAL) * (1 + mCurrentApplication * 3) / applications.length() / 3);                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Terminate if no response received from any server                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    QHash<qint64, QList<const VersionInfo *>> versionGroups;                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Fill versionGroups                                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    const QList<const VersionInfo *> *generalGroup = nullptr;                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Find version that more spread among servers                                                                                                                                                       // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Find server with the minimum delay                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Send request to server in order to get list of files                                                                                                                                              // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::handleDownloadState()                                                                                                                                                                   // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    ui->statusProgressBar->setValue(PROGRESS_BAR_INITIAL + (PROGRESS_BAR_BURNING - PROGRESS_BAR_INITIAL) * (2 + mCurrentApplication * 3) / applications.length() / 3);                                   // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Send requests to server in order to download files                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::handleBurningState()                                                                                                                                                                    // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    ui->statusProgressBar->setValue(PROGRESS_BAR_BURNING);                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    addLog("");                                                                                                                                                                                          // Colorize: green
    addLog(tr("Making bootable USB flash drive on disk \"%1\"").arg(ui->deviceComboBox->currentText()));                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Create and start burn thread                                                                                                                                                                      // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        mBurnThread = new BurnThread(ui->deviceComboBox->currentData().value<UsbDeviceInfo *>(), mTemporaryDir->path());                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        connect(mBurnThread, SIGNAL(logAdded(const QString &)), this, SLOT(addLog(const QString &)));                                                                                                    // Colorize: green
        connect(mBurnThread, SIGNAL(progress(quint8, quint8)),  this, SLOT(burnProgress(quint8, quint8)));                                                                                               // Colorize: green
        connect(mBurnThread, SIGNAL(finished()),                this, SLOT(burnFinished()));                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        mBurnThread->start();                                                                                                                                                                            // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::resetToInitialState()                                                                                                                                                                   // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::abortReplies()                                                                                                                                                                          // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::switchToInitialState()                                                                                                                                                                  // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    mState = UsbBootMakerState::INITIAL;                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Setup UI controls                                                                                                                                                                                 // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        ui->statusProgressBar->setValue(0);                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        ui->deviceComboBox->setEnabled(true);                                                                                                                                                            // Colorize: green
        ui->startButton->setIcon(QIcon(":/assets/images/start.png")); // Ignore CppPunctuationVerifier                                                                                                   // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::saveWindowState()                                                                                                                                                                       // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    QSettings settings("NGOS", "usb_boot_maker");                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Save settings                                                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
void MainWindow::loadWindowState()                                                                                                                                                                       // Colorize: green
{                                                                                                                                                                                                        // Colorize: green
    QSettings settings("NGOS", "usb_boot_maker");                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Load settings                                                                                                                                                                                     // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        // Ignore CppAlignmentVerifier [BEGIN]                                                                                                                                                           // Colorize: green
        mLanguage =     settings.value("Language", QLocale::system().name()).toString(); // Ignore CppEqualAlignmentVerifier                                                                             // Colorize: green
        restoreGeometry(settings.value("MainWindow/geometry").toByteArray());                                                                                                                            // Colorize: green
        restoreState(   settings.value("MainWindow/windowState").toByteArray());                                                                                                                         // Colorize: green
        // Ignore CppAlignmentVerifier [END]                                                                                                                                                             // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    // Mark selected language menu item                                                                                                                                                                  // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
}                                                                                                                                                                                                        // Colorize: green
