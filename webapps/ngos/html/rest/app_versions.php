<?php                                                                                                                                                                                                    // Colorize: green
    require_once "../common/functions.php";                                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    function handle_request()                                                                                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        switch ($_SERVER["REQUEST_METHOD"])                                                                                                                                                              // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            case "GET":                                                                                                                                                                                  // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                handle_get();                                                                                                                                                                            // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
            break;                                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            case "POST":                                                                                                                                                                                 // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                handle_post();                                                                                                                                                                           // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
            break;                                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            default:                                                                                                                                                                                     // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                die("Unknown method");                                                                                                                                                                   // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
            break;                                                                                                                                                                                       // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    function include_files_for_app_version($link, &$data, $app_version_id, $include_files)                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        if ($include_files)                                                                                                                                                                              // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            // Ignore PhpAlignmentVerifier [BEGIN]                                                                                                                                                       // Colorize: green
            $sql = "SELECT"                                                                                                                                                                              // Colorize: green
                . "     filename,"                                                                                                                                                                       // Colorize: green
                . "     download_name,"                                                                                                                                                                  // Colorize: green
                . "     hash"                                                                                                                                                                            // Colorize: green
                . " FROM " . DB_TABLE_APP_FILES                                                                                                                                                          // Colorize: green
                . " WHERE app_version_id = '" . $link->real_escape_string($app_version_id) . "'"                                                                                                         // Colorize: green
                . " ORDER BY filename";                                                                                                                                                                  // Colorize: green
            // Ignore PhpAlignmentVerifier [END]                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            $result = $link->query($sql);                                                                                                                                                                // Colorize: green
            die_if_sql_failed($result, $link, $data, $sql);                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            $files = [];                                                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            while ($row = $result->fetch_assoc())                                                                                                                                                        // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                array_push($files, $row);                                                                                                                                                                // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            $result->close();                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            $data["files"] = $files;                                                                                                                                                                     // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    function handle_get_for_app_version_id($link, &$data, $app_version_id, $include_files)                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        // Ignore PhpAlignmentVerifier [BEGIN]                                                                                                                                                           // Colorize: green
        $sql = "SELECT"                                                                                                                                                                                  // Colorize: green
            . "     id,"                                                                                                                                                                                 // Colorize: green
            . "     version,"                                                                                                                                                                            // Colorize: green
            . "     hash"                                                                                                                                                                                // Colorize: green
            . " FROM " . DB_TABLE_APP_VERSIONS                                                                                                                                                           // Colorize: green
            . " WHERE id        = '" . $link->real_escape_string($app_version_id) . "'"                                                                                                                  // Colorize: green
            . "   AND completed = '1'";                                                                                                                                                                  // Colorize: green
        // Ignore PhpAlignmentVerifier [END]                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $result = $link->query($sql);                                                                                                                                                                    // Colorize: green
        die_if_sql_failed($result, $link, $data, $sql);                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if ($result->num_rows == 0)                                                                                                                                                                      // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            $result->close();                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            db_disconnect($link);                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            $data["message"] = "Version not found";                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            die(json_encode($data));                                                                                                                                                                     // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $data["version"]            = $result->fetch_assoc();                                                                                                                                            // Colorize: green
        $data["version"]["id"]      = (int)$data["version"]["id"];                                                                                                                                       // Colorize: green
        $data["version"]["version"] = (int)$data["version"]["version"];                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $result->close();                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        include_files_for_app_version($link, $data, $app_version_id, $include_files);                                                                                                                    // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    function handle_get_for_app_id_and_latest_version($link, &$data, $app_id, $include_files)                                                                                                            // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        // Ignore PhpAlignmentVerifier [BEGIN]                                                                                                                                                           // Colorize: green
        $sql = "SELECT"                                                                                                                                                                                  // Colorize: green
            . "     id,"                                                                                                                                                                                 // Colorize: green
            . "     version,"                                                                                                                                                                            // Colorize: green
            . "     hash"                                                                                                                                                                                // Colorize: green
            . " FROM " . DB_TABLE_APP_VERSIONS                                                                                                                                                           // Colorize: green
            . " WHERE app_id    = '" . $link->real_escape_string($app_id) . "'"                                                                                                                          // Colorize: green
            . "   AND completed = '1'"                                                                                                                                                                   // Colorize: green
            . " ORDER BY version DESC"                                                                                                                                                                   // Colorize: green
            . " LIMIT 1";                                                                                                                                                                                // Colorize: green
        // Ignore PhpAlignmentVerifier [END]                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $result = $link->query($sql);                                                                                                                                                                    // Colorize: green
        die_if_sql_failed($result, $link, $data, $sql);                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if ($result->num_rows == 0)                                                                                                                                                                      // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            $result->close();                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            db_disconnect($link);                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            $data["message"] = "Version not found";                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            die(json_encode($data));                                                                                                                                                                     // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $data["version"]            = $result->fetch_assoc();                                                                                                                                            // Colorize: green
        $data["version"]["id"]      = (int)$data["version"]["id"];                                                                                                                                       // Colorize: green
        $data["version"]["version"] = (int)$data["version"]["version"];                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $result->close();                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        include_files_for_app_version($link, $data, $data["version"]["id"], $include_files);                                                                                                             // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    function handle_get_for_app_id_and_version($link, &$data, $app_id, $version, $include_files)                                                                                                         // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        $sql = "";                                                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (verify_version($version))                                                                                                                                                                    // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            // Ignore PhpAlignmentVerifier [BEGIN]                                                                                                                                                       // Colorize: green
            $sql = "SELECT"                                                                                                                                                                              // Colorize: green
                . "     id,"                                                                                                                                                                             // Colorize: green
                . "     version,"                                                                                                                                                                        // Colorize: green
                . "     hash"                                                                                                                                                                            // Colorize: green
                . " FROM " . DB_TABLE_APP_VERSIONS                                                                                                                                                       // Colorize: green
                . " WHERE app_id    = '" . $link->real_escape_string($app_id) . "'"                                                                                                                      // Colorize: green
                . "   AND version   = '" . $link->real_escape_string($version) . "'"                                                                                                                     // Colorize: green
                . "   AND completed = '1'";                                                                                                                                                              // Colorize: green
            // Ignore PhpAlignmentVerifier [END]                                                                                                                                                         // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
        else                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            // Ignore PhpAlignmentVerifier [BEGIN]                                                                                                                                                       // Colorize: green
            $sql = "SELECT"                                                                                                                                                                              // Colorize: green
                . "     id,"                                                                                                                                                                             // Colorize: green
                . "     version,"                                                                                                                                                                        // Colorize: green
                . "     hash"                                                                                                                                                                            // Colorize: green
                . " FROM " . DB_TABLE_APP_VERSIONS                                                                                                                                                       // Colorize: green
                . " WHERE app_id    =  '" . $link->real_escape_string($app_id) . "'"                                                                                                                     // Colorize: green
                . "   AND version   >= '" . $link->real_escape_string($version * 1000000) . "'"                                                                                                          // Colorize: green
                . "   AND version   <  '" . $link->real_escape_string(($version + 1) * 1000000) . "'"                                                                                                    // Colorize: green
                . "   AND completed =  '1'"                                                                                                                                                              // Colorize: green
                . " ORDER BY version DESC"                                                                                                                                                               // Colorize: green
                . " LIMIT 1";                                                                                                                                                                            // Colorize: green
            // Ignore PhpAlignmentVerifier [END]                                                                                                                                                         // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $result = $link->query($sql);                                                                                                                                                                    // Colorize: green
        die_if_sql_failed($result, $link, $data, $sql);                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if ($result->num_rows == 0)                                                                                                                                                                      // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            $result->close();                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            db_disconnect($link);                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            $data["message"] = "Version not found";                                                                                                                                                      // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            die(json_encode($data));                                                                                                                                                                     // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $data["version"]            = $result->fetch_assoc();                                                                                                                                            // Colorize: green
        $data["version"]["id"]      = (int)$data["version"]["id"];                                                                                                                                       // Colorize: green
        $data["version"]["version"] = (int)$data["version"]["version"];                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $result->close();                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        include_files_for_app_version($link, $data, $data["version"]["id"], $include_files);                                                                                                             // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    function handle_get_for_app_id($link, &$data, $app_id)                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        // Ignore PhpAlignmentVerifier [BEGIN]                                                                                                                                                           // Colorize: green
        $sql = "SELECT"                                                                                                                                                                                  // Colorize: green
            . "     id,"                                                                                                                                                                                 // Colorize: green
            . "     version,"                                                                                                                                                                            // Colorize: green
            . "     hash"                                                                                                                                                                                // Colorize: green
            . " FROM " . DB_TABLE_APP_VERSIONS                                                                                                                                                           // Colorize: green
            . " WHERE app_id    = '" . $link->real_escape_string($app_id) . "'"                                                                                                                          // Colorize: green
            . "   AND completed = '1'"                                                                                                                                                                   // Colorize: green
            . " ORDER BY version";                                                                                                                                                                       // Colorize: green
        // Ignore PhpAlignmentVerifier [END]                                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $result = $link->query($sql);                                                                                                                                                                    // Colorize: green
        die_if_sql_failed($result, $link, $data, $sql);                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $versions = [];                                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        while ($row = $result->fetch_assoc())                                                                                                                                                            // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            $version            = $row;                                                                                                                                                                  // Colorize: green
            $version["id"]      = (int)$version["id"];                                                                                                                                                   // Colorize: green
            $version["version"] = (int)$version["version"];                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            array_push($versions, $version);                                                                                                                                                             // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $result->close();                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $data["versions"] = $versions;                                                                                                                                                                   // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    function handle_get()                                                                                                                                                                                // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        header("Content-type: application/json");                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $data = [                                                                                                                                                                                        // Colorize: green
            "status" => "Failed"                                                                                                                                                                         // Colorize: green
        ];                                                                                                                                                                                               // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $app_version_id = @$_GET["id"];                                                                                                                                                                  // Colorize: green
        $app_id         = @$_GET["app_id"];                                                                                                                                                              // Colorize: green
        $codename       = @$_GET["codename"];                                                                                                                                                            // Colorize: green
        $version        = @$_GET["version"];                                                                                                                                                             // Colorize: green
        $include_files  = @$_GET["include_files"];                                                                                                                                                       // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if (isset($include_files))                                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            $include_files = ($include_files == "true");                                                                                                                                                 // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
        else                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            $include_files = true;                                                                                                                                                                       // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $link = db_connect();                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        if ($link)                                                                                                                                                                                       // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            if (isset($app_version_id))                                                                                                                                                                  // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                $app_version_id = (int)$app_version_id;                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                if (!verify_app_version_id($app_version_id))                                                                                                                                             // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    db_disconnect($link);                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    $data["message"] = "Invalid parameters";                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    die(json_encode($data));                                                                                                                                                             // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                handle_get_for_app_version_id($link, $data, $app_version_id, $include_files);                                                                                                            // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
            else                                                                                                                                                                                         // Colorize: green
            if (isset($app_id))                                                                                                                                                                          // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                $app_id = (int)$app_id;                                                                                                                                                                  // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                if (!verify_app_id($app_id))                                                                                                                                                             // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    db_disconnect($link);                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    $data["message"] = "Invalid parameters";                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    die(json_encode($data));                                                                                                                                                             // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                if (isset($version))                                                                                                                                                                     // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    if ($version == "latest")                                                                                                                                                            // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        handle_get_for_app_id_and_latest_version($link, $data, $app_id, $include_files);                                                                                                 // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                    else                                                                                                                                                                                 // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        $version = (int)$version;                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        if (                                                                                                                                                                             // Colorize: green
                            !verify_version_for_user($version)                                                                                                                                           // Colorize: green
                            &&                                                                                                                                                                           // Colorize: green
                            !verify_version($version)                                                                                                                                                    // Colorize: green
                           )                                                                                                                                                                             // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            db_disconnect($link);                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            $data["message"] = "Invalid parameters";                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            die(json_encode($data));                                                                                                                                                     // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        handle_get_for_app_id_and_version($link, $data, $app_id, $version, $include_files);                                                                                              // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    handle_get_for_app_id($link, $data, $app_id);                                                                                                                                        // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
            else                                                                                                                                                                                         // Colorize: green
            if (isset($codename))                                                                                                                                                                        // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                if (!verify_codename($codename))                                                                                                                                                         // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    db_disconnect($link);                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    $data["message"] = "Invalid parameters";                                                                                                                                             // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                    die(json_encode($data));                                                                                                                                                             // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                $app_id = get_app_id_for_codename($link, $data, $codename);                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                if (isset($version))                                                                                                                                                                     // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    if ($version == "latest")                                                                                                                                                            // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        handle_get_for_app_id_and_latest_version($link, $data, $app_id, $include_files);                                                                                                 // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                    else                                                                                                                                                                                 // Colorize: green
                    {                                                                                                                                                                                    // Colorize: green
                        $version = (int)$version;                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        if (                                                                                                                                                                             // Colorize: green
                            !verify_version_for_user($version)                                                                                                                                           // Colorize: green
                            &&                                                                                                                                                                           // Colorize: green
                            !verify_version($version)                                                                                                                                                    // Colorize: green
                           )                                                                                                                                                                             // Colorize: green
                        {                                                                                                                                                                                // Colorize: green
                            db_disconnect($link);                                                                                                                                                        // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            $data["message"] = "Invalid parameters";                                                                                                                                     // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                            die(json_encode($data));                                                                                                                                                     // Colorize: green
                        }                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                        handle_get_for_app_id_and_version($link, $data, $app_id, $version, $include_files);                                                                                              // Colorize: green
                    }                                                                                                                                                                                    // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
                else                                                                                                                                                                                     // Colorize: green
                {                                                                                                                                                                                        // Colorize: green
                    handle_get_for_app_id($link, $data, $app_id);                                                                                                                                        // Colorize: green
                }                                                                                                                                                                                        // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
            else                                                                                                                                                                                         // Colorize: green
            {                                                                                                                                                                                            // Colorize: green
                $data["message"] = "Invalid parameters";                                                                                                                                                 // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                die(json_encode($data));                                                                                                                                                                 // Colorize: green
            }                                                                                                                                                                                            // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            db_disconnect($link);                                                                                                                                                                        // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
        else                                                                                                                                                                                             // Colorize: green
        {                                                                                                                                                                                                // Colorize: green
            $data["message"] = "Database connection error";                                                                                                                                              // Colorize: green
                                                                                                                                                                                                         // Colorize: green
            die(json_encode($data));                                                                                                                                                                     // Colorize: green
        }                                                                                                                                                                                                // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
        $data["status"] = "OK";                                                                                                                                                                          // Colorize: green
        echo json_encode($data);                                                                                                                                                                         // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    function handle_post()                                                                                                                                                                               // Colorize: green
    {                                                                                                                                                                                                    // Colorize: green
        // Nothing                                                                                                                                                                                       // Colorize: green
    }                                                                                                                                                                                                    // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
                                                                                                                                                                                                         // Colorize: green
    handle_request();                                                                                                                                                                                    // Colorize: green
?>                                                                                                                                                                                                       // Colorize: green
